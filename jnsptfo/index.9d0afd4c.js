function e(e,t,n,i){Object.defineProperty(e,t,{get:n,set:i,enumerable:!0,configurable:!0})}function t(e){return e&&e.__esModule?e.default:e}var n="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},i={},r={},a=n.parcelRequire94c2;null==a&&((a=function(e){if(e in i)return i[e].exports;if(e in r){var t=r[e];delete r[e];var n={id:e,exports:{}};return i[e]=n,t.call(n.exports,n,n.exports),n.exports}var a=new Error("Cannot find module '"+e+"'");throw a.code="MODULE_NOT_FOUND",a}).register=function(e,t){r[e]=t},n.parcelRequire94c2=a),a.register("27Lyk",(function(t,n){var i,r;e(t.exports,"register",(()=>i),(e=>i=e)),e(t.exports,"resolve",(()=>r),(e=>r=e));var a={};i=function(e){for(var t=Object.keys(e),n=0;n<t.length;n++)a[t[n]]=e[t[n]]},r=function(e){var t=a[e];if(null==t)throw new Error("Could not resolve bundle with id "+e);return t}})),a("27Lyk").register(JSON.parse('{"izUj7":"index.9d0afd4c.js","fO4sz":"viridis.2c522adb.png","clFkl":"plasma.d28ab077.png","61uym":"reds.15cdaf4e.png","5zTxb":"oranges.df6fcf7a.png","hy8En":"browns.8fa167d6.png","ebDdH":"beige-pink.2e64d5ed.png","yBh7C":"light-gray.42201a06.png","9Pher":"blues.755b6c6c.png","9pFgq":"beige-gray.c5c85221.png","3xL7k":"purples.d270113d.png"}'));
/**
 * @license
 * Copyright 2010-2023 Three.js Authors
 * SPDX-License-Identifier: MIT
 */
const s="150",o=0,l=1,u=2,c=1,h=2,d=3,p=0,f=1,m=2,g=0,v=1,_=2,x=3,y=4,b=5,M=100,S=101,w=102,T=103,E=104,A=200,C=201,L=202,P=203,R=204,D=205,I=206,O=207,N=208,z=209,U=210,F=0,k=1,B=2,V=3,G=4,H=5,q=6,W=7,j=0,X=1,Y=2,J=0,Z=1,K=2,Q=3,$=4,ee=5,te=301,ne=302,ie=303,re=304,ae=306,se=1e3,oe=1001,le=1002,ue=1003,ce=1004,he=1005,de=1006,pe=1007,fe=1008,me=1009,ge=1010,ve=1011,_e=1012,xe=1013,ye=1014,be=1015,Me=1016,Se=1017,we=1018,Te=1020,Ee=1021,Ae=1023,Ce=1024,Le=1025,Pe=1026,Re=1027,De=1028,Ie=1029,Oe=1030,Ne=1031,ze=1033,Ue=33776,Fe=33777,ke=33778,Be=33779,Ve=35840,Ge=35841,He=35842,qe=35843,We=36196,je=37492,Xe=37496,Ye=37808,Je=37809,Ze=37810,Ke=37811,Qe=37812,$e=37813,et=37814,tt=37815,nt=37816,it=37817,rt=37818,at=37819,st=37820,ot=37821,lt=36492,ut=36283,ct=36284,ht=36285,dt=36286,pt=2300,ft=2301,mt=2302,gt=2400,vt=2401,_t=2402,xt=3e3,yt=3001,bt=3201,Mt=0,St=1,wt="srgb",Tt="srgb-linear",Et="display-p3",At=7680,Ct=35044,Lt="300 es",Pt=1035;class Rt{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const n=this._listeners[e];if(void 0!==n){const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const n=t.slice(0);for(let t=0,i=n.length;t<i;t++)n[t].call(this,e);e.target=null}}}const Dt=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];const It=Math.PI/180,Ot=180/Math.PI;function Nt(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(Dt[255&e]+Dt[e>>8&255]+Dt[e>>16&255]+Dt[e>>24&255]+"-"+Dt[255&t]+Dt[t>>8&255]+"-"+Dt[t>>16&15|64]+Dt[t>>24&255]+"-"+Dt[63&n|128]+Dt[n>>8&255]+"-"+Dt[n>>16&255]+Dt[n>>24&255]+Dt[255&i]+Dt[i>>8&255]+Dt[i>>16&255]+Dt[i>>24&255]).toLowerCase()}function zt(e,t,n){return Math.max(t,Math.min(n,e))}function Ut(e,t){return(e%t+t)%t}function Ft(e,t,n){return(1-n)*e+n*t}function kt(e){return 0==(e&e-1)&&0!==e}function Bt(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function Vt(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function Gt(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw new Error("Invalid component type.")}}class Ht{constructor(e=0,t=0){Ht.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),i=Math.sin(t),r=this.x-e.x,a=this.y-e.y;return this.x=r*n-a*i+e.x,this.y=r*i+a*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class qt{constructor(){qt.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(e,t,n,i,r,a,s,o,l){const u=this.elements;return u[0]=e,u[1]=i,u[2]=s,u[3]=t,u[4]=r,u[5]=o,u[6]=n,u[7]=a,u[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,r=this.elements,a=n[0],s=n[3],o=n[6],l=n[1],u=n[4],c=n[7],h=n[2],d=n[5],p=n[8],f=i[0],m=i[3],g=i[6],v=i[1],_=i[4],x=i[7],y=i[2],b=i[5],M=i[8];return r[0]=a*f+s*v+o*y,r[3]=a*m+s*_+o*b,r[6]=a*g+s*x+o*M,r[1]=l*f+u*v+c*y,r[4]=l*m+u*_+c*b,r[7]=l*g+u*x+c*M,r[2]=h*f+d*v+p*y,r[5]=h*m+d*_+p*b,r[8]=h*g+d*x+p*M,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],a=e[4],s=e[5],o=e[6],l=e[7],u=e[8];return t*a*u-t*s*l-n*r*u+n*s*o+i*r*l-i*a*o}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],a=e[4],s=e[5],o=e[6],l=e[7],u=e[8],c=u*a-s*l,h=s*o-u*r,d=l*r-a*o,p=t*c+n*h+i*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const f=1/p;return e[0]=c*f,e[1]=(i*l-u*n)*f,e[2]=(s*n-i*a)*f,e[3]=h*f,e[4]=(u*t-i*o)*f,e[5]=(i*r-s*t)*f,e[6]=d*f,e[7]=(n*o-l*t)*f,e[8]=(a*t-n*r)*f,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,i,r,a,s){const o=Math.cos(r),l=Math.sin(r);return this.set(n*o,n*l,-n*(o*a+l*s)+a+e,-i*l,i*o,-i*(-l*a+o*s)+s+t,0,0,1),this}scale(e,t){return this.premultiply(Wt.makeScale(e,t)),this}rotate(e){return this.premultiply(Wt.makeRotation(-e)),this}translate(e,t){return this.premultiply(Wt.makeTranslation(e,t)),this}makeTranslation(e,t){return this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let e=0;e<9;e++)if(t[e]!==n[e])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}const Wt=new qt;function jt(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array;function Xt(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}class Yt{constructor(e=0,t=0,n=0,i=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=i}static slerpFlat(e,t,n,i,r,a,s){let o=n[i+0],l=n[i+1],u=n[i+2],c=n[i+3];const h=r[a+0],d=r[a+1],p=r[a+2],f=r[a+3];if(0===s)return e[t+0]=o,e[t+1]=l,e[t+2]=u,void(e[t+3]=c);if(1===s)return e[t+0]=h,e[t+1]=d,e[t+2]=p,void(e[t+3]=f);if(c!==f||o!==h||l!==d||u!==p){let e=1-s;const t=o*h+l*d+u*p+c*f,n=t>=0?1:-1,i=1-t*t;if(i>Number.EPSILON){const r=Math.sqrt(i),a=Math.atan2(r,t*n);e=Math.sin(e*a)/r,s=Math.sin(s*a)/r}const r=s*n;if(o=o*e+h*r,l=l*e+d*r,u=u*e+p*r,c=c*e+f*r,e===1-s){const e=1/Math.sqrt(o*o+l*l+u*u+c*c);o*=e,l*=e,u*=e,c*=e}}e[t]=o,e[t+1]=l,e[t+2]=u,e[t+3]=c}static multiplyQuaternionsFlat(e,t,n,i,r,a){const s=n[i],o=n[i+1],l=n[i+2],u=n[i+3],c=r[a],h=r[a+1],d=r[a+2],p=r[a+3];return e[t]=s*p+u*c+o*d-l*h,e[t+1]=o*p+u*h+l*c-s*d,e[t+2]=l*p+u*d+s*h-o*c,e[t+3]=u*p-s*c-o*h-l*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){const n=e._x,i=e._y,r=e._z,a=e._order,s=Math.cos,o=Math.sin,l=s(n/2),u=s(i/2),c=s(r/2),h=o(n/2),d=o(i/2),p=o(r/2);switch(a){case"XYZ":this._x=h*u*c+l*d*p,this._y=l*d*c-h*u*p,this._z=l*u*p+h*d*c,this._w=l*u*c-h*d*p;break;case"YXZ":this._x=h*u*c+l*d*p,this._y=l*d*c-h*u*p,this._z=l*u*p-h*d*c,this._w=l*u*c+h*d*p;break;case"ZXY":this._x=h*u*c-l*d*p,this._y=l*d*c+h*u*p,this._z=l*u*p+h*d*c,this._w=l*u*c-h*d*p;break;case"ZYX":this._x=h*u*c-l*d*p,this._y=l*d*c+h*u*p,this._z=l*u*p-h*d*c,this._w=l*u*c+h*d*p;break;case"YZX":this._x=h*u*c+l*d*p,this._y=l*d*c+h*u*p,this._z=l*u*p-h*d*c,this._w=l*u*c-h*d*p;break;case"XZY":this._x=h*u*c-l*d*p,this._y=l*d*c-h*u*p,this._z=l*u*p+h*d*c,this._w=l*u*c+h*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],i=t[4],r=t[8],a=t[1],s=t[5],o=t[9],l=t[2],u=t[6],c=t[10],h=n+s+c;if(h>0){const e=.5/Math.sqrt(h+1);this._w=.25/e,this._x=(u-o)*e,this._y=(r-l)*e,this._z=(a-i)*e}else if(n>s&&n>c){const e=2*Math.sqrt(1+n-s-c);this._w=(u-o)/e,this._x=.25*e,this._y=(i+a)/e,this._z=(r+l)/e}else if(s>c){const e=2*Math.sqrt(1+s-n-c);this._w=(r-l)/e,this._x=(i+a)/e,this._y=.25*e,this._z=(o+u)/e}else{const e=2*Math.sqrt(1+c-n-s);this._w=(a-i)/e,this._x=(r+l)/e,this._y=(o+u)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(zt(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(0===n)return this;const i=Math.min(1,t/n);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,i=e._y,r=e._z,a=e._w,s=t._x,o=t._y,l=t._z,u=t._w;return this._x=n*u+a*s+i*l-r*o,this._y=i*u+a*o+r*s-n*l,this._z=r*u+a*l+n*o-i*s,this._w=a*u-n*s-i*o-r*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const n=this._x,i=this._y,r=this._z,a=this._w;let s=a*e._w+n*e._x+i*e._y+r*e._z;if(s<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,s=-s):this.copy(e),s>=1)return this._w=a,this._x=n,this._y=i,this._z=r,this;const o=1-s*s;if(o<=Number.EPSILON){const e=1-t;return this._w=e*a+t*this._w,this._x=e*n+t*this._x,this._y=e*i+t*this._y,this._z=e*r+t*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(o),u=Math.atan2(l,s),c=Math.sin((1-t)*u)/l,h=Math.sin(t*u)/l;return this._w=a*c+this._w*h,this._x=n*c+this._x*h,this._y=i*c+this._y*h,this._z=r*c+this._z*h,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=Math.random(),t=Math.sqrt(1-e),n=Math.sqrt(e),i=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(t*Math.cos(i),n*Math.sin(r),n*Math.cos(r),t*Math.sin(i))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Jt{constructor(e=0,t=0,n=0){Jt.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(Kt.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(Kt.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*i,this.y=r[1]*t+r[4]*n+r[7]*i,this.z=r[2]*t+r[5]*n+r[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,r=e.elements,a=1/(r[3]*t+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*t+r[4]*n+r[8]*i+r[12])*a,this.y=(r[1]*t+r[5]*n+r[9]*i+r[13])*a,this.z=(r[2]*t+r[6]*n+r[10]*i+r[14])*a,this}applyQuaternion(e){const t=this.x,n=this.y,i=this.z,r=e.x,a=e.y,s=e.z,o=e.w,l=o*t+a*i-s*n,u=o*n+s*t-r*i,c=o*i+r*n-a*t,h=-r*t-a*n-s*i;return this.x=l*o+h*-r+u*-s-c*-a,this.y=u*o+h*-a+c*-r-l*-s,this.z=c*o+h*-s+l*-a-u*-r,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*i,this.y=r[1]*t+r[5]*n+r[9]*i,this.z=r[2]*t+r[6]*n+r[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,i=e.y,r=e.z,a=t.x,s=t.y,o=t.z;return this.x=i*o-r*s,this.y=r*a-n*o,this.z=n*s-i*a,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return Zt.copy(this).projectOnVector(e),this.sub(Zt)}reflect(e){return this.sub(Zt.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(zt(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,n=Math.sqrt(1-e**2);return this.x=n*Math.cos(t),this.y=n*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Zt=new Jt,Kt=new Yt;function Qt(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function $t(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}const tn=(new qt).fromArray([.8224621,.0331941,.0170827,.177538,.9668058,.0723974,-1e-7,1e-7,.9105199]),nn=(new qt).fromArray([1.2249401,-.0420569,-.0196376,-.2249404,1.0420571,-.0786361,1e-7,0,1.0982735]),rn=new Jt;const an={[Tt]:e=>e,[wt]:e=>e.convertSRGBToLinear(),[Et]:function(e){return e.convertSRGBToLinear(),rn.set(e.r,e.g,e.b).applyMatrix3(nn),e.setRGB(rn.x,rn.y,rn.z)}},sn={[Tt]:e=>e,[wt]:e=>e.convertLinearToSRGB(),[Et]:function(e){return rn.set(e.r,e.g,e.b).applyMatrix3(tn),e.setRGB(rn.x,rn.y,rn.z).convertLinearToSRGB()}},on={enabled:!1,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(e){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!e},get workingColorSpace(){return Tt},set workingColorSpace(e){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(e,t,n){if(!1===this.enabled||t===n||!t||!n)return e;const i=an[t],r=sn[n];if(void 0===i||void 0===r)throw new Error(`Unsupported color space conversion, "${t}" to "${n}".`);return r(i(e))},fromWorkingColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this.workingColorSpace)}};let ln;class un{static getDataURL(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===ln&&(ln=Xt("canvas")),ln.width=e.width,ln.height=e.height;const n=ln.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=ln}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const t=Xt("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const i=n.getImageData(0,0,e.width,e.height),r=i.data;for(let e=0;e<r.length;e++)r[e]=255*Qt(r[e]/255);return n.putImageData(i,0,0),t}if(e.data){const t=e.data.slice(0);for(let e=0;e<t.length;e++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[e]=Math.floor(255*Qt(t[e]/255)):t[e]=Qt(t[e]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}class cn{constructor(e=null){this.isSource=!0,this.uuid=Nt(),this.data=e,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];const n={uuid:this.uuid,url:""},i=this.data;if(null!==i){let e;if(Array.isArray(i)){e=[];for(let t=0,n=i.length;t<n;t++)i[t].isDataTexture?e.push(hn(i[t].image)):e.push(hn(i[t]))}else e=hn(i);n.url=e}return t||(e.images[this.uuid]=n),n}}function hn(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?un.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let dn=0;class pn extends Rt{constructor(e=pn.DEFAULT_IMAGE,t=pn.DEFAULT_MAPPING,n=oe,i=oe,r=de,a=fe,s=Ae,o=me,l=pn.DEFAULT_ANISOTROPY,u=xt){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:dn++}),this.uuid=Nt(),this.name="",this.source=new cn(e),this.mipmaps=[],this.mapping=t,this.wrapS=n,this.wrapT=i,this.magFilter=r,this.minFilter=a,this.anisotropy=l,this.format=s,this.internalFormat=null,this.type=o,this.offset=new Ht(0,0),this.repeat=new Ht(1,1),this.center=new Ht(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new qt,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=u,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case se:e.x=e.x-Math.floor(e.x);break;case oe:e.x=e.x<0?0:1;break;case le:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case se:e.y=e.y-Math.floor(e.y);break;case oe:e.y=e.y<0?0:1;break;case le:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}}pn.DEFAULT_IMAGE=null,pn.DEFAULT_MAPPING=300,pn.DEFAULT_ANISOTROPY=1;class fn{constructor(e=0,t=0,n=0,i=1){fn.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,r=this.w,a=e.elements;return this.x=a[0]*t+a[4]*n+a[8]*i+a[12]*r,this.y=a[1]*t+a[5]*n+a[9]*i+a[13]*r,this.z=a[2]*t+a[6]*n+a[10]*i+a[14]*r,this.w=a[3]*t+a[7]*n+a[11]*i+a[15]*r,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,i,r;const a=.01,s=.1,o=e.elements,l=o[0],u=o[4],c=o[8],h=o[1],d=o[5],p=o[9],f=o[2],m=o[6],g=o[10];if(Math.abs(u-h)<a&&Math.abs(c-f)<a&&Math.abs(p-m)<a){if(Math.abs(u+h)<s&&Math.abs(c+f)<s&&Math.abs(p+m)<s&&Math.abs(l+d+g-3)<s)return this.set(1,0,0,0),this;t=Math.PI;const e=(l+1)/2,o=(d+1)/2,v=(g+1)/2,_=(u+h)/4,x=(c+f)/4,y=(p+m)/4;return e>o&&e>v?e<a?(n=0,i=.707106781,r=.707106781):(n=Math.sqrt(e),i=_/n,r=x/n):o>v?o<a?(n=.707106781,i=0,r=.707106781):(i=Math.sqrt(o),n=_/i,r=y/i):v<a?(n=.707106781,i=.707106781,r=0):(r=Math.sqrt(v),n=x/r,i=y/r),this.set(n,i,r,t),this}let v=Math.sqrt((m-p)*(m-p)+(c-f)*(c-f)+(h-u)*(h-u));return Math.abs(v)<.001&&(v=1),this.x=(m-p)/v,this.y=(c-f)/v,this.z=(h-u)/v,this.w=Math.acos((l+d+g-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class mn extends Rt{constructor(e=1,t=1,n={}){super(),this.isWebGLRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new fn(0,0,e,t),this.scissorTest=!1,this.viewport=new fn(0,0,e,t);const i={width:e,height:t,depth:1};this.texture=new pn(i,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=void 0!==n.generateMipmaps&&n.generateMipmaps,this.texture.internalFormat=void 0!==n.internalFormat?n.internalFormat:null,this.texture.minFilter=void 0!==n.minFilter?n.minFilter:de,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0!==n.stencilBuffer&&n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null,this.samples=void 0!==n.samples?n.samples:0}setSize(e,t,n=1){this.width===e&&this.height===t&&this.depth===n||(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new cn(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class gn extends pn{constructor(e=null,t=1,n=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=ue,this.minFilter=ue,this.wrapR=oe,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class vn extends pn{constructor(e=null,t=1,n=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=ue,this.minFilter=ue,this.wrapR=oe,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class _n{constructor(e=new Jt(1/0,1/0,1/0),t=new Jt(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,n=1/0,i=1/0,r=-1/0,a=-1/0,s=-1/0;for(let o=0,l=e.length;o<l;o+=3){const l=e[o],u=e[o+1],c=e[o+2];l<t&&(t=l),u<n&&(n=u),c<i&&(i=c),l>r&&(r=l),u>a&&(a=u),c>s&&(s=c)}return this.min.set(t,n,i),this.max.set(r,a,s),this}setFromBufferAttribute(e){let t=1/0,n=1/0,i=1/0,r=-1/0,a=-1/0,s=-1/0;for(let o=0,l=e.count;o<l;o++){const l=e.getX(o),u=e.getY(o),c=e.getZ(o);l<t&&(t=l),u<n&&(n=u),c<i&&(i=c),l>r&&(r=l),u>a&&(a=u),c>s&&(s=c)}return this.min.set(t,n,i),this.max.set(r,a,s),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=yn.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(void 0!==n)if(t&&null!=n.attributes&&void 0!==n.attributes.position){const t=n.attributes.position;for(let n=0,i=t.count;n<i;n++)yn.fromBufferAttribute(t,n).applyMatrix4(e.matrixWorld),this.expandByPoint(yn)}else null===n.boundingBox&&n.computeBoundingBox(),bn.copy(n.boundingBox),bn.applyMatrix4(e.matrixWorld),this.union(bn);const i=e.children;for(let e=0,n=i.length;e<n;e++)this.expandByObject(i[e],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,yn),yn.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Cn),Ln.subVectors(this.max,Cn),Mn.subVectors(e.a,Cn),Sn.subVectors(e.b,Cn),wn.subVectors(e.c,Cn),Tn.subVectors(Sn,Mn),En.subVectors(wn,Sn),An.subVectors(Mn,wn);let t=[0,-Tn.z,Tn.y,0,-En.z,En.y,0,-An.z,An.y,Tn.z,0,-Tn.x,En.z,0,-En.x,An.z,0,-An.x,-Tn.y,Tn.x,0,-En.y,En.x,0,-An.y,An.x,0];return!!Dn(t,Mn,Sn,wn,Ln)&&(t=[1,0,0,0,1,0,0,0,1],!!Dn(t,Mn,Sn,wn,Ln)&&(Pn.crossVectors(Tn,En),t=[Pn.x,Pn.y,Pn.z],Dn(t,Mn,Sn,wn,Ln)))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,yn).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=.5*this.getSize(yn).length()),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(xn[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),xn[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),xn[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),xn[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),xn[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),xn[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),xn[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),xn[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(xn)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const xn=[new Jt,new Jt,new Jt,new Jt,new Jt,new Jt,new Jt,new Jt],yn=new Jt,bn=new _n,Mn=new Jt,Sn=new Jt,wn=new Jt,Tn=new Jt,En=new Jt,An=new Jt,Cn=new Jt,Ln=new Jt,Pn=new Jt,Rn=new Jt;function Dn(e,t,n,i,r){for(let a=0,s=e.length-3;a<=s;a+=3){Rn.fromArray(e,a);const s=r.x*Math.abs(Rn.x)+r.y*Math.abs(Rn.y)+r.z*Math.abs(Rn.z),o=t.dot(Rn),l=n.dot(Rn),u=i.dot(Rn);if(Math.max(-Math.max(o,l,u),Math.min(o,l,u))>s)return!1}return!0}const In=new _n,On=new Jt,Nn=new Jt;class zn{constructor(e=new Jt,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;void 0!==t?n.copy(t):In.setFromPoints(e).getCenter(n);let i=0;for(let t=0,r=e.length;t<r;t++)i=Math.max(i,n.distanceToSquared(e[t]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;On.subVectors(e,this.center);const t=On.lengthSq();if(t>this.radius*this.radius){const e=Math.sqrt(t),n=.5*(e-this.radius);this.center.addScaledVector(On,n/e),this.radius+=n}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(!0===this.center.equals(e.center)?this.radius=Math.max(this.radius,e.radius):(Nn.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(On.copy(e.center).add(Nn)),this.expandByPoint(On.copy(e.center).sub(Nn))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const Un=new Jt,Fn=new Jt,kn=new Jt,Bn=new Jt,Vn=new Jt,Gn=new Jt,Hn=new Jt;class qn{constructor(e=new Jt,t=new Jt(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Un)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Un.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Un.copy(this.origin).addScaledVector(this.direction,t),Un.distanceToSquared(e))}distanceSqToSegment(e,t,n,i){Fn.copy(e).add(t).multiplyScalar(.5),kn.copy(t).sub(e).normalize(),Bn.copy(this.origin).sub(Fn);const r=.5*e.distanceTo(t),a=-this.direction.dot(kn),s=Bn.dot(this.direction),o=-Bn.dot(kn),l=Bn.lengthSq(),u=Math.abs(1-a*a);let c,h,d,p;if(u>0)if(c=a*o-s,h=a*s-o,p=r*u,c>=0)if(h>=-p)if(h<=p){const e=1/u;c*=e,h*=e,d=c*(c+a*h+2*s)+h*(a*c+h+2*o)+l}else h=r,c=Math.max(0,-(a*h+s)),d=-c*c+h*(h+2*o)+l;else h=-r,c=Math.max(0,-(a*h+s)),d=-c*c+h*(h+2*o)+l;else h<=-p?(c=Math.max(0,-(-a*r+s)),h=c>0?-r:Math.min(Math.max(-r,-o),r),d=-c*c+h*(h+2*o)+l):h<=p?(c=0,h=Math.min(Math.max(-r,-o),r),d=h*(h+2*o)+l):(c=Math.max(0,-(a*r+s)),h=c>0?r:Math.min(Math.max(-r,-o),r),d=-c*c+h*(h+2*o)+l);else h=a>0?-r:r,c=Math.max(0,-(a*h+s)),d=-c*c+h*(h+2*o)+l;return n&&n.copy(this.origin).addScaledVector(this.direction,c),i&&i.copy(Fn).addScaledVector(kn,h),d}intersectSphere(e,t){Un.subVectors(e.center,this.origin);const n=Un.dot(this.direction),i=Un.dot(Un)-n*n,r=e.radius*e.radius;if(i>r)return null;const a=Math.sqrt(r-i),s=n-a,o=n+a;return o<0?null:s<0?this.at(o,t):this.at(s,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);if(0===t)return!0;return e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,i,r,a,s,o;const l=1/this.direction.x,u=1/this.direction.y,c=1/this.direction.z,h=this.origin;return l>=0?(n=(e.min.x-h.x)*l,i=(e.max.x-h.x)*l):(n=(e.max.x-h.x)*l,i=(e.min.x-h.x)*l),u>=0?(r=(e.min.y-h.y)*u,a=(e.max.y-h.y)*u):(r=(e.max.y-h.y)*u,a=(e.min.y-h.y)*u),n>a||r>i?null:((r>n||isNaN(n))&&(n=r),(a<i||isNaN(i))&&(i=a),c>=0?(s=(e.min.z-h.z)*c,o=(e.max.z-h.z)*c):(s=(e.max.z-h.z)*c,o=(e.min.z-h.z)*c),n>o||s>i?null:((s>n||n!=n)&&(n=s),(o<i||i!=i)&&(i=o),i<0?null:this.at(n>=0?n:i,t)))}intersectsBox(e){return null!==this.intersectBox(e,Un)}intersectTriangle(e,t,n,i,r){Vn.subVectors(t,e),Gn.subVectors(n,e),Hn.crossVectors(Vn,Gn);let a,s=this.direction.dot(Hn);if(s>0){if(i)return null;a=1}else{if(!(s<0))return null;a=-1,s=-s}Bn.subVectors(this.origin,e);const o=a*this.direction.dot(Gn.crossVectors(Bn,Gn));if(o<0)return null;const l=a*this.direction.dot(Vn.cross(Bn));if(l<0)return null;if(o+l>s)return null;const u=-a*Bn.dot(Hn);return u<0?null:this.at(u/s,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class Wn{constructor(){Wn.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(e,t,n,i,r,a,s,o,l,u,c,h,d,p,f,m){const g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=i,g[1]=r,g[5]=a,g[9]=s,g[13]=o,g[2]=l,g[6]=u,g[10]=c,g[14]=h,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Wn).fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,i=1/jn.setFromMatrixColumn(e,0).length(),r=1/jn.setFromMatrixColumn(e,1).length(),a=1/jn.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*r,t[5]=n[5]*r,t[6]=n[6]*r,t[7]=0,t[8]=n[8]*a,t[9]=n[9]*a,t[10]=n[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,i=e.y,r=e.z,a=Math.cos(n),s=Math.sin(n),o=Math.cos(i),l=Math.sin(i),u=Math.cos(r),c=Math.sin(r);if("XYZ"===e.order){const e=a*u,n=a*c,i=s*u,r=s*c;t[0]=o*u,t[4]=-o*c,t[8]=l,t[1]=n+i*l,t[5]=e-r*l,t[9]=-s*o,t[2]=r-e*l,t[6]=i+n*l,t[10]=a*o}else if("YXZ"===e.order){const e=o*u,n=o*c,i=l*u,r=l*c;t[0]=e+r*s,t[4]=i*s-n,t[8]=a*l,t[1]=a*c,t[5]=a*u,t[9]=-s,t[2]=n*s-i,t[6]=r+e*s,t[10]=a*o}else if("ZXY"===e.order){const e=o*u,n=o*c,i=l*u,r=l*c;t[0]=e-r*s,t[4]=-a*c,t[8]=i+n*s,t[1]=n+i*s,t[5]=a*u,t[9]=r-e*s,t[2]=-a*l,t[6]=s,t[10]=a*o}else if("ZYX"===e.order){const e=a*u,n=a*c,i=s*u,r=s*c;t[0]=o*u,t[4]=i*l-n,t[8]=e*l+r,t[1]=o*c,t[5]=r*l+e,t[9]=n*l-i,t[2]=-l,t[6]=s*o,t[10]=a*o}else if("YZX"===e.order){const e=a*o,n=a*l,i=s*o,r=s*l;t[0]=o*u,t[4]=r-e*c,t[8]=i*c+n,t[1]=c,t[5]=a*u,t[9]=-s*u,t[2]=-l*u,t[6]=n*c+i,t[10]=e-r*c}else if("XZY"===e.order){const e=a*o,n=a*l,i=s*o,r=s*l;t[0]=o*u,t[4]=-c,t[8]=l*u,t[1]=e*c+r,t[5]=a*u,t[9]=n*c-i,t[2]=i*c-n,t[6]=s*u,t[10]=r*c+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(Yn,e,Jn)}lookAt(e,t,n){const i=this.elements;return Qn.subVectors(e,t),0===Qn.lengthSq()&&(Qn.z=1),Qn.normalize(),Zn.crossVectors(n,Qn),0===Zn.lengthSq()&&(1===Math.abs(n.z)?Qn.x+=1e-4:Qn.z+=1e-4,Qn.normalize(),Zn.crossVectors(n,Qn)),Zn.normalize(),Kn.crossVectors(Qn,Zn),i[0]=Zn.x,i[4]=Kn.x,i[8]=Qn.x,i[1]=Zn.y,i[5]=Kn.y,i[9]=Qn.y,i[2]=Zn.z,i[6]=Kn.z,i[10]=Qn.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,r=this.elements,a=n[0],s=n[4],o=n[8],l=n[12],u=n[1],c=n[5],h=n[9],d=n[13],p=n[2],f=n[6],m=n[10],g=n[14],v=n[3],_=n[7],x=n[11],y=n[15],b=i[0],M=i[4],S=i[8],w=i[12],T=i[1],E=i[5],A=i[9],C=i[13],L=i[2],P=i[6],R=i[10],D=i[14],I=i[3],O=i[7],N=i[11],z=i[15];return r[0]=a*b+s*T+o*L+l*I,r[4]=a*M+s*E+o*P+l*O,r[8]=a*S+s*A+o*R+l*N,r[12]=a*w+s*C+o*D+l*z,r[1]=u*b+c*T+h*L+d*I,r[5]=u*M+c*E+h*P+d*O,r[9]=u*S+c*A+h*R+d*N,r[13]=u*w+c*C+h*D+d*z,r[2]=p*b+f*T+m*L+g*I,r[6]=p*M+f*E+m*P+g*O,r[10]=p*S+f*A+m*R+g*N,r[14]=p*w+f*C+m*D+g*z,r[3]=v*b+_*T+x*L+y*I,r[7]=v*M+_*E+x*P+y*O,r[11]=v*S+_*A+x*R+y*N,r[15]=v*w+_*C+x*D+y*z,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],i=e[8],r=e[12],a=e[1],s=e[5],o=e[9],l=e[13],u=e[2],c=e[6],h=e[10],d=e[14];return e[3]*(+r*o*c-i*l*c-r*s*h+n*l*h+i*s*d-n*o*d)+e[7]*(+t*o*d-t*l*h+r*a*h-i*a*d+i*l*u-r*o*u)+e[11]*(+t*l*c-t*s*d-r*a*c+n*a*d+r*s*u-n*l*u)+e[15]*(-i*s*u-t*o*c+t*s*h+i*a*c-n*a*h+n*o*u)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],a=e[4],s=e[5],o=e[6],l=e[7],u=e[8],c=e[9],h=e[10],d=e[11],p=e[12],f=e[13],m=e[14],g=e[15],v=c*m*l-f*h*l+f*o*d-s*m*d-c*o*g+s*h*g,_=p*h*l-u*m*l-p*o*d+a*m*d+u*o*g-a*h*g,x=u*f*l-p*c*l+p*s*d-a*f*d-u*s*g+a*c*g,y=p*c*o-u*f*o-p*s*h+a*f*h+u*s*m-a*c*m,b=t*v+n*_+i*x+r*y;if(0===b)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const M=1/b;return e[0]=v*M,e[1]=(f*h*r-c*m*r-f*i*d+n*m*d+c*i*g-n*h*g)*M,e[2]=(s*m*r-f*o*r+f*i*l-n*m*l-s*i*g+n*o*g)*M,e[3]=(c*o*r-s*h*r-c*i*l+n*h*l+s*i*d-n*o*d)*M,e[4]=_*M,e[5]=(u*m*r-p*h*r+p*i*d-t*m*d-u*i*g+t*h*g)*M,e[6]=(p*o*r-a*m*r-p*i*l+t*m*l+a*i*g-t*o*g)*M,e[7]=(a*h*r-u*o*r+u*i*l-t*h*l-a*i*d+t*o*d)*M,e[8]=x*M,e[9]=(p*c*r-u*f*r-p*n*d+t*f*d+u*n*g-t*c*g)*M,e[10]=(a*f*r-p*s*r+p*n*l-t*f*l-a*n*g+t*s*g)*M,e[11]=(u*s*r-a*c*r-u*n*l+t*c*l+a*n*d-t*s*d)*M,e[12]=y*M,e[13]=(u*f*i-p*c*i+p*n*h-t*f*h-u*n*m+t*c*m)*M,e[14]=(p*s*i-a*f*i-p*n*o+t*f*o+a*n*m-t*s*m)*M,e[15]=(a*c*i-u*s*i+u*n*o-t*c*o-a*n*h+t*s*h)*M,this}scale(e){const t=this.elements,n=e.x,i=e.y,r=e.z;return t[0]*=n,t[4]*=i,t[8]*=r,t[1]*=n,t[5]*=i,t[9]*=r,t[2]*=n,t[6]*=i,t[10]*=r,t[3]*=n,t[7]*=i,t[11]*=r,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,i))}makeTranslation(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),i=Math.sin(t),r=1-n,a=e.x,s=e.y,o=e.z,l=r*a,u=r*s;return this.set(l*a+n,l*s-i*o,l*o+i*s,0,l*s+i*o,u*s+n,u*o-i*a,0,l*o-i*s,u*o+i*a,r*o*o+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,i,r,a){return this.set(1,n,r,0,e,1,a,0,t,i,1,0,0,0,0,1),this}compose(e,t,n){const i=this.elements,r=t._x,a=t._y,s=t._z,o=t._w,l=r+r,u=a+a,c=s+s,h=r*l,d=r*u,p=r*c,f=a*u,m=a*c,g=s*c,v=o*l,_=o*u,x=o*c,y=n.x,b=n.y,M=n.z;return i[0]=(1-(f+g))*y,i[1]=(d+x)*y,i[2]=(p-_)*y,i[3]=0,i[4]=(d-x)*b,i[5]=(1-(h+g))*b,i[6]=(m+v)*b,i[7]=0,i[8]=(p+_)*M,i[9]=(m-v)*M,i[10]=(1-(h+f))*M,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,n){const i=this.elements;let r=jn.set(i[0],i[1],i[2]).length();const a=jn.set(i[4],i[5],i[6]).length(),s=jn.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),e.x=i[12],e.y=i[13],e.z=i[14],Xn.copy(this);const o=1/r,l=1/a,u=1/s;return Xn.elements[0]*=o,Xn.elements[1]*=o,Xn.elements[2]*=o,Xn.elements[4]*=l,Xn.elements[5]*=l,Xn.elements[6]*=l,Xn.elements[8]*=u,Xn.elements[9]*=u,Xn.elements[10]*=u,t.setFromRotationMatrix(Xn),n.x=r,n.y=a,n.z=s,this}makePerspective(e,t,n,i,r,a){const s=this.elements,o=2*r/(t-e),l=2*r/(n-i),u=(t+e)/(t-e),c=(n+i)/(n-i),h=-(a+r)/(a-r),d=-2*a*r/(a-r);return s[0]=o,s[4]=0,s[8]=u,s[12]=0,s[1]=0,s[5]=l,s[9]=c,s[13]=0,s[2]=0,s[6]=0,s[10]=h,s[14]=d,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this}makeOrthographic(e,t,n,i,r,a){const s=this.elements,o=1/(t-e),l=1/(n-i),u=1/(a-r),c=(t+e)*o,h=(n+i)*l,d=(a+r)*u;return s[0]=2*o,s[4]=0,s[8]=0,s[12]=-c,s[1]=0,s[5]=2*l,s[9]=0,s[13]=-h,s[2]=0,s[6]=0,s[10]=-2*u,s[14]=-d,s[3]=0,s[7]=0,s[11]=0,s[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let e=0;e<16;e++)if(t[e]!==n[e])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const jn=new Jt,Xn=new Wn,Yn=new Jt(0,0,0),Jn=new Jt(1,1,1),Zn=new Jt,Kn=new Jt,Qn=new Jt,$n=new Wn,ei=new Yt;class ti{constructor(e=0,t=0,n=0,i=ti.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,i=this._order){return this._x=e,this._y=t,this._z=n,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const i=e.elements,r=i[0],a=i[4],s=i[8],o=i[1],l=i[5],u=i[9],c=i[2],h=i[6],d=i[10];switch(t){case"XYZ":this._y=Math.asin(zt(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-u,d),this._z=Math.atan2(-a,r)):(this._x=Math.atan2(h,l),this._z=0);break;case"YXZ":this._x=Math.asin(-zt(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(s,d),this._z=Math.atan2(o,l)):(this._y=Math.atan2(-c,r),this._z=0);break;case"ZXY":this._x=Math.asin(zt(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-c,d),this._z=Math.atan2(-a,l)):(this._y=0,this._z=Math.atan2(o,r));break;case"ZYX":this._y=Math.asin(-zt(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(h,d),this._z=Math.atan2(o,r)):(this._x=0,this._z=Math.atan2(-a,l));break;case"YZX":this._z=Math.asin(zt(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-u,l),this._y=Math.atan2(-c,r)):(this._x=0,this._y=Math.atan2(s,d));break;case"XZY":this._z=Math.asin(-zt(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(h,l),this._y=Math.atan2(s,r)):(this._x=Math.atan2(-u,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===n&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return $n.makeRotationFromQuaternion(e),this.setFromRotationMatrix($n,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return ei.setFromEuler(this),this.setFromQuaternion(ei,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}ti.DEFAULT_ORDER="XYZ";class ni{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return 0!=(this.mask&e.mask)}isEnabled(e){return 0!=(this.mask&(1<<e|0))}}let ii=0;const ri=new Jt,ai=new Yt,si=new Wn,oi=new Jt,li=new Jt,ui=new Jt,ci=new Yt,hi=new Jt(1,0,0),di=new Jt(0,1,0),pi=new Jt(0,0,1),fi={type:"added"},mi={type:"removed"};class gi extends Rt{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:ii++}),this.uuid=Nt(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=gi.DEFAULT_UP.clone();const e=new Jt,t=new ti,n=new Yt,i=new Jt(1,1,1);t._onChange((function(){n.setFromEuler(t,!1)})),n._onChange((function(){t.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new Wn},normalMatrix:{value:new qt}}),this.matrix=new Wn,this.matrixWorld=new Wn,this.matrixAutoUpdate=gi.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=gi.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new ni,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return ai.setFromAxisAngle(e,t),this.quaternion.multiply(ai),this}rotateOnWorldAxis(e,t){return ai.setFromAxisAngle(e,t),this.quaternion.premultiply(ai),this}rotateX(e){return this.rotateOnAxis(hi,e)}rotateY(e){return this.rotateOnAxis(di,e)}rotateZ(e){return this.rotateOnAxis(pi,e)}translateOnAxis(e,t){return ri.copy(e).applyQuaternion(this.quaternion),this.position.add(ri.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(hi,e)}translateY(e){return this.translateOnAxis(di,e)}translateZ(e){return this.translateOnAxis(pi,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(si.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?oi.copy(e):oi.set(e,t,n);const i=this.parent;this.updateWorldMatrix(!0,!1),li.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?si.lookAt(li,oi,this.up):si.lookAt(oi,li,this.up),this.quaternion.setFromRotationMatrix(si),i&&(si.extractRotation(i.matrixWorld),ai.setFromRotationMatrix(si),this.quaternion.premultiply(ai.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(fi)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(mi)),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(mi)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),si.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),si.multiply(e.parent.matrixWorld)),e.applyMatrix4(si),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,i=this.children.length;n<i;n++){const i=this.children[n].getObjectByProperty(e,t);if(void 0!==i)return i}}getObjectsByProperty(e,t){let n=[];this[e]===t&&n.push(this);for(let i=0,r=this.children.length;i<r;i++){const r=this.children[i].getObjectsByProperty(e,t);r.length>0&&(n=n.concat(r))}return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(li,e,ui),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(li,ci,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,i=t.length;n<i;n++){const i=t[n];!0!==i.matrixWorldAutoUpdate&&!0!==e||i.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const n=this.parent;if(!0===e&&null!==n&&!0===n.matrixWorldAutoUpdate&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){const e=this.children;for(let t=0,n=e.length;t<n;t++){const n=e[t];!0===n.matrixWorldAutoUpdate&&n.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=void 0===e||"string"==typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const i={};function r(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(i.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=r(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const n=t.shapes;if(Array.isArray(n))for(let t=0,i=n.length;t<i;t++){const i=n[t];r(e.shapes,i)}else r(e.shapes,n)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let n=0,i=this.material.length;n<i;n++)t.push(r(e.materials,this.material[n]));i.material=t}else i.material=r(e.materials,this.material);if(this.children.length>0){i.children=[];for(let t=0;t<this.children.length;t++)i.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let t=0;t<this.animations.length;t++){const n=this.animations[t];i.animations.push(r(e.animations,n))}}if(t){const t=a(e.geometries),i=a(e.materials),r=a(e.textures),s=a(e.images),o=a(e.shapes),l=a(e.skeletons),u=a(e.animations),c=a(e.nodes);t.length>0&&(n.geometries=t),i.length>0&&(n.materials=i),r.length>0&&(n.textures=r),s.length>0&&(n.images=s),o.length>0&&(n.shapes=o),l.length>0&&(n.skeletons=l),u.length>0&&(n.animations=u),c.length>0&&(n.nodes=c)}return n.object=i,n;function a(e){const t=[];for(const n in e){const i=e[n];delete i.metadata,t.push(i)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let t=0;t<e.children.length;t++){const n=e.children[t];this.add(n.clone())}return this}}gi.DEFAULT_UP=new Jt(0,1,0),gi.DEFAULT_MATRIX_AUTO_UPDATE=!0,gi.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const vi=new Jt,_i=new Jt,xi=new Jt,yi=new Jt,bi=new Jt,Mi=new Jt,Si=new Jt,wi=new Jt,Ti=new Jt,Ei=new Jt;class Ai{constructor(e=new Jt,t=new Jt,n=new Jt){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,i){i.subVectors(n,t),vi.subVectors(e,t),i.cross(vi);const r=i.lengthSq();return r>0?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0)}static getBarycoord(e,t,n,i,r){vi.subVectors(i,t),_i.subVectors(n,t),xi.subVectors(e,t);const a=vi.dot(vi),s=vi.dot(_i),o=vi.dot(xi),l=_i.dot(_i),u=_i.dot(xi),c=a*l-s*s;if(0===c)return r.set(-2,-1,-1);const h=1/c,d=(l*o-s*u)*h,p=(a*u-s*o)*h;return r.set(1-d-p,p,d)}static containsPoint(e,t,n,i){return this.getBarycoord(e,t,n,i,yi),yi.x>=0&&yi.y>=0&&yi.x+yi.y<=1}static getUV(e,t,n,i,r,a,s,o){return this.getBarycoord(e,t,n,i,yi),o.set(0,0),o.addScaledVector(r,yi.x),o.addScaledVector(a,yi.y),o.addScaledVector(s,yi.z),o}static isFrontFacing(e,t,n,i){return vi.subVectors(n,t),_i.subVectors(e,t),vi.cross(_i).dot(i)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,t,n,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,i),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return vi.subVectors(this.c,this.b),_i.subVectors(this.a,this.b),.5*vi.cross(_i).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Ai.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Ai.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,n,i,r){return Ai.getUV(e,this.a,this.b,this.c,t,n,i,r)}containsPoint(e){return Ai.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Ai.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,i=this.b,r=this.c;let a,s;bi.subVectors(i,n),Mi.subVectors(r,n),wi.subVectors(e,n);const o=bi.dot(wi),l=Mi.dot(wi);if(o<=0&&l<=0)return t.copy(n);Ti.subVectors(e,i);const u=bi.dot(Ti),c=Mi.dot(Ti);if(u>=0&&c<=u)return t.copy(i);const h=o*c-u*l;if(h<=0&&o>=0&&u<=0)return a=o/(o-u),t.copy(n).addScaledVector(bi,a);Ei.subVectors(e,r);const d=bi.dot(Ei),p=Mi.dot(Ei);if(p>=0&&d<=p)return t.copy(r);const f=d*l-o*p;if(f<=0&&l>=0&&p<=0)return s=l/(l-p),t.copy(n).addScaledVector(Mi,s);const m=u*p-d*c;if(m<=0&&c-u>=0&&d-p>=0)return Si.subVectors(r,i),s=(c-u)/(c-u+(d-p)),t.copy(i).addScaledVector(Si,s);const g=1/(m+f+h);return a=f*g,s=h*g,t.copy(n).addScaledVector(bi,a).addScaledVector(Mi,s)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let Ci=0;class Li extends Rt{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Ci++}),this.uuid=Nt(),this.name="",this.type="Material",this.blending=v,this.side=p,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=R,this.blendDst=D,this.blendEquation=M,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=V,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=At,this.stencilZFail=At,this.stencilZPass=At,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const n=e[t];if(void 0===n){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}const i=this[t];void 0!==i?i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[t]=n:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}}toJSON(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function i(e){const t=[];for(const n in e){const i=e[n];delete i.metadata,t.push(i)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.iridescence&&(n.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(n.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==v&&(n.blending=this.blending),this.side!==p&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(n.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.forceSinglePass&&(n.forceSinglePass=this.forceSinglePass),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=this.flatShading),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData),t){const t=i(e.textures),r=i(e.images);t.length>0&&(n.textures=t),r.length>0&&(n.images=r)}return n}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(null!==t){const e=t.length;n=new Array(e);for(let i=0;i!==e;++i)n[i]=t[i].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}const Pi={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Ri={h:0,s:0,l:0},Di={h:0,s:0,l:0};function Ii(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}class Oi{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,void 0===t&&void 0===n?this.set(e):this.setRGB(e,t,n)}set(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=wt){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,on.toWorkingColorSpace(this,t),this}setRGB(e,t,n,i=on.workingColorSpace){return this.r=e,this.g=t,this.b=n,on.toWorkingColorSpace(this,i),this}setHSL(e,t,n,i=on.workingColorSpace){if(e=Ut(e,1),t=zt(t,0,1),n=zt(n,0,1),0===t)this.r=this.g=this.b=n;else{const i=n<=.5?n*(1+t):n+t-n*t,r=2*n-i;this.r=Ii(r,i,e+1/3),this.g=Ii(r,i,e),this.b=Ii(r,i,e-1/3)}return on.toWorkingColorSpace(this,i),this}setStyle(e,t=wt){function n(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(e)){let r;const a=i[1],s=i[2];switch(a){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.r=Math.min(255,parseInt(r[1],10))/255,this.g=Math.min(255,parseInt(r[2],10))/255,this.b=Math.min(255,parseInt(r[3],10))/255,on.toWorkingColorSpace(this,t),n(r[4]),this;if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.r=Math.min(100,parseInt(r[1],10))/100,this.g=Math.min(100,parseInt(r[2],10))/100,this.b=Math.min(100,parseInt(r[3],10))/100,on.toWorkingColorSpace(this,t),n(r[4]),this;break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s)){const e=parseFloat(r[1])/360,i=parseFloat(r[2])/100,a=parseFloat(r[3])/100;return n(r[4]),this.setHSL(e,i,a,t)}break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const n=i[1],r=n.length;if(3===r)return this.r=parseInt(n.charAt(0)+n.charAt(0),16)/255,this.g=parseInt(n.charAt(1)+n.charAt(1),16)/255,this.b=parseInt(n.charAt(2)+n.charAt(2),16)/255,on.toWorkingColorSpace(this,t),this;if(6===r)return this.r=parseInt(n.charAt(0)+n.charAt(1),16)/255,this.g=parseInt(n.charAt(2)+n.charAt(3),16)/255,this.b=parseInt(n.charAt(4)+n.charAt(5),16)/255,on.toWorkingColorSpace(this,t),this;console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=wt){const n=Pi[e.toLowerCase()];return void 0!==n?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Qt(e.r),this.g=Qt(e.g),this.b=Qt(e.b),this}copyLinearToSRGB(e){return this.r=$t(e.r),this.g=$t(e.g),this.b=$t(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=wt){return on.fromWorkingColorSpace(Ni.copy(this),e),zt(255*Ni.r,0,255)<<16^zt(255*Ni.g,0,255)<<8^zt(255*Ni.b,0,255)<<0}getHexString(e=wt){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=on.workingColorSpace){on.fromWorkingColorSpace(Ni.copy(this),t);const n=Ni.r,i=Ni.g,r=Ni.b,a=Math.max(n,i,r),s=Math.min(n,i,r);let o,l;const u=(s+a)/2;if(s===a)o=0,l=0;else{const e=a-s;switch(l=u<=.5?e/(a+s):e/(2-a-s),a){case n:o=(i-r)/e+(i<r?6:0);break;case i:o=(r-n)/e+2;break;case r:o=(n-i)/e+4}o/=6}return e.h=o,e.s=l,e.l=u,e}getRGB(e,t=on.workingColorSpace){return on.fromWorkingColorSpace(Ni.copy(this),t),e.r=Ni.r,e.g=Ni.g,e.b=Ni.b,e}getStyle(e=wt){on.fromWorkingColorSpace(Ni.copy(this),e);const t=Ni.r,n=Ni.g,i=Ni.b;return e!==wt?`color(${e} ${t.toFixed(3)} ${n.toFixed(3)} ${i.toFixed(3)})`:`rgb(${255*t|0},${255*n|0},${255*i|0})`}offsetHSL(e,t,n){return this.getHSL(Ri),Ri.h+=e,Ri.s+=t,Ri.l+=n,this.setHSL(Ri.h,Ri.s,Ri.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(Ri),e.getHSL(Di);const n=Ft(Ri.h,Di.h,t),i=Ft(Ri.s,Di.s,t),r=Ft(Ri.l,Di.l,t);return this.setHSL(n,i,r),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Ni=new Oi;Oi.NAMES=Pi;class zi extends Li{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Oi(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=j,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Ui=new Jt,Fi=new Ht;class ki{constructor(e,t,n=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=n,this.usage=Ct,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let i=0,r=this.itemSize;i<r;i++)this.array[e+i]=t.array[n+i];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,n=this.count;t<n;t++)Fi.fromBufferAttribute(this,t),Fi.applyMatrix3(e),this.setXY(t,Fi.x,Fi.y);else if(3===this.itemSize)for(let t=0,n=this.count;t<n;t++)Ui.fromBufferAttribute(this,t),Ui.applyMatrix3(e),this.setXYZ(t,Ui.x,Ui.y,Ui.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)Ui.fromBufferAttribute(this,t),Ui.applyMatrix4(e),this.setXYZ(t,Ui.x,Ui.y,Ui.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Ui.fromBufferAttribute(this,t),Ui.applyNormalMatrix(e),this.setXYZ(t,Ui.x,Ui.y,Ui.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Ui.fromBufferAttribute(this,t),Ui.transformDirection(e),this.setXYZ(t,Ui.x,Ui.y,Ui.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=Vt(t,this.array)),t}setX(e,t){return this.normalized&&(t=Gt(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=Vt(t,this.array)),t}setY(e,t){return this.normalized&&(t=Gt(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=Vt(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Gt(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=Vt(t,this.array)),t}setW(e,t){return this.normalized&&(t=Gt(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=Gt(t,this.array),n=Gt(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,i){return e*=this.itemSize,this.normalized&&(t=Gt(t,this.array),n=Gt(n,this.array),i=Gt(i,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this}setXYZW(e,t,n,i,r){return e*=this.itemSize,this.normalized&&(t=Gt(t,this.array),n=Gt(n,this.array),i=Gt(i,this.array),r=Gt(r,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==Ct&&(e.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(e.updateRange=this.updateRange),e}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}class Bi extends ki{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class Vi extends ki{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class Gi extends ki{constructor(e,t,n){super(new Float32Array(e),t,n)}}let Hi=0;const qi=new Wn,Wi=new gi,ji=new Jt,Xi=new _n,Yi=new _n,Ji=new Jt;class Zi extends Rt{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Hi++}),this.uuid=Nt(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(jt(e)?Vi:Bi)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const t=(new qt).getNormalMatrix(e);n.applyNormalMatrix(t),n.needsUpdate=!0}const i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(e),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return qi.makeRotationFromQuaternion(e),this.applyMatrix4(qi),this}rotateX(e){return qi.makeRotationX(e),this.applyMatrix4(qi),this}rotateY(e){return qi.makeRotationY(e),this.applyMatrix4(qi),this}rotateZ(e){return qi.makeRotationZ(e),this.applyMatrix4(qi),this}translate(e,t,n){return qi.makeTranslation(e,t,n),this.applyMatrix4(qi),this}scale(e,t,n){return qi.makeScale(e,t,n),this.applyMatrix4(qi),this}lookAt(e){return Wi.lookAt(e),Wi.updateMatrix(),this.applyMatrix4(Wi.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(ji).negate(),this.translate(ji.x,ji.y,ji.z),this}setFromPoints(e){const t=[];for(let n=0,i=e.length;n<i;n++){const i=e[n];t.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new Gi(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new _n);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new Jt(-1/0,-1/0,-1/0),new Jt(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const n=t[e];Xi.setFromBufferAttribute(n),this.morphTargetsRelative?(Ji.addVectors(this.boundingBox.min,Xi.min),this.boundingBox.expandByPoint(Ji),Ji.addVectors(this.boundingBox.max,Xi.max),this.boundingBox.expandByPoint(Ji)):(this.boundingBox.expandByPoint(Xi.min),this.boundingBox.expandByPoint(Xi.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new zn);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new Jt,1/0);if(e){const n=this.boundingSphere.center;if(Xi.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const n=t[e];Yi.setFromBufferAttribute(n),this.morphTargetsRelative?(Ji.addVectors(Xi.min,Yi.min),Xi.expandByPoint(Ji),Ji.addVectors(Xi.max,Yi.max),Xi.expandByPoint(Ji)):(Xi.expandByPoint(Yi.min),Xi.expandByPoint(Yi.max))}Xi.getCenter(n);let i=0;for(let t=0,r=e.count;t<r;t++)Ji.fromBufferAttribute(e,t),i=Math.max(i,n.distanceToSquared(Ji));if(t)for(let r=0,a=t.length;r<a;r++){const a=t[r],s=this.morphTargetsRelative;for(let t=0,r=a.count;t<r;t++)Ji.fromBufferAttribute(a,t),s&&(ji.fromBufferAttribute(e,t),Ji.add(ji)),i=Math.max(i,n.distanceToSquared(Ji))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=e.array,i=t.position.array,r=t.normal.array,a=t.uv.array,s=i.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new ki(new Float32Array(4*s),4));const o=this.getAttribute("tangent").array,l=[],u=[];for(let e=0;e<s;e++)l[e]=new Jt,u[e]=new Jt;const c=new Jt,h=new Jt,d=new Jt,p=new Ht,f=new Ht,m=new Ht,g=new Jt,v=new Jt;function _(e,t,n){c.fromArray(i,3*e),h.fromArray(i,3*t),d.fromArray(i,3*n),p.fromArray(a,2*e),f.fromArray(a,2*t),m.fromArray(a,2*n),h.sub(c),d.sub(c),f.sub(p),m.sub(p);const r=1/(f.x*m.y-m.x*f.y);isFinite(r)&&(g.copy(h).multiplyScalar(m.y).addScaledVector(d,-f.y).multiplyScalar(r),v.copy(d).multiplyScalar(f.x).addScaledVector(h,-m.x).multiplyScalar(r),l[e].add(g),l[t].add(g),l[n].add(g),u[e].add(v),u[t].add(v),u[n].add(v))}let x=this.groups;0===x.length&&(x=[{start:0,count:n.length}]);for(let e=0,t=x.length;e<t;++e){const t=x[e],i=t.start;for(let e=i,r=i+t.count;e<r;e+=3)_(n[e+0],n[e+1],n[e+2])}const y=new Jt,b=new Jt,M=new Jt,S=new Jt;function w(e){M.fromArray(r,3*e),S.copy(M);const t=l[e];y.copy(t),y.sub(M.multiplyScalar(M.dot(t))).normalize(),b.crossVectors(S,t);const n=b.dot(u[e])<0?-1:1;o[4*e]=y.x,o[4*e+1]=y.y,o[4*e+2]=y.z,o[4*e+3]=n}for(let e=0,t=x.length;e<t;++e){const t=x[e],i=t.start;for(let e=i,r=i+t.count;e<r;e+=3)w(n[e+0]),w(n[e+1]),w(n[e+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let n=this.getAttribute("normal");if(void 0===n)n=new ki(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(let e=0,t=n.count;e<t;e++)n.setXYZ(e,0,0,0);const i=new Jt,r=new Jt,a=new Jt,s=new Jt,o=new Jt,l=new Jt,u=new Jt,c=new Jt;if(e)for(let h=0,d=e.count;h<d;h+=3){const d=e.getX(h+0),p=e.getX(h+1),f=e.getX(h+2);i.fromBufferAttribute(t,d),r.fromBufferAttribute(t,p),a.fromBufferAttribute(t,f),u.subVectors(a,r),c.subVectors(i,r),u.cross(c),s.fromBufferAttribute(n,d),o.fromBufferAttribute(n,p),l.fromBufferAttribute(n,f),s.add(u),o.add(u),l.add(u),n.setXYZ(d,s.x,s.y,s.z),n.setXYZ(p,o.x,o.y,o.z),n.setXYZ(f,l.x,l.y,l.z)}else for(let e=0,s=t.count;e<s;e+=3)i.fromBufferAttribute(t,e+0),r.fromBufferAttribute(t,e+1),a.fromBufferAttribute(t,e+2),u.subVectors(a,r),c.subVectors(i,r),u.cross(c),n.setXYZ(e+0,u.x,u.y,u.z),n.setXYZ(e+1,u.x,u.y,u.z),n.setXYZ(e+2,u.x,u.y,u.z);this.normalizeNormals(),n.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeBufferGeometries() instead."),this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)Ji.fromBufferAttribute(e,t),Ji.normalize(),e.setXYZ(t,Ji.x,Ji.y,Ji.z)}toNonIndexed(){function e(e,t){const n=e.array,i=e.itemSize,r=e.normalized,a=new n.constructor(t.length*i);let s=0,o=0;for(let r=0,l=t.length;r<l;r++){s=e.isInterleavedBufferAttribute?t[r]*e.data.stride+e.offset:t[r]*i;for(let e=0;e<i;e++)a[o++]=n[s++]}return new ki(a,i,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new Zi,n=this.index.array,i=this.attributes;for(const r in i){const a=e(i[r],n);t.setAttribute(r,a)}const r=this.morphAttributes;for(const i in r){const a=[],s=r[i];for(let t=0,i=s.length;t<i;t++){const i=e(s[t],n);a.push(i)}t.morphAttributes[i]=a}t.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let e=0,n=a.length;e<n;e++){const n=a[e];t.addGroup(n.start,n.count,n.materialIndex)}return t}toJSON(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const t in n){const i=n[t];e.data.attributes[t]=i.toJSON(e.data)}const i={};let r=!1;for(const t in this.morphAttributes){const n=this.morphAttributes[t],a=[];for(let t=0,i=n.length;t<i;t++){const i=n[t];a.push(i.toJSON(e.data))}a.length>0&&(i[t]=a,r=!0)}r&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(e.data.groups=JSON.parse(JSON.stringify(a)));const s=this.boundingSphere;return null!==s&&(e.data.boundingSphere={center:s.center.toArray(),radius:s.radius}),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;null!==n&&this.setIndex(n.clone(t));const i=e.attributes;for(const e in i){const n=i[e];this.setAttribute(e,n.clone(t))}const r=e.morphAttributes;for(const e in r){const n=[],i=r[e];for(let e=0,r=i.length;e<r;e++)n.push(i[e].clone(t));this.morphAttributes[e]=n}this.morphTargetsRelative=e.morphTargetsRelative;const a=e.groups;for(let e=0,t=a.length;e<t;e++){const t=a[e];this.addGroup(t.start,t.count,t.materialIndex)}const s=e.boundingBox;null!==s&&(this.boundingBox=s.clone());const o=e.boundingSphere;return null!==o&&(this.boundingSphere=o.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const Ki=new Wn,Qi=new qn,$i=new zn,er=new Jt,tr=new Jt,nr=new Jt,ir=new Jt,rr=new Jt,ar=new Jt,sr=new Ht,or=new Ht,lr=new Ht,ur=new Jt,cr=new Jt;class hr extends gi{constructor(e=new Zi,t=new zi){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}getVertexPosition(e,t){const n=this.geometry,i=n.attributes.position,r=n.morphAttributes.position,a=n.morphTargetsRelative;t.fromBufferAttribute(i,e);const s=this.morphTargetInfluences;if(r&&s){ar.set(0,0,0);for(let n=0,i=r.length;n<i;n++){const i=s[n],o=r[n];0!==i&&(rr.fromBufferAttribute(o,e),a?ar.addScaledVector(rr,i):ar.addScaledVector(rr.sub(t),i))}t.add(ar)}return this.isSkinnedMesh&&this.boneTransform(e,t),t}raycast(e,t){const n=this.geometry,i=this.material,r=this.matrixWorld;if(void 0===i)return;if(null===n.boundingSphere&&n.computeBoundingSphere(),$i.copy(n.boundingSphere),$i.applyMatrix4(r),Qi.copy(e.ray).recast(e.near),!1===$i.containsPoint(Qi.origin)){if(null===Qi.intersectSphere($i,er))return;if(Qi.origin.distanceToSquared(er)>(e.far-e.near)**2)return}if(Ki.copy(r).invert(),Qi.copy(e.ray).applyMatrix4(Ki),null!==n.boundingBox&&!1===Qi.intersectsBox(n.boundingBox))return;let a;const s=n.index,o=n.attributes.position,l=n.attributes.uv,u=n.attributes.uv2,c=n.groups,h=n.drawRange;if(null!==s)if(Array.isArray(i))for(let n=0,r=c.length;n<r;n++){const r=c[n],o=i[r.materialIndex];for(let n=Math.max(r.start,h.start),i=Math.min(s.count,Math.min(r.start+r.count,h.start+h.count));n<i;n+=3){const i=s.getX(n),c=s.getX(n+1),h=s.getX(n+2);a=dr(this,o,e,Qi,l,u,i,c,h),a&&(a.faceIndex=Math.floor(n/3),a.face.materialIndex=r.materialIndex,t.push(a))}}else{for(let n=Math.max(0,h.start),r=Math.min(s.count,h.start+h.count);n<r;n+=3){const r=s.getX(n),o=s.getX(n+1),c=s.getX(n+2);a=dr(this,i,e,Qi,l,u,r,o,c),a&&(a.faceIndex=Math.floor(n/3),t.push(a))}}else if(void 0!==o)if(Array.isArray(i))for(let n=0,r=c.length;n<r;n++){const r=c[n],s=i[r.materialIndex];for(let n=Math.max(r.start,h.start),i=Math.min(o.count,Math.min(r.start+r.count,h.start+h.count));n<i;n+=3){a=dr(this,s,e,Qi,l,u,n,n+1,n+2),a&&(a.faceIndex=Math.floor(n/3),a.face.materialIndex=r.materialIndex,t.push(a))}}else{for(let n=Math.max(0,h.start),r=Math.min(o.count,h.start+h.count);n<r;n+=3){a=dr(this,i,e,Qi,l,u,n,n+1,n+2),a&&(a.faceIndex=Math.floor(n/3),t.push(a))}}}}function dr(e,t,n,i,r,a,s,o,l){e.getVertexPosition(s,tr),e.getVertexPosition(o,nr),e.getVertexPosition(l,ir);const u=function(e,t,n,i,r,a,s,o){let l;if(l=t.side===f?i.intersectTriangle(s,a,r,!0,o):i.intersectTriangle(r,a,s,t.side===p,o),null===l)return null;cr.copy(o),cr.applyMatrix4(e.matrixWorld);const u=n.ray.origin.distanceTo(cr);return u<n.near||u>n.far?null:{distance:u,point:cr.clone(),object:e}}(e,t,n,i,tr,nr,ir,ur);if(u){r&&(sr.fromBufferAttribute(r,s),or.fromBufferAttribute(r,o),lr.fromBufferAttribute(r,l),u.uv=Ai.getUV(ur,tr,nr,ir,sr,or,lr,new Ht)),a&&(sr.fromBufferAttribute(a,s),or.fromBufferAttribute(a,o),lr.fromBufferAttribute(a,l),u.uv2=Ai.getUV(ur,tr,nr,ir,sr,or,lr,new Ht));const e={a:s,b:o,c:l,normal:new Jt,materialIndex:0};Ai.getNormal(tr,nr,ir,e.normal),u.face=e}return u}class pr extends Zi{constructor(e=1,t=1,n=1,i=1,r=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:i,heightSegments:r,depthSegments:a};const s=this;i=Math.floor(i),r=Math.floor(r),a=Math.floor(a);const o=[],l=[],u=[],c=[];let h=0,d=0;function p(e,t,n,i,r,a,p,f,m,g,v){const _=a/m,x=p/g,y=a/2,b=p/2,M=f/2,S=m+1,w=g+1;let T=0,E=0;const A=new Jt;for(let a=0;a<w;a++){const s=a*x-b;for(let o=0;o<S;o++){const h=o*_-y;A[e]=h*i,A[t]=s*r,A[n]=M,l.push(A.x,A.y,A.z),A[e]=0,A[t]=0,A[n]=f>0?1:-1,u.push(A.x,A.y,A.z),c.push(o/m),c.push(1-a/g),T+=1}}for(let e=0;e<g;e++)for(let t=0;t<m;t++){const n=h+t+S*e,i=h+t+S*(e+1),r=h+(t+1)+S*(e+1),a=h+(t+1)+S*e;o.push(n,i,a),o.push(i,r,a),E+=6}s.addGroup(d,E,v),d+=E,h+=T}p("z","y","x",-1,-1,n,t,e,a,r,0),p("z","y","x",1,-1,n,t,-e,a,r,1),p("x","z","y",1,1,e,n,t,i,a,2),p("x","z","y",1,-1,e,n,-t,i,a,3),p("x","y","z",1,-1,e,t,n,i,r,4),p("x","y","z",-1,-1,e,t,-n,i,r,5),this.setIndex(o),this.setAttribute("position",new Gi(l,3)),this.setAttribute("normal",new Gi(u,3)),this.setAttribute("uv",new Gi(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new pr(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function fr(e){const t={};for(const n in e){t[n]={};for(const i in e[n]){const r=e[n][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?t[n][i]=r.clone():Array.isArray(r)?t[n][i]=r.slice():t[n][i]=r}}return t}function mr(e){const t={};for(let n=0;n<e.length;n++){const i=fr(e[n]);for(const e in i)t[e]=i[e]}return t}function gr(e){return null===e.getRenderTarget()&&e.outputEncoding===yt?wt:Tt}const vr={clone:fr,merge:mr};class _r extends Li{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=fr(e.uniforms),this.uniformsGroups=function(e){const t=[];for(let n=0;n<e.length;n++)t.push(e[n].clone());return t}(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const n in this.uniforms){const i=this.uniforms[n].value;i&&i.isTexture?t.uniforms[n]={type:"t",value:i.toJSON(e).uuid}:i&&i.isColor?t.uniforms[n]={type:"c",value:i.getHex()}:i&&i.isVector2?t.uniforms[n]={type:"v2",value:i.toArray()}:i&&i.isVector3?t.uniforms[n]={type:"v3",value:i.toArray()}:i&&i.isVector4?t.uniforms[n]={type:"v4",value:i.toArray()}:i&&i.isMatrix3?t.uniforms[n]={type:"m3",value:i.toArray()}:i&&i.isMatrix4?t.uniforms[n]={type:"m4",value:i.toArray()}:t.uniforms[n]={value:i}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const n={};for(const e in this.extensions)!0===this.extensions[e]&&(n[e]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}class xr extends gi{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Wn,this.projectionMatrix=new Wn,this.projectionMatrixInverse=new Wn}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}class yr extends xr{constructor(e=50,t=1,n=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*Ot*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*It*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*Ot*Math.atan(Math.tan(.5*It*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,n,i,r,a){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*It*this.fov)/this.zoom,n=2*t,i=this.aspect*n,r=-.5*i;const a=this.view;if(null!==this.view&&this.view.enabled){const e=a.fullWidth,s=a.fullHeight;r+=a.offsetX*i/e,t-=a.offsetY*n/s,i*=a.width/e,n*=a.height/s}const s=this.filmOffset;0!==s&&(r+=e*s/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,t,t-n,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const br=-90;class Mr extends gi{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n;const i=new yr(br,1,e,t);i.layers=this.layers,i.up.set(0,1,0),i.lookAt(1,0,0),this.add(i);const r=new yr(br,1,e,t);r.layers=this.layers,r.up.set(0,1,0),r.lookAt(-1,0,0),this.add(r);const a=new yr(br,1,e,t);a.layers=this.layers,a.up.set(0,0,-1),a.lookAt(0,1,0),this.add(a);const s=new yr(br,1,e,t);s.layers=this.layers,s.up.set(0,0,1),s.lookAt(0,-1,0),this.add(s);const o=new yr(br,1,e,t);o.layers=this.layers,o.up.set(0,1,0),o.lookAt(0,0,1),this.add(o);const l=new yr(br,1,e,t);l.layers=this.layers,l.up.set(0,1,0),l.lookAt(0,0,-1),this.add(l)}update(e,t){null===this.parent&&this.updateMatrixWorld();const n=this.renderTarget,[i,r,a,s,o,l]=this.children,u=e.getRenderTarget(),c=e.toneMapping,h=e.xr.enabled;e.toneMapping=J,e.xr.enabled=!1;const d=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,i),e.setRenderTarget(n,1),e.render(t,r),e.setRenderTarget(n,2),e.render(t,a),e.setRenderTarget(n,3),e.render(t,s),e.setRenderTarget(n,4),e.render(t,o),n.texture.generateMipmaps=d,e.setRenderTarget(n,5),e.render(t,l),e.setRenderTarget(u),e.toneMapping=c,e.xr.enabled=h,n.texture.needsPMREMUpdate=!0}}class Sr extends pn{constructor(e,t,n,i,r,a,s,o,l,u){super(e=void 0!==e?e:[],t=void 0!==t?t:te,n,i,r,a,s,o,l,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class wr extends mn{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},i=[n,n,n,n,n,n];this.texture=new Sr(i,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:de}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t"},i=new pr(5,5,5),r=new _r({name:"CubemapFromEquirect",uniforms:fr(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:f,blending:g});r.uniforms.tEquirect.value=t;const a=new hr(i,r),s=t.minFilter;t.minFilter===fe&&(t.minFilter=de);return new Mr(1,10,this).update(e,a),t.minFilter=s,a.geometry.dispose(),a.material.dispose(),this}clear(e,t,n,i){const r=e.getRenderTarget();for(let r=0;r<6;r++)e.setRenderTarget(this,r),e.clear(t,n,i);e.setRenderTarget(r)}}const Tr=new Jt,Er=new Jt,Ar=new qt;class Cr{constructor(e=new Jt(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const i=Tr.subVectors(n,t).cross(Er.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const n=e.delta(Tr),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const r=-(e.start.dot(this.normal)+this.constant)/i;return r<0||r>1?null:t.copy(e.start).addScaledVector(n,r)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||Ar.getNormalMatrix(e),i=this.coplanarPoint(Tr).applyMatrix4(e),r=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const Lr=new zn,Pr=new Jt;class Rr{constructor(e=new Cr,t=new Cr,n=new Cr,i=new Cr,r=new Cr,a=new Cr){this.planes=[e,t,n,i,r,a]}set(e,t,n,i,r,a){const s=this.planes;return s[0].copy(e),s[1].copy(t),s[2].copy(n),s[3].copy(i),s[4].copy(r),s[5].copy(a),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e){const t=this.planes,n=e.elements,i=n[0],r=n[1],a=n[2],s=n[3],o=n[4],l=n[5],u=n[6],c=n[7],h=n[8],d=n[9],p=n[10],f=n[11],m=n[12],g=n[13],v=n[14],_=n[15];return t[0].setComponents(s-i,c-o,f-h,_-m).normalize(),t[1].setComponents(s+i,c+o,f+h,_+m).normalize(),t[2].setComponents(s+r,c+l,f+d,_+g).normalize(),t[3].setComponents(s-r,c-l,f-d,_-g).normalize(),t[4].setComponents(s-a,c-u,f-p,_-v).normalize(),t[5].setComponents(s+a,c+u,f+p,_+v).normalize(),this}intersectsObject(e){const t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),Lr.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(Lr)}intersectsSprite(e){return Lr.center.set(0,0,0),Lr.radius=.7071067811865476,Lr.applyMatrix4(e.matrixWorld),this.intersectsSphere(Lr)}intersectsSphere(e){const t=this.planes,n=e.center,i=-e.radius;for(let e=0;e<6;e++){if(t[e].distanceToPoint(n)<i)return!1}return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const i=t[n];if(Pr.x=i.normal.x>0?e.max.x:e.min.x,Pr.y=i.normal.y>0?e.max.y:e.min.y,Pr.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(Pr)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function Dr(){let e=null,t=!1,n=null,i=null;function r(t,a){n(t,a),i=e.requestAnimationFrame(r)}return{start:function(){!0!==t&&null!==n&&(i=e.requestAnimationFrame(r),t=!0)},stop:function(){e.cancelAnimationFrame(i),t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function Ir(e,t){const n=t.isWebGL2,i=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),i.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);const n=i.get(t);n&&(e.deleteBuffer(n.buffer),i.delete(t))},update:function(t,r){if(t.isGLBufferAttribute){const e=i.get(t);return void((!e||e.version<t.version)&&i.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version}))}t.isInterleavedBufferAttribute&&(t=t.data);const a=i.get(t);void 0===a?i.set(t,function(t,i){const r=t.array,a=t.usage,s=e.createBuffer();let o;if(e.bindBuffer(i,s),e.bufferData(i,r,a),t.onUploadCallback(),r instanceof Float32Array)o=5126;else if(r instanceof Uint16Array)if(t.isFloat16BufferAttribute){if(!n)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");o=5131}else o=5123;else if(r instanceof Int16Array)o=5122;else if(r instanceof Uint32Array)o=5125;else if(r instanceof Int32Array)o=5124;else if(r instanceof Int8Array)o=5120;else if(r instanceof Uint8Array)o=5121;else{if(!(r instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+r);o=5121}return{buffer:s,type:o,bytesPerElement:r.BYTES_PER_ELEMENT,version:t.version}}(t,r)):a.version<t.version&&(!function(t,i,r){const a=i.array,s=i.updateRange;e.bindBuffer(r,t),-1===s.count?e.bufferSubData(r,0,a):(n?e.bufferSubData(r,s.offset*a.BYTES_PER_ELEMENT,a,s.offset,s.count):e.bufferSubData(r,s.offset*a.BYTES_PER_ELEMENT,a.subarray(s.offset,s.offset+s.count)),s.count=-1),i.onUploadCallback()}(a.buffer,t,r),a.version=t.version)}}}class Or extends Zi{constructor(e=1,t=1,n=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i};const r=e/2,a=t/2,s=Math.floor(n),o=Math.floor(i),l=s+1,u=o+1,c=e/s,h=t/o,d=[],p=[],f=[],m=[];for(let e=0;e<u;e++){const t=e*h-a;for(let n=0;n<l;n++){const i=n*c-r;p.push(i,-t,0),f.push(0,0,1),m.push(n/s),m.push(1-e/o)}}for(let e=0;e<o;e++)for(let t=0;t<s;t++){const n=t+l*e,i=t+l*(e+1),r=t+1+l*(e+1),a=t+1+l*e;d.push(n,i,a),d.push(i,r,a)}this.setIndex(d),this.setAttribute("position",new Gi(p,3)),this.setAttribute("normal",new Gi(f,3)),this.setAttribute("uv",new Gi(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Or(e.width,e.height,e.widthSegments,e.heightSegments)}}const Nr={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\n#ifdef USE_IRIDESCENCE\n\tvec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\t return vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat R21 = R12;\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = dFdx( surf_pos.xyz );\n\t\tvec3 vSigmaY = dFdy( surf_pos.xyz );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n\tconst vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n\treturn dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_v0 0.339\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_v1 0.276\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_v4 0.046\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_v5 0.016\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_v6 0.0038\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"vec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( LEGACY_LIGHTS )\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#else\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARCOLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vUv ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;\n\t#endif\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\treflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );\n\t#else\n\t\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometry.viewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec2 packDepthToRG( in highp float v ) {\n\treturn packDepthToRGBA( v ).yx;\n}\nfloat unpackRGToDepth( const in highp vec2 v ) {\n\treturn unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tuniform int boneTextureSize;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tfloat j = i * 4.0;\n\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\ty = dy * ( y + 0.5 );\n\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\treturn bone;\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, vec2 fullSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\t\n\t\tvec2 lodFudge = pow( 1.95, lod ) / fullSize;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec2 fullSize = vec2( textureSize( sampler, 0 ) );\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), fullSize, floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), fullSize, ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARCOLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},zr={common:{diffuse:{value:new Oi(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new qt},uv2Transform:{value:new qt},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Ht(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Oi(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Oi(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new qt}},sprite:{diffuse:{value:new Oi(16777215)},opacity:{value:1},center:{value:new Ht(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new qt}}},Ur={basic:{uniforms:mr([zr.common,zr.specularmap,zr.envmap,zr.aomap,zr.lightmap,zr.fog]),vertexShader:Nr.meshbasic_vert,fragmentShader:Nr.meshbasic_frag},lambert:{uniforms:mr([zr.common,zr.specularmap,zr.envmap,zr.aomap,zr.lightmap,zr.emissivemap,zr.bumpmap,zr.normalmap,zr.displacementmap,zr.fog,zr.lights,{emissive:{value:new Oi(0)}}]),vertexShader:Nr.meshlambert_vert,fragmentShader:Nr.meshlambert_frag},phong:{uniforms:mr([zr.common,zr.specularmap,zr.envmap,zr.aomap,zr.lightmap,zr.emissivemap,zr.bumpmap,zr.normalmap,zr.displacementmap,zr.fog,zr.lights,{emissive:{value:new Oi(0)},specular:{value:new Oi(1118481)},shininess:{value:30}}]),vertexShader:Nr.meshphong_vert,fragmentShader:Nr.meshphong_frag},standard:{uniforms:mr([zr.common,zr.envmap,zr.aomap,zr.lightmap,zr.emissivemap,zr.bumpmap,zr.normalmap,zr.displacementmap,zr.roughnessmap,zr.metalnessmap,zr.fog,zr.lights,{emissive:{value:new Oi(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Nr.meshphysical_vert,fragmentShader:Nr.meshphysical_frag},toon:{uniforms:mr([zr.common,zr.aomap,zr.lightmap,zr.emissivemap,zr.bumpmap,zr.normalmap,zr.displacementmap,zr.gradientmap,zr.fog,zr.lights,{emissive:{value:new Oi(0)}}]),vertexShader:Nr.meshtoon_vert,fragmentShader:Nr.meshtoon_frag},matcap:{uniforms:mr([zr.common,zr.bumpmap,zr.normalmap,zr.displacementmap,zr.fog,{matcap:{value:null}}]),vertexShader:Nr.meshmatcap_vert,fragmentShader:Nr.meshmatcap_frag},points:{uniforms:mr([zr.points,zr.fog]),vertexShader:Nr.points_vert,fragmentShader:Nr.points_frag},dashed:{uniforms:mr([zr.common,zr.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Nr.linedashed_vert,fragmentShader:Nr.linedashed_frag},depth:{uniforms:mr([zr.common,zr.displacementmap]),vertexShader:Nr.depth_vert,fragmentShader:Nr.depth_frag},normal:{uniforms:mr([zr.common,zr.bumpmap,zr.normalmap,zr.displacementmap,{opacity:{value:1}}]),vertexShader:Nr.meshnormal_vert,fragmentShader:Nr.meshnormal_frag},sprite:{uniforms:mr([zr.sprite,zr.fog]),vertexShader:Nr.sprite_vert,fragmentShader:Nr.sprite_frag},background:{uniforms:{uvTransform:{value:new qt},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Nr.background_vert,fragmentShader:Nr.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:Nr.backgroundCube_vert,fragmentShader:Nr.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Nr.cube_vert,fragmentShader:Nr.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Nr.equirect_vert,fragmentShader:Nr.equirect_frag},distanceRGBA:{uniforms:mr([zr.common,zr.displacementmap,{referencePosition:{value:new Jt},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Nr.distanceRGBA_vert,fragmentShader:Nr.distanceRGBA_frag},shadow:{uniforms:mr([zr.lights,zr.fog,{color:{value:new Oi(0)},opacity:{value:1}}]),vertexShader:Nr.shadow_vert,fragmentShader:Nr.shadow_frag}};Ur.physical={uniforms:mr([Ur.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Ht(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new Oi(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Ht},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new Oi(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new Oi(1,1,1)},specularColorMap:{value:null}}]),vertexShader:Nr.meshphysical_vert,fragmentShader:Nr.meshphysical_frag};const Fr={r:0,b:0,g:0};function kr(e,t,n,i,r,a,s){const o=new Oi(0);let l,u,c=!0===a?0:1,h=null,d=0,m=null;function g(t,n){t.getRGB(Fr,gr(e)),i.buffers.color.setClear(Fr.r,Fr.g,Fr.b,n,s)}return{getClearColor:function(){return o},setClearColor:function(e,t=1){o.set(e),c=t,g(o,c)},getClearAlpha:function(){return c},setClearAlpha:function(e){c=e,g(o,c)},render:function(i,a){let s=!1,v=!0===a.isScene?a.background:null;if(v&&v.isTexture){v=(a.backgroundBlurriness>0?n:t).get(v)}const _=e.xr,x=_.getSession&&_.getSession();x&&"additive"===x.environmentBlendMode&&(v=null),null===v?g(o,c):v&&v.isColor&&(g(v,1),s=!0),(e.autoClear||s)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),v&&(v.isCubeTexture||v.mapping===ae)?(void 0===u&&(u=new hr(new pr(1,1,1),new _r({name:"BackgroundCubeMaterial",uniforms:fr(Ur.backgroundCube.uniforms),vertexShader:Ur.backgroundCube.vertexShader,fragmentShader:Ur.backgroundCube.fragmentShader,side:f,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(u)),u.material.uniforms.envMap.value=v,u.material.uniforms.flipEnvMap.value=v.isCubeTexture&&!1===v.isRenderTargetTexture?-1:1,u.material.uniforms.backgroundBlurriness.value=a.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=a.backgroundIntensity,u.material.toneMapped=v.encoding!==yt,h===v&&d===v.version&&m===e.toneMapping||(u.material.needsUpdate=!0,h=v,d=v.version,m=e.toneMapping),u.layers.enableAll(),i.unshift(u,u.geometry,u.material,0,0,null)):v&&v.isTexture&&(void 0===l&&(l=new hr(new Or(2,2),new _r({name:"BackgroundMaterial",uniforms:fr(Ur.background.uniforms),vertexShader:Ur.background.vertexShader,fragmentShader:Ur.background.fragmentShader,side:p,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(l)),l.material.uniforms.t2D.value=v,l.material.uniforms.backgroundIntensity.value=a.backgroundIntensity,l.material.toneMapped=v.encoding!==yt,!0===v.matrixAutoUpdate&&v.updateMatrix(),l.material.uniforms.uvTransform.value.copy(v.matrix),h===v&&d===v.version&&m===e.toneMapping||(l.material.needsUpdate=!0,h=v,d=v.version,m=e.toneMapping),l.layers.enableAll(),i.unshift(l,l.geometry,l.material,0,0,null))}}}function Br(e,t,n,i){const r=e.getParameter(34921),a=i.isWebGL2?null:t.get("OES_vertex_array_object"),s=i.isWebGL2||null!==a,o={},l=p(null);let u=l,c=!1;function h(t){return i.isWebGL2?e.bindVertexArray(t):a.bindVertexArrayOES(t)}function d(t){return i.isWebGL2?e.deleteVertexArray(t):a.deleteVertexArrayOES(t)}function p(e){const t=[],n=[],i=[];for(let e=0;e<r;e++)t[e]=0,n[e]=0,i[e]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:n,attributeDivisors:i,object:e,attributes:{},index:null}}function f(){const e=u.newAttributes;for(let t=0,n=e.length;t<n;t++)e[t]=0}function m(e){g(e,0)}function g(n,r){const a=u.newAttributes,s=u.enabledAttributes,o=u.attributeDivisors;if(a[n]=1,0===s[n]&&(e.enableVertexAttribArray(n),s[n]=1),o[n]!==r){(i.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,r),o[n]=r}}function v(){const t=u.newAttributes,n=u.enabledAttributes;for(let i=0,r=n.length;i<r;i++)n[i]!==t[i]&&(e.disableVertexAttribArray(i),n[i]=0)}function _(t,n,r,a,s,o){!0!==i.isWebGL2||5124!==r&&5125!==r?e.vertexAttribPointer(t,n,r,a,s,o):e.vertexAttribIPointer(t,n,r,s,o)}function x(){y(),c=!0,u!==l&&(u=l,h(u.object))}function y(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(r,l,d,x,y){let b=!1;if(s){const t=function(t,n,r){const s=!0===r.wireframe;let l=o[t.id];void 0===l&&(l={},o[t.id]=l);let u=l[n.id];void 0===u&&(u={},l[n.id]=u);let c=u[s];void 0===c&&(c=p(i.isWebGL2?e.createVertexArray():a.createVertexArrayOES()),u[s]=c);return c}(x,d,l);u!==t&&(u=t,h(u.object)),b=function(e,t,n,i){const r=u.attributes,a=t.attributes;let s=0;const o=n.getAttributes();for(const t in o){if(o[t].location>=0){const n=r[t];let i=a[t];if(void 0===i&&("instanceMatrix"===t&&e.instanceMatrix&&(i=e.instanceMatrix),"instanceColor"===t&&e.instanceColor&&(i=e.instanceColor)),void 0===n)return!0;if(n.attribute!==i)return!0;if(i&&n.data!==i.data)return!0;s++}}return u.attributesNum!==s||u.index!==i}(r,x,d,y),b&&function(e,t,n,i){const r={},a=t.attributes;let s=0;const o=n.getAttributes();for(const t in o){if(o[t].location>=0){let n=a[t];void 0===n&&("instanceMatrix"===t&&e.instanceMatrix&&(n=e.instanceMatrix),"instanceColor"===t&&e.instanceColor&&(n=e.instanceColor));const i={};i.attribute=n,n&&n.data&&(i.data=n.data),r[t]=i,s++}}u.attributes=r,u.attributesNum=s,u.index=i}(r,x,d,y)}else{const e=!0===l.wireframe;u.geometry===x.id&&u.program===d.id&&u.wireframe===e||(u.geometry=x.id,u.program=d.id,u.wireframe=e,b=!0)}null!==y&&n.update(y,34963),(b||c)&&(c=!1,function(r,a,s,o){if(!1===i.isWebGL2&&(r.isInstancedMesh||o.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;f();const l=o.attributes,u=s.getAttributes(),c=a.defaultAttributeValues;for(const t in u){const i=u[t];if(i.location>=0){let a=l[t];if(void 0===a&&("instanceMatrix"===t&&r.instanceMatrix&&(a=r.instanceMatrix),"instanceColor"===t&&r.instanceColor&&(a=r.instanceColor)),void 0!==a){const t=a.normalized,s=a.itemSize,l=n.get(a);if(void 0===l)continue;const u=l.buffer,c=l.type,h=l.bytesPerElement;if(a.isInterleavedBufferAttribute){const n=a.data,l=n.stride,d=a.offset;if(n.isInstancedInterleavedBuffer){for(let e=0;e<i.locationSize;e++)g(i.location+e,n.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===o._maxInstanceCount&&(o._maxInstanceCount=n.meshPerAttribute*n.count)}else for(let e=0;e<i.locationSize;e++)m(i.location+e);e.bindBuffer(34962,u);for(let e=0;e<i.locationSize;e++)_(i.location+e,s/i.locationSize,c,t,l*h,(d+s/i.locationSize*e)*h)}else{if(a.isInstancedBufferAttribute){for(let e=0;e<i.locationSize;e++)g(i.location+e,a.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===o._maxInstanceCount&&(o._maxInstanceCount=a.meshPerAttribute*a.count)}else for(let e=0;e<i.locationSize;e++)m(i.location+e);e.bindBuffer(34962,u);for(let e=0;e<i.locationSize;e++)_(i.location+e,s/i.locationSize,c,t,s*h,s/i.locationSize*e*h)}}else if(void 0!==c){const n=c[t];if(void 0!==n)switch(n.length){case 2:e.vertexAttrib2fv(i.location,n);break;case 3:e.vertexAttrib3fv(i.location,n);break;case 4:e.vertexAttrib4fv(i.location,n);break;default:e.vertexAttrib1fv(i.location,n)}}}}v()}(r,l,d,x),null!==y&&e.bindBuffer(34963,n.get(y).buffer))},reset:x,resetDefaultState:y,dispose:function(){x();for(const e in o){const t=o[e];for(const e in t){const n=t[e];for(const e in n)d(n[e].object),delete n[e];delete t[e]}delete o[e]}},releaseStatesOfGeometry:function(e){if(void 0===o[e.id])return;const t=o[e.id];for(const e in t){const n=t[e];for(const e in n)d(n[e].object),delete n[e];delete t[e]}delete o[e.id]},releaseStatesOfProgram:function(e){for(const t in o){const n=o[t];if(void 0===n[e.id])continue;const i=n[e.id];for(const e in i)d(i[e].object),delete i[e];delete n[e.id]}},initAttributes:f,enableAttribute:m,disableUnusedAttributes:v}}function Vr(e,t,n,i){const r=i.isWebGL2;let a;this.setMode=function(e){a=e},this.render=function(t,i){e.drawArrays(a,t,i),n.update(i,a,1)},this.renderInstances=function(i,s,o){if(0===o)return;let l,u;if(r)l=e,u="drawArraysInstanced";else if(l=t.get("ANGLE_instanced_arrays"),u="drawArraysInstancedANGLE",null===l)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[u](a,i,s,o),n.update(s,a,o)}}function Gr(e,t,n){let i;function r(t){if("highp"===t){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const a="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext;let s=void 0!==n.precision?n.precision:"highp";const o=r(s);o!==s&&(console.warn("THREE.WebGLRenderer:",s,"not supported, using",o,"instead."),s=o);const l=a||t.has("WEBGL_draw_buffers"),u=!0===n.logarithmicDepthBuffer,c=e.getParameter(34930),h=e.getParameter(35660),d=e.getParameter(3379),p=e.getParameter(34076),f=e.getParameter(34921),m=e.getParameter(36347),g=e.getParameter(36348),v=e.getParameter(36349),_=h>0,x=a||t.has("OES_texture_float");return{isWebGL2:a,drawBuffers:l,getMaxAnisotropy:function(){if(void 0!==i)return i;if(!0===t.has("EXT_texture_filter_anisotropic")){const n=t.get("EXT_texture_filter_anisotropic");i=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i},getMaxPrecision:r,precision:s,logarithmicDepthBuffer:u,maxTextures:c,maxVertexTextures:h,maxTextureSize:d,maxCubemapSize:p,maxAttributes:f,maxVertexUniforms:m,maxVaryings:g,maxFragmentUniforms:v,vertexTextures:_,floatFragmentTextures:x,floatVertexTextures:_&&x,maxSamples:a?e.getParameter(36183):0}}function Hr(e){const t=this;let n=null,i=0,r=!1,a=!1;const s=new Cr,o=new qt,l={value:null,needsUpdate:!1};function u(e,n,i,r){const a=null!==e?e.length:0;let u=null;if(0!==a){if(u=l.value,!0!==r||null===u){const t=i+4*a,r=n.matrixWorldInverse;o.getNormalMatrix(r),(null===u||u.length<t)&&(u=new Float32Array(t));for(let t=0,n=i;t!==a;++t,n+=4)s.copy(e[t]).applyMatrix4(r,o),s.normal.toArray(u,n),u[n+3]=s.constant}l.value=u,l.needsUpdate=!0}return t.numPlanes=a,t.numIntersection=0,u}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t){const n=0!==e.length||t||0!==i||r;return r=t,i=e.length,n},this.beginShadows=function(){a=!0,u(null)},this.endShadows=function(){a=!1},this.setGlobalState=function(e,t){n=u(e,t,0)},this.setState=function(s,o,c){const h=s.clippingPlanes,d=s.clipIntersection,p=s.clipShadows,f=e.get(s);if(!r||null===h||0===h.length||a&&!p)a?u(null):function(){l.value!==n&&(l.value=n,l.needsUpdate=i>0);t.numPlanes=i,t.numIntersection=0}();else{const e=a?0:i,t=4*e;let r=f.clippingState||null;l.value=r,r=u(h,o,t,c);for(let e=0;e!==t;++e)r[e]=n[e];f.clippingState=r,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=e}}}function qr(e){let t=new WeakMap;function n(e,t){return t===ie?e.mapping=te:t===re&&(e.mapping=ne),e}function i(e){const n=e.target;n.removeEventListener("dispose",i);const r=t.get(n);void 0!==r&&(t.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture&&!1===r.isRenderTargetTexture){const a=r.mapping;if(a===ie||a===re){if(t.has(r)){return n(t.get(r).texture,r.mapping)}{const a=r.image;if(a&&a.height>0){const s=new wr(a.height/2);return s.fromEquirectangularTexture(e,r),t.set(r,s),r.addEventListener("dispose",i),n(s.texture,r.mapping)}return null}}}return r},dispose:function(){t=new WeakMap}}}class Wr extends xr{constructor(e=-1,t=1,n=1,i=-1,r=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=i,this.near=r,this.far=a,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,n,i,r,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let r=n-e,a=n+e,s=i+t,o=i-t;if(null!==this.view&&this.view.enabled){const e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=e*this.view.offsetX,a=r+e*this.view.width,s-=t*this.view.offsetY,o=s-t*this.view.height}this.projectionMatrix.makeOrthographic(r,a,s,o,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}const jr=4,Xr=[.125,.215,.35,.446,.526,.582],Yr=20,Jr=new Wr,Zr=new Oi;let Kr=null;const Qr=(1+Math.sqrt(5))/2,$r=1/Qr,ea=[new Jt(1,1,1),new Jt(-1,1,1),new Jt(1,1,-1),new Jt(-1,1,-1),new Jt(0,Qr,$r),new Jt(0,Qr,-$r),new Jt($r,0,Qr),new Jt(-$r,0,Qr),new Jt(Qr,$r,0),new Jt(-Qr,$r,0)];class ta{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,i=100){Kr=this._renderer.getRenderTarget(),this._setSize(256);const r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(e,n,i,r),t>0&&this._blur(r,0,0,t),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=aa(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=ra(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(Kr),e.scissorTest=!1,ia(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===te||e.mapping===ne?this._setSize(0===e.image.length?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),Kr=this._renderer.getRenderTarget();const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:de,minFilter:de,generateMipmaps:!1,type:Me,format:Ae,encoding:xt,depthBuffer:!1},i=na(e,t,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=na(e,t,n);const{_lodMax:i}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(e){const t=[],n=[],i=[];let r=e;const a=e-jr+1+Xr.length;for(let s=0;s<a;s++){const a=Math.pow(2,r);n.push(a);let o=1/a;s>e-jr?o=Xr[s-e+jr-1]:0===s&&(o=0),i.push(o);const l=1/(a-2),u=-l,c=1+l,h=[u,u,c,u,c,c,u,u,c,c,u,c],d=6,p=6,f=3,m=2,g=1,v=new Float32Array(f*p*d),_=new Float32Array(m*p*d),x=new Float32Array(g*p*d);for(let e=0;e<d;e++){const t=e%3*2/3-1,n=e>2?0:-1,i=[t,n,0,t+2/3,n,0,t+2/3,n+1,0,t,n,0,t+2/3,n+1,0,t,n+1,0];v.set(i,f*p*e),_.set(h,m*p*e);const r=[e,e,e,e,e,e];x.set(r,g*p*e)}const y=new Zi;y.setAttribute("position",new ki(v,f)),y.setAttribute("uv",new ki(_,m)),y.setAttribute("faceIndex",new ki(x,g)),t.push(y),r>jr&&r--}return{lodPlanes:t,sizeLods:n,sigmas:i}}(i)),this._blurMaterial=function(e,t,n){const i=new Float32Array(Yr),r=new Jt(0,1,0),a=new _r({name:"SphericalGaussianBlur",defines:{n:Yr,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:`${e}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:sa(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:g,depthTest:!1,depthWrite:!1});return a}(i,e,t)}return i}_compileMaterial(e){const t=new hr(this._lodPlanes[0],e);this._renderer.compile(t,Jr)}_sceneToCubeUV(e,t,n,i){const r=new yr(90,1,t,n),a=[1,-1,1,1,1,1],s=[1,1,1,-1,-1,-1],o=this._renderer,l=o.autoClear,u=o.toneMapping;o.getClearColor(Zr),o.toneMapping=J,o.autoClear=!1;const c=new zi({name:"PMREM.Background",side:f,depthWrite:!1,depthTest:!1}),h=new hr(new pr,c);let d=!1;const p=e.background;p?p.isColor&&(c.color.copy(p),e.background=null,d=!0):(c.color.copy(Zr),d=!0);for(let t=0;t<6;t++){const n=t%3;0===n?(r.up.set(0,a[t],0),r.lookAt(s[t],0,0)):1===n?(r.up.set(0,0,a[t]),r.lookAt(0,s[t],0)):(r.up.set(0,a[t],0),r.lookAt(0,0,s[t]));const l=this._cubeSize;ia(i,n*l,t>2?l:0,l,l),o.setRenderTarget(i),d&&o.render(h,r),o.render(e,r)}h.geometry.dispose(),h.material.dispose(),o.toneMapping=u,o.autoClear=l,e.background=p}_textureToCubeUV(e,t){const n=this._renderer,i=e.mapping===te||e.mapping===ne;i?(null===this._cubemapMaterial&&(this._cubemapMaterial=aa()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=ra());const r=i?this._cubemapMaterial:this._equirectMaterial,a=new hr(this._lodPlanes[0],r);r.uniforms.envMap.value=e;const s=this._cubeSize;ia(t,0,0,3*s,2*s),n.setRenderTarget(t),n.render(a,Jr)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;for(let t=1;t<this._lodPlanes.length;t++){const n=Math.sqrt(this._sigmas[t]*this._sigmas[t]-this._sigmas[t-1]*this._sigmas[t-1]),i=ea[(t-1)%ea.length];this._blur(e,t-1,t,n,i)}t.autoClear=n}_blur(e,t,n,i,r){const a=this._pingPongRenderTarget;this._halfBlur(e,a,t,n,i,"latitudinal",r),this._halfBlur(a,e,n,n,i,"longitudinal",r)}_halfBlur(e,t,n,i,r,a,s){const o=this._renderer,l=this._blurMaterial;"latitudinal"!==a&&"longitudinal"!==a&&console.error("blur direction must be either latitudinal or longitudinal!");const u=new hr(this._lodPlanes[i],l),c=l.uniforms,h=this._sizeLods[n]-1,d=isFinite(r)?Math.PI/(2*h):2*Math.PI/(2*Yr-1),p=r/d,f=isFinite(r)?1+Math.floor(3*p):Yr;f>Yr&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${f} samples when the maximum is set to ${Yr}`);const m=[];let g=0;for(let e=0;e<Yr;++e){const t=e/p,n=Math.exp(-t*t/2);m.push(n),0===e?g+=n:e<f&&(g+=2*n)}for(let e=0;e<m.length;e++)m[e]=m[e]/g;c.envMap.value=e.texture,c.samples.value=f,c.weights.value=m,c.latitudinal.value="latitudinal"===a,s&&(c.poleAxis.value=s);const{_lodMax:v}=this;c.dTheta.value=d,c.mipInt.value=v-n;const _=this._sizeLods[i];ia(t,3*_*(i>v-jr?i-v+jr:0),4*(this._cubeSize-_),3*_,2*_),o.setRenderTarget(t),o.render(u,Jr)}}function na(e,t,n){const i=new mn(e,t,n);return i.texture.mapping=ae,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function ia(e,t,n,i,r){e.viewport.set(t,n,i,r),e.scissor.set(t,n,i,r)}function ra(){return new _r({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:sa(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:g,depthTest:!1,depthWrite:!1})}function aa(){return new _r({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:sa(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:g,depthTest:!1,depthWrite:!1})}function sa(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function oa(e){let t=new WeakMap,n=null;function i(e){const n=e.target;n.removeEventListener("dispose",i);const r=t.get(n);void 0!==r&&(t.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture){const a=r.mapping,s=a===ie||a===re,o=a===te||a===ne;if(s||o){if(r.isRenderTargetTexture&&!0===r.needsPMREMUpdate){r.needsPMREMUpdate=!1;let i=t.get(r);return null===n&&(n=new ta(e)),i=s?n.fromEquirectangular(r,i):n.fromCubemap(r,i),t.set(r,i),i.texture}if(t.has(r))return t.get(r).texture;{const a=r.image;if(s&&a&&a.height>0||o&&a&&function(e){let t=0;const n=6;for(let i=0;i<n;i++)void 0!==e[i]&&t++;return t===n}(a)){null===n&&(n=new ta(e));const a=s?n.fromEquirectangular(r):n.fromCubemap(r);return t.set(r,a),r.addEventListener("dispose",i),a.texture}return null}}}return r},dispose:function(){t=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function la(e){const t={};function n(n){if(void 0!==t[n])return t[n];let i;switch(n){case"WEBGL_depth_texture":i=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=e.getExtension(n)}return t[n]=i,i}return{has:function(e){return null!==n(e)},init:function(e){e.isWebGL2?n("EXT_color_buffer_float"):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture")},get:function(e){const t=n(e);return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function ua(e,t,n,i){const r={},a=new WeakMap;function s(e){const o=e.target;null!==o.index&&t.remove(o.index);for(const e in o.attributes)t.remove(o.attributes[e]);o.removeEventListener("dispose",s),delete r[o.id];const l=a.get(o);l&&(t.remove(l),a.delete(o)),i.releaseStatesOfGeometry(o),!0===o.isInstancedBufferGeometry&&delete o._maxInstanceCount,n.memory.geometries--}function o(e){const n=[],i=e.index,r=e.attributes.position;let s=0;if(null!==i){const e=i.array;s=i.version;for(let t=0,i=e.length;t<i;t+=3){const i=e[t+0],r=e[t+1],a=e[t+2];n.push(i,r,r,a,a,i)}}else{const e=r.array;s=r.version;for(let t=0,i=e.length/3-1;t<i;t+=3){const e=t+0,i=t+1,r=t+2;n.push(e,i,i,r,r,e)}}const o=new(jt(n)?Vi:Bi)(n,1);o.version=s;const l=a.get(e);l&&t.remove(l),a.set(e,o)}return{get:function(e,t){return!0===r[t.id]||(t.addEventListener("dispose",s),r[t.id]=!0,n.memory.geometries++),t},update:function(e){const n=e.attributes;for(const e in n)t.update(n[e],34962);const i=e.morphAttributes;for(const e in i){const n=i[e];for(let e=0,i=n.length;e<i;e++)t.update(n[e],34962)}},getWireframeAttribute:function(e){const t=a.get(e);if(t){const n=e.index;null!==n&&t.version<n.version&&o(e)}else o(e);return a.get(e)}}}function ca(e,t,n,i){const r=i.isWebGL2;let a,s,o;this.setMode=function(e){a=e},this.setIndex=function(e){s=e.type,o=e.bytesPerElement},this.render=function(t,i){e.drawElements(a,i,s,t*o),n.update(i,a,1)},this.renderInstances=function(i,l,u){if(0===u)return;let c,h;if(r)c=e,h="drawElementsInstanced";else if(c=t.get("ANGLE_instanced_arrays"),h="drawElementsInstancedANGLE",null===c)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");c[h](a,l,s,i*o,u),n.update(l,a,u)}}function ha(e){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(e,n,i){switch(t.calls++,n){case 4:t.triangles+=i*(e/3);break;case 1:t.lines+=i*(e/2);break;case 3:t.lines+=i*(e-1);break;case 2:t.lines+=i*e;break;case 0:t.points+=i*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}function da(e,t){return e[0]-t[0]}function pa(e,t){return Math.abs(t[1])-Math.abs(e[1])}function fa(e,t,n){const i={},r=new Float32Array(8),a=new WeakMap,s=new fn,o=[];for(let e=0;e<8;e++)o[e]=[e,0];return{update:function(l,u,c){const h=l.morphTargetInfluences;if(!0===t.isWebGL2){const i=u.morphAttributes.position||u.morphAttributes.normal||u.morphAttributes.color,r=void 0!==i?i.length:0;let o=a.get(u);if(void 0===o||o.count!==r){void 0!==o&&o.texture.dispose();const e=void 0!==u.morphAttributes.position,n=void 0!==u.morphAttributes.normal,i=void 0!==u.morphAttributes.color,l=u.morphAttributes.position||[],c=u.morphAttributes.normal||[],h=u.morphAttributes.color||[];let d=0;!0===e&&(d=1),!0===n&&(d=2),!0===i&&(d=3);let p=u.attributes.position.count*d,f=1;p>t.maxTextureSize&&(f=Math.ceil(p/t.maxTextureSize),p=t.maxTextureSize);const m=new Float32Array(p*f*4*r),g=new gn(m,p,f,r);g.type=be,g.needsUpdate=!0;const v=4*d;for(let t=0;t<r;t++){const r=l[t],a=c[t],o=h[t],u=p*f*4*t;for(let t=0;t<r.count;t++){const l=t*v;!0===e&&(s.fromBufferAttribute(r,t),m[u+l+0]=s.x,m[u+l+1]=s.y,m[u+l+2]=s.z,m[u+l+3]=0),!0===n&&(s.fromBufferAttribute(a,t),m[u+l+4]=s.x,m[u+l+5]=s.y,m[u+l+6]=s.z,m[u+l+7]=0),!0===i&&(s.fromBufferAttribute(o,t),m[u+l+8]=s.x,m[u+l+9]=s.y,m[u+l+10]=s.z,m[u+l+11]=4===o.itemSize?s.w:1)}}o={count:r,texture:g,size:new Ht(p,f)},a.set(u,o),u.addEventListener("dispose",(function e(){g.dispose(),a.delete(u),u.removeEventListener("dispose",e)}))}let l=0;for(let e=0;e<h.length;e++)l+=h[e];const d=u.morphTargetsRelative?1:1-l;c.getUniforms().setValue(e,"morphTargetBaseInfluence",d),c.getUniforms().setValue(e,"morphTargetInfluences",h),c.getUniforms().setValue(e,"morphTargetsTexture",o.texture,n),c.getUniforms().setValue(e,"morphTargetsTextureSize",o.size)}else{const t=void 0===h?0:h.length;let n=i[u.id];if(void 0===n||n.length!==t){n=[];for(let e=0;e<t;e++)n[e]=[e,0];i[u.id]=n}for(let e=0;e<t;e++){const t=n[e];t[0]=e,t[1]=h[e]}n.sort(pa);for(let e=0;e<8;e++)e<t&&n[e][1]?(o[e][0]=n[e][0],o[e][1]=n[e][1]):(o[e][0]=Number.MAX_SAFE_INTEGER,o[e][1]=0);o.sort(da);const a=u.morphAttributes.position,s=u.morphAttributes.normal;let l=0;for(let e=0;e<8;e++){const t=o[e],n=t[0],i=t[1];n!==Number.MAX_SAFE_INTEGER&&i?(a&&u.getAttribute("morphTarget"+e)!==a[n]&&u.setAttribute("morphTarget"+e,a[n]),s&&u.getAttribute("morphNormal"+e)!==s[n]&&u.setAttribute("morphNormal"+e,s[n]),r[e]=i,l+=i):(a&&!0===u.hasAttribute("morphTarget"+e)&&u.deleteAttribute("morphTarget"+e),s&&!0===u.hasAttribute("morphNormal"+e)&&u.deleteAttribute("morphNormal"+e),r[e]=0)}const d=u.morphTargetsRelative?1:1-l;c.getUniforms().setValue(e,"morphTargetBaseInfluence",d),c.getUniforms().setValue(e,"morphTargetInfluences",r)}}}}function ma(e,t,n,i){let r=new WeakMap;function a(e){const t=e.target;t.removeEventListener("dispose",a),n.remove(t.instanceMatrix),null!==t.instanceColor&&n.remove(t.instanceColor)}return{update:function(e){const s=i.render.frame,o=e.geometry,l=t.get(e,o);return r.get(l)!==s&&(t.update(l),r.set(l,s)),e.isInstancedMesh&&(!1===e.hasEventListener("dispose",a)&&e.addEventListener("dispose",a),n.update(e.instanceMatrix,34962),null!==e.instanceColor&&n.update(e.instanceColor,34962)),l},dispose:function(){r=new WeakMap}}}const ga=new pn,va=new gn,_a=new vn,xa=new Sr,ya=[],ba=[],Ma=new Float32Array(16),Sa=new Float32Array(9),wa=new Float32Array(4);function Ta(e,t,n){const i=e[0];if(i<=0||i>0)return e;const r=t*n;let a=ya[r];if(void 0===a&&(a=new Float32Array(r),ya[r]=a),0!==t){i.toArray(a,0);for(let i=1,r=0;i!==t;++i)r+=n,e[i].toArray(a,r)}return a}function Ea(e,t){if(e.length!==t.length)return!1;for(let n=0,i=e.length;n<i;n++)if(e[n]!==t[n])return!1;return!0}function Aa(e,t){for(let n=0,i=t.length;n<i;n++)e[n]=t[n]}function Ca(e,t){let n=ba[t];void 0===n&&(n=new Int32Array(t),ba[t]=n);for(let i=0;i!==t;++i)n[i]=e.allocateTextureUnit();return n}function La(e,t){const n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function Pa(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(Ea(n,t))return;e.uniform2fv(this.addr,t),Aa(n,t)}}function Ra(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(Ea(n,t))return;e.uniform3fv(this.addr,t),Aa(n,t)}}function Da(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(Ea(n,t))return;e.uniform4fv(this.addr,t),Aa(n,t)}}function Ia(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(Ea(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),Aa(n,t)}else{if(Ea(n,i))return;wa.set(i),e.uniformMatrix2fv(this.addr,!1,wa),Aa(n,i)}}function Oa(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(Ea(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),Aa(n,t)}else{if(Ea(n,i))return;Sa.set(i),e.uniformMatrix3fv(this.addr,!1,Sa),Aa(n,i)}}function Na(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(Ea(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),Aa(n,t)}else{if(Ea(n,i))return;Ma.set(i),e.uniformMatrix4fv(this.addr,!1,Ma),Aa(n,i)}}function za(e,t){const n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function Ua(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2i(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(Ea(n,t))return;e.uniform2iv(this.addr,t),Aa(n,t)}}function Fa(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3i(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(Ea(n,t))return;e.uniform3iv(this.addr,t),Aa(n,t)}}function ka(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(Ea(n,t))return;e.uniform4iv(this.addr,t),Aa(n,t)}}function Ba(e,t){const n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function Va(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2ui(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(Ea(n,t))return;e.uniform2uiv(this.addr,t),Aa(n,t)}}function Ga(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3ui(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(Ea(n,t))return;e.uniform3uiv(this.addr,t),Aa(n,t)}}function Ha(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(Ea(n,t))return;e.uniform4uiv(this.addr,t),Aa(n,t)}}function qa(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture2D(t||ga,r)}function Wa(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture3D(t||_a,r)}function ja(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTextureCube(t||xa,r)}function Xa(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture2DArray(t||va,r)}function Ya(e,t){e.uniform1fv(this.addr,t)}function Ja(e,t){const n=Ta(t,this.size,2);e.uniform2fv(this.addr,n)}function Za(e,t){const n=Ta(t,this.size,3);e.uniform3fv(this.addr,n)}function Ka(e,t){const n=Ta(t,this.size,4);e.uniform4fv(this.addr,n)}function Qa(e,t){const n=Ta(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function $a(e,t){const n=Ta(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function es(e,t){const n=Ta(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function ts(e,t){e.uniform1iv(this.addr,t)}function ns(e,t){e.uniform2iv(this.addr,t)}function is(e,t){e.uniform3iv(this.addr,t)}function rs(e,t){e.uniform4iv(this.addr,t)}function as(e,t){e.uniform1uiv(this.addr,t)}function ss(e,t){e.uniform2uiv(this.addr,t)}function os(e,t){e.uniform3uiv(this.addr,t)}function ls(e,t){e.uniform4uiv(this.addr,t)}function us(e,t,n){const i=this.cache,r=t.length,a=Ca(n,r);Ea(i,a)||(e.uniform1iv(this.addr,a),Aa(i,a));for(let e=0;e!==r;++e)n.setTexture2D(t[e]||ga,a[e])}function cs(e,t,n){const i=this.cache,r=t.length,a=Ca(n,r);Ea(i,a)||(e.uniform1iv(this.addr,a),Aa(i,a));for(let e=0;e!==r;++e)n.setTexture3D(t[e]||_a,a[e])}function hs(e,t,n){const i=this.cache,r=t.length,a=Ca(n,r);Ea(i,a)||(e.uniform1iv(this.addr,a),Aa(i,a));for(let e=0;e!==r;++e)n.setTextureCube(t[e]||xa,a[e])}function ds(e,t,n){const i=this.cache,r=t.length,a=Ca(n,r);Ea(i,a)||(e.uniform1iv(this.addr,a),Aa(i,a));for(let e=0;e!==r;++e)n.setTexture2DArray(t[e]||va,a[e])}class ps{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=function(e){switch(e){case 5126:return La;case 35664:return Pa;case 35665:return Ra;case 35666:return Da;case 35674:return Ia;case 35675:return Oa;case 35676:return Na;case 5124:case 35670:return za;case 35667:case 35671:return Ua;case 35668:case 35672:return Fa;case 35669:case 35673:return ka;case 5125:return Ba;case 36294:return Va;case 36295:return Ga;case 36296:return Ha;case 35678:case 36198:case 36298:case 36306:case 35682:return qa;case 35679:case 36299:case 36307:return Wa;case 35680:case 36300:case 36308:case 36293:return ja;case 36289:case 36303:case 36311:case 36292:return Xa}}(t.type)}}class fs{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return Ya;case 35664:return Ja;case 35665:return Za;case 35666:return Ka;case 35674:return Qa;case 35675:return $a;case 35676:return es;case 5124:case 35670:return ts;case 35667:case 35671:return ns;case 35668:case 35672:return is;case 35669:case 35673:return rs;case 5125:return as;case 36294:return ss;case 36295:return os;case 36296:return ls;case 35678:case 36198:case 36298:case 36306:case 35682:return us;case 35679:case 36299:case 36307:return cs;case 35680:case 36300:case 36308:case 36293:return hs;case 36289:case 36303:case 36311:case 36292:return ds}}(t.type)}}class ms{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const i=this.seq;for(let r=0,a=i.length;r!==a;++r){const a=i[r];a.setValue(e,t[a.id],n)}}}const gs=/(\w+)(\])?(\[|\.)?/g;function vs(e,t){e.seq.push(t),e.map[t.id]=t}function _s(e,t,n){const i=e.name,r=i.length;for(gs.lastIndex=0;;){const a=gs.exec(i),s=gs.lastIndex;let o=a[1];const l="]"===a[2],u=a[3];if(l&&(o|=0),void 0===u||"["===u&&s+2===r){vs(n,void 0===u?new ps(o,e,t):new fs(o,e,t));break}{let e=n.map[o];void 0===e&&(e=new ms(o),vs(n,e)),n=e}}}class xs{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,35718);for(let i=0;i<n;++i){const n=e.getActiveUniform(t,i);_s(n,e.getUniformLocation(t,n.name),this)}}setValue(e,t,n,i){const r=this.map[t];void 0!==r&&r.setValue(e,n,i)}setOptional(e,t,n){const i=t[n];void 0!==i&&this.setValue(e,n,i)}static upload(e,t,n,i){for(let r=0,a=t.length;r!==a;++r){const a=t[r],s=n[a.id];!1!==s.needsUpdate&&a.setValue(e,s.value,i)}}static seqWithValue(e,t){const n=[];for(let i=0,r=e.length;i!==r;++i){const r=e[i];r.id in t&&n.push(r)}return n}}function ys(e,t,n){const i=e.createShader(t);return e.shaderSource(i,n),e.compileShader(i),i}let bs=0;function Ms(e,t,n){const i=e.getShaderParameter(t,35713),r=e.getShaderInfoLog(t).trim();if(i&&""===r)return"";const a=/ERROR: 0:(\d+)/.exec(r);if(a){const i=parseInt(a[1]);return n.toUpperCase()+"\n\n"+r+"\n\n"+function(e,t){const n=e.split("\n"),i=[],r=Math.max(t-6,0),a=Math.min(t+6,n.length);for(let e=r;e<a;e++){const r=e+1;i.push(`${r===t?">":" "} ${r}: ${n[e]}`)}return i.join("\n")}(e.getShaderSource(t),i)}return r}function Ss(e,t){const n=function(e){switch(e){case xt:return["Linear","( value )"];case yt:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function ws(e,t){let n;switch(t){case Z:n="Linear";break;case K:n="Reinhard";break;case Q:n="OptimizedCineon";break;case $:n="ACESFilmic";break;case ee:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),n="Linear"}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function Ts(e){return""!==e}function Es(e,t){const n=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function As(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const Cs=/^[ \t]*#include +<([\w\d./]+)>/gm;function Ls(e){return e.replace(Cs,Ps)}function Ps(e,t){const n=Nr[t];if(void 0===n)throw new Error("Can not resolve #include <"+t+">");return Ls(n)}const Rs=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Ds(e){return e.replace(Rs,Is)}function Is(e,t,n,i){let r="";for(let e=parseInt(t);e<parseInt(n);e++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+e+" ]").replace(/UNROLLED_LOOP_INDEX/g,e);return r}function Os(e){let t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function Ns(e,t,n,i){const r=e.getContext(),a=n.defines;let s=n.vertexShader,o=n.fragmentShader;const l=function(e){let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===c?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===h?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===d&&(t="SHADOWMAP_TYPE_VSM"),t}(n),u=function(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case te:case ne:t="ENVMAP_TYPE_CUBE";break;case ae:t="ENVMAP_TYPE_CUBE_UV"}return t}(n),p=function(e){let t="ENVMAP_MODE_REFLECTION";e.envMap&&e.envMapMode===ne&&(t="ENVMAP_MODE_REFRACTION");return t}(n),f=function(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case j:t="ENVMAP_BLENDING_MULTIPLY";break;case X:t="ENVMAP_BLENDING_MIX";break;case Y:t="ENVMAP_BLENDING_ADD"}return t}(n),m=function(e){const t=e.envMapCubeUVHeight;if(null===t)return null;const n=Math.log2(t)-2,i=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,n),112)),texelHeight:i,maxMip:n}}(n),g=n.isWebGL2?"":function(e){return[e.extensionDerivatives||e.envMapCubeUVHeight||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Ts).join("\n")}(n),v=function(e){const t=[];for(const n in e){const i=e[n];!1!==i&&t.push("#define "+n+" "+i)}return t.join("\n")}(a),_=r.createProgram();let x,y,b=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(x=[v].filter(Ts).join("\n"),x.length>0&&(x+="\n"),y=[g,v].filter(Ts).join("\n"),y.length>0&&(y+="\n")):(x=[Os(n),"#define SHADER_NAME "+n.shaderName,v,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+p:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",n.specularColorMap?"#define USE_SPECULARCOLORMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEENCOLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.morphColors&&n.isWebGL2?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Ts).join("\n"),y=[g,Os(n),"#define SHADER_NAME "+n.shaderName,v,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+u:"",n.envMap?"#define "+p:"",n.envMap?"#define "+f:"",m?"#define CUBEUV_TEXEL_WIDTH "+m.texelWidth:"",m?"#define CUBEUV_TEXEL_HEIGHT "+m.texelHeight:"",m?"#define CUBEUV_MAX_MIP "+m.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",n.specularColorMap?"#define USE_SPECULARCOLORMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEENCOLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.useLegacyLights?"#define LEGACY_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==J?"#define TONE_MAPPING":"",n.toneMapping!==J?Nr.tonemapping_pars_fragment:"",n.toneMapping!==J?ws("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",Nr.encodings_pars_fragment,Ss("linearToOutputTexel",n.outputEncoding),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(Ts).join("\n")),s=Ls(s),s=Es(s,n),s=As(s,n),o=Ls(o),o=Es(o,n),o=As(o,n),s=Ds(s),o=Ds(o),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(b="#version 300 es\n",x=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+x,y=["#define varying in",n.glslVersion===Lt?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===Lt?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+y);const M=b+y+o,S=ys(r,35633,b+x+s),w=ys(r,35632,M);if(r.attachShader(_,S),r.attachShader(_,w),void 0!==n.index0AttributeName?r.bindAttribLocation(_,0,n.index0AttributeName):!0===n.morphTargets&&r.bindAttribLocation(_,0,"position"),r.linkProgram(_),e.debug.checkShaderErrors){const e=r.getProgramInfoLog(_).trim(),t=r.getShaderInfoLog(S).trim(),n=r.getShaderInfoLog(w).trim();let i=!0,a=!0;if(!1===r.getProgramParameter(_,35714)){i=!1;const t=Ms(r,S,"vertex"),n=Ms(r,w,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(_,35715)+"\n\nProgram Info Log: "+e+"\n"+t+"\n"+n)}else""!==e?console.warn("THREE.WebGLProgram: Program Info Log:",e):""!==t&&""!==n||(a=!1);a&&(this.diagnostics={runnable:i,programLog:e,vertexShader:{log:t,prefix:x},fragmentShader:{log:n,prefix:y}})}let T,E;return r.deleteShader(S),r.deleteShader(w),this.getUniforms=function(){return void 0===T&&(T=new xs(r,_)),T},this.getAttributes=function(){return void 0===E&&(E=function(e,t){const n={},i=e.getProgramParameter(t,35721);for(let r=0;r<i;r++){const i=e.getActiveAttrib(t,r),a=i.name;let s=1;35674===i.type&&(s=2),35675===i.type&&(s=3),35676===i.type&&(s=4),n[a]={type:i.type,location:e.getAttribLocation(t,a),locationSize:s}}return n}(r,_)),E},this.destroy=function(){i.releaseStatesOfProgram(this),r.deleteProgram(_),this.program=void 0},this.name=n.shaderName,this.id=bs++,this.cacheKey=t,this.usedTimes=1,this.program=_,this.vertexShader=S,this.fragmentShader=w,this}let zs=0;class Us{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,i=this._getShaderStage(t),r=this._getShaderStage(n),a=this._getShaderCacheForMaterial(e);return!1===a.has(i)&&(a.add(i),i.usedTimes++),!1===a.has(r)&&(a.add(r),r.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const e of t)e.usedTimes--,0===e.usedTimes&&this.shaderCache.delete(e.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let n=t.get(e);return void 0===n&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){const t=this.shaderCache;let n=t.get(e);return void 0===n&&(n=new Fs(e),t.set(e,n)),n}}class Fs{constructor(e){this.id=zs++,this.code=e,this.usedTimes=0}}function ks(e,t,n,i,r,a,s){const o=new ni,l=new Us,u=[],c=r.isWebGL2,h=r.logarithmicDepthBuffer,d=r.vertexTextures;let p=r.precision;const g={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};return{getParameters:function(a,o,u,_,x){const y=_.fog,b=x.geometry,M=a.isMeshStandardMaterial?_.environment:null,S=(a.isMeshStandardMaterial?n:t).get(a.envMap||M),w=S&&S.mapping===ae?S.image.height:null,T=g[a.type];null!==a.precision&&(p=r.getMaxPrecision(a.precision),p!==a.precision&&console.warn("THREE.WebGLProgram.getParameters:",a.precision,"not supported, using",p,"instead."));const E=b.morphAttributes.position||b.morphAttributes.normal||b.morphAttributes.color,A=void 0!==E?E.length:0;let C,L,P,R,D=0;if(void 0!==b.morphAttributes.position&&(D=1),void 0!==b.morphAttributes.normal&&(D=2),void 0!==b.morphAttributes.color&&(D=3),T){const e=Ur[T];C=e.vertexShader,L=e.fragmentShader}else C=a.vertexShader,L=a.fragmentShader,l.update(a),P=l.getVertexShaderID(a),R=l.getFragmentShaderID(a);const I=e.getRenderTarget(),O=a.alphaTest>0,N=a.clearcoat>0,z=a.iridescence>0;return{isWebGL2:c,shaderID:T,shaderName:a.type,vertexShader:C,fragmentShader:L,defines:a.defines,customVertexShaderID:P,customFragmentShaderID:R,isRawShaderMaterial:!0===a.isRawShaderMaterial,glslVersion:a.glslVersion,precision:p,instancing:!0===x.isInstancedMesh,instancingColor:!0===x.isInstancedMesh&&null!==x.instanceColor,supportsVertexTextures:d,outputEncoding:null===I?e.outputEncoding:!0===I.isXRRenderTarget?I.texture.encoding:xt,map:!!a.map,matcap:!!a.matcap,envMap:!!S,envMapMode:S&&S.mapping,envMapCubeUVHeight:w,lightMap:!!a.lightMap,aoMap:!!a.aoMap,emissiveMap:!!a.emissiveMap,bumpMap:!!a.bumpMap,normalMap:!!a.normalMap,objectSpaceNormalMap:a.normalMapType===St,tangentSpaceNormalMap:a.normalMapType===Mt,decodeVideoTexture:!!a.map&&!0===a.map.isVideoTexture&&a.map.encoding===yt,clearcoat:N,clearcoatMap:N&&!!a.clearcoatMap,clearcoatRoughnessMap:N&&!!a.clearcoatRoughnessMap,clearcoatNormalMap:N&&!!a.clearcoatNormalMap,iridescence:z,iridescenceMap:z&&!!a.iridescenceMap,iridescenceThicknessMap:z&&!!a.iridescenceThicknessMap,displacementMap:!!a.displacementMap,roughnessMap:!!a.roughnessMap,metalnessMap:!!a.metalnessMap,specularMap:!!a.specularMap,specularIntensityMap:!!a.specularIntensityMap,specularColorMap:!!a.specularColorMap,opaque:!1===a.transparent&&a.blending===v,alphaMap:!!a.alphaMap,alphaTest:O,gradientMap:!!a.gradientMap,sheen:a.sheen>0,sheenColorMap:!!a.sheenColorMap,sheenRoughnessMap:!!a.sheenRoughnessMap,transmission:a.transmission>0,transmissionMap:!!a.transmissionMap,thicknessMap:!!a.thicknessMap,combine:a.combine,vertexTangents:!!a.normalMap&&!!b.attributes.tangent,vertexColors:a.vertexColors,vertexAlphas:!0===a.vertexColors&&!!b.attributes.color&&4===b.attributes.color.itemSize,vertexUvs:!!(a.map||a.bumpMap||a.normalMap||a.specularMap||a.alphaMap||a.emissiveMap||a.roughnessMap||a.metalnessMap||a.clearcoatMap||a.clearcoatRoughnessMap||a.clearcoatNormalMap||a.iridescenceMap||a.iridescenceThicknessMap||a.displacementMap||a.transmissionMap||a.thicknessMap||a.specularIntensityMap||a.specularColorMap||a.sheenColorMap||a.sheenRoughnessMap),uvsVertexOnly:!(a.map||a.bumpMap||a.normalMap||a.specularMap||a.alphaMap||a.emissiveMap||a.roughnessMap||a.metalnessMap||a.clearcoatNormalMap||a.iridescenceMap||a.iridescenceThicknessMap||a.transmission>0||a.transmissionMap||a.thicknessMap||a.specularIntensityMap||a.specularColorMap||a.sheen>0||a.sheenColorMap||a.sheenRoughnessMap||!a.displacementMap),fog:!!y,useFog:!0===a.fog,fogExp2:y&&y.isFogExp2,flatShading:!!a.flatShading,sizeAttenuation:a.sizeAttenuation,logarithmicDepthBuffer:h,skinning:!0===x.isSkinnedMesh,morphTargets:void 0!==b.morphAttributes.position,morphNormals:void 0!==b.morphAttributes.normal,morphColors:void 0!==b.morphAttributes.color,morphTargetsCount:A,morphTextureStride:D,numDirLights:o.directional.length,numPointLights:o.point.length,numSpotLights:o.spot.length,numSpotLightMaps:o.spotLightMap.length,numRectAreaLights:o.rectArea.length,numHemiLights:o.hemi.length,numDirLightShadows:o.directionalShadowMap.length,numPointLightShadows:o.pointShadowMap.length,numSpotLightShadows:o.spotShadowMap.length,numSpotLightShadowsWithMaps:o.numSpotLightShadowsWithMaps,numClippingPlanes:s.numPlanes,numClipIntersection:s.numIntersection,dithering:a.dithering,shadowMapEnabled:e.shadowMap.enabled&&u.length>0,shadowMapType:e.shadowMap.type,toneMapping:a.toneMapped?e.toneMapping:J,useLegacyLights:e.useLegacyLights,premultipliedAlpha:a.premultipliedAlpha,doubleSided:a.side===m,flipSided:a.side===f,useDepthPacking:!!a.depthPacking,depthPacking:a.depthPacking||0,index0AttributeName:a.index0AttributeName,extensionDerivatives:a.extensions&&a.extensions.derivatives,extensionFragDepth:a.extensions&&a.extensions.fragDepth,extensionDrawBuffers:a.extensions&&a.extensions.drawBuffers,extensionShaderTextureLOD:a.extensions&&a.extensions.shaderTextureLOD,rendererExtensionFragDepth:c||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:c||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:c||i.has("EXT_shader_texture_lod"),customProgramCacheKey:a.customProgramCacheKey()}},getProgramCacheKey:function(t){const n=[];if(t.shaderID?n.push(t.shaderID):(n.push(t.customVertexShaderID),n.push(t.customFragmentShaderID)),void 0!==t.defines)for(const e in t.defines)n.push(e),n.push(t.defines[e]);return!1===t.isRawShaderMaterial&&(!function(e,t){e.push(t.precision),e.push(t.outputEncoding),e.push(t.envMapMode),e.push(t.envMapCubeUVHeight),e.push(t.combine),e.push(t.vertexUvs),e.push(t.fogExp2),e.push(t.sizeAttenuation),e.push(t.morphTargetsCount),e.push(t.morphAttributeCount),e.push(t.numDirLights),e.push(t.numPointLights),e.push(t.numSpotLights),e.push(t.numSpotLightMaps),e.push(t.numHemiLights),e.push(t.numRectAreaLights),e.push(t.numDirLightShadows),e.push(t.numPointLightShadows),e.push(t.numSpotLightShadows),e.push(t.numSpotLightShadowsWithMaps),e.push(t.shadowMapType),e.push(t.toneMapping),e.push(t.numClippingPlanes),e.push(t.numClipIntersection),e.push(t.depthPacking)}(n,t),function(e,t){o.disableAll(),t.isWebGL2&&o.enable(0);t.supportsVertexTextures&&o.enable(1);t.instancing&&o.enable(2);t.instancingColor&&o.enable(3);t.map&&o.enable(4);t.matcap&&o.enable(5);t.envMap&&o.enable(6);t.lightMap&&o.enable(7);t.aoMap&&o.enable(8);t.emissiveMap&&o.enable(9);t.bumpMap&&o.enable(10);t.normalMap&&o.enable(11);t.objectSpaceNormalMap&&o.enable(12);t.tangentSpaceNormalMap&&o.enable(13);t.clearcoat&&o.enable(14);t.clearcoatMap&&o.enable(15);t.clearcoatRoughnessMap&&o.enable(16);t.clearcoatNormalMap&&o.enable(17);t.iridescence&&o.enable(18);t.iridescenceMap&&o.enable(19);t.iridescenceThicknessMap&&o.enable(20);t.displacementMap&&o.enable(21);t.specularMap&&o.enable(22);t.roughnessMap&&o.enable(23);t.metalnessMap&&o.enable(24);t.gradientMap&&o.enable(25);t.alphaMap&&o.enable(26);t.alphaTest&&o.enable(27);t.vertexColors&&o.enable(28);t.vertexAlphas&&o.enable(29);t.vertexUvs&&o.enable(30);t.vertexTangents&&o.enable(31);t.uvsVertexOnly&&o.enable(32);e.push(o.mask),o.disableAll(),t.fog&&o.enable(0);t.useFog&&o.enable(1);t.flatShading&&o.enable(2);t.logarithmicDepthBuffer&&o.enable(3);t.skinning&&o.enable(4);t.morphTargets&&o.enable(5);t.morphNormals&&o.enable(6);t.morphColors&&o.enable(7);t.premultipliedAlpha&&o.enable(8);t.shadowMapEnabled&&o.enable(9);t.useLegacyLights&&o.enable(10);t.doubleSided&&o.enable(11);t.flipSided&&o.enable(12);t.useDepthPacking&&o.enable(13);t.dithering&&o.enable(14);t.specularIntensityMap&&o.enable(15);t.specularColorMap&&o.enable(16);t.transmission&&o.enable(17);t.transmissionMap&&o.enable(18);t.thicknessMap&&o.enable(19);t.sheen&&o.enable(20);t.sheenColorMap&&o.enable(21);t.sheenRoughnessMap&&o.enable(22);t.decodeVideoTexture&&o.enable(23);t.opaque&&o.enable(24);e.push(o.mask)}(n,t),n.push(e.outputEncoding)),n.push(t.customProgramCacheKey),n.join()},getUniforms:function(e){const t=g[e.type];let n;if(t){const e=Ur[t];n=vr.clone(e.uniforms)}else n=e.uniforms;return n},acquireProgram:function(t,n){let i;for(let e=0,t=u.length;e<t;e++){const t=u[e];if(t.cacheKey===n){i=t,++i.usedTimes;break}}return void 0===i&&(i=new Ns(e,n,t,a),u.push(i)),i},releaseProgram:function(e){if(0==--e.usedTimes){const t=u.indexOf(e);u[t]=u[u.length-1],u.pop(),e.destroy()}},releaseShaderCache:function(e){l.remove(e)},programs:u,dispose:function(){l.dispose()}}}function Bs(){let e=new WeakMap;return{get:function(t){let n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,i){e.get(t)[n]=i},dispose:function(){e=new WeakMap}}}function Vs(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function Gs(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function Hs(){const e=[];let t=0;const n=[],i=[],r=[];function a(n,i,r,a,s,o){let l=e[t];return void 0===l?(l={id:n.id,object:n,geometry:i,material:r,groupOrder:a,renderOrder:n.renderOrder,z:s,group:o},e[t]=l):(l.id=n.id,l.object=n,l.geometry=i,l.material=r,l.groupOrder=a,l.renderOrder=n.renderOrder,l.z=s,l.group=o),t++,l}return{opaque:n,transmissive:i,transparent:r,init:function(){t=0,n.length=0,i.length=0,r.length=0},push:function(e,t,s,o,l,u){const c=a(e,t,s,o,l,u);s.transmission>0?i.push(c):!0===s.transparent?r.push(c):n.push(c)},unshift:function(e,t,s,o,l,u){const c=a(e,t,s,o,l,u);s.transmission>0?i.unshift(c):!0===s.transparent?r.unshift(c):n.unshift(c)},finish:function(){for(let n=t,i=e.length;n<i;n++){const t=e[n];if(null===t.id)break;t.id=null,t.object=null,t.geometry=null,t.material=null,t.group=null}},sort:function(e,t){n.length>1&&n.sort(e||Vs),i.length>1&&i.sort(t||Gs),r.length>1&&r.sort(t||Gs)}}}function qs(){let e=new WeakMap;return{get:function(t,n){const i=e.get(t);let r;return void 0===i?(r=new Hs,e.set(t,[r])):n>=i.length?(r=new Hs,i.push(r)):r=i[n],r},dispose:function(){e=new WeakMap}}}function Ws(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":n={direction:new Jt,color:new Oi};break;case"SpotLight":n={position:new Jt,direction:new Jt,color:new Oi,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new Jt,color:new Oi,distance:0,decay:0};break;case"HemisphereLight":n={direction:new Jt,skyColor:new Oi,groundColor:new Oi};break;case"RectAreaLight":n={color:new Oi,position:new Jt,halfWidth:new Jt,halfHeight:new Jt}}return e[t.id]=n,n}}}let js=0;function Xs(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function Ys(e,t){const n=new Ws,i=function(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ht};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ht,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=n,n}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let e=0;e<9;e++)r.probe.push(new Jt);const a=new Jt,s=new Wn,o=new Wn;return{setup:function(a,s){let o=0,l=0,u=0;for(let e=0;e<9;e++)r.probe[e].set(0,0,0);let c=0,h=0,d=0,p=0,f=0,m=0,g=0,v=0,_=0,x=0;a.sort(Xs);const y=!0===s?Math.PI:1;for(let e=0,t=a.length;e<t;e++){const t=a[e],s=t.color,b=t.intensity,M=t.distance,S=t.shadow&&t.shadow.map?t.shadow.map.texture:null;if(t.isAmbientLight)o+=s.r*b*y,l+=s.g*b*y,u+=s.b*b*y;else if(t.isLightProbe)for(let e=0;e<9;e++)r.probe[e].addScaledVector(t.sh.coefficients[e],b);else if(t.isDirectionalLight){const e=n.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*y),t.castShadow){const e=t.shadow,n=i.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,r.directionalShadow[c]=n,r.directionalShadowMap[c]=S,r.directionalShadowMatrix[c]=t.shadow.matrix,m++}r.directional[c]=e,c++}else if(t.isSpotLight){const e=n.get(t);e.position.setFromMatrixPosition(t.matrixWorld),e.color.copy(s).multiplyScalar(b*y),e.distance=M,e.coneCos=Math.cos(t.angle),e.penumbraCos=Math.cos(t.angle*(1-t.penumbra)),e.decay=t.decay,r.spot[d]=e;const a=t.shadow;if(t.map&&(r.spotLightMap[_]=t.map,_++,a.updateMatrices(t),t.castShadow&&x++),r.spotLightMatrix[d]=a.matrix,t.castShadow){const e=i.get(t);e.shadowBias=a.bias,e.shadowNormalBias=a.normalBias,e.shadowRadius=a.radius,e.shadowMapSize=a.mapSize,r.spotShadow[d]=e,r.spotShadowMap[d]=S,v++}d++}else if(t.isRectAreaLight){const e=n.get(t);e.color.copy(s).multiplyScalar(b),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),r.rectArea[p]=e,p++}else if(t.isPointLight){const e=n.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*y),e.distance=t.distance,e.decay=t.decay,t.castShadow){const e=t.shadow,n=i.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,n.shadowCameraNear=e.camera.near,n.shadowCameraFar=e.camera.far,r.pointShadow[h]=n,r.pointShadowMap[h]=S,r.pointShadowMatrix[h]=t.shadow.matrix,g++}r.point[h]=e,h++}else if(t.isHemisphereLight){const e=n.get(t);e.skyColor.copy(t.color).multiplyScalar(b*y),e.groundColor.copy(t.groundColor).multiplyScalar(b*y),r.hemi[f]=e,f++}}p>0&&(t.isWebGL2||!0===e.has("OES_texture_float_linear")?(r.rectAreaLTC1=zr.LTC_FLOAT_1,r.rectAreaLTC2=zr.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")?(r.rectAreaLTC1=zr.LTC_HALF_1,r.rectAreaLTC2=zr.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=o,r.ambient[1]=l,r.ambient[2]=u;const b=r.hash;b.directionalLength===c&&b.pointLength===h&&b.spotLength===d&&b.rectAreaLength===p&&b.hemiLength===f&&b.numDirectionalShadows===m&&b.numPointShadows===g&&b.numSpotShadows===v&&b.numSpotMaps===_||(r.directional.length=c,r.spot.length=d,r.rectArea.length=p,r.point.length=h,r.hemi.length=f,r.directionalShadow.length=m,r.directionalShadowMap.length=m,r.pointShadow.length=g,r.pointShadowMap.length=g,r.spotShadow.length=v,r.spotShadowMap.length=v,r.directionalShadowMatrix.length=m,r.pointShadowMatrix.length=g,r.spotLightMatrix.length=v+_-x,r.spotLightMap.length=_,r.numSpotLightShadowsWithMaps=x,b.directionalLength=c,b.pointLength=h,b.spotLength=d,b.rectAreaLength=p,b.hemiLength=f,b.numDirectionalShadows=m,b.numPointShadows=g,b.numSpotShadows=v,b.numSpotMaps=_,r.version=js++)},setupView:function(e,t){let n=0,i=0,l=0,u=0,c=0;const h=t.matrixWorldInverse;for(let t=0,d=e.length;t<d;t++){const d=e[t];if(d.isDirectionalLight){const e=r.directional[n];e.direction.setFromMatrixPosition(d.matrixWorld),a.setFromMatrixPosition(d.target.matrixWorld),e.direction.sub(a),e.direction.transformDirection(h),n++}else if(d.isSpotLight){const e=r.spot[l];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(h),e.direction.setFromMatrixPosition(d.matrixWorld),a.setFromMatrixPosition(d.target.matrixWorld),e.direction.sub(a),e.direction.transformDirection(h),l++}else if(d.isRectAreaLight){const e=r.rectArea[u];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(h),o.identity(),s.copy(d.matrixWorld),s.premultiply(h),o.extractRotation(s),e.halfWidth.set(.5*d.width,0,0),e.halfHeight.set(0,.5*d.height,0),e.halfWidth.applyMatrix4(o),e.halfHeight.applyMatrix4(o),u++}else if(d.isPointLight){const e=r.point[i];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(h),i++}else if(d.isHemisphereLight){const e=r.hemi[c];e.direction.setFromMatrixPosition(d.matrixWorld),e.direction.transformDirection(h),c++}}},state:r}}function Js(e,t){const n=new Ys(e,t),i=[],r=[];return{init:function(){i.length=0,r.length=0},state:{lightsArray:i,shadowsArray:r,lights:n},setupLights:function(e){n.setup(i,e)},setupLightsView:function(e){n.setupView(i,e)},pushLight:function(e){i.push(e)},pushShadow:function(e){r.push(e)}}}function Zs(e,t){let n=new WeakMap;return{get:function(i,r=0){const a=n.get(i);let s;return void 0===a?(s=new Js(e,t),n.set(i,[s])):r>=a.length?(s=new Js(e,t),a.push(s)):s=a[r],s},dispose:function(){n=new WeakMap}}}class Ks extends Li{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class Qs extends Li{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new Jt,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const $s="void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",eo="uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}";function to(e,t,n){let i=new Rr;const r=new Ht,a=new Ht,s=new fn,o=new Ks({depthPacking:bt}),l=new Qs,u={},h=n.maxTextureSize,v={[p]:f,[f]:p,[m]:m},_=new _r({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Ht},radius:{value:4}},vertexShader:$s,fragmentShader:eo}),x=_.clone();x.defines.HORIZONTAL_PASS=1;const y=new Zi;y.setAttribute("position",new ki(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const b=new hr(y,_),M=this;function S(n,i){const a=t.update(b);_.defines.VSM_SAMPLES!==n.blurSamples&&(_.defines.VSM_SAMPLES=n.blurSamples,x.defines.VSM_SAMPLES=n.blurSamples,_.needsUpdate=!0,x.needsUpdate=!0),null===n.mapPass&&(n.mapPass=new mn(r.x,r.y)),_.uniforms.shadow_pass.value=n.map.texture,_.uniforms.resolution.value=n.mapSize,_.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(i,null,a,_,b,null),x.uniforms.shadow_pass.value=n.mapPass.texture,x.uniforms.resolution.value=n.mapSize,x.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(i,null,a,x,b,null)}function w(t,n,i,r,a,s){let c=null;const h=!0===i.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(void 0!==h)c=h;else if(c=!0===i.isPointLight?l:o,e.localClippingEnabled&&!0===n.clipShadows&&Array.isArray(n.clippingPlanes)&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0||n.map&&n.alphaTest>0){const e=c.uuid,t=n.uuid;let i=u[e];void 0===i&&(i={},u[e]=i);let r=i[t];void 0===r&&(r=c.clone(),i[t]=r),c=r}return c.visible=n.visible,c.wireframe=n.wireframe,c.side=s===d?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:v[n.side],c.alphaMap=n.alphaMap,c.alphaTest=n.alphaTest,c.map=n.map,c.clipShadows=n.clipShadows,c.clippingPlanes=n.clippingPlanes,c.clipIntersection=n.clipIntersection,c.displacementMap=n.displacementMap,c.displacementScale=n.displacementScale,c.displacementBias=n.displacementBias,c.wireframeLinewidth=n.wireframeLinewidth,c.linewidth=n.linewidth,!0===i.isPointLight&&!0===c.isMeshDistanceMaterial&&(c.referencePosition.setFromMatrixPosition(i.matrixWorld),c.nearDistance=r,c.farDistance=a),c}function T(n,r,a,s,o){if(!1===n.visible)return;if(n.layers.test(r.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&o===d)&&(!n.frustumCulled||i.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,n.matrixWorld);const i=t.update(n),r=n.material;if(Array.isArray(r)){const t=i.groups;for(let l=0,u=t.length;l<u;l++){const u=t[l],c=r[u.materialIndex];if(c&&c.visible){const t=w(n,c,s,a.near,a.far,o);e.renderBufferDirect(a,null,i,t,n,u)}}}else if(r.visible){const t=w(n,r,s,a.near,a.far,o);e.renderBufferDirect(a,null,i,t,n,null)}}const l=n.children;for(let e=0,t=l.length;e<t;e++)T(l[e],r,a,s,o)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=c,this.render=function(t,n,o){if(!1===M.enabled)return;if(!1===M.autoUpdate&&!1===M.needsUpdate)return;if(0===t.length)return;const l=e.getRenderTarget(),u=e.getActiveCubeFace(),c=e.getActiveMipmapLevel(),p=e.state;p.setBlending(g),p.buffers.color.setClear(1,1,1,1),p.buffers.depth.setTest(!0),p.setScissorTest(!1);for(let l=0,u=t.length;l<u;l++){const u=t[l],c=u.shadow;if(void 0===c){console.warn("THREE.WebGLShadowMap:",u,"has no shadow.");continue}if(!1===c.autoUpdate&&!1===c.needsUpdate)continue;r.copy(c.mapSize);const f=c.getFrameExtents();if(r.multiply(f),a.copy(c.mapSize),(r.x>h||r.y>h)&&(r.x>h&&(a.x=Math.floor(h/f.x),r.x=a.x*f.x,c.mapSize.x=a.x),r.y>h&&(a.y=Math.floor(h/f.y),r.y=a.y*f.y,c.mapSize.y=a.y)),null===c.map){const e=this.type!==d?{minFilter:ue,magFilter:ue}:{};c.map=new mn(r.x,r.y,e),c.map.texture.name=u.name+".shadowMap",c.camera.updateProjectionMatrix()}e.setRenderTarget(c.map),e.clear();const m=c.getViewportCount();for(let e=0;e<m;e++){const t=c.getViewport(e);s.set(a.x*t.x,a.y*t.y,a.x*t.z,a.y*t.w),p.viewport(s),c.updateMatrices(u,e),i=c.getFrustum(),T(n,o,c.camera,u,this.type)}!0!==c.isPointLightShadow&&this.type===d&&S(c,o),c.needsUpdate=!1}M.needsUpdate=!1,e.setRenderTarget(l,u,c)}}function no(e,t,n){const i=n.isWebGL2;const r=new function(){let t=!1;const n=new fn;let i=null;const r=new fn(0,0,0,0);return{setMask:function(n){i===n||t||(e.colorMask(n,n,n,n),i=n)},setLocked:function(e){t=e},setClear:function(t,i,a,s,o){!0===o&&(t*=s,i*=s,a*=s),n.set(t,i,a,s),!1===r.equals(n)&&(e.clearColor(t,i,a,s),r.copy(n))},reset:function(){t=!1,i=null,r.set(-1,0,0,0)}}},a=new function(){let t=!1,n=null,i=null,r=null;return{setTest:function(e){e?be(2929):Me(2929)},setMask:function(i){n===i||t||(e.depthMask(i),n=i)},setFunc:function(t){if(i!==t){switch(t){case F:e.depthFunc(512);break;case k:e.depthFunc(519);break;case B:e.depthFunc(513);break;case V:e.depthFunc(515);break;case G:e.depthFunc(514);break;case H:e.depthFunc(518);break;case q:e.depthFunc(516);break;case W:e.depthFunc(517);break;default:e.depthFunc(515)}i=t}},setLocked:function(e){t=e},setClear:function(t){r!==t&&(e.clearDepth(t),r=t)},reset:function(){t=!1,n=null,i=null,r=null}}},s=new function(){let t=!1,n=null,i=null,r=null,a=null,s=null,o=null,l=null,u=null;return{setTest:function(e){t||(e?be(2960):Me(2960))},setMask:function(i){n===i||t||(e.stencilMask(i),n=i)},setFunc:function(t,n,s){i===t&&r===n&&a===s||(e.stencilFunc(t,n,s),i=t,r=n,a=s)},setOp:function(t,n,i){s===t&&o===n&&l===i||(e.stencilOp(t,n,i),s=t,o=n,l=i)},setLocked:function(e){t=e},setClear:function(t){u!==t&&(e.clearStencil(t),u=t)},reset:function(){t=!1,n=null,i=null,r=null,a=null,s=null,o=null,l=null,u=null}}},c=new WeakMap,h=new WeakMap;let d={},p={},j=new WeakMap,X=[],Y=null,J=!1,Z=null,K=null,Q=null,$=null,ee=null,te=null,ne=null,ie=!1,re=null,ae=null,se=null,oe=null,le=null;const ue=e.getParameter(35661);let ce=!1,he=0;const de=e.getParameter(7938);-1!==de.indexOf("WebGL")?(he=parseFloat(/^WebGL (\d)/.exec(de)[1]),ce=he>=1):-1!==de.indexOf("OpenGL ES")&&(he=parseFloat(/^OpenGL ES (\d)/.exec(de)[1]),ce=he>=2);let pe=null,fe={};const me=e.getParameter(3088),ge=e.getParameter(2978),ve=(new fn).fromArray(me),_e=(new fn).fromArray(ge);function xe(t,n,i){const r=new Uint8Array(4),a=e.createTexture();e.bindTexture(t,a),e.texParameteri(t,10241,9728),e.texParameteri(t,10240,9728);for(let t=0;t<i;t++)e.texImage2D(n+t,0,6408,1,1,0,6408,5121,r);return a}const ye={};function be(t){!0!==d[t]&&(e.enable(t),d[t]=!0)}function Me(t){!1!==d[t]&&(e.disable(t),d[t]=!1)}ye[3553]=xe(3553,3553,1),ye[34067]=xe(34067,34069,6),r.setClear(0,0,0,1),a.setClear(1),s.setClear(0),be(2929),a.setFunc(V),Ee(!1),Ae(l),be(2884),Te(g);const Se={[M]:32774,[S]:32778,[w]:32779};if(i)Se[T]=32775,Se[E]=32776;else{const e=t.get("EXT_blend_minmax");null!==e&&(Se[T]=e.MIN_EXT,Se[E]=e.MAX_EXT)}const we={[A]:0,[C]:1,[L]:768,[R]:770,[U]:776,[N]:774,[I]:772,[P]:769,[D]:771,[z]:775,[O]:773};function Te(t,n,i,r,a,s,o,l){if(t!==g){if(!1===J&&(be(3042),J=!0),t===b)a=a||n,s=s||i,o=o||r,n===K&&a===ee||(e.blendEquationSeparate(Se[n],Se[a]),K=n,ee=a),i===Q&&r===$&&s===te&&o===ne||(e.blendFuncSeparate(we[i],we[r],we[s],we[o]),Q=i,$=r,te=s,ne=o),Z=t,ie=!1;else if(t!==Z||l!==ie){if(K===M&&ee===M||(e.blendEquation(32774),K=M,ee=M),l)switch(t){case v:e.blendFuncSeparate(1,771,1,771);break;case _:e.blendFunc(1,1);break;case x:e.blendFuncSeparate(0,769,0,1);break;case y:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case v:e.blendFuncSeparate(770,771,1,771);break;case _:e.blendFunc(770,1);break;case x:e.blendFuncSeparate(0,769,0,1);break;case y:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}Q=null,$=null,te=null,ne=null,Z=t,ie=l}}else!0===J&&(Me(3042),J=!1)}function Ee(t){re!==t&&(t?e.frontFace(2304):e.frontFace(2305),re=t)}function Ae(t){t!==o?(be(2884),t!==ae&&(t===l?e.cullFace(1029):t===u?e.cullFace(1028):e.cullFace(1032))):Me(2884),ae=t}function Ce(t,n,i){t?(be(32823),oe===n&&le===i||(e.polygonOffset(n,i),oe=n,le=i)):Me(32823)}return{buffers:{color:r,depth:a,stencil:s},enable:be,disable:Me,bindFramebuffer:function(t,n){return p[t]!==n&&(e.bindFramebuffer(t,n),p[t]=n,i&&(36009===t&&(p[36160]=n),36160===t&&(p[36009]=n)),!0)},drawBuffers:function(i,r){let a=X,s=!1;if(i)if(a=j.get(r),void 0===a&&(a=[],j.set(r,a)),i.isWebGLMultipleRenderTargets){const e=i.texture;if(a.length!==e.length||36064!==a[0]){for(let t=0,n=e.length;t<n;t++)a[t]=36064+t;a.length=e.length,s=!0}}else 36064!==a[0]&&(a[0]=36064,s=!0);else 1029!==a[0]&&(a[0]=1029,s=!0);s&&(n.isWebGL2?e.drawBuffers(a):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(a))},useProgram:function(t){return Y!==t&&(e.useProgram(t),Y=t,!0)},setBlending:Te,setMaterial:function(e,t){e.side===m?Me(2884):be(2884);let n=e.side===f;t&&(n=!n),Ee(n),e.blending===v&&!1===e.transparent?Te(g):Te(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),a.setFunc(e.depthFunc),a.setTest(e.depthTest),a.setMask(e.depthWrite),r.setMask(e.colorWrite);const i=e.stencilWrite;s.setTest(i),i&&(s.setMask(e.stencilWriteMask),s.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),s.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),Ce(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),!0===e.alphaToCoverage?be(32926):Me(32926)},setFlipSided:Ee,setCullFace:Ae,setLineWidth:function(t){t!==se&&(ce&&e.lineWidth(t),se=t)},setPolygonOffset:Ce,setScissorTest:function(e){e?be(3089):Me(3089)},activeTexture:function(t){void 0===t&&(t=33984+ue-1),pe!==t&&(e.activeTexture(t),pe=t)},bindTexture:function(t,n,i){void 0===i&&(i=null===pe?33984+ue-1:pe);let r=fe[i];void 0===r&&(r={type:void 0,texture:void 0},fe[i]=r),r.type===t&&r.texture===n||(pe!==i&&(e.activeTexture(i),pe=i),e.bindTexture(t,n||ye[t]),r.type=t,r.texture=n)},unbindTexture:function(){const t=fe[pe];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexImage3D:function(){try{e.compressedTexImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},updateUBOMapping:function(t,n){let i=h.get(n);void 0===i&&(i=new WeakMap,h.set(n,i));let r=i.get(t);void 0===r&&(r=e.getUniformBlockIndex(n,t.name),i.set(t,r))},uniformBlockBinding:function(t,n){const i=h.get(n).get(t);c.get(n)!==i&&(e.uniformBlockBinding(n,i,t.__bindingPointIndex),c.set(n,i))},texStorage2D:function(){try{e.texStorage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texStorage3D:function(){try{e.texStorage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage2D:function(){try{e.texSubImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage3D:function(){try{e.texSubImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexSubImage2D:function(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexSubImage3D:function(){try{e.compressedTexSubImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===ve.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),ve.copy(t))},viewport:function(t){!1===_e.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),_e.copy(t))},reset:function(){e.disable(3042),e.disable(2884),e.disable(2929),e.disable(32823),e.disable(3089),e.disable(2960),e.disable(32926),e.blendEquation(32774),e.blendFunc(1,0),e.blendFuncSeparate(1,0,1,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(513),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(519,0,4294967295),e.stencilOp(7680,7680,7680),e.clearStencil(0),e.cullFace(1029),e.frontFace(2305),e.polygonOffset(0,0),e.activeTexture(33984),e.bindFramebuffer(36160,null),!0===i&&(e.bindFramebuffer(36009,null),e.bindFramebuffer(36008,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),d={},pe=null,fe={},p={},j=new WeakMap,X=[],Y=null,J=!1,Z=null,K=null,Q=null,$=null,ee=null,te=null,ne=null,ie=!1,re=null,ae=null,se=null,oe=null,le=null,ve.set(0,0,e.canvas.width,e.canvas.height),_e.set(0,0,e.canvas.width,e.canvas.height),r.reset(),a.reset(),s.reset()}}}function io(e,t,n,i,r,a,s){const o=r.isWebGL2,l=r.maxTextures,u=r.maxCubemapSize,c=r.maxTextureSize,h=r.maxSamples,d=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,p="undefined"!=typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),f=new WeakMap;let m;const g=new WeakMap;let v=!1;try{v="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function _(e,t){return v?new OffscreenCanvas(e,t):Xt("canvas")}function x(e,t,n,i){let r=1;if((e.width>i||e.height>i)&&(r=i/Math.max(e.width,e.height)),r<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const i=t?Bt:Math.floor,a=i(r*e.width),s=i(r*e.height);void 0===m&&(m=_(a,s));const o=n?_(a,s):m;o.width=a,o.height=s;return o.getContext("2d").drawImage(e,0,0,a,s),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+a+"x"+s+")."),o}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function y(e){return kt(e.width)&&kt(e.height)}function b(e,t){return e.generateMipmaps&&t&&e.minFilter!==ue&&e.minFilter!==de}function M(t){e.generateMipmap(t)}function S(n,i,r,a,s=!1){if(!1===o)return i;if(null!==n){if(void 0!==e[n])return e[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let l=i;return 6403===i&&(5126===r&&(l=33326),5131===r&&(l=33325),5121===r&&(l=33321)),33319===i&&(5126===r&&(l=33328),5131===r&&(l=33327),5121===r&&(l=33323)),6408===i&&(5126===r&&(l=34836),5131===r&&(l=34842),5121===r&&(l=a===yt&&!1===s?35907:32856),32819===r&&(l=32854),32820===r&&(l=32855)),33325!==l&&33326!==l&&33327!==l&&33328!==l&&34842!==l&&34836!==l||t.get("EXT_color_buffer_float"),l}function w(e,t,n){return!0===b(e,n)||e.isFramebufferTexture&&e.minFilter!==ue&&e.minFilter!==de?Math.log2(Math.max(t.width,t.height))+1:void 0!==e.mipmaps&&e.mipmaps.length>0?e.mipmaps.length:e.isCompressedTexture&&Array.isArray(e.image)?t.mipmaps.length:1}function T(e){return e===ue||e===ce||e===he?9728:9729}function E(e){const t=e.target;t.removeEventListener("dispose",E),function(e){const t=i.get(e);if(void 0===t.__webglInit)return;const n=e.source,r=g.get(n);if(r){const i=r[t.__cacheKey];i.usedTimes--,0===i.usedTimes&&C(e),0===Object.keys(r).length&&g.delete(n)}i.remove(e)}(t),t.isVideoTexture&&f.delete(t)}function A(t){const n=t.target;n.removeEventListener("dispose",A),function(t){const n=t.texture,r=i.get(t),a=i.get(n);void 0!==a.__webglTexture&&(e.deleteTexture(a.__webglTexture),s.memory.textures--);t.depthTexture&&t.depthTexture.dispose();if(t.isWebGLCubeRenderTarget)for(let t=0;t<6;t++)e.deleteFramebuffer(r.__webglFramebuffer[t]),r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer[t]);else{if(e.deleteFramebuffer(r.__webglFramebuffer),r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer),r.__webglMultisampledFramebuffer&&e.deleteFramebuffer(r.__webglMultisampledFramebuffer),r.__webglColorRenderbuffer)for(let t=0;t<r.__webglColorRenderbuffer.length;t++)r.__webglColorRenderbuffer[t]&&e.deleteRenderbuffer(r.__webglColorRenderbuffer[t]);r.__webglDepthRenderbuffer&&e.deleteRenderbuffer(r.__webglDepthRenderbuffer)}if(t.isWebGLMultipleRenderTargets)for(let t=0,r=n.length;t<r;t++){const r=i.get(n[t]);r.__webglTexture&&(e.deleteTexture(r.__webglTexture),s.memory.textures--),i.remove(n[t])}i.remove(n),i.remove(t)}(n)}function C(t){const n=i.get(t);e.deleteTexture(n.__webglTexture);const r=t.source;delete g.get(r)[n.__cacheKey],s.memory.textures--}let L=0;function P(e,t){const r=i.get(e);if(e.isVideoTexture&&function(e){const t=s.render.frame;f.get(e)!==t&&(f.set(e,t),e.update())}(e),!1===e.isRenderTargetTexture&&e.version>0&&r.__version!==e.version){const n=e.image;if(null===n)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==n.complete)return void N(r,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.bindTexture(3553,r.__webglTexture,33984+t)}const R={[se]:10497,[oe]:33071,[le]:33648},D={[ue]:9728,[ce]:9984,[he]:9986,[de]:9729,[pe]:9985,[fe]:9987};function I(n,a,s){if(s?(e.texParameteri(n,10242,R[a.wrapS]),e.texParameteri(n,10243,R[a.wrapT]),32879!==n&&35866!==n||e.texParameteri(n,32882,R[a.wrapR]),e.texParameteri(n,10240,D[a.magFilter]),e.texParameteri(n,10241,D[a.minFilter])):(e.texParameteri(n,10242,33071),e.texParameteri(n,10243,33071),32879!==n&&35866!==n||e.texParameteri(n,32882,33071),a.wrapS===oe&&a.wrapT===oe||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(n,10240,T(a.magFilter)),e.texParameteri(n,10241,T(a.minFilter)),a.minFilter!==ue&&a.minFilter!==de&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===t.has("EXT_texture_filter_anisotropic")){const s=t.get("EXT_texture_filter_anisotropic");if(a.magFilter===ue)return;if(a.minFilter!==he&&a.minFilter!==fe)return;if(a.type===be&&!1===t.has("OES_texture_float_linear"))return;if(!1===o&&a.type===Me&&!1===t.has("OES_texture_half_float_linear"))return;(a.anisotropy>1||i.get(a).__currentAnisotropy)&&(e.texParameterf(n,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(a.anisotropy,r.getMaxAnisotropy())),i.get(a).__currentAnisotropy=a.anisotropy)}}function O(t,n){let i=!1;void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",E));const r=n.source;let a=g.get(r);void 0===a&&(a={},g.set(r,a));const o=function(e){const t=[];return t.push(e.wrapS),t.push(e.wrapT),t.push(e.wrapR||0),t.push(e.magFilter),t.push(e.minFilter),t.push(e.anisotropy),t.push(e.internalFormat),t.push(e.format),t.push(e.type),t.push(e.generateMipmaps),t.push(e.premultiplyAlpha),t.push(e.flipY),t.push(e.unpackAlignment),t.push(e.encoding),t.join()}(n);if(o!==t.__cacheKey){void 0===a[o]&&(a[o]={texture:e.createTexture(),usedTimes:0},s.memory.textures++,i=!0),a[o].usedTimes++;const r=a[t.__cacheKey];void 0!==r&&(a[t.__cacheKey].usedTimes--,0===r.usedTimes&&C(n)),t.__cacheKey=o,t.__webglTexture=a[o].texture}return i}function N(t,r,s){let l=3553;(r.isDataArrayTexture||r.isCompressedArrayTexture)&&(l=35866),r.isData3DTexture&&(l=32879);const u=O(t,r),h=r.source;n.bindTexture(l,t.__webglTexture,33984+s);const d=i.get(h);if(h.version!==d.__version||!0===u){n.activeTexture(33984+s),e.pixelStorei(37440,r.flipY),e.pixelStorei(37441,r.premultiplyAlpha),e.pixelStorei(3317,r.unpackAlignment),e.pixelStorei(37443,0);const t=function(e){return!o&&(e.wrapS!==oe||e.wrapT!==oe||e.minFilter!==ue&&e.minFilter!==de)}(r)&&!1===y(r.image);let i=x(r.image,t,!1,c);i=V(r,i);const p=y(i)||o,f=a.convert(r.format,r.encoding);let m,g=a.convert(r.type),v=S(r.internalFormat,f,g,r.encoding,r.isVideoTexture);I(l,r,p);const _=r.mipmaps,T=o&&!0!==r.isVideoTexture,E=void 0===d.__version||!0===u,A=w(r,i,p);if(r.isDepthTexture)v=6402,o?v=r.type===be?36012:r.type===ye?33190:r.type===Te?35056:33189:r.type===be&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),r.format===Pe&&6402===v&&r.type!==_e&&r.type!==ye&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),r.type=ye,g=a.convert(r.type)),r.format===Re&&6402===v&&(v=34041,r.type!==Te&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),r.type=Te,g=a.convert(r.type))),E&&(T?n.texStorage2D(3553,1,v,i.width,i.height):n.texImage2D(3553,0,v,i.width,i.height,0,f,g,null));else if(r.isDataTexture)if(_.length>0&&p){T&&E&&n.texStorage2D(3553,A,v,_[0].width,_[0].height);for(let e=0,t=_.length;e<t;e++)m=_[e],T?n.texSubImage2D(3553,e,0,0,m.width,m.height,f,g,m.data):n.texImage2D(3553,e,v,m.width,m.height,0,f,g,m.data);r.generateMipmaps=!1}else T?(E&&n.texStorage2D(3553,A,v,i.width,i.height),n.texSubImage2D(3553,0,0,0,i.width,i.height,f,g,i.data)):n.texImage2D(3553,0,v,i.width,i.height,0,f,g,i.data);else if(r.isCompressedTexture)if(r.isCompressedArrayTexture){T&&E&&n.texStorage3D(35866,A,v,_[0].width,_[0].height,i.depth);for(let e=0,t=_.length;e<t;e++)m=_[e],r.format!==Ae?null!==f?T?n.compressedTexSubImage3D(35866,e,0,0,0,m.width,m.height,i.depth,f,m.data,0,0):n.compressedTexImage3D(35866,e,v,m.width,m.height,i.depth,0,m.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):T?n.texSubImage3D(35866,e,0,0,0,m.width,m.height,i.depth,f,g,m.data):n.texImage3D(35866,e,v,m.width,m.height,i.depth,0,f,g,m.data)}else{T&&E&&n.texStorage2D(3553,A,v,_[0].width,_[0].height);for(let e=0,t=_.length;e<t;e++)m=_[e],r.format!==Ae?null!==f?T?n.compressedTexSubImage2D(3553,e,0,0,m.width,m.height,f,m.data):n.compressedTexImage2D(3553,e,v,m.width,m.height,0,m.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):T?n.texSubImage2D(3553,e,0,0,m.width,m.height,f,g,m.data):n.texImage2D(3553,e,v,m.width,m.height,0,f,g,m.data)}else if(r.isDataArrayTexture)T?(E&&n.texStorage3D(35866,A,v,i.width,i.height,i.depth),n.texSubImage3D(35866,0,0,0,0,i.width,i.height,i.depth,f,g,i.data)):n.texImage3D(35866,0,v,i.width,i.height,i.depth,0,f,g,i.data);else if(r.isData3DTexture)T?(E&&n.texStorage3D(32879,A,v,i.width,i.height,i.depth),n.texSubImage3D(32879,0,0,0,0,i.width,i.height,i.depth,f,g,i.data)):n.texImage3D(32879,0,v,i.width,i.height,i.depth,0,f,g,i.data);else if(r.isFramebufferTexture){if(E)if(T)n.texStorage2D(3553,A,v,i.width,i.height);else{let e=i.width,t=i.height;for(let i=0;i<A;i++)n.texImage2D(3553,i,v,e,t,0,f,g,null),e>>=1,t>>=1}}else if(_.length>0&&p){T&&E&&n.texStorage2D(3553,A,v,_[0].width,_[0].height);for(let e=0,t=_.length;e<t;e++)m=_[e],T?n.texSubImage2D(3553,e,0,0,f,g,m):n.texImage2D(3553,e,v,f,g,m);r.generateMipmaps=!1}else T?(E&&n.texStorage2D(3553,A,v,i.width,i.height),n.texSubImage2D(3553,0,0,0,f,g,i)):n.texImage2D(3553,0,v,f,g,i);b(r,p)&&M(l),d.__version=h.version,r.onUpdate&&r.onUpdate(r)}t.__version=r.version}function z(t,r,s,o,l){const u=a.convert(s.format,s.encoding),c=a.convert(s.type),h=S(s.internalFormat,u,c,s.encoding);i.get(r).__hasExternalTextures||(32879===l||35866===l?n.texImage3D(l,0,h,r.width,r.height,r.depth,0,u,c,null):n.texImage2D(l,0,h,r.width,r.height,0,u,c,null)),n.bindFramebuffer(36160,t),B(r)?d.framebufferTexture2DMultisampleEXT(36160,o,l,i.get(s).__webglTexture,0,k(r)):(3553===l||l>=34069&&l<=34074)&&e.framebufferTexture2D(36160,o,l,i.get(s).__webglTexture,0),n.bindFramebuffer(36160,null)}function U(t,n,i){if(e.bindRenderbuffer(36161,t),n.depthBuffer&&!n.stencilBuffer){let r=33189;if(i||B(n)){const t=n.depthTexture;t&&t.isDepthTexture&&(t.type===be?r=36012:t.type===ye&&(r=33190));const i=k(n);B(n)?d.renderbufferStorageMultisampleEXT(36161,i,r,n.width,n.height):e.renderbufferStorageMultisample(36161,i,r,n.width,n.height)}else e.renderbufferStorage(36161,r,n.width,n.height);e.framebufferRenderbuffer(36160,36096,36161,t)}else if(n.depthBuffer&&n.stencilBuffer){const r=k(n);i&&!1===B(n)?e.renderbufferStorageMultisample(36161,r,35056,n.width,n.height):B(n)?d.renderbufferStorageMultisampleEXT(36161,r,35056,n.width,n.height):e.renderbufferStorage(36161,34041,n.width,n.height),e.framebufferRenderbuffer(36160,33306,36161,t)}else{const t=!0===n.isWebGLMultipleRenderTargets?n.texture:[n.texture];for(let r=0;r<t.length;r++){const s=t[r],o=a.convert(s.format,s.encoding),l=a.convert(s.type),u=S(s.internalFormat,o,l,s.encoding),c=k(n);i&&!1===B(n)?e.renderbufferStorageMultisample(36161,c,u,n.width,n.height):B(n)?d.renderbufferStorageMultisampleEXT(36161,c,u,n.width,n.height):e.renderbufferStorage(36161,u,n.width,n.height)}}e.bindRenderbuffer(36161,null)}function F(t){const r=i.get(t),a=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture&&!r.__autoAllocateDepthBuffer){if(a)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,r){if(r&&r.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(36160,t),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");i.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),P(r.depthTexture,0);const a=i.get(r.depthTexture).__webglTexture,s=k(r);if(r.depthTexture.format===Pe)B(r)?d.framebufferTexture2DMultisampleEXT(36160,36096,3553,a,0,s):e.framebufferTexture2D(36160,36096,3553,a,0);else{if(r.depthTexture.format!==Re)throw new Error("Unknown depthTexture format");B(r)?d.framebufferTexture2DMultisampleEXT(36160,33306,3553,a,0,s):e.framebufferTexture2D(36160,33306,3553,a,0)}}(r.__webglFramebuffer,t)}else if(a){r.__webglDepthbuffer=[];for(let i=0;i<6;i++)n.bindFramebuffer(36160,r.__webglFramebuffer[i]),r.__webglDepthbuffer[i]=e.createRenderbuffer(),U(r.__webglDepthbuffer[i],t,!1)}else n.bindFramebuffer(36160,r.__webglFramebuffer),r.__webglDepthbuffer=e.createRenderbuffer(),U(r.__webglDepthbuffer,t,!1);n.bindFramebuffer(36160,null)}function k(e){return Math.min(h,e.samples)}function B(e){const n=i.get(e);return o&&e.samples>0&&!0===t.has("WEBGL_multisampled_render_to_texture")&&!1!==n.__useRenderToTexture}function V(e,n){const i=e.encoding,r=e.format,a=e.type;return!0===e.isCompressedTexture||!0===e.isVideoTexture||e.format===Pt||i!==xt&&(i===yt?!1===o?!0===t.has("EXT_sRGB")&&r===Ae?(e.format=Pt,e.minFilter=de,e.generateMipmaps=!1):n=un.sRGBToLinear(n):r===Ae&&a===me||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",i)),n}this.allocateTextureUnit=function(){const e=L;return e>=l&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+l),L+=1,e},this.resetTextureUnits=function(){L=0},this.setTexture2D=P,this.setTexture2DArray=function(e,t){const r=i.get(e);e.version>0&&r.__version!==e.version?N(r,e,t):n.bindTexture(35866,r.__webglTexture,33984+t)},this.setTexture3D=function(e,t){const r=i.get(e);e.version>0&&r.__version!==e.version?N(r,e,t):n.bindTexture(32879,r.__webglTexture,33984+t)},this.setTextureCube=function(t,r){const s=i.get(t);t.version>0&&s.__version!==t.version?function(t,r,s){if(6!==r.image.length)return;const l=O(t,r),c=r.source;n.bindTexture(34067,t.__webglTexture,33984+s);const h=i.get(c);if(c.version!==h.__version||!0===l){n.activeTexture(33984+s),e.pixelStorei(37440,r.flipY),e.pixelStorei(37441,r.premultiplyAlpha),e.pixelStorei(3317,r.unpackAlignment),e.pixelStorei(37443,0);const t=r.isCompressedTexture||r.image[0].isCompressedTexture,i=r.image[0]&&r.image[0].isDataTexture,d=[];for(let e=0;e<6;e++)d[e]=t||i?i?r.image[e].image:r.image[e]:x(r.image[e],!1,!0,u),d[e]=V(r,d[e]);const p=d[0],f=y(p)||o,m=a.convert(r.format,r.encoding),g=a.convert(r.type),v=S(r.internalFormat,m,g,r.encoding),_=o&&!0!==r.isVideoTexture,T=void 0===h.__version||!0===l;let E,A=w(r,p,f);if(I(34067,r,f),t){_&&T&&n.texStorage2D(34067,A,v,p.width,p.height);for(let e=0;e<6;e++){E=d[e].mipmaps;for(let t=0;t<E.length;t++){const i=E[t];r.format!==Ae?null!==m?_?n.compressedTexSubImage2D(34069+e,t,0,0,i.width,i.height,m,i.data):n.compressedTexImage2D(34069+e,t,v,i.width,i.height,0,i.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):_?n.texSubImage2D(34069+e,t,0,0,i.width,i.height,m,g,i.data):n.texImage2D(34069+e,t,v,i.width,i.height,0,m,g,i.data)}}}else{E=r.mipmaps,_&&T&&(E.length>0&&A++,n.texStorage2D(34067,A,v,d[0].width,d[0].height));for(let e=0;e<6;e++)if(i){_?n.texSubImage2D(34069+e,0,0,0,d[e].width,d[e].height,m,g,d[e].data):n.texImage2D(34069+e,0,v,d[e].width,d[e].height,0,m,g,d[e].data);for(let t=0;t<E.length;t++){const i=E[t].image[e].image;_?n.texSubImage2D(34069+e,t+1,0,0,i.width,i.height,m,g,i.data):n.texImage2D(34069+e,t+1,v,i.width,i.height,0,m,g,i.data)}}else{_?n.texSubImage2D(34069+e,0,0,0,m,g,d[e]):n.texImage2D(34069+e,0,v,m,g,d[e]);for(let t=0;t<E.length;t++){const i=E[t];_?n.texSubImage2D(34069+e,t+1,0,0,m,g,i.image[e]):n.texImage2D(34069+e,t+1,v,m,g,i.image[e])}}}b(r,f)&&M(34067),h.__version=c.version,r.onUpdate&&r.onUpdate(r)}t.__version=r.version}(s,t,r):n.bindTexture(34067,s.__webglTexture,33984+r)},this.rebindTextures=function(e,t,n){const r=i.get(e);void 0!==t&&z(r.__webglFramebuffer,e,e.texture,36064,3553),void 0!==n&&F(e)},this.setupRenderTarget=function(t){const l=t.texture,u=i.get(t),c=i.get(l);t.addEventListener("dispose",A),!0!==t.isWebGLMultipleRenderTargets&&(void 0===c.__webglTexture&&(c.__webglTexture=e.createTexture()),c.__version=l.version,s.memory.textures++);const h=!0===t.isWebGLCubeRenderTarget,d=!0===t.isWebGLMultipleRenderTargets,p=y(t)||o;if(h){u.__webglFramebuffer=[];for(let t=0;t<6;t++)u.__webglFramebuffer[t]=e.createFramebuffer()}else{if(u.__webglFramebuffer=e.createFramebuffer(),d)if(r.drawBuffers){const n=t.texture;for(let t=0,r=n.length;t<r;t++){const r=i.get(n[t]);void 0===r.__webglTexture&&(r.__webglTexture=e.createTexture(),s.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(o&&t.samples>0&&!1===B(t)){const i=d?l:[l];u.__webglMultisampledFramebuffer=e.createFramebuffer(),u.__webglColorRenderbuffer=[],n.bindFramebuffer(36160,u.__webglMultisampledFramebuffer);for(let n=0;n<i.length;n++){const r=i[n];u.__webglColorRenderbuffer[n]=e.createRenderbuffer(),e.bindRenderbuffer(36161,u.__webglColorRenderbuffer[n]);const s=a.convert(r.format,r.encoding),o=a.convert(r.type),l=S(r.internalFormat,s,o,r.encoding,!0===t.isXRRenderTarget),c=k(t);e.renderbufferStorageMultisample(36161,c,l,t.width,t.height),e.framebufferRenderbuffer(36160,36064+n,36161,u.__webglColorRenderbuffer[n])}e.bindRenderbuffer(36161,null),t.depthBuffer&&(u.__webglDepthRenderbuffer=e.createRenderbuffer(),U(u.__webglDepthRenderbuffer,t,!0)),n.bindFramebuffer(36160,null)}}if(h){n.bindTexture(34067,c.__webglTexture),I(34067,l,p);for(let e=0;e<6;e++)z(u.__webglFramebuffer[e],t,l,36064,34069+e);b(l,p)&&M(34067),n.unbindTexture()}else if(d){const e=t.texture;for(let r=0,a=e.length;r<a;r++){const a=e[r],s=i.get(a);n.bindTexture(3553,s.__webglTexture),I(3553,a,p),z(u.__webglFramebuffer,t,a,36064+r,3553),b(a,p)&&M(3553)}n.unbindTexture()}else{let e=3553;(t.isWebGL3DRenderTarget||t.isWebGLArrayRenderTarget)&&(o?e=t.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),n.bindTexture(e,c.__webglTexture),I(e,l,p),z(u.__webglFramebuffer,t,l,36064,e),b(l,p)&&M(e),n.unbindTexture()}t.depthBuffer&&F(t)},this.updateRenderTargetMipmap=function(e){const t=y(e)||o,r=!0===e.isWebGLMultipleRenderTargets?e.texture:[e.texture];for(let a=0,s=r.length;a<s;a++){const s=r[a];if(b(s,t)){const t=e.isWebGLCubeRenderTarget?34067:3553,r=i.get(s).__webglTexture;n.bindTexture(t,r),M(t),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(t){if(o&&t.samples>0&&!1===B(t)){const r=t.isWebGLMultipleRenderTargets?t.texture:[t.texture],a=t.width,s=t.height;let o=16384;const l=[],u=t.stencilBuffer?33306:36096,c=i.get(t),h=!0===t.isWebGLMultipleRenderTargets;if(h)for(let t=0;t<r.length;t++)n.bindFramebuffer(36160,c.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064+t,36161,null),n.bindFramebuffer(36160,c.__webglFramebuffer),e.framebufferTexture2D(36009,36064+t,3553,null,0);n.bindFramebuffer(36008,c.__webglMultisampledFramebuffer),n.bindFramebuffer(36009,c.__webglFramebuffer);for(let n=0;n<r.length;n++){l.push(36064+n),t.depthBuffer&&l.push(u);const d=void 0!==c.__ignoreDepthValues&&c.__ignoreDepthValues;if(!1===d&&(t.depthBuffer&&(o|=256),t.stencilBuffer&&(o|=1024)),h&&e.framebufferRenderbuffer(36008,36064,36161,c.__webglColorRenderbuffer[n]),!0===d&&(e.invalidateFramebuffer(36008,[u]),e.invalidateFramebuffer(36009,[u])),h){const t=i.get(r[n]).__webglTexture;e.framebufferTexture2D(36009,36064,3553,t,0)}e.blitFramebuffer(0,0,a,s,0,0,a,s,o,9728),p&&e.invalidateFramebuffer(36008,l)}if(n.bindFramebuffer(36008,null),n.bindFramebuffer(36009,null),h)for(let t=0;t<r.length;t++){n.bindFramebuffer(36160,c.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064+t,36161,c.__webglColorRenderbuffer[t]);const a=i.get(r[t]).__webglTexture;n.bindFramebuffer(36160,c.__webglFramebuffer),e.framebufferTexture2D(36009,36064+t,3553,a,0)}n.bindFramebuffer(36009,c.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=F,this.setupFrameBufferTexture=z,this.useMultisampledRTT=B}function ro(e,t,n){const i=n.isWebGL2;return{convert:function(n,r=null){let a;if(n===me)return 5121;if(n===Se)return 32819;if(n===we)return 32820;if(n===ge)return 5120;if(n===ve)return 5122;if(n===_e)return 5123;if(n===xe)return 5124;if(n===ye)return 5125;if(n===be)return 5126;if(n===Me)return i?5131:(a=t.get("OES_texture_half_float"),null!==a?a.HALF_FLOAT_OES:null);if(n===Ee)return 6406;if(n===Ae)return 6408;if(n===Ce)return 6409;if(n===Le)return 6410;if(n===Pe)return 6402;if(n===Re)return 34041;if(n===Pt)return a=t.get("EXT_sRGB"),null!==a?a.SRGB_ALPHA_EXT:null;if(n===De)return 6403;if(n===Ie)return 36244;if(n===Oe)return 33319;if(n===Ne)return 33320;if(n===ze)return 36249;if(n===Ue||n===Fe||n===ke||n===Be)if(r===yt){if(a=t.get("WEBGL_compressed_texture_s3tc_srgb"),null===a)return null;if(n===Ue)return a.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===Fe)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===ke)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===Be)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(a=t.get("WEBGL_compressed_texture_s3tc"),null===a)return null;if(n===Ue)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===Fe)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===ke)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===Be)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(n===Ve||n===Ge||n===He||n===qe){if(a=t.get("WEBGL_compressed_texture_pvrtc"),null===a)return null;if(n===Ve)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===Ge)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===He)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===qe)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(n===We)return a=t.get("WEBGL_compressed_texture_etc1"),null!==a?a.COMPRESSED_RGB_ETC1_WEBGL:null;if(n===je||n===Xe){if(a=t.get("WEBGL_compressed_texture_etc"),null===a)return null;if(n===je)return r===yt?a.COMPRESSED_SRGB8_ETC2:a.COMPRESSED_RGB8_ETC2;if(n===Xe)return r===yt?a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:a.COMPRESSED_RGBA8_ETC2_EAC}if(n===Ye||n===Je||n===Ze||n===Ke||n===Qe||n===$e||n===et||n===tt||n===nt||n===it||n===rt||n===at||n===st||n===ot){if(a=t.get("WEBGL_compressed_texture_astc"),null===a)return null;if(n===Ye)return r===yt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:a.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===Je)return r===yt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:a.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===Ze)return r===yt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:a.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===Ke)return r===yt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:a.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===Qe)return r===yt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:a.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===$e)return r===yt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:a.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===et)return r===yt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:a.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===tt)return r===yt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:a.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===nt)return r===yt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:a.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===it)return r===yt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:a.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===rt)return r===yt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:a.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===at)return r===yt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:a.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===st)return r===yt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:a.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===ot)return r===yt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:a.COMPRESSED_RGBA_ASTC_12x12_KHR}if(n===lt){if(a=t.get("EXT_texture_compression_bptc"),null===a)return null;if(n===lt)return r===yt?a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:a.COMPRESSED_RGBA_BPTC_UNORM_EXT}if(n===ut||n===ct||n===ht||n===dt){if(a=t.get("EXT_texture_compression_rgtc"),null===a)return null;if(n===lt)return a.COMPRESSED_RED_RGTC1_EXT;if(n===ct)return a.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(n===ht)return a.COMPRESSED_RED_GREEN_RGTC2_EXT;if(n===dt)return a.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return n===Te?i?34042:(a=t.get("WEBGL_depth_texture"),null!==a?a.UNSIGNED_INT_24_8_WEBGL:null):void 0!==e[n]?e[n]:null}}}class ao extends yr{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class so extends gi{constructor(){super(),this.isGroup=!0,this.type="Group"}}const oo={type:"move"};class lo{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new so,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new so,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Jt,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Jt),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new so,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Jt,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Jt),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const n of e.hand.values())this._getHandJoint(t,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,n){let i=null,r=null,a=null;const s=this._targetRay,o=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(l&&e.hand){a=!0;for(const i of e.hand.values()){const e=t.getJointPose(i,n),r=this._getHandJoint(l,i);null!==e&&(r.matrix.fromArray(e.transform.matrix),r.matrix.decompose(r.position,r.rotation,r.scale),r.jointRadius=e.radius),r.visible=null!==e}const i=l.joints["index-finger-tip"],r=l.joints["thumb-tip"],s=i.position.distanceTo(r.position),o=.02,u=.005;l.inputState.pinching&&s>o+u?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&s<=o-u&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==o&&e.gripSpace&&(r=t.getPose(e.gripSpace,n),null!==r&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),r.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(r.linearVelocity)):o.hasLinearVelocity=!1,r.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(r.angularVelocity)):o.hasAngularVelocity=!1));null!==s&&(i=t.getPose(e.targetRaySpace,n),null===i&&null!==r&&(i=r),null!==i&&(s.matrix.fromArray(i.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),i.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(i.linearVelocity)):s.hasLinearVelocity=!1,i.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(i.angularVelocity)):s.hasAngularVelocity=!1,this.dispatchEvent(oo)))}return null!==s&&(s.visible=null!==i),null!==o&&(o.visible=null!==r),null!==l&&(l.visible=null!==a),this}_getHandJoint(e,t){if(void 0===e.joints[t.jointName]){const n=new so;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}}class uo extends pn{constructor(e,t,n,i,r,a,s,o,l,u){if((u=void 0!==u?u:Pe)!==Pe&&u!==Re)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&u===Pe&&(n=ye),void 0===n&&u===Re&&(n=Te),super(null,i,r,a,s,o,u,n,l),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=void 0!==s?s:ue,this.minFilter=void 0!==o?o:ue,this.flipY=!1,this.generateMipmaps=!1}}class co extends Rt{constructor(e,t){super();const n=this;let i=null,r=1,a=null,s="local-floor",o=1,l=null,u=null,c=null,h=null,d=null,p=null;const f=t.getContextAttributes();let m=null,g=null;const v=[],_=[],x=new Set,y=new Map,b=new yr;b.layers.enable(1),b.viewport=new fn;const M=new yr;M.layers.enable(2),M.viewport=new fn;const S=[b,M],w=new ao;w.layers.enable(1),w.layers.enable(2);let T=null,E=null;function A(e){const t=_.indexOf(e.inputSource);if(-1===t)return;const n=v[t];void 0!==n&&n.dispatchEvent({type:e.type,data:e.inputSource})}function C(){i.removeEventListener("select",A),i.removeEventListener("selectstart",A),i.removeEventListener("selectend",A),i.removeEventListener("squeeze",A),i.removeEventListener("squeezestart",A),i.removeEventListener("squeezeend",A),i.removeEventListener("end",C),i.removeEventListener("inputsourceschange",L);for(let e=0;e<v.length;e++){const t=_[e];null!==t&&(_[e]=null,v[e].disconnect(t))}T=null,E=null,e.setRenderTarget(m),d=null,h=null,c=null,i=null,g=null,O.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}function L(e){for(let t=0;t<e.removed.length;t++){const n=e.removed[t],i=_.indexOf(n);i>=0&&(_[i]=null,v[i].disconnect(n))}for(let t=0;t<e.added.length;t++){const n=e.added[t];let i=_.indexOf(n);if(-1===i){for(let e=0;e<v.length;e++){if(e>=_.length){_.push(n),i=e;break}if(null===_[e]){_[e]=n,i=e;break}}if(-1===i)break}const r=v[i];r&&r.connect(n)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=v[e];return void 0===t&&(t=new lo,v[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=v[e];return void 0===t&&(t=new lo,v[e]=t),t.getGripSpace()},this.getHand=function(e){let t=v[e];return void 0===t&&(t=new lo,v[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){r=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){s=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||a},this.setReferenceSpace=function(e){l=e},this.getBaseLayer=function(){return null!==h?h:d},this.getBinding=function(){return c},this.getFrame=function(){return p},this.getSession=function(){return i},this.setSession=async function(u){if(i=u,null!==i){if(m=e.getRenderTarget(),i.addEventListener("select",A),i.addEventListener("selectstart",A),i.addEventListener("selectend",A),i.addEventListener("squeeze",A),i.addEventListener("squeezestart",A),i.addEventListener("squeezeend",A),i.addEventListener("end",C),i.addEventListener("inputsourceschange",L),!0!==f.xrCompatible&&await t.makeXRCompatible(),void 0===i.renderState.layers||!1===e.capabilities.isWebGL2){const n={antialias:void 0!==i.renderState.layers||f.antialias,alpha:f.alpha,depth:f.depth,stencil:f.stencil,framebufferScaleFactor:r};d=new XRWebGLLayer(i,t,n),i.updateRenderState({baseLayer:d}),g=new mn(d.framebufferWidth,d.framebufferHeight,{format:Ae,type:me,encoding:e.outputEncoding,stencilBuffer:f.stencil})}else{let n=null,a=null,s=null;f.depth&&(s=f.stencil?35056:33190,n=f.stencil?Re:Pe,a=f.stencil?Te:ye);const o={colorFormat:32856,depthFormat:s,scaleFactor:r};c=new XRWebGLBinding(i,t),h=c.createProjectionLayer(o),i.updateRenderState({layers:[h]}),g=new mn(h.textureWidth,h.textureHeight,{format:Ae,type:me,depthTexture:new uo(h.textureWidth,h.textureHeight,a,void 0,void 0,void 0,void 0,void 0,void 0,n),stencilBuffer:f.stencil,encoding:e.outputEncoding,samples:f.antialias?4:0});e.properties.get(g).__ignoreDepthValues=h.ignoreDepthValues}g.isXRRenderTarget=!0,this.setFoveation(o),l=null,a=await i.requestReferenceSpace(s),O.setContext(i),O.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}};const P=new Jt,R=new Jt;function D(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.updateCamera=function(e){if(null===i)return;w.near=M.near=b.near=e.near,w.far=M.far=b.far=e.far,T===w.near&&E===w.far||(i.updateRenderState({depthNear:w.near,depthFar:w.far}),T=w.near,E=w.far);const t=e.parent,n=w.cameras;D(w,t);for(let e=0;e<n.length;e++)D(n[e],t);w.matrixWorld.decompose(w.position,w.quaternion,w.scale),e.matrix.copy(w.matrix),e.matrix.decompose(e.position,e.quaternion,e.scale);const r=e.children;for(let e=0,t=r.length;e<t;e++)r[e].updateMatrixWorld(!0);2===n.length?function(e,t,n){P.setFromMatrixPosition(t.matrixWorld),R.setFromMatrixPosition(n.matrixWorld);const i=P.distanceTo(R),r=t.projectionMatrix.elements,a=n.projectionMatrix.elements,s=r[14]/(r[10]-1),o=r[14]/(r[10]+1),l=(r[9]+1)/r[5],u=(r[9]-1)/r[5],c=(r[8]-1)/r[0],h=(a[8]+1)/a[0],d=s*c,p=s*h,f=i/(-c+h),m=f*-c;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(f),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();const g=s+f,v=o+f,_=d-m,x=p+(i-m),y=l*o/v*g,b=u*o/v*g;e.projectionMatrix.makePerspective(_,x,y,b,g,v)}(w,b,M):w.projectionMatrix.copy(b.projectionMatrix)},this.getCamera=function(){return w},this.getFoveation=function(){if(null!==h||null!==d)return o},this.setFoveation=function(e){o=e,null!==h&&(h.fixedFoveation=e),null!==d&&void 0!==d.fixedFoveation&&(d.fixedFoveation=e)},this.getPlanes=function(){return x};let I=null;const O=new Dr;O.setAnimationLoop((function(t,i){if(u=i.getViewerPose(l||a),p=i,null!==u){const t=u.views;null!==d&&(e.setRenderTargetFramebuffer(g,d.framebuffer),e.setRenderTarget(g));let n=!1;t.length!==w.cameras.length&&(w.cameras.length=0,n=!0);for(let i=0;i<t.length;i++){const r=t[i];let a=null;if(null!==d)a=d.getViewport(r);else{const t=c.getViewSubImage(h,r);a=t.viewport,0===i&&(e.setRenderTargetTextures(g,t.colorTexture,h.ignoreDepthValues?void 0:t.depthStencilTexture),e.setRenderTarget(g))}let s=S[i];void 0===s&&(s=new yr,s.layers.enable(i),s.viewport=new fn,S[i]=s),s.matrix.fromArray(r.transform.matrix),s.projectionMatrix.fromArray(r.projectionMatrix),s.viewport.set(a.x,a.y,a.width,a.height),0===i&&w.matrix.copy(s.matrix),!0===n&&w.cameras.push(s)}}for(let e=0;e<v.length;e++){const t=_[e],n=v[e];null!==t&&void 0!==n&&n.update(t,i,l||a)}if(I&&I(t,i),i.detectedPlanes){n.dispatchEvent({type:"planesdetected",data:i.detectedPlanes});let e=null;for(const t of x)i.detectedPlanes.has(t)||(null===e&&(e=[]),e.push(t));if(null!==e)for(const t of e)x.delete(t),y.delete(t),n.dispatchEvent({type:"planeremoved",data:t});for(const e of i.detectedPlanes)if(x.has(e)){const t=y.get(e);e.lastChangedTime>t&&(y.set(e,e.lastChangedTime),n.dispatchEvent({type:"planechanged",data:e}))}else x.add(e),y.set(e,i.lastChangedTime),n.dispatchEvent({type:"planeadded",data:e})}p=null})),this.setAnimationLoop=function(e){I=e},this.dispose=function(){}}}function ho(e,t){function n(n,i){n.opacity.value=i.opacity,i.color&&n.diffuse.value.copy(i.color),i.emissive&&n.emissive.value.copy(i.emissive).multiplyScalar(i.emissiveIntensity),i.map&&(n.map.value=i.map),i.alphaMap&&(n.alphaMap.value=i.alphaMap),i.bumpMap&&(n.bumpMap.value=i.bumpMap,n.bumpScale.value=i.bumpScale,i.side===f&&(n.bumpScale.value*=-1)),i.displacementMap&&(n.displacementMap.value=i.displacementMap,n.displacementScale.value=i.displacementScale,n.displacementBias.value=i.displacementBias),i.emissiveMap&&(n.emissiveMap.value=i.emissiveMap),i.normalMap&&(n.normalMap.value=i.normalMap,n.normalScale.value.copy(i.normalScale),i.side===f&&n.normalScale.value.negate()),i.specularMap&&(n.specularMap.value=i.specularMap),i.alphaTest>0&&(n.alphaTest.value=i.alphaTest);const r=t.get(i).envMap;if(r&&(n.envMap.value=r,n.flipEnvMap.value=r.isCubeTexture&&!1===r.isRenderTargetTexture?-1:1,n.reflectivity.value=i.reflectivity,n.ior.value=i.ior,n.refractionRatio.value=i.refractionRatio),i.lightMap){n.lightMap.value=i.lightMap;const t=!0===e.useLegacyLights?Math.PI:1;n.lightMapIntensity.value=i.lightMapIntensity*t}let a,s;i.aoMap&&(n.aoMap.value=i.aoMap,n.aoMapIntensity.value=i.aoMapIntensity),i.map?a=i.map:i.specularMap?a=i.specularMap:i.displacementMap?a=i.displacementMap:i.normalMap?a=i.normalMap:i.bumpMap?a=i.bumpMap:i.roughnessMap?a=i.roughnessMap:i.metalnessMap?a=i.metalnessMap:i.alphaMap?a=i.alphaMap:i.emissiveMap?a=i.emissiveMap:i.clearcoatMap?a=i.clearcoatMap:i.clearcoatNormalMap?a=i.clearcoatNormalMap:i.clearcoatRoughnessMap?a=i.clearcoatRoughnessMap:i.iridescenceMap?a=i.iridescenceMap:i.iridescenceThicknessMap?a=i.iridescenceThicknessMap:i.specularIntensityMap?a=i.specularIntensityMap:i.specularColorMap?a=i.specularColorMap:i.transmissionMap?a=i.transmissionMap:i.thicknessMap?a=i.thicknessMap:i.sheenColorMap?a=i.sheenColorMap:i.sheenRoughnessMap&&(a=i.sheenRoughnessMap),void 0!==a&&(a.isWebGLRenderTarget&&(a=a.texture),!0===a.matrixAutoUpdate&&a.updateMatrix(),n.uvTransform.value.copy(a.matrix)),i.aoMap?s=i.aoMap:i.lightMap&&(s=i.lightMap),void 0!==s&&(s.isWebGLRenderTarget&&(s=s.texture),!0===s.matrixAutoUpdate&&s.updateMatrix(),n.uv2Transform.value.copy(s.matrix))}return{refreshFogUniforms:function(t,n){n.color.getRGB(t.fogColor.value,gr(e)),n.isFog?(t.fogNear.value=n.near,t.fogFar.value=n.far):n.isFogExp2&&(t.fogDensity.value=n.density)},refreshMaterialUniforms:function(e,i,r,a,s){i.isMeshBasicMaterial||i.isMeshLambertMaterial?n(e,i):i.isMeshToonMaterial?(n(e,i),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(e,i)):i.isMeshPhongMaterial?(n(e,i),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4)}(e,i)):i.isMeshStandardMaterial?(n(e,i),function(e,n){e.roughness.value=n.roughness,e.metalness.value=n.metalness,n.roughnessMap&&(e.roughnessMap.value=n.roughnessMap);n.metalnessMap&&(e.metalnessMap.value=n.metalnessMap);const i=t.get(n).envMap;i&&(e.envMapIntensity.value=n.envMapIntensity)}(e,i),i.isMeshPhysicalMaterial&&function(e,t,n){e.ior.value=t.ior,t.sheen>0&&(e.sheenColor.value.copy(t.sheenColor).multiplyScalar(t.sheen),e.sheenRoughness.value=t.sheenRoughness,t.sheenColorMap&&(e.sheenColorMap.value=t.sheenColorMap),t.sheenRoughnessMap&&(e.sheenRoughnessMap.value=t.sheenRoughnessMap));t.clearcoat>0&&(e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap),t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,t.side===f&&e.clearcoatNormalScale.value.negate()));t.iridescence>0&&(e.iridescence.value=t.iridescence,e.iridescenceIOR.value=t.iridescenceIOR,e.iridescenceThicknessMinimum.value=t.iridescenceThicknessRange[0],e.iridescenceThicknessMaximum.value=t.iridescenceThicknessRange[1],t.iridescenceMap&&(e.iridescenceMap.value=t.iridescenceMap),t.iridescenceThicknessMap&&(e.iridescenceThicknessMap.value=t.iridescenceThicknessMap));t.transmission>0&&(e.transmission.value=t.transmission,e.transmissionSamplerMap.value=n.texture,e.transmissionSamplerSize.value.set(n.width,n.height),t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap),e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor));e.specularIntensity.value=t.specularIntensity,e.specularColor.value.copy(t.specularColor),t.specularIntensityMap&&(e.specularIntensityMap.value=t.specularIntensityMap);t.specularColorMap&&(e.specularColorMap.value=t.specularColorMap)}(e,i,s)):i.isMeshMatcapMaterial?(n(e,i),function(e,t){t.matcap&&(e.matcap.value=t.matcap)}(e,i)):i.isMeshDepthMaterial?n(e,i):i.isMeshDistanceMaterial?(n(e,i),function(e,t){e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(e,i)):i.isMeshNormalMaterial?n(e,i):i.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity}(e,i),i.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,i)):i.isPointsMaterial?function(e,t,n,i){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*n,e.scale.value=.5*i,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);t.alphaTest>0&&(e.alphaTest.value=t.alphaTest);let r;t.map?r=t.map:t.alphaMap&&(r=t.alphaMap);void 0!==r&&(!0===r.matrixAutoUpdate&&r.updateMatrix(),e.uvTransform.value.copy(r.matrix))}(e,i,r,a):i.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);t.alphaTest>0&&(e.alphaTest.value=t.alphaTest);let n;t.map?n=t.map:t.alphaMap&&(n=t.alphaMap);void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uvTransform.value.copy(n.matrix))}(e,i):i.isShadowMaterial?(e.color.value.copy(i.color),e.opacity.value=i.opacity):i.isShaderMaterial&&(i.uniformsNeedUpdate=!1)}}}function po(e,t,n,i){let r={},a={},s=[];const o=n.isWebGL2?e.getParameter(35375):0;function l(e,t,n){const i=e.value;if(void 0===n[t]){if("number"==typeof i)n[t]=i;else{const e=Array.isArray(i)?i:[i],r=[];for(let t=0;t<e.length;t++)r.push(e[t].clone());n[t]=r}return!0}if("number"==typeof i){if(n[t]!==i)return n[t]=i,!0}else{const e=Array.isArray(n[t])?n[t]:[n[t]],r=Array.isArray(i)?i:[i];for(let t=0;t<e.length;t++){const n=e[t];if(!1===n.equals(r[t]))return n.copy(r[t]),!0}}return!1}function u(e){const t={boundary:0,storage:0};return"number"==typeof e?(t.boundary=4,t.storage=4):e.isVector2?(t.boundary=8,t.storage=8):e.isVector3||e.isColor?(t.boundary=16,t.storage=12):e.isVector4?(t.boundary=16,t.storage=16):e.isMatrix3?(t.boundary=48,t.storage=48):e.isMatrix4?(t.boundary=64,t.storage=64):e.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",e),t}function c(t){const n=t.target;n.removeEventListener("dispose",c);const i=s.indexOf(n.__bindingPointIndex);s.splice(i,1),e.deleteBuffer(r[n.id]),delete r[n.id],delete a[n.id]}return{bind:function(e,t){const n=t.program;i.uniformBlockBinding(e,n)},update:function(n,h){let d=r[n.id];void 0===d&&(!function(e){const t=e.uniforms;let n=0;const i=16;let r=0;for(let e=0,a=t.length;e<a;e++){const a=t[e],s={boundary:0,storage:0},o=Array.isArray(a.value)?a.value:[a.value];for(let e=0,t=o.length;e<t;e++){const t=u(o[e]);s.boundary+=t.boundary,s.storage+=t.storage}if(a.__data=new Float32Array(s.storage/Float32Array.BYTES_PER_ELEMENT),a.__offset=n,e>0){r=n%i;0!==r&&i-r-s.boundary<0&&(n+=i-r,a.__offset=n)}n+=s.storage}r=n%i,r>0&&(n+=i-r);e.__size=n,e.__cache={}}(n),d=function(t){const n=function(){for(let e=0;e<o;e++)if(-1===s.indexOf(e))return s.push(e),e;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();t.__bindingPointIndex=n;const i=e.createBuffer(),r=t.__size,a=t.usage;return e.bindBuffer(35345,i),e.bufferData(35345,r,a),e.bindBuffer(35345,null),e.bindBufferBase(35345,n,i),i}(n),r[n.id]=d,n.addEventListener("dispose",c));const p=h.program;i.updateUBOMapping(n,p);const f=t.render.frame;a[n.id]!==f&&(!function(t){const n=r[t.id],i=t.uniforms,a=t.__cache;e.bindBuffer(35345,n);for(let t=0,n=i.length;t<n;t++){const n=i[t];if(!0===l(n,t,a)){const t=n.__offset,i=Array.isArray(n.value)?n.value:[n.value];let r=0;for(let a=0;a<i.length;a++){const s=i[a],o=u(s);"number"==typeof s?(n.__data[0]=s,e.bufferSubData(35345,t+r,n.__data)):s.isMatrix3?(n.__data[0]=s.elements[0],n.__data[1]=s.elements[1],n.__data[2]=s.elements[2],n.__data[3]=s.elements[0],n.__data[4]=s.elements[3],n.__data[5]=s.elements[4],n.__data[6]=s.elements[5],n.__data[7]=s.elements[0],n.__data[8]=s.elements[6],n.__data[9]=s.elements[7],n.__data[10]=s.elements[8],n.__data[11]=s.elements[0]):(s.toArray(n.__data,r),r+=o.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(35345,t,n.__data)}}e.bindBuffer(35345,null)}(n),a[n.id]=f)},dispose:function(){for(const t in r)e.deleteBuffer(r[t]);s=[],r={},a={}}}}function fo(e={}){this.isWebGLRenderer=!0;const t=void 0!==e.canvas?e.canvas:function(){const e=Xt("canvas");return e.style.display="block",e}(),n=void 0!==e.context?e.context:null,i=void 0===e.depth||e.depth,r=void 0===e.stencil||e.stencil,a=void 0!==e.antialias&&e.antialias,o=void 0===e.premultipliedAlpha||e.premultipliedAlpha,l=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,u=void 0!==e.powerPreference?e.powerPreference:"default",c=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat;let h;h=null!==n?n.getContextAttributes().alpha:void 0!==e.alpha&&e.alpha;let d=null,g=null;const v=[],_=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=xt,this.useLegacyLights=!0,this.toneMapping=J,this.toneMappingExposure=1;const x=this;let y=!1,b=0,M=0,S=null,w=-1,T=null;const E=new fn,A=new fn;let C=null,L=t.width,P=t.height,R=1,D=null,I=null;const O=new fn(0,0,L,P),N=new fn(0,0,L,P);let z=!1;const U=new Rr;let F=!1,k=!1,B=null;const V=new Wn,G=new Jt,H={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function q(){return null===S?R:1}let W,j,X,Y,Z,K,Q,$,ee,te,ne,ie,re,ae,se,oe,le,ue,ce,he,de,pe,ge,ve,_e=n;function xe(e,n){for(let i=0;i<e.length;i++){const r=e[i],a=t.getContext(r,n);if(null!==a)return a}return null}try{const e={alpha:!0,depth:i,stencil:r,antialias:a,premultipliedAlpha:o,preserveDrawingBuffer:l,powerPreference:u,failIfMajorPerformanceCaveat:c};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${s}`),t.addEventListener("webglcontextlost",we,!1),t.addEventListener("webglcontextrestored",Te,!1),t.addEventListener("webglcontextcreationerror",Ee,!1),null===_e){const t=["webgl2","webgl","experimental-webgl"];if(!0===x.isWebGL1Renderer&&t.shift(),_e=xe(t,e),null===_e)throw xe(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===_e.getShaderPrecisionFormat&&(_e.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function ye(){W=new la(_e),j=new Gr(_e,W,e),W.init(j),pe=new ro(_e,W,j),X=new no(_e,W,j),Y=new ha,Z=new Bs,K=new io(_e,W,X,Z,j,pe,Y),Q=new qr(x),$=new oa(x),ee=new Ir(_e,j),ge=new Br(_e,W,ee,j),te=new ua(_e,ee,Y,ge),ne=new ma(_e,te,ee,Y),ce=new fa(_e,j,K),oe=new Hr(Z),ie=new ks(x,Q,$,W,j,ge,oe),re=new ho(x,Z),ae=new qs,se=new Zs(W,j),ue=new kr(x,Q,$,X,ne,h,o),le=new to(x,ne,j),ve=new po(_e,Y,j,X),he=new Vr(_e,W,Y,j),de=new ca(_e,W,Y,j),Y.programs=ie.programs,x.capabilities=j,x.extensions=W,x.properties=Z,x.renderLists=ae,x.shadowMap=le,x.state=X,x.info=Y}ye();const Se=new co(x,_e);function we(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),y=!0}function Te(){console.log("THREE.WebGLRenderer: Context Restored."),y=!1;const e=Y.autoReset,t=le.enabled,n=le.autoUpdate,i=le.needsUpdate,r=le.type;ye(),Y.autoReset=e,le.enabled=t,le.autoUpdate=n,le.needsUpdate=i,le.type=r}function Ee(e){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",e.statusMessage)}function Ce(e){const t=e.target;t.removeEventListener("dispose",Ce),function(e){(function(e){const t=Z.get(e).programs;void 0!==t&&(t.forEach((function(e){ie.releaseProgram(e)})),e.isShaderMaterial&&ie.releaseShaderCache(e))})(e),Z.remove(e)}(t)}this.xr=Se,this.getContext=function(){return _e},this.getContextAttributes=function(){return _e.getContextAttributes()},this.forceContextLoss=function(){const e=W.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){const e=W.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return R},this.setPixelRatio=function(e){void 0!==e&&(R=e,this.setSize(L,P,!1))},this.getSize=function(e){return e.set(L,P)},this.setSize=function(e,n,i=!0){Se.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(L=e,P=n,t.width=Math.floor(e*R),t.height=Math.floor(n*R),!0===i&&(t.style.width=e+"px",t.style.height=n+"px"),this.setViewport(0,0,e,n))},this.getDrawingBufferSize=function(e){return e.set(L*R,P*R).floor()},this.setDrawingBufferSize=function(e,n,i){L=e,P=n,R=i,t.width=Math.floor(e*i),t.height=Math.floor(n*i),this.setViewport(0,0,e,n)},this.getCurrentViewport=function(e){return e.copy(E)},this.getViewport=function(e){return e.copy(O)},this.setViewport=function(e,t,n,i){e.isVector4?O.set(e.x,e.y,e.z,e.w):O.set(e,t,n,i),X.viewport(E.copy(O).multiplyScalar(R).floor())},this.getScissor=function(e){return e.copy(N)},this.setScissor=function(e,t,n,i){e.isVector4?N.set(e.x,e.y,e.z,e.w):N.set(e,t,n,i),X.scissor(A.copy(N).multiplyScalar(R).floor())},this.getScissorTest=function(){return z},this.setScissorTest=function(e){X.setScissorTest(z=e)},this.setOpaqueSort=function(e){D=e},this.setTransparentSort=function(e){I=e},this.getClearColor=function(e){return e.copy(ue.getClearColor())},this.setClearColor=function(){ue.setClearColor.apply(ue,arguments)},this.getClearAlpha=function(){return ue.getClearAlpha()},this.setClearAlpha=function(){ue.setClearAlpha.apply(ue,arguments)},this.clear=function(e=!0,t=!0,n=!0){let i=0;e&&(i|=16384),t&&(i|=256),n&&(i|=1024),_e.clear(i)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",we,!1),t.removeEventListener("webglcontextrestored",Te,!1),t.removeEventListener("webglcontextcreationerror",Ee,!1),ae.dispose(),se.dispose(),Z.dispose(),Q.dispose(),$.dispose(),ne.dispose(),ge.dispose(),ve.dispose(),ie.dispose(),Se.dispose(),Se.removeEventListener("sessionstart",Pe),Se.removeEventListener("sessionend",Re),B&&(B.dispose(),B=null),De.stop()},this.renderBufferDirect=function(e,t,n,i,r,a){null===t&&(t=H);const s=r.isMesh&&r.matrixWorld.determinant()<0,o=function(e,t,n,i,r){!0!==t.isScene&&(t=H);K.resetTextureUnits();const a=t.fog,s=i.isMeshStandardMaterial?t.environment:null,o=null===S?x.outputEncoding:!0===S.isXRRenderTarget?S.texture.encoding:xt,l=(i.isMeshStandardMaterial?$:Q).get(i.envMap||s),u=!0===i.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,c=!!i.normalMap&&!!n.attributes.tangent,h=!!n.morphAttributes.position,d=!!n.morphAttributes.normal,p=!!n.morphAttributes.color,f=i.toneMapped?x.toneMapping:J,m=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,v=void 0!==m?m.length:0,_=Z.get(i),y=g.state.lights;if(!0===F&&(!0===k||e!==T)){const t=e===T&&i.id===w;oe.setState(i,e,t)}let b=!1;i.version===_.__version?_.needsLights&&_.lightsStateVersion!==y.state.version||_.outputEncoding!==o||r.isInstancedMesh&&!1===_.instancing?b=!0:r.isInstancedMesh||!0!==_.instancing?r.isSkinnedMesh&&!1===_.skinning?b=!0:r.isSkinnedMesh||!0!==_.skinning?_.envMap!==l||!0===i.fog&&_.fog!==a?b=!0:void 0===_.numClippingPlanes||_.numClippingPlanes===oe.numPlanes&&_.numIntersection===oe.numIntersection?(_.vertexAlphas!==u||_.vertexTangents!==c||_.morphTargets!==h||_.morphNormals!==d||_.morphColors!==p||_.toneMapping!==f||!0===j.isWebGL2&&_.morphTargetsCount!==v)&&(b=!0):b=!0:b=!0:b=!0:(b=!0,_.__version=i.version);let M=_.currentProgram;!0===b&&(M=Ue(i,t,r));let E=!1,A=!1,C=!1;const L=M.getUniforms(),D=_.uniforms;X.useProgram(M.program)&&(E=!0,A=!0,C=!0);i.id!==w&&(w=i.id,A=!0);if(E||T!==e){if(L.setValue(_e,"projectionMatrix",e.projectionMatrix),j.logarithmicDepthBuffer&&L.setValue(_e,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),T!==e&&(T=e,A=!0,C=!0),i.isShaderMaterial||i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshStandardMaterial||i.envMap){const t=L.map.cameraPosition;void 0!==t&&t.setValue(_e,G.setFromMatrixPosition(e.matrixWorld))}(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial)&&L.setValue(_e,"isOrthographic",!0===e.isOrthographicCamera),(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial||i.isShadowMaterial||r.isSkinnedMesh)&&L.setValue(_e,"viewMatrix",e.matrixWorldInverse)}if(r.isSkinnedMesh){L.setOptional(_e,r,"bindMatrix"),L.setOptional(_e,r,"bindMatrixInverse");const e=r.skeleton;e&&(j.floatVertexTextures?(null===e.boneTexture&&e.computeBoneTexture(),L.setValue(_e,"boneTexture",e.boneTexture,K),L.setValue(_e,"boneTextureSize",e.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const I=n.morphAttributes;(void 0!==I.position||void 0!==I.normal||void 0!==I.color&&!0===j.isWebGL2)&&ce.update(r,n,M);(A||_.receiveShadow!==r.receiveShadow)&&(_.receiveShadow=r.receiveShadow,L.setValue(_e,"receiveShadow",r.receiveShadow));i.isMeshGouraudMaterial&&null!==i.envMap&&(D.envMap.value=l,D.flipEnvMap.value=l.isCubeTexture&&!1===l.isRenderTargetTexture?-1:1);A&&(L.setValue(_e,"toneMappingExposure",x.toneMappingExposure),_.needsLights&&(N=C,(O=D).ambientLightColor.needsUpdate=N,O.lightProbe.needsUpdate=N,O.directionalLights.needsUpdate=N,O.directionalLightShadows.needsUpdate=N,O.pointLights.needsUpdate=N,O.pointLightShadows.needsUpdate=N,O.spotLights.needsUpdate=N,O.spotLightShadows.needsUpdate=N,O.rectAreaLights.needsUpdate=N,O.hemisphereLights.needsUpdate=N),a&&!0===i.fog&&re.refreshFogUniforms(D,a),re.refreshMaterialUniforms(D,i,R,P,B),xs.upload(_e,_.uniformsList,D,K));var O,N;i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(xs.upload(_e,_.uniformsList,D,K),i.uniformsNeedUpdate=!1);i.isSpriteMaterial&&L.setValue(_e,"center",r.center);if(L.setValue(_e,"modelViewMatrix",r.modelViewMatrix),L.setValue(_e,"normalMatrix",r.normalMatrix),L.setValue(_e,"modelMatrix",r.matrixWorld),i.isShaderMaterial||i.isRawShaderMaterial){const e=i.uniformsGroups;for(let t=0,n=e.length;t<n;t++)if(j.isWebGL2){const n=e[t];ve.update(n,M),ve.bind(n,M)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return M}(e,t,n,i,r);X.setMaterial(i,s);let l=n.index,u=1;!0===i.wireframe&&(l=te.getWireframeAttribute(n),u=2);const c=n.drawRange,h=n.attributes.position;let d=c.start*u,p=(c.start+c.count)*u;null!==a&&(d=Math.max(d,a.start*u),p=Math.min(p,(a.start+a.count)*u)),null!==l?(d=Math.max(d,0),p=Math.min(p,l.count)):null!=h&&(d=Math.max(d,0),p=Math.min(p,h.count));const f=p-d;if(f<0||f===1/0)return;let m;ge.setup(r,i,o,n,l);let v=he;if(null!==l&&(m=ee.get(l),v=de,v.setIndex(m)),r.isMesh)!0===i.wireframe?(X.setLineWidth(i.wireframeLinewidth*q()),v.setMode(1)):v.setMode(4);else if(r.isLine){let e=i.linewidth;void 0===e&&(e=1),X.setLineWidth(e*q()),r.isLineSegments?v.setMode(1):r.isLineLoop?v.setMode(2):v.setMode(3)}else r.isPoints?v.setMode(0):r.isSprite&&v.setMode(4);if(r.isInstancedMesh)v.renderInstances(d,f,r.count);else if(n.isInstancedBufferGeometry){const e=void 0!==n._maxInstanceCount?n._maxInstanceCount:1/0,t=Math.min(n.instanceCount,e);v.renderInstances(d,f,t)}else v.render(d,f)},this.compile=function(e,t){function n(e,t,n){!0===e.transparent&&e.side===m&&!1===e.forceSinglePass?(e.side=f,e.needsUpdate=!0,Ue(e,t,n),e.side=p,e.needsUpdate=!0,Ue(e,t,n),e.side=m):Ue(e,t,n)}g=se.get(e),g.init(),_.push(g),e.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(g.pushLight(e),e.castShadow&&g.pushShadow(e))})),g.setupLights(x.useLegacyLights),e.traverse((function(t){const i=t.material;if(i)if(Array.isArray(i))for(let r=0;r<i.length;r++){n(i[r],e,t)}else n(i,e,t)})),_.pop(),g=null};let Le=null;function Pe(){De.stop()}function Re(){De.start()}const De=new Dr;function Ie(e,t,n,i){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)g.pushLight(e),e.castShadow&&g.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||U.intersectsSprite(e)){i&&G.setFromMatrixPosition(e.matrixWorld).applyMatrix4(V);const t=ne.update(e),r=e.material;r.visible&&d.push(e,t,r,n,G.z,null)}}else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.frame!==Y.render.frame&&(e.skeleton.update(),e.skeleton.frame=Y.render.frame),!e.frustumCulled||U.intersectsObject(e))){i&&G.setFromMatrixPosition(e.matrixWorld).applyMatrix4(V);const t=ne.update(e),r=e.material;if(Array.isArray(r)){const i=t.groups;for(let a=0,s=i.length;a<s;a++){const s=i[a],o=r[s.materialIndex];o&&o.visible&&d.push(e,t,o,n,G.z,s)}}else r.visible&&d.push(e,t,r,n,G.z,null)}const r=e.children;for(let e=0,a=r.length;e<a;e++)Ie(r[e],t,n,i)}function Oe(e,t,n,i){const r=e.opaque,s=e.transmissive,o=e.transparent;g.setupLightsView(n),!0===F&&oe.setGlobalState(x.clippingPlanes,n),s.length>0&&function(e,t,n){const i=j.isWebGL2;null===B&&(B=new mn(1024,1024,{generateMipmaps:!0,type:W.has("EXT_color_buffer_half_float")?Me:me,minFilter:fe,samples:i&&!0===a?4:0}));const r=x.getRenderTarget();x.setRenderTarget(B),x.clear();const s=x.toneMapping;x.toneMapping=J,Ne(e,t,n),x.toneMapping=s,K.updateMultisampleRenderTarget(B),K.updateRenderTargetMipmap(B),x.setRenderTarget(r)}(r,t,n),i&&X.viewport(E.copy(i)),r.length>0&&Ne(r,t,n),s.length>0&&Ne(s,t,n),o.length>0&&Ne(o,t,n),X.buffers.depth.setTest(!0),X.buffers.depth.setMask(!0),X.buffers.color.setMask(!0),X.setPolygonOffset(!1)}function Ne(e,t,n){const i=!0===t.isScene?t.overrideMaterial:null;for(let r=0,a=e.length;r<a;r++){const a=e[r],s=a.object,o=a.geometry,l=null===i?a.material:i,u=a.group;s.layers.test(n.layers)&&ze(s,t,n,o,l,u)}}function ze(e,t,n,i,r,a){e.onBeforeRender(x,t,n,i,r,a),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),r.onBeforeRender(x,t,n,i,e,a),!0===r.transparent&&r.side===m&&!1===r.forceSinglePass?(r.side=f,r.needsUpdate=!0,x.renderBufferDirect(n,t,i,r,e,a),r.side=p,r.needsUpdate=!0,x.renderBufferDirect(n,t,i,r,e,a),r.side=m):x.renderBufferDirect(n,t,i,r,e,a),e.onAfterRender(x,t,n,i,r,a)}function Ue(e,t,n){!0!==t.isScene&&(t=H);const i=Z.get(e),r=g.state.lights,a=g.state.shadowsArray,s=r.state.version,o=ie.getParameters(e,r.state,a,t,n),l=ie.getProgramCacheKey(o);let u=i.programs;i.environment=e.isMeshStandardMaterial?t.environment:null,i.fog=t.fog,i.envMap=(e.isMeshStandardMaterial?$:Q).get(e.envMap||i.environment),void 0===u&&(e.addEventListener("dispose",Ce),u=new Map,i.programs=u);let c=u.get(l);if(void 0!==c){if(i.currentProgram===c&&i.lightsStateVersion===s)return Fe(e,o),c}else o.uniforms=ie.getUniforms(e),e.onBuild(n,o,x),e.onBeforeCompile(o,x),c=ie.acquireProgram(o,l),u.set(l,c),i.uniforms=o.uniforms;const h=i.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(h.clippingPlanes=oe.uniform),Fe(e,o),i.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),i.lightsStateVersion=s,i.needsLights&&(h.ambientLightColor.value=r.state.ambient,h.lightProbe.value=r.state.probe,h.directionalLights.value=r.state.directional,h.directionalLightShadows.value=r.state.directionalShadow,h.spotLights.value=r.state.spot,h.spotLightShadows.value=r.state.spotShadow,h.rectAreaLights.value=r.state.rectArea,h.ltc_1.value=r.state.rectAreaLTC1,h.ltc_2.value=r.state.rectAreaLTC2,h.pointLights.value=r.state.point,h.pointLightShadows.value=r.state.pointShadow,h.hemisphereLights.value=r.state.hemi,h.directionalShadowMap.value=r.state.directionalShadowMap,h.directionalShadowMatrix.value=r.state.directionalShadowMatrix,h.spotShadowMap.value=r.state.spotShadowMap,h.spotLightMatrix.value=r.state.spotLightMatrix,h.spotLightMap.value=r.state.spotLightMap,h.pointShadowMap.value=r.state.pointShadowMap,h.pointShadowMatrix.value=r.state.pointShadowMatrix);const d=c.getUniforms(),p=xs.seqWithValue(d.seq,h);return i.currentProgram=c,i.uniformsList=p,c}function Fe(e,t){const n=Z.get(e);n.outputEncoding=t.outputEncoding,n.instancing=t.instancing,n.skinning=t.skinning,n.morphTargets=t.morphTargets,n.morphNormals=t.morphNormals,n.morphColors=t.morphColors,n.morphTargetsCount=t.morphTargetsCount,n.numClippingPlanes=t.numClippingPlanes,n.numIntersection=t.numClipIntersection,n.vertexAlphas=t.vertexAlphas,n.vertexTangents=t.vertexTangents,n.toneMapping=t.toneMapping}De.setAnimationLoop((function(e){Le&&Le(e)})),"undefined"!=typeof self&&De.setContext(self),this.setAnimationLoop=function(e){Le=e,Se.setAnimationLoop(e),null===e?De.stop():De.start()},Se.addEventListener("sessionstart",Pe),Se.addEventListener("sessionend",Re),this.render=function(e,t){if(void 0!==t&&!0!==t.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===y)return;!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),!0===Se.enabled&&!0===Se.isPresenting&&(!0===Se.cameraAutoUpdate&&Se.updateCamera(t),t=Se.getCamera()),!0===e.isScene&&e.onBeforeRender(x,e,t,S),g=se.get(e,_.length),g.init(),_.push(g),V.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),U.setFromProjectionMatrix(V),k=this.localClippingEnabled,F=oe.init(this.clippingPlanes,k),d=ae.get(e,v.length),d.init(),v.push(d),Ie(e,t,0,x.sortObjects),d.finish(),!0===x.sortObjects&&d.sort(D,I),!0===F&&oe.beginShadows();const n=g.state.shadowsArray;if(le.render(n,e,t),!0===F&&oe.endShadows(),!0===this.info.autoReset&&this.info.reset(),ue.render(d,e),g.setupLights(x.useLegacyLights),t.isArrayCamera){const n=t.cameras;for(let t=0,i=n.length;t<i;t++){const i=n[t];Oe(d,e,i,i.viewport)}}else Oe(d,e,t);null!==S&&(K.updateMultisampleRenderTarget(S),K.updateRenderTargetMipmap(S)),!0===e.isScene&&e.onAfterRender(x,e,t),ge.resetDefaultState(),w=-1,T=null,_.pop(),g=_.length>0?_[_.length-1]:null,v.pop(),d=v.length>0?v[v.length-1]:null},this.getActiveCubeFace=function(){return b},this.getActiveMipmapLevel=function(){return M},this.getRenderTarget=function(){return S},this.setRenderTargetTextures=function(e,t,n){Z.get(e.texture).__webglTexture=t,Z.get(e.depthTexture).__webglTexture=n;const i=Z.get(e);i.__hasExternalTextures=!0,i.__hasExternalTextures&&(i.__autoAllocateDepthBuffer=void 0===n,i.__autoAllocateDepthBuffer||!0===W.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),i.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(e,t){const n=Z.get(e);n.__webglFramebuffer=t,n.__useDefaultFramebuffer=void 0===t},this.setRenderTarget=function(e,t=0,n=0){S=e,b=t,M=n;let i=!0,r=null,a=!1,s=!1;if(e){const n=Z.get(e);void 0!==n.__useDefaultFramebuffer?(X.bindFramebuffer(36160,null),i=!1):void 0===n.__webglFramebuffer?K.setupRenderTarget(e):n.__hasExternalTextures&&K.rebindTextures(e,Z.get(e.texture).__webglTexture,Z.get(e.depthTexture).__webglTexture);const o=e.texture;(o.isData3DTexture||o.isDataArrayTexture||o.isCompressedArrayTexture)&&(s=!0);const l=Z.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(r=l[t],a=!0):r=j.isWebGL2&&e.samples>0&&!1===K.useMultisampledRTT(e)?Z.get(e).__webglMultisampledFramebuffer:l,E.copy(e.viewport),A.copy(e.scissor),C=e.scissorTest}else E.copy(O).multiplyScalar(R).floor(),A.copy(N).multiplyScalar(R).floor(),C=z;if(X.bindFramebuffer(36160,r)&&j.drawBuffers&&i&&X.drawBuffers(e,r),X.viewport(E),X.scissor(A),X.setScissorTest(C),a){const i=Z.get(e.texture);_e.framebufferTexture2D(36160,36064,34069+t,i.__webglTexture,n)}else if(s){const i=Z.get(e.texture),r=t||0;_e.framebufferTextureLayer(36160,36064,i.__webglTexture,n||0,r)}w=-1},this.readRenderTargetPixels=function(e,t,n,i,r,a,s){if(!e||!e.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let o=Z.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==s&&(o=o[s]),o){X.bindFramebuffer(36160,o);try{const s=e.texture,o=s.format,l=s.type;if(o!==Ae&&pe.convert(o)!==_e.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const u=l===Me&&(W.has("EXT_color_buffer_half_float")||j.isWebGL2&&W.has("EXT_color_buffer_float"));if(!(l===me||pe.convert(l)===_e.getParameter(35738)||l===be&&(j.isWebGL2||W.has("OES_texture_float")||W.has("WEBGL_color_buffer_float"))||u))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");t>=0&&t<=e.width-i&&n>=0&&n<=e.height-r&&_e.readPixels(t,n,i,r,pe.convert(o),pe.convert(l),a)}finally{const e=null!==S?Z.get(S).__webglFramebuffer:null;X.bindFramebuffer(36160,e)}}},this.copyFramebufferToTexture=function(e,t,n=0){const i=Math.pow(2,-n),r=Math.floor(t.image.width*i),a=Math.floor(t.image.height*i);K.setTexture2D(t,0),_e.copyTexSubImage2D(3553,n,0,0,e.x,e.y,r,a),X.unbindTexture()},this.copyTextureToTexture=function(e,t,n,i=0){const r=t.image.width,a=t.image.height,s=pe.convert(n.format),o=pe.convert(n.type);K.setTexture2D(n,0),_e.pixelStorei(37440,n.flipY),_e.pixelStorei(37441,n.premultiplyAlpha),_e.pixelStorei(3317,n.unpackAlignment),t.isDataTexture?_e.texSubImage2D(3553,i,e.x,e.y,r,a,s,o,t.image.data):t.isCompressedTexture?_e.compressedTexSubImage2D(3553,i,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,s,t.mipmaps[0].data):_e.texSubImage2D(3553,i,e.x,e.y,s,o,t.image),0===i&&n.generateMipmaps&&_e.generateMipmap(3553),X.unbindTexture()},this.copyTextureToTexture3D=function(e,t,n,i,r=0){if(x.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const a=e.max.x-e.min.x+1,s=e.max.y-e.min.y+1,o=e.max.z-e.min.z+1,l=pe.convert(i.format),u=pe.convert(i.type);let c;if(i.isData3DTexture)K.setTexture3D(i,0),c=32879;else{if(!i.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");K.setTexture2DArray(i,0),c=35866}_e.pixelStorei(37440,i.flipY),_e.pixelStorei(37441,i.premultiplyAlpha),_e.pixelStorei(3317,i.unpackAlignment);const h=_e.getParameter(3314),d=_e.getParameter(32878),p=_e.getParameter(3316),f=_e.getParameter(3315),m=_e.getParameter(32877),g=n.isCompressedTexture?n.mipmaps[0]:n.image;_e.pixelStorei(3314,g.width),_e.pixelStorei(32878,g.height),_e.pixelStorei(3316,e.min.x),_e.pixelStorei(3315,e.min.y),_e.pixelStorei(32877,e.min.z),n.isDataTexture||n.isData3DTexture?_e.texSubImage3D(c,r,t.x,t.y,t.z,a,s,o,l,u,g.data):n.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),_e.compressedTexSubImage3D(c,r,t.x,t.y,t.z,a,s,o,l,g.data)):_e.texSubImage3D(c,r,t.x,t.y,t.z,a,s,o,l,u,g),_e.pixelStorei(3314,h),_e.pixelStorei(32878,d),_e.pixelStorei(3316,p),_e.pixelStorei(3315,f),_e.pixelStorei(32877,m),0===r&&i.generateMipmaps&&_e.generateMipmap(c),X.unbindTexture()},this.initTexture=function(e){e.isCubeTexture?K.setTextureCube(e,0):e.isData3DTexture?K.setTexture3D(e,0):e.isDataArrayTexture||e.isCompressedArrayTexture?K.setTexture2DArray(e,0):K.setTexture2D(e,0),X.unbindTexture()},this.resetState=function(){b=0,M=0,S=null,X.reset(),ge.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}Object.defineProperties(fo.prototype,{physicallyCorrectLights:{get:function(){return console.warn("THREE.WebGLRenderer: the property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),!this.useLegacyLights},set:function(e){console.warn("THREE.WebGLRenderer: the property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),this.useLegacyLights=!e}}});(class extends fo{}).prototype.isWebGL1Renderer=!0;class mo extends gi{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(t.object.backgroundIntensity=this.backgroundIntensity),t}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(e){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=e}}class go extends Li{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Mt,this.normalScale=new Ht(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}function vo(e,t,n){return xo(e)?new e.constructor(e.subarray(t,void 0!==n?n:e.length)):e.slice(t,n)}function _o(e,t,n){return!e||!n&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)}function xo(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}class yo{constructor(e,t,n,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,i=t[n],r=t[n-1];e:{t:{let a;n:{i:if(!(e<i)){for(let a=n+2;;){if(void 0===i){if(e<r)break i;return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===a)break;if(r=i,i=t[++n],e<i)break t}a=t.length;break n}if(e>=r)break e;{const s=t[1];e<s&&(n=2,r=s);for(let a=n-2;;){if(void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(n===a)break;if(i=r,r=t[--n-1],e>=r)break t}a=n,n=0}}for(;n<a;){const i=n+a>>>1;e<t[i]?a=i:n=i+1}if(i=t[n],r=t[n-1],void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===i)return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,r,i)}return this.interpolate_(n,r,e,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=e*i;for(let e=0;e!==i;++e)t[e]=n[r+e];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class bo extends yo{constructor(e,t,n,i){super(e,t,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:gt,endingEnd:gt}}intervalChanged_(e,t,n){const i=this.parameterPositions;let r=e-2,a=e+1,s=i[r],o=i[a];if(void 0===s)switch(this.getSettings_().endingStart){case vt:r=e,s=2*t-n;break;case _t:r=i.length-2,s=t+i[r]-i[r+1];break;default:r=e,s=n}if(void 0===o)switch(this.getSettings_().endingEnd){case vt:a=e,o=2*n-t;break;case _t:a=1,o=n+i[1]-i[0];break;default:a=e-1,o=t}const l=.5*(n-t),u=this.valueSize;this._weightPrev=l/(t-s),this._weightNext=l/(o-n),this._offsetPrev=r*u,this._offsetNext=a*u}interpolate_(e,t,n,i){const r=this.resultBuffer,a=this.sampleValues,s=this.valueSize,o=e*s,l=o-s,u=this._offsetPrev,c=this._offsetNext,h=this._weightPrev,d=this._weightNext,p=(n-t)/(i-t),f=p*p,m=f*p,g=-h*m+2*h*f-h*p,v=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*p+1,_=(-1-d)*m+(1.5+d)*f+.5*p,x=d*m-d*f;for(let e=0;e!==s;++e)r[e]=g*a[u+e]+v*a[l+e]+_*a[o+e]+x*a[c+e];return r}}class Mo extends yo{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const r=this.resultBuffer,a=this.sampleValues,s=this.valueSize,o=e*s,l=o-s,u=(n-t)/(i-t),c=1-u;for(let e=0;e!==s;++e)r[e]=a[l+e]*c+a[o+e]*u;return r}}class So extends yo{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e){return this.copySampleValue_(e-1)}}class wo{constructor(e,t,n,i){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=_o(t,this.TimeBufferType),this.values=_o(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:_o(e.times,Array),values:_o(e.values,Array)};const t=e.getInterpolation();t!==e.DefaultInterpolation&&(n.interpolation=t)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new So(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new Mo(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new bo(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case pt:t=this.InterpolantFactoryMethodDiscrete;break;case ft:t=this.InterpolantFactoryMethodLinear;break;case mt:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(t);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return pt;case this.InterpolantFactoryMethodLinear:return ft;case this.InterpolantFactoryMethodSmooth:return mt}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]*=e}return this}trim(e,t){const n=this.times,i=n.length;let r=0,a=i-1;for(;r!==i&&n[r]<e;)++r;for(;-1!==a&&n[a]>t;)--a;if(++a,0!==r||a!==i){r>=a&&(a=Math.max(a,1),r=a-1);const e=this.getValueSize();this.times=vo(n,r,a),this.values=vo(this.values,r*e,a*e)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,i=this.values,r=n.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let a=null;for(let t=0;t!==r;t++){const i=n[t];if("number"==typeof i&&isNaN(i)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,t,i),e=!1;break}if(null!==a&&a>i){console.error("THREE.KeyframeTrack: Out of order keys.",this,t,i,a),e=!1;break}a=i}if(void 0!==i&&xo(i))for(let t=0,n=i.length;t!==n;++t){const n=i[t];if(isNaN(n)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,t,n),e=!1;break}}return e}optimize(){const e=vo(this.times),t=vo(this.values),n=this.getValueSize(),i=this.getInterpolation()===mt,r=e.length-1;let a=1;for(let s=1;s<r;++s){let r=!1;const o=e[s];if(o!==e[s+1]&&(1!==s||o!==e[0]))if(i)r=!0;else{const e=s*n,i=e-n,a=e+n;for(let s=0;s!==n;++s){const n=t[e+s];if(n!==t[i+s]||n!==t[a+s]){r=!0;break}}}if(r){if(s!==a){e[a]=e[s];const i=s*n,r=a*n;for(let e=0;e!==n;++e)t[r+e]=t[i+e]}++a}}if(r>0){e[a]=e[r];for(let e=r*n,i=a*n,s=0;s!==n;++s)t[i+s]=t[e+s];++a}return a!==e.length?(this.times=vo(e,0,a),this.values=vo(t,0,a*n)):(this.times=e,this.values=t),this}clone(){const e=vo(this.times,0),t=vo(this.values,0),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}wo.prototype.TimeBufferType=Float32Array,wo.prototype.ValueBufferType=Float32Array,wo.prototype.DefaultInterpolation=ft;class To extends wo{}To.prototype.ValueTypeName="bool",To.prototype.ValueBufferType=Array,To.prototype.DefaultInterpolation=pt,To.prototype.InterpolantFactoryMethodLinear=void 0,To.prototype.InterpolantFactoryMethodSmooth=void 0;class Eo extends wo{}Eo.prototype.ValueTypeName="color";class Ao extends wo{}Ao.prototype.ValueTypeName="number";class Co extends yo{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const r=this.resultBuffer,a=this.sampleValues,s=this.valueSize,o=(n-t)/(i-t);let l=e*s;for(let e=l+s;l!==e;l+=4)Yt.slerpFlat(r,0,a,l-s,a,l,o);return r}}class Lo extends wo{InterpolantFactoryMethodLinear(e){return new Co(this.times,this.values,this.getValueSize(),e)}}Lo.prototype.ValueTypeName="quaternion",Lo.prototype.DefaultInterpolation=ft,Lo.prototype.InterpolantFactoryMethodSmooth=void 0;class Po extends wo{}Po.prototype.ValueTypeName="string",Po.prototype.ValueBufferType=Array,Po.prototype.DefaultInterpolation=pt,Po.prototype.InterpolantFactoryMethodLinear=void 0,Po.prototype.InterpolantFactoryMethodSmooth=void 0;class Ro extends wo{}Ro.prototype.ValueTypeName="vector";const Do={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};class Io{constructor(e,t,n){const i=this;let r,a=!1,s=0,o=0;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){o++,!1===a&&void 0!==i.onStart&&i.onStart(e,s,o),a=!0},this.itemEnd=function(e){s++,void 0!==i.onProgress&&i.onProgress(e,s,o),s===o&&(a=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(e){void 0!==i.onError&&i.onError(e)},this.resolveURL=function(e){return r?r(e):e},this.setURLModifier=function(e){return r=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){const t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(let t=0,n=l.length;t<n;t+=2){const n=l[t],i=l[t+1];if(n.global&&(n.lastIndex=0),n.test(e))return i}return null}}}const Oo=new Io;class No{constructor(e){this.manager=void 0!==e?e:Oo,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise((function(i,r){n.load(e,i,t,r)}))}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}class zo extends Error{constructor(e,t){super(e),this.response=t}}class Uo extends No{constructor(e){super(e)}load(e,t,n,i){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,a=Do.get(e);if(void 0!==a)return r.manager.itemStart(e),setTimeout((function(){t&&t(a),r.manager.itemEnd(e)}),0),a;const s=Xt("img");function o(){u(),Do.add(e,this),t&&t(this),r.manager.itemEnd(e)}function l(t){u(),i&&i(t),r.manager.itemError(e),r.manager.itemEnd(e)}function u(){s.removeEventListener("load",o,!1),s.removeEventListener("error",l,!1)}return s.addEventListener("load",o,!1),s.addEventListener("error",l,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(s.crossOrigin=this.crossOrigin),r.manager.itemStart(e),s.src=e,s}}class Fo extends No{constructor(e){super(e)}load(e,t,n,i){const r=new pn,a=new Uo(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,(function(e){r.image=e,r.needsUpdate=!0,void 0!==t&&t(r)}),n,i),r}}class ko{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=Bo(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=Bo();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function Bo(){return("undefined"==typeof performance?Date:performance).now()}const Vo="\\[\\]\\.:\\/",Go=new RegExp("["+Vo+"]","g"),Ho="[^"+Vo+"]",qo="[^"+Vo.replace("\\.","")+"]",Wo=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",Ho)+/(WCOD+)?/.source.replace("WCOD",qo)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Ho)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Ho)+"$"),jo=["material","materials","bones","map"];class Xo{constructor(e,t,n){this.path=t,this.parsedPath=n||Xo.parseTrackName(t),this.node=Xo.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new Xo.Composite(e,t,n):new Xo(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(Go,"")}static parseTrackName(e){const t=Wo.exec(e);if(null===t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){const e=n.nodeName.substring(i+1);-1!==jo.indexOf(e)&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=e)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(void 0===t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){const n=function(e){for(let i=0;i<e.length;i++){const r=e[i];if(r.name===t||r.uuid===t)return r;const a=n(r.children);if(a)return a}return null},i=n(e.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)e[t++]=n[i]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,i=t.propertyName;let r=t.propertyIndex;if(e||(e=Xo.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(n){let i=t.objectIndex;switch(n){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===i){i=t;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);e=e.material.map;break;default:if(void 0===e[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[n]}if(void 0!==i){if(void 0===e[i])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[i]}}const a=e[i];if(void 0===a){const n=t.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+i+" but it wasn't found.",e)}let s=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?s=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(s=this.Versioning.MatrixWorldNeedsUpdate);let o=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===i){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[r]&&(r=e.morphTargetDictionary[r])}o=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=r}else void 0!==a.fromArray&&void 0!==a.toArray?(o=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(o=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=i;this.getValue=this.GetterByBindingType[o],this.setValue=this.SetterByBindingTypeAndVersioning[o][s]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Xo.Composite=class{constructor(e,t,n){const i=n||Xo.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,i=this._bindings[n];void 0!==i&&i.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=n.length;i!==r;++i)n[i].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}},Xo.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Xo.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Xo.prototype.GetterByBindingType=[Xo.prototype._getValue_direct,Xo.prototype._getValue_array,Xo.prototype._getValue_arrayElement,Xo.prototype._getValue_toArray],Xo.prototype.SetterByBindingTypeAndVersioning=[[Xo.prototype._setValue_direct,Xo.prototype._setValue_direct_setNeedsUpdate,Xo.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Xo.prototype._setValue_array,Xo.prototype._setValue_array_setNeedsUpdate,Xo.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Xo.prototype._setValue_arrayElement,Xo.prototype._setValue_arrayElement_setNeedsUpdate,Xo.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Xo.prototype._setValue_fromArray,Xo.prototype._setValue_fromArray_setNeedsUpdate,Xo.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];new Float32Array(1);"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:s}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=s);class Yo{constructor(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const Jo=new Wr(-1,1,1,-1,0,1),Zo=new Zi;Zo.setAttribute("position",new Gi([-1,3,0,-1,-1,0,3,-1,0],3)),Zo.setAttribute("uv",new Gi([0,2,0,0,2,0],2));class Ko{constructor(e){this._mesh=new hr(Zo,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,Jo)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class Qo extends Yo{constructor(e,t,n,i,r){super(),this.scene=e,this.camera=t,this.overrideMaterial=n,this.clearColor=i,this.clearAlpha=void 0!==r?r:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new Oi}render(e,t,n){const i=e.autoClear;let r,a;e.autoClear=!1,void 0!==this.overrideMaterial&&(a=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(e.getClearColor(this._oldClearColor),r=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:n),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor&&e.setClearColor(this._oldClearColor,r),void 0!==this.overrideMaterial&&(this.scene.overrideMaterial=a),e.autoClear=i}}const $o={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform float opacity;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tgl_FragColor = texture2D( tDiffuse, vUv );\n\t\t\tgl_FragColor.a *= opacity;\n\n\n\t\t}"};class el extends Yo{constructor(e,t){super(),this.textureID=void 0!==t?t:"tDiffuse",e instanceof _r?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=vr.clone(e.uniforms),this.material=new _r({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new Ko(this.material)}render(e,t,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}class tl extends Yo{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,n){const i=e.getContext(),r=e.state;let a,s;r.buffers.color.setMask(!1),r.buffers.depth.setMask(!1),r.buffers.color.setLocked(!0),r.buffers.depth.setLocked(!0),this.inverse?(a=0,s=1):(a=1,s=0),r.buffers.stencil.setTest(!0),r.buffers.stencil.setOp(i.REPLACE,i.REPLACE,i.REPLACE),r.buffers.stencil.setFunc(i.ALWAYS,a,4294967295),r.buffers.stencil.setClear(s),r.buffers.stencil.setLocked(!0),e.setRenderTarget(n),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),r.buffers.color.setLocked(!1),r.buffers.depth.setLocked(!1),r.buffers.stencil.setLocked(!1),r.buffers.stencil.setFunc(i.EQUAL,1,4294967295),r.buffers.stencil.setOp(i.KEEP,i.KEEP,i.KEEP),r.buffers.stencil.setLocked(!0)}}class nl extends Yo{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class il{constructor(e,t){if(this.renderer=e,void 0===t){const n=e.getSize(new Ht);this._pixelRatio=e.getPixelRatio(),this._width=n.width,this._height=n.height,(t=new mn(this._width*this._pixelRatio,this._height*this._pixelRatio)).texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new el($o),this.clock=new ko}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);-1!==t&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){void 0===e&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let n=!1;for(let t=0,i=this.passes.length;t<i;t++){const i=this.passes[t];if(!1!==i.enabled){if(i.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(t),i.render(this.renderer,this.writeBuffer,this.readBuffer,e,n),i.needsSwap){if(n){const t=this.renderer.getContext(),n=this.renderer.state.buffers.stencil;n.setFunc(t.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),n.setFunc(t.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==tl&&(i instanceof tl?n=!0:i instanceof nl&&(n=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(void 0===e){const t=this.renderer.getSize(new Ht);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const n=this._width*this._pixelRatio,i=this._height*this._pixelRatio;this.renderTarget1.setSize(n,i),this.renderTarget2.setSize(n,i);for(let e=0;e<this.passes.length;e++)this.passes[e].setSize(n,i)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}var rl,al,sl,ol,ll,ul,cl,hl,dl,pl={};rl=function(){return Date.now()},al=function(e,t){var n=e+rl();return{start:n,end:n+t}},sl=function(e){return function(t){return Math.pow(t,e)}},ol=function(e){return function(t){return 1-Math.abs(Math.pow(t-1,e))}},ll=function(e){return function(t){return t<.5?sl(e)(2*t)/2:ol(e)(2*t-1)/2+.5}},ul={linear:ll(1),easeInQuad:sl(2),easeOutQuad:ol(2),easeInOutQuad:ll(2),easeInCubic:sl(3),easeOutCubic:ol(3),easeInOutCubic:ll(3),easeInQuart:sl(4),easeOutQuart:ol(4),easeInOutQuart:ll(4),easeInQuint:sl(5),easeOutQuint:ol(5),easeInOutQuint:ll(5)},cl=function(e,t,n){var i=(Date.now()-e)/t;return ul[n](i)},hl=function e(t,n,i){var r=t,a=r.start,s=r.end,o=r.easing,l=r.to,u=r.from,c=r.duration,h=r.change,d=r.done,p=r.loop,f=r.rewind,m=r.loopDelay;if(a&&s){var g=cl(a,c,o);if(t.value=u+(l-u)*g,rl()<=s)h&&rl()>=a&&h(t.value),n=requestAnimationFrame((function(){return e(t,n,i)}));else if(h&&h(t.to),p){if(f){var v=t,_=v.from,x=v.to;t.from=x,t.to=_}var y=m;if((t=Object.assign({},t,al(y,c))).iteration){t.iteration+=1;var b=t.iteration;f&&(b/=2),!0===p||b<=p?n=requestAnimationFrame((function(){return e(t,n,i)})):(d&&d(),i())}}else d&&d()}},dl=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Promise((function(t){var n=e.from,i=void 0===n?0:n,r=e.to,a=void 0===r?1:r,s=e.easing,o=void 0===s?"easeInQuad":s,l=e.duration,u=void 0===l?600:l,c=e.delay,h=void 0===c?0:c,d=e.loopDelay,p=void 0===d?0:d,f=e.rewind,m=void 0!==f&&f,g=e.change,v=e.done,_=e.loop,x=void 0===_?1:_;!1===x&&(x=1);var y={from:i,to:a,duration:u,delay:h,loopDelay:p,loop:x,easing:o,rewind:m,change:g,done:v};(y=Object.assign({},y,al(h,u))).iteration=1;var b=requestAnimationFrame((function(){return hl(y,b,t)}))}))},pl=dl;class fl extends Yo{constructor(e){super(),this.material=new _r({uniforms:{tDiffuse:{type:"t",value:null},colorMap:{type:"t",value:e},oldColorMap:{type:"t",value:e},progress:{type:"f",value:0},opacity:{type:"f",value:0}},fragmentShader:t("#define GLSLIFY 1\nuniform sampler2D tDiffuse;\nuniform sampler2D colorMap;\nuniform sampler2D oldColorMap;\nuniform float progress;\nuniform float opacity;\n\nvarying vec2 vUv;\n\n#define luma vec3(0.299, 0.587, 0.114)\n\nvoid main() {\n    vec4 originalTexel = texture2D(tDiffuse, vUv);\n\n    float brightness = dot(originalTexel.rgb, luma);\n\n    vec3 oldColor = texture2D(oldColorMap, vec2(brightness, 0.)).rgb;\n    vec3 newColor = texture2D(colorMap, vec2(brightness, 0.)).rgb;\n\n    vec3 colormapsTexelColor = mix(oldColor, newColor, progress);\n\n    vec3 color = mix(originalTexel.rgb, colormapsTexelColor, opacity);\n\n    gl_FragColor = vec4(color, 1.0);\n}"),vertexShader:t("#define GLSLIFY 1\nvarying vec2 vUv;\n\nvoid main(){\n    vUv = uv;\n\n    vec4 mvPosition = modelViewMatrix * vec4(position, 1.);\n    gl_Position = projectionMatrix * mvPosition;\n}")}),this.fsQuad=new Ko(this.material)}updateIntensity(e){this.material.uniforms.intensity.value=e}updateOpacity(e){this.material.uniforms.opacity.value=e}changeColormap(e){this.material.uniforms.oldColorMap.value=this.material.uniforms.colorMap.value,this.material.uniforms.colorMap.value=e,this.material.uniforms.progress.value=0,t(pl)({from:0,to:1,duration:1e3,easing:"easeInOutCubic",change:e=>{this.material.uniforms.progress.value=e}})}toggleOpacity(){0==this.material.uniforms.opacity.value?this.changeOpacity(1):this.changeOpacity(0)}changeOpacity(e){t(pl)({from:this.material.uniforms.opacity.value,to:e,duration:1e3,easing:"easeInOutCubic",change:e=>{this.material.uniforms.opacity.value=e}})}dispose(){this.material.dispose(),this.fsQuad.dispose()}render(e,t,n){this.material.uniforms.tDiffuse.value=n.texture,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(),this.fsQuad.render(e))}}new URL(a("27Lyk").resolve("fO4sz"),import.meta.url).toString();new URL(a("27Lyk").resolve("clFkl"),import.meta.url).toString();var ml;ml=new URL(a("27Lyk").resolve("61uym"),import.meta.url).toString();var gl;gl=new URL(a("27Lyk").resolve("5zTxb"),import.meta.url).toString();var vl;vl=new URL(a("27Lyk").resolve("hy8En"),import.meta.url).toString();var _l;_l=new URL(a("27Lyk").resolve("ebDdH"),import.meta.url).toString();var xl;xl=new URL(a("27Lyk").resolve("yBh7C"),import.meta.url).toString();var yl;yl=new URL(a("27Lyk").resolve("9Pher"),import.meta.url).toString();var bl;bl=new URL(a("27Lyk").resolve("9pFgq"),import.meta.url).toString();var Ml;Ml=new URL(a("27Lyk").resolve("3xL7k"),import.meta.url).toString();function Sl(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function wl(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}
/*!
 * GSAP 3.12.2
 * https://greensock.com
 *
 * @license Copyright 2008-2023, GreenSock. All rights reserved.
 * Subject to the terms at https://greensock.com/standard-license or for
 * Club GreenSock members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var Tl,El,Al,Cl,Ll,Pl,Rl,Dl,Il,Ol,Nl,zl,Ul,Fl,kl,Bl,Vl,Gl,Hl,ql,Wl,jl,Xl,Yl,Jl,Zl,Kl={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},Ql={duration:.5,overwrite:!1,delay:0},$l=1e8,eu=1/$l,tu=2*Math.PI,nu=tu/4,iu=0,ru=Math.sqrt,au=Math.cos,su=Math.sin,ou=function(e){return"string"==typeof e},lu=function(e){return"function"==typeof e},uu=function(e){return"number"==typeof e},cu=function(e){return void 0===e},hu=function(e){return"object"==typeof e},du=function(e){return!1!==e},pu=function(){return"undefined"!=typeof window},fu=function(e){return lu(e)||ou(e)},mu="function"==typeof ArrayBuffer&&ArrayBuffer.isView||function(){},gu=Array.isArray,vu=/(?:-?\.?\d|\.)+/gi,_u=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,xu=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,yu=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,bu=/[+-]=-?[.\d]+/,Mu=/[^,'"\[\]\s]+/gi,Su=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,wu={},Tu={},Eu=function(e){return(Tu=tc(e,wu))&&nd},Au=function(e,t){return console.warn("Invalid property",e,"set to",t,"Missing plugin? gsap.registerPlugin()")},Cu=function(e,t){return!t&&console.warn(e)},Lu=function(e,t){return e&&(wu[e]=t)&&Tu&&(Tu[e]=t)||wu},Pu=function(){return 0},Ru={suppressEvents:!0,isStart:!0,kill:!1},Du={suppressEvents:!0,kill:!1},Iu={suppressEvents:!0},Ou={},Nu=[],zu={},Uu={},Fu={},ku=30,Bu=[],Vu="",Gu=function(e){var t,n,i=e[0];if(hu(i)||lu(i)||(e=[e]),!(t=(i._gsap||{}).harness)){for(n=Bu.length;n--&&!Bu[n].targetTest(i););t=Bu[n]}for(n=e.length;n--;)e[n]&&(e[n]._gsap||(e[n]._gsap=new gh(e[n],t)))||e.splice(n,1);return e},Hu=function(e){return e._gsap||Gu(Ic(e))[0]._gsap},qu=function(e,t,n){return(n=e[t])&&lu(n)?e[t]():cu(n)&&e.getAttribute&&e.getAttribute(t)||n},Wu=function(e,t){return(e=e.split(",")).forEach(t)||e},ju=function(e){return Math.round(1e5*e)/1e5||0},Xu=function(e){return Math.round(1e7*e)/1e7||0},Yu=function(e,t){var n=t.charAt(0),i=parseFloat(t.substr(2));return e=parseFloat(e),"+"===n?e+i:"-"===n?e-i:"*"===n?e*i:e/i},Ju=function(e,t){for(var n=t.length,i=0;e.indexOf(t[i])<0&&++i<n;);return i<n},Zu=function(){var e,t,n=Nu.length,i=Nu.slice(0);for(zu={},Nu.length=0,e=0;e<n;e++)(t=i[e])&&t._lazy&&(t.render(t._lazy[0],t._lazy[1],!0)._lazy=0)},Ku=function(e,t,n,i){Nu.length&&!El&&Zu(),e.render(t,n,i||El&&t<0&&(e._initted||e._startAt)),Nu.length&&!El&&Zu()},Qu=function(e){var t=parseFloat(e);return(t||0===t)&&(e+"").match(Mu).length<2?t:ou(e)?e.trim():e},$u=function(e){return e},ec=function(e,t){for(var n in t)n in e||(e[n]=t[n]);return e},tc=function(e,t){for(var n in t)e[n]=t[n];return e},nc=function e(t,n){for(var i in n)"__proto__"!==i&&"constructor"!==i&&"prototype"!==i&&(t[i]=hu(n[i])?e(t[i]||(t[i]={}),n[i]):n[i]);return t},ic=function(e,t){var n,i={};for(n in e)n in t||(i[n]=e[n]);return i},rc=function(e){var t,n=e.parent||Cl,i=e.keyframes?(t=gu(e.keyframes),function(e,n){for(var i in n)i in e||"duration"===i&&t||"ease"===i||(e[i]=n[i])}):ec;if(du(e.inherit))for(;n;)i(e,n.vars.defaults),n=n.parent||n._dp;return e},ac=function(e,t,n,i,r){void 0===n&&(n="_first"),void 0===i&&(i="_last");var a,s=e[i];if(r)for(a=t[r];s&&s[r]>a;)s=s._prev;return s?(t._next=s._next,s._next=t):(t._next=e[n],e[n]=t),t._next?t._next._prev=t:e[i]=t,t._prev=s,t.parent=t._dp=e,t},sc=function(e,t,n,i){void 0===n&&(n="_first"),void 0===i&&(i="_last");var r=t._prev,a=t._next;r?r._next=a:e[n]===t&&(e[n]=a),a?a._prev=r:e[i]===t&&(e[i]=r),t._next=t._prev=t.parent=null},oc=function(e,t){e.parent&&(!t||e.parent.autoRemoveChildren)&&e.parent.remove&&e.parent.remove(e),e._act=0},lc=function(e,t){if(e&&(!t||t._end>e._dur||t._start<0))for(var n=e;n;)n._dirty=1,n=n.parent;return e},uc=function(e){for(var t=e.parent;t&&t.parent;)t._dirty=1,t.totalDuration(),t=t.parent;return e},cc=function(e,t,n,i){return e._startAt&&(El?e._startAt.revert(Du):e.vars.immediateRender&&!e.vars.autoRevert||e._startAt.render(t,!0,i))},hc=function e(t){return!t||t._ts&&e(t.parent)},dc=function(e){return e._repeat?pc(e._tTime,e=e.duration()+e._rDelay)*e:0},pc=function(e,t){var n=Math.floor(e/=t);return e&&n===e?n-1:n},fc=function(e,t){return(e-t._start)*t._ts+(t._ts>=0?0:t._dirty?t.totalDuration():t._tDur)},mc=function(e){return e._end=Xu(e._start+(e._tDur/Math.abs(e._ts||e._rts||eu)||0))},gc=function(e,t){var n=e._dp;return n&&n.smoothChildTiming&&e._ts&&(e._start=Xu(n._time-(e._ts>0?t/e._ts:((e._dirty?e.totalDuration():e._tDur)-t)/-e._ts)),mc(e),n._dirty||lc(n,e)),e},vc=function(e,t){var n;if((t._time||!t._dur&&t._initted||t._start<e._time&&(t._dur||!t.add))&&(n=fc(e.rawTime(),t),(!t._dur||Lc(0,t.totalDuration(),n)-t._tTime>eu)&&t.render(n,!0)),lc(e,t)._dp&&e._initted&&e._time>=e._dur&&e._ts){if(e._dur<e.duration())for(n=e;n._dp;)n.rawTime()>=0&&n.totalTime(n._tTime),n=n._dp;e._zTime=-eu}},_c=function(e,t,n,i){return t.parent&&oc(t),t._start=Xu((uu(n)?n:n||e!==Cl?Ec(e,n,t):e._time)+t._delay),t._end=Xu(t._start+(t.totalDuration()/Math.abs(t.timeScale())||0)),ac(e,t,"_first","_last",e._sort?"_start":0),Mc(t)||(e._recent=t),i||vc(e,t),e._ts<0&&gc(e,e._tTime),e},xc=function(e,t){return(wu.ScrollTrigger||Au("scrollTrigger",t))&&wu.ScrollTrigger.create(t,e)},yc=function(e,t,n,i,r){return wh(e,t,r),e._initted?!n&&e._pt&&!El&&(e._dur&&!1!==e.vars.lazy||!e._dur&&e.vars.lazy)&&Il!==ih.frame?(Nu.push(e),e._lazy=[r,i],1):void 0:1},bc=function e(t){var n=t.parent;return n&&n._ts&&n._initted&&!n._lock&&(n.rawTime()<0||e(n))},Mc=function(e){var t=e.data;return"isFromStart"===t||"isStart"===t},Sc=function(e,t,n,i){var r=e._repeat,a=Xu(t)||0,s=e._tTime/e._tDur;return s&&!i&&(e._time*=a/e._dur),e._dur=a,e._tDur=r?r<0?1e10:Xu(a*(r+1)+e._rDelay*r):a,s>0&&!i&&gc(e,e._tTime=e._tDur*s),e.parent&&mc(e),n||lc(e.parent,e),e},wc=function(e){return e instanceof _h?lc(e):Sc(e,e._dur)},Tc={_start:0,endTime:Pu,totalDuration:Pu},Ec=function e(t,n,i){var r,a,s,o=t.labels,l=t._recent||Tc,u=t.duration()>=$l?l.endTime(!1):t._dur;return ou(n)&&(isNaN(n)||n in o)?(a=n.charAt(0),s="%"===n.substr(-1),r=n.indexOf("="),"<"===a||">"===a?(r>=0&&(n=n.replace(/=/,"")),("<"===a?l._start:l.endTime(l._repeat>=0))+(parseFloat(n.substr(1))||0)*(s?(r<0?l:i).totalDuration()/100:1)):r<0?(n in o||(o[n]=u),o[n]):(a=parseFloat(n.charAt(r-1)+n.substr(r+1)),s&&i&&(a=a/100*(gu(i)?i[0]:i).totalDuration()),r>1?e(t,n.substr(0,r-1),i)+a:u+a)):null==n?u:+n},Ac=function(e,t,n){var i,r,a=uu(t[1]),s=(a?2:1)+(e<2?0:1),o=t[s];if(a&&(o.duration=t[1]),o.parent=n,e){for(i=o,r=n;r&&!("immediateRender"in i);)i=r.vars.defaults||{},r=du(r.vars.inherit)&&r.parent;o.immediateRender=du(i.immediateRender),e<2?o.runBackwards=1:o.startAt=t[s-1]}return new Lh(t[0],o,t[s+1])},Cc=function(e,t){return e||0===e?t(e):t},Lc=function(e,t,n){return n<e?e:n>t?t:n},Pc=function(e,t){return ou(e)&&(t=Su.exec(e))?t[1]:""},Rc=[].slice,Dc=function(e,t){return e&&hu(e)&&"length"in e&&(!t&&!e.length||e.length-1 in e&&hu(e[0]))&&!e.nodeType&&e!==Ll},Ic=function(e,t,n){return Al&&!t&&Al.selector?Al.selector(e):!ou(e)||n||!Pl&&rh()?gu(e)?function(e,t,n){return void 0===n&&(n=[]),e.forEach((function(e){var i;return ou(e)&&!t||Dc(e,1)?(i=n).push.apply(i,Ic(e)):n.push(e)}))||n}(e,n):Dc(e)?Rc.call(e,0):e?[e]:[]:Rc.call((t||Rl).querySelectorAll(e),0)},Oc=function(e){return e=Ic(e)[0]||Cu("Invalid scope")||{},function(t){var n=e.current||e.nativeElement||e;return Ic(t,n.querySelectorAll?n:n===e?Cu("Invalid scope")||Rl.createElement("div"):e)}},Nc=function(e){return e.sort((function(){return.5-Math.random()}))},zc=function(e){if(lu(e))return e;var t=hu(e)?e:{each:e},n=hh(t.ease),i=t.from||0,r=parseFloat(t.base)||0,a={},s=i>0&&i<1,o=isNaN(i)||s,l=t.axis,u=i,c=i;return ou(i)?u=c={center:.5,edges:.5,end:1}[i]||0:!s&&o&&(u=i[0],c=i[1]),function(e,s,h){var d,p,f,m,g,v,_,x,y,b=(h||t).length,M=a[b];if(!M){if(!(y="auto"===t.grid?0:(t.grid||[1,$l])[1])){for(_=-$l;_<(_=h[y++].getBoundingClientRect().left)&&y<b;);y--}for(M=a[b]=[],d=o?Math.min(y,b)*u-.5:i%y,p=y===$l?0:o?b*c/y-.5:i/y|0,_=0,x=$l,v=0;v<b;v++)f=v%y-d,m=p-(v/y|0),M[v]=g=l?Math.abs("y"===l?m:f):ru(f*f+m*m),g>_&&(_=g),g<x&&(x=g);"random"===i&&Nc(M),M.max=_-x,M.min=x,M.v=b=(parseFloat(t.amount)||parseFloat(t.each)*(y>b?b-1:l?"y"===l?b/y:y:Math.max(y,b/y))||0)*("edges"===i?-1:1),M.b=b<0?r-b:r,M.u=Pc(t.amount||t.each)||0,n=n&&b<0?uh(n):n}return b=(M[e]-M.min)/M.max||0,Xu(M.b+(n?n(b):b)*M.v)+M.u}},Uc=function(e){var t=Math.pow(10,((e+"").split(".")[1]||"").length);return function(n){var i=Xu(Math.round(parseFloat(n)/e)*e*t);return(i-i%1)/t+(uu(n)?0:Pc(n))}},Fc=function(e,t){var n,i,r=gu(e);return!r&&hu(e)&&(n=r=e.radius||$l,e.values?(e=Ic(e.values),(i=!uu(e[0]))&&(n*=n)):e=Uc(e.increment)),Cc(t,r?lu(e)?function(t){return i=e(t),Math.abs(i-t)<=n?i:t}:function(t){for(var r,a,s=parseFloat(i?t.x:t),o=parseFloat(i?t.y:0),l=$l,u=0,c=e.length;c--;)(r=i?(r=e[c].x-s)*r+(a=e[c].y-o)*a:Math.abs(e[c]-s))<l&&(l=r,u=c);return u=!n||l<=n?e[u]:t,i||u===t||uu(t)?u:u+Pc(t)}:Uc(e))},kc=function(e,t,n,i){return Cc(gu(e)?!t:!0===n?(n=0,!1):!i,(function(){return gu(e)?e[~~(Math.random()*e.length)]:(i=(n=n||1e-5)<1?Math.pow(10,(n+"").length-2):1)&&Math.floor(Math.round((e-n/2+Math.random()*(t-e+.99*n))/n)*n*i)/i}))},Bc=function(e,t,n){return Cc(n,(function(n){return e[~~t(n)]}))},Vc=function(e){for(var t,n,i,r,a=0,s="";~(t=e.indexOf("random(",a));)i=e.indexOf(")",t),r="["===e.charAt(t+7),n=e.substr(t+7,i-t-7).match(r?Mu:vu),s+=e.substr(a,t-a)+kc(r?n:+n[0],r?0:+n[1],+n[2]||1e-5),a=i+1;return s+e.substr(a,e.length-a)},Gc=function(e,t,n,i,r){var a=t-e,s=i-n;return Cc(r,(function(t){return n+((t-e)/a*s||0)}))},Hc=function(e,t,n){var i,r,a,s=e.labels,o=$l;for(i in s)(r=s[i]-t)<0==!!n&&r&&o>(r=Math.abs(r))&&(a=i,o=r);return a},qc=function(e,t,n){var i,r,a,s=e.vars,o=s[t],l=Al,u=e._ctx;if(o)return i=s[t+"Params"],r=s.callbackScope||e,n&&Nu.length&&Zu(),u&&(Al=u),a=i?o.apply(r,i):o.call(r),Al=l,a},Wc=function(e){return oc(e),e.scrollTrigger&&e.scrollTrigger.kill(!!El),e.progress()<1&&qc(e,"onInterrupt"),e},jc=[],Xc=function(e){if(pu()&&e){var t=(e=!e.name&&e.default||e).name,n=lu(e),i=t&&!n&&e.init?function(){this._props=[]}:e,r={init:Pu,render:Fh,add:Mh,kill:Bh,modifier:kh,rawVars:0},a={targetTest:0,get:0,getSetter:Oh,aliases:{},register:0};if(rh(),e!==i){if(Uu[t])return;ec(i,ec(ic(e,r),a)),tc(i.prototype,tc(r,ic(e,a))),Uu[i.prop=t]=i,e.targetTest&&(Bu.push(i),Ou[t]=1),t=("css"===t?"CSS":t.charAt(0).toUpperCase()+t.substr(1))+"Plugin"}Lu(t,i),e.register&&e.register(nd,i,Hh)}else e&&jc.push(e)},Yc=255,Jc={aqua:[0,Yc,Yc],lime:[0,Yc,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,Yc],navy:[0,0,128],white:[Yc,Yc,Yc],olive:[128,128,0],yellow:[Yc,Yc,0],orange:[Yc,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[Yc,0,0],pink:[Yc,192,203],cyan:[0,Yc,Yc],transparent:[Yc,Yc,Yc,0]},Zc=function(e,t,n){return(6*(e+=e<0?1:e>1?-1:0)<1?t+(n-t)*e*6:e<.5?n:3*e<2?t+(n-t)*(2/3-e)*6:t)*Yc+.5|0},Kc=function(e,t,n){var i,r,a,s,o,l,u,c,h,d,p=e?uu(e)?[e>>16,e>>8&Yc,e&Yc]:0:Jc.black;if(!p){if(","===e.substr(-1)&&(e=e.substr(0,e.length-1)),Jc[e])p=Jc[e];else if("#"===e.charAt(0)){if(e.length<6&&(i=e.charAt(1),r=e.charAt(2),a=e.charAt(3),e="#"+i+i+r+r+a+a+(5===e.length?e.charAt(4)+e.charAt(4):"")),9===e.length)return[(p=parseInt(e.substr(1,6),16))>>16,p>>8&Yc,p&Yc,parseInt(e.substr(7),16)/255];p=[(e=parseInt(e.substr(1),16))>>16,e>>8&Yc,e&Yc]}else if("hsl"===e.substr(0,3))if(p=d=e.match(vu),t){if(~e.indexOf("="))return p=e.match(_u),n&&p.length<4&&(p[3]=1),p}else s=+p[0]%360/360,o=+p[1]/100,i=2*(l=+p[2]/100)-(r=l<=.5?l*(o+1):l+o-l*o),p.length>3&&(p[3]*=1),p[0]=Zc(s+1/3,i,r),p[1]=Zc(s,i,r),p[2]=Zc(s-1/3,i,r);else p=e.match(vu)||Jc.transparent;p=p.map(Number)}return t&&!d&&(i=p[0]/Yc,r=p[1]/Yc,a=p[2]/Yc,l=((u=Math.max(i,r,a))+(c=Math.min(i,r,a)))/2,u===c?s=o=0:(h=u-c,o=l>.5?h/(2-u-c):h/(u+c),s=u===i?(r-a)/h+(r<a?6:0):u===r?(a-i)/h+2:(i-r)/h+4,s*=60),p[0]=~~(s+.5),p[1]=~~(100*o+.5),p[2]=~~(100*l+.5)),n&&p.length<4&&(p[3]=1),p},Qc=function(e){var t=[],n=[],i=-1;return e.split(eh).forEach((function(e){var r=e.match(xu)||[];t.push.apply(t,r),n.push(i+=r.length+1)})),t.c=n,t},$c=function(e,t,n){var i,r,a,s,o="",l=(e+o).match(eh),u=t?"hsla(":"rgba(",c=0;if(!l)return e;if(l=l.map((function(e){return(e=Kc(e,t,1))&&u+(t?e[0]+","+e[1]+"%,"+e[2]+"%,"+e[3]:e.join(","))+")"})),n&&(a=Qc(e),(i=n.c).join(o)!==a.c.join(o)))for(s=(r=e.replace(eh,"1").split(xu)).length-1;c<s;c++)o+=r[c]+(~i.indexOf(c)?l.shift()||u+"0,0,0,0)":(a.length?a:l.length?l:n).shift());if(!r)for(s=(r=e.split(eh)).length-1;c<s;c++)o+=r[c]+l[c];return o+r[s]},eh=function(){var e,t="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b";for(e in Jc)t+="|"+e+"\\b";return new RegExp(t+")","gi")}(),th=/hsl[a]?\(/,nh=function(e){var t,n=e.join(" ");if(eh.lastIndex=0,eh.test(n))return t=th.test(n),e[1]=$c(e[1],t),e[0]=$c(e[0],t,Qc(e[1])),!0},ih=(Gl=Date.now,Hl=500,ql=33,Wl=Gl(),jl=Wl,Yl=Xl=1e3/240,Zl=function e(t){var n,i,r,a,s=Gl()-jl,o=!0===t;if(s>Hl&&(Wl+=s-ql),((n=(r=(jl+=s)-Wl)-Yl)>0||o)&&(a=++kl.frame,Bl=r-1e3*kl.time,kl.time=r/=1e3,Yl+=n+(n>=Xl?4:Xl-n),i=1),o||(zl=Ul(e)),i)for(Vl=0;Vl<Jl.length;Vl++)Jl[Vl](r,Bl,a,t)},kl={time:0,frame:0,tick:function(){Zl(!0)},deltaRatio:function(e){return Bl/(1e3/(e||60))},wake:function(){Dl&&(!Pl&&pu()&&(Ll=Pl=window,Rl=Ll.document||{},wu.gsap=nd,(Ll.gsapVersions||(Ll.gsapVersions=[])).push(nd.version),Eu(Tu||Ll.GreenSockGlobals||!Ll.gsap&&Ll||{}),Fl=Ll.requestAnimationFrame,jc.forEach(Xc)),zl&&kl.sleep(),Ul=Fl||function(e){return setTimeout(e,Yl-1e3*kl.time+1|0)},Nl=1,Zl(2))},sleep:function(){(Fl?Ll.cancelAnimationFrame:clearTimeout)(zl),Nl=0,Ul=Pu},lagSmoothing:function(e,t){Hl=e||1/0,ql=Math.min(t||33,Hl)},fps:function(e){Xl=1e3/(e||240),Yl=1e3*kl.time+Xl},add:function(e,t,n){var i=t?function(t,n,r,a){e(t,n,r,a),kl.remove(i)}:e;return kl.remove(e),Jl[n?"unshift":"push"](i),rh(),i},remove:function(e,t){~(t=Jl.indexOf(e))&&Jl.splice(t,1)&&Vl>=t&&Vl--},_listeners:Jl=[]},kl),rh=function(){return!Nl&&ih.wake()},ah={},sh=/^[\d.\-M][\d.\-,\s]/,oh=/["']/g,lh=function(e){for(var t,n,i,r={},a=e.substr(1,e.length-3).split(":"),s=a[0],o=1,l=a.length;o<l;o++)n=a[o],t=o!==l-1?n.lastIndexOf(","):n.length,i=n.substr(0,t),r[s]=isNaN(i)?i.replace(oh,"").trim():+i,s=n.substr(t+1).trim();return r},uh=function(e){return function(t){return 1-e(1-t)}},ch=function e(t,n){for(var i,r=t._first;r;)r instanceof _h?e(r,n):!r.vars.yoyoEase||r._yoyo&&r._repeat||r._yoyo===n||(r.timeline?e(r.timeline,n):(i=r._ease,r._ease=r._yEase,r._yEase=i,r._yoyo=n)),r=r._next},hh=function(e,t){return e&&(lu(e)?e:ah[e]||function(e){var t,n,i,r,a=(e+"").split("("),s=ah[a[0]];return s&&a.length>1&&s.config?s.config.apply(null,~e.indexOf("{")?[lh(a[1])]:(t=e,n=t.indexOf("(")+1,i=t.indexOf(")"),r=t.indexOf("(",n),t.substring(n,~r&&r<i?t.indexOf(")",i+1):i)).split(",").map(Qu)):ah._CE&&sh.test(e)?ah._CE("",e):s}(e))||t},dh=function(e,t,n,i){void 0===n&&(n=function(e){return 1-t(1-e)}),void 0===i&&(i=function(e){return e<.5?t(2*e)/2:1-t(2*(1-e))/2});var r,a={easeIn:t,easeOut:n,easeInOut:i};return Wu(e,(function(e){for(var t in ah[e]=wu[e]=a,ah[r=e.toLowerCase()]=n,a)ah[r+("easeIn"===t?".in":"easeOut"===t?".out":".inOut")]=ah[e+"."+t]=a[t]})),a},ph=function(e){return function(t){return t<.5?(1-e(1-2*t))/2:.5+e(2*(t-.5))/2}},fh=function e(t,n,i){var r=n>=1?n:1,a=(i||(t?.3:.45))/(n<1?n:1),s=a/tu*(Math.asin(1/r)||0),o=function(e){return 1===e?1:r*Math.pow(2,-10*e)*su((e-s)*a)+1},l="out"===t?o:"in"===t?function(e){return 1-o(1-e)}:ph(o);return a=tu/a,l.config=function(n,i){return e(t,n,i)},l},mh=function e(t,n){void 0===n&&(n=1.70158);var i=function(e){return e?--e*e*((n+1)*e+n)+1:0},r="out"===t?i:"in"===t?function(e){return 1-i(1-e)}:ph(i);return r.config=function(n){return e(t,n)},r};Wu("Linear,Quad,Cubic,Quart,Quint,Strong",(function(e,t){var n=t<5?t+1:t;dh(e+",Power"+(n-1),t?function(e){return Math.pow(e,n)}:function(e){return e},(function(e){return 1-Math.pow(1-e,n)}),(function(e){return e<.5?Math.pow(2*e,n)/2:1-Math.pow(2*(1-e),n)/2}))})),ah.Linear.easeNone=ah.none=ah.Linear.easeIn,dh("Elastic",fh("in"),fh("out"),fh()),function(e,t){var n=1/t,i=function(i){return i<n?e*i*i:i<.7272727272727273?e*Math.pow(i-1.5/t,2)+.75:i<.9090909090909092?e*(i-=2.25/t)*i+.9375:e*Math.pow(i-2.625/t,2)+.984375};dh("Bounce",(function(e){return 1-i(1-e)}),i)}(7.5625,2.75),dh("Expo",(function(e){return e?Math.pow(2,10*(e-1)):0})),dh("Circ",(function(e){return-(ru(1-e*e)-1)})),dh("Sine",(function(e){return 1===e?1:1-au(e*nu)})),dh("Back",mh("in"),mh("out"),mh()),ah.SteppedEase=ah.steps=wu.SteppedEase={config:function(e,t){void 0===e&&(e=1);var n=1/e,i=e+(t?0:1),r=t?1:0,a=1-eu;return function(e){return((i*Lc(0,a,e)|0)+r)*n}}},Ql.ease=ah["quad.out"],Wu("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",(function(e){return Vu+=e+","+e+"Params,"}));var gh=function(e,t){this.id=iu++,e._gsap=this,this.target=e,this.harness=t,this.get=t?t.get:qu,this.set=t?t.getSetter:Oh},vh=function(){function e(e){this.vars=e,this._delay=+e.delay||0,(this._repeat=e.repeat===1/0?-2:e.repeat||0)&&(this._rDelay=e.repeatDelay||0,this._yoyo=!!e.yoyo||!!e.yoyoEase),this._ts=1,Sc(this,+e.duration,1,1),this.data=e.data,Al&&(this._ctx=Al,Al.data.push(this)),Nl||ih.wake()}var t=e.prototype;return t.delay=function(e){return e||0===e?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+e-this._delay),this._delay=e,this):this._delay},t.duration=function(e){return arguments.length?this.totalDuration(this._repeat>0?e+(e+this._rDelay)*this._repeat:e):this.totalDuration()&&this._dur},t.totalDuration=function(e){return arguments.length?(this._dirty=0,Sc(this,this._repeat<0?e:(e-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},t.totalTime=function(e,t){if(rh(),!arguments.length)return this._tTime;var n=this._dp;if(n&&n.smoothChildTiming&&this._ts){for(gc(this,e),!n._dp||n.parent||vc(n,this);n&&n.parent;)n.parent._time!==n._start+(n._ts>=0?n._tTime/n._ts:(n.totalDuration()-n._tTime)/-n._ts)&&n.totalTime(n._tTime,!0),n=n.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&e<this._tDur||this._ts<0&&e>0||!this._tDur&&!e)&&_c(this._dp,this,this._start-this._delay)}return(this._tTime!==e||!this._dur&&!t||this._initted&&Math.abs(this._zTime)===eu||!e&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=e),Ku(this,e,t)),this},t.time=function(e,t){return arguments.length?this.totalTime(Math.min(this.totalDuration(),e+dc(this))%(this._dur+this._rDelay)||(e?this._dur:0),t):this._time},t.totalProgress=function(e,t){return arguments.length?this.totalTime(this.totalDuration()*e,t):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.ratio},t.progress=function(e,t){return arguments.length?this.totalTime(this.duration()*(!this._yoyo||1&this.iteration()?e:1-e)+dc(this),t):this.duration()?Math.min(1,this._time/this._dur):this.ratio},t.iteration=function(e,t){var n=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(e-1)*n,t):this._repeat?pc(this._tTime,n)+1:1},t.timeScale=function(e){if(!arguments.length)return this._rts===-eu?0:this._rts;if(this._rts===e)return this;var t=this.parent&&this._ts?fc(this.parent._time,this):this._tTime;return this._rts=+e||0,this._ts=this._ps||e===-eu?0:this._rts,this.totalTime(Lc(-Math.abs(this._delay),this._tDur,t),!0),mc(this),uc(this)},t.paused=function(e){return arguments.length?(this._ps!==e&&(this._ps=e,e?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(rh(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,1===this.progress()&&Math.abs(this._zTime)!==eu&&(this._tTime-=eu)))),this):this._ps},t.startTime=function(e){if(arguments.length){this._start=e;var t=this.parent||this._dp;return t&&(t._sort||!this.parent)&&_c(t,this,e-this._delay),this}return this._start},t.endTime=function(e){return this._start+(du(e)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},t.rawTime=function(e){var t=this.parent||this._dp;return t?e&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?fc(t.rawTime(e),this):this._tTime:this._tTime},t.revert=function(e){void 0===e&&(e=Iu);var t=El;return El=e,(this._initted||this._startAt)&&(this.timeline&&this.timeline.revert(e),this.totalTime(-.01,e.suppressEvents)),"nested"!==this.data&&!1!==e.kill&&this.kill(),El=t,this},t.globalTime=function(e){for(var t=this,n=arguments.length?e:t.rawTime();t;)n=t._start+n/(t._ts||1),t=t._dp;return!this.parent&&this._sat?this._sat.vars.immediateRender?-1/0:this._sat.globalTime(e):n},t.repeat=function(e){return arguments.length?(this._repeat=e===1/0?-2:e,wc(this)):-2===this._repeat?1/0:this._repeat},t.repeatDelay=function(e){if(arguments.length){var t=this._time;return this._rDelay=e,wc(this),t?this.time(t):this}return this._rDelay},t.yoyo=function(e){return arguments.length?(this._yoyo=e,this):this._yoyo},t.seek=function(e,t){return this.totalTime(Ec(this,e),du(t))},t.restart=function(e,t){return this.play().totalTime(e?-this._delay:0,du(t))},t.play=function(e,t){return null!=e&&this.seek(e,t),this.reversed(!1).paused(!1)},t.reverse=function(e,t){return null!=e&&this.seek(e||this.totalDuration(),t),this.reversed(!0).paused(!1)},t.pause=function(e,t){return null!=e&&this.seek(e,t),this.paused(!0)},t.resume=function(){return this.paused(!1)},t.reversed=function(e){return arguments.length?(!!e!==this.reversed()&&this.timeScale(-this._rts||(e?-eu:0)),this):this._rts<0},t.invalidate=function(){return this._initted=this._act=0,this._zTime=-eu,this},t.isActive=function(){var e,t=this.parent||this._dp,n=this._start;return!(t&&!(this._ts&&this._initted&&t.isActive()&&(e=t.rawTime(!0))>=n&&e<this.endTime(!0)-eu))},t.eventCallback=function(e,t,n){var i=this.vars;return arguments.length>1?(t?(i[e]=t,n&&(i[e+"Params"]=n),"onUpdate"===e&&(this._onUpdate=t)):delete i[e],this):i[e]},t.then=function(e){var t=this;return new Promise((function(n){var i=lu(e)?e:$u,r=function(){var e=t.then;t.then=null,lu(i)&&(i=i(t))&&(i.then||i===t)&&(t.then=e),n(i),t.then=e};t._initted&&1===t.totalProgress()&&t._ts>=0||!t._tTime&&t._ts<0?r():t._prom=r}))},t.kill=function(){Wc(this)},e}();ec(vh.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-eu,_prom:0,_ps:!1,_rts:1});var _h=function(e){function t(t,n){var i;return void 0===t&&(t={}),(i=e.call(this,t)||this).labels={},i.smoothChildTiming=!!t.smoothChildTiming,i.autoRemoveChildren=!!t.autoRemoveChildren,i._sort=du(t.sortChildren),Cl&&_c(t.parent||Cl,Sl(i),n),t.reversed&&i.reverse(),t.paused&&i.paused(!0),t.scrollTrigger&&xc(Sl(i),t.scrollTrigger),i}wl(t,e);var n=t.prototype;return n.to=function(e,t,n){return Ac(0,arguments,this),this},n.from=function(e,t,n){return Ac(1,arguments,this),this},n.fromTo=function(e,t,n,i){return Ac(2,arguments,this),this},n.set=function(e,t,n){return t.duration=0,t.parent=this,rc(t).repeatDelay||(t.repeat=0),t.immediateRender=!!t.immediateRender,new Lh(e,t,Ec(this,n),1),this},n.call=function(e,t,n){return _c(this,Lh.delayedCall(0,e,t),n)},n.staggerTo=function(e,t,n,i,r,a,s){return n.duration=t,n.stagger=n.stagger||i,n.onComplete=a,n.onCompleteParams=s,n.parent=this,new Lh(e,n,Ec(this,r)),this},n.staggerFrom=function(e,t,n,i,r,a,s){return n.runBackwards=1,rc(n).immediateRender=du(n.immediateRender),this.staggerTo(e,t,n,i,r,a,s)},n.staggerFromTo=function(e,t,n,i,r,a,s,o){return i.startAt=n,rc(i).immediateRender=du(i.immediateRender),this.staggerTo(e,t,i,r,a,s,o)},n.render=function(e,t,n){var i,r,a,s,o,l,u,c,h,d,p,f,m=this._time,g=this._dirty?this.totalDuration():this._tDur,v=this._dur,_=e<=0?0:Xu(e),x=this._zTime<0!=e<0&&(this._initted||!v);if(this!==Cl&&_>g&&e>=0&&(_=g),_!==this._tTime||n||x){if(m!==this._time&&v&&(_+=this._time-m,e+=this._time-m),i=_,h=this._start,l=!(c=this._ts),x&&(v||(m=this._zTime),(e||!t)&&(this._zTime=e)),this._repeat){if(p=this._yoyo,o=v+this._rDelay,this._repeat<-1&&e<0)return this.totalTime(100*o+e,t,n);if(i=Xu(_%o),_===g?(s=this._repeat,i=v):((s=~~(_/o))&&s===_/o&&(i=v,s--),i>v&&(i=v)),d=pc(this._tTime,o),!m&&this._tTime&&d!==s&&this._tTime-d*o-this._dur<=0&&(d=s),p&&1&s&&(i=v-i,f=1),s!==d&&!this._lock){var y=p&&1&d,b=y===(p&&1&s);if(s<d&&(y=!y),m=y?0:_%v?v:_,this._lock=1,this.render(m||(f?0:Xu(s*o)),t,!v)._lock=0,this._tTime=_,!t&&this.parent&&qc(this,"onRepeat"),this.vars.repeatRefresh&&!f&&(this.invalidate()._lock=1),m&&m!==this._time||l!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(v=this._dur,g=this._tDur,b&&(this._lock=2,m=y?v:-1e-4,this.render(m,!0),this.vars.repeatRefresh&&!f&&this.invalidate()),this._lock=0,!this._ts&&!l)return this;ch(this,f)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(u=function(e,t,n){var i;if(n>t)for(i=e._first;i&&i._start<=n;){if("isPause"===i.data&&i._start>t)return i;i=i._next}else for(i=e._last;i&&i._start>=n;){if("isPause"===i.data&&i._start<t)return i;i=i._prev}}(this,Xu(m),Xu(i)),u&&(_-=i-(i=u._start))),this._tTime=_,this._time=i,this._act=!c,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=e,m=0),!m&&i&&!t&&!s&&(qc(this,"onStart"),this._tTime!==_))return this;if(i>=m&&e>=0)for(r=this._first;r;){if(a=r._next,(r._act||i>=r._start)&&r._ts&&u!==r){if(r.parent!==this)return this.render(e,t,n);if(r.render(r._ts>0?(i-r._start)*r._ts:(r._dirty?r.totalDuration():r._tDur)+(i-r._start)*r._ts,t,n),i!==this._time||!this._ts&&!l){u=0,a&&(_+=this._zTime=-eu);break}}r=a}else{r=this._last;for(var M=e<0?e:i;r;){if(a=r._prev,(r._act||M<=r._end)&&r._ts&&u!==r){if(r.parent!==this)return this.render(e,t,n);if(r.render(r._ts>0?(M-r._start)*r._ts:(r._dirty?r.totalDuration():r._tDur)+(M-r._start)*r._ts,t,n||El&&(r._initted||r._startAt)),i!==this._time||!this._ts&&!l){u=0,a&&(_+=this._zTime=M?-eu:eu);break}}r=a}}if(u&&!t&&(this.pause(),u.render(i>=m?0:-eu)._zTime=i>=m?1:-1,this._ts))return this._start=h,mc(this),this.render(e,t,n);this._onUpdate&&!t&&qc(this,"onUpdate",!0),(_===g&&this._tTime>=this.totalDuration()||!_&&m)&&(h!==this._start&&Math.abs(c)===Math.abs(this._ts)||this._lock||((e||!v)&&(_===g&&this._ts>0||!_&&this._ts<0)&&oc(this,1),t||e<0&&!m||!_&&!m&&g||(qc(this,_===g&&e>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(_<g&&this.timeScale()>0)&&this._prom())))}return this},n.add=function(e,t){var n=this;if(uu(t)||(t=Ec(this,t,e)),!(e instanceof vh)){if(gu(e))return e.forEach((function(e){return n.add(e,t)})),this;if(ou(e))return this.addLabel(e,t);if(!lu(e))return this;e=Lh.delayedCall(0,e)}return this!==e?_c(this,e,t):this},n.getChildren=function(e,t,n,i){void 0===e&&(e=!0),void 0===t&&(t=!0),void 0===n&&(n=!0),void 0===i&&(i=-$l);for(var r=[],a=this._first;a;)a._start>=i&&(a instanceof Lh?t&&r.push(a):(n&&r.push(a),e&&r.push.apply(r,a.getChildren(!0,t,n)))),a=a._next;return r},n.getById=function(e){for(var t=this.getChildren(1,1,1),n=t.length;n--;)if(t[n].vars.id===e)return t[n]},n.remove=function(e){return ou(e)?this.removeLabel(e):lu(e)?this.killTweensOf(e):(sc(this,e),e===this._recent&&(this._recent=this._last),lc(this))},n.totalTime=function(t,n){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=Xu(ih.time-(this._ts>0?t/this._ts:(this.totalDuration()-t)/-this._ts))),e.prototype.totalTime.call(this,t,n),this._forcing=0,this):this._tTime},n.addLabel=function(e,t){return this.labels[e]=Ec(this,t),this},n.removeLabel=function(e){return delete this.labels[e],this},n.addPause=function(e,t,n){var i=Lh.delayedCall(0,t||Pu,n);return i.data="isPause",this._hasPause=1,_c(this,i,Ec(this,e))},n.removePause=function(e){var t=this._first;for(e=Ec(this,e);t;)t._start===e&&"isPause"===t.data&&oc(t),t=t._next},n.killTweensOf=function(e,t,n){for(var i=this.getTweensOf(e,n),r=i.length;r--;)xh!==i[r]&&i[r].kill(e,t);return this},n.getTweensOf=function(e,t){for(var n,i=[],r=Ic(e),a=this._first,s=uu(t);a;)a instanceof Lh?Ju(a._targets,r)&&(s?(!xh||a._initted&&a._ts)&&a.globalTime(0)<=t&&a.globalTime(a.totalDuration())>t:!t||a.isActive())&&i.push(a):(n=a.getTweensOf(r,t)).length&&i.push.apply(i,n),a=a._next;return i},n.tweenTo=function(e,t){t=t||{};var n,i=this,r=Ec(i,e),a=t,s=a.startAt,o=a.onStart,l=a.onStartParams,u=a.immediateRender,c=Lh.to(i,ec({ease:t.ease||"none",lazy:!1,immediateRender:!1,time:r,overwrite:"auto",duration:t.duration||Math.abs((r-(s&&"time"in s?s.time:i._time))/i.timeScale())||eu,onStart:function(){if(i.pause(),!n){var e=t.duration||Math.abs((r-(s&&"time"in s?s.time:i._time))/i.timeScale());c._dur!==e&&Sc(c,e,0,1).render(c._time,!0,!0),n=1}o&&o.apply(c,l||[])}},t));return u?c.render(0):c},n.tweenFromTo=function(e,t,n){return this.tweenTo(t,ec({startAt:{time:Ec(this,e)}},n))},n.recent=function(){return this._recent},n.nextLabel=function(e){return void 0===e&&(e=this._time),Hc(this,Ec(this,e))},n.previousLabel=function(e){return void 0===e&&(e=this._time),Hc(this,Ec(this,e),1)},n.currentLabel=function(e){return arguments.length?this.seek(e,!0):this.previousLabel(this._time+eu)},n.shiftChildren=function(e,t,n){void 0===n&&(n=0);for(var i,r=this._first,a=this.labels;r;)r._start>=n&&(r._start+=e,r._end+=e),r=r._next;if(t)for(i in a)a[i]>=n&&(a[i]+=e);return lc(this)},n.invalidate=function(t){var n=this._first;for(this._lock=0;n;)n.invalidate(t),n=n._next;return e.prototype.invalidate.call(this,t)},n.clear=function(e){void 0===e&&(e=!0);for(var t,n=this._first;n;)t=n._next,this.remove(n),n=t;return this._dp&&(this._time=this._tTime=this._pTime=0),e&&(this.labels={}),lc(this)},n.totalDuration=function(e){var t,n,i,r=0,a=this,s=a._last,o=$l;if(arguments.length)return a.timeScale((a._repeat<0?a.duration():a.totalDuration())/(a.reversed()?-e:e));if(a._dirty){for(i=a.parent;s;)t=s._prev,s._dirty&&s.totalDuration(),(n=s._start)>o&&a._sort&&s._ts&&!a._lock?(a._lock=1,_c(a,s,n-s._delay,1)._lock=0):o=n,n<0&&s._ts&&(r-=n,(!i&&!a._dp||i&&i.smoothChildTiming)&&(a._start+=n/a._ts,a._time-=n,a._tTime-=n),a.shiftChildren(-n,!1,-1/0),o=0),s._end>r&&s._ts&&(r=s._end),s=t;Sc(a,a===Cl&&a._time>r?a._time:r,1,1),a._dirty=0}return a._tDur},t.updateRoot=function(e){if(Cl._ts&&(Ku(Cl,fc(e,Cl)),Il=ih.frame),ih.frame>=ku){ku+=Kl.autoSleep||120;var t=Cl._first;if((!t||!t._ts)&&Kl.autoSleep&&ih._listeners.length<2){for(;t&&!t._ts;)t=t._next;t||ih.sleep()}}},t}(vh);ec(_h.prototype,{_lock:0,_hasPause:0,_forcing:0});var xh,yh,bh=function(e,t,n,i,r,a,s){var o,l,u,c,h,d,p,f,m=new Hh(this._pt,e,t,0,1,Uh,null,r),g=0,v=0;for(m.b=n,m.e=i,n+="",(p=~(i+="").indexOf("random("))&&(i=Vc(i)),a&&(a(f=[n,i],e,t),n=f[0],i=f[1]),l=n.match(yu)||[];o=yu.exec(i);)c=o[0],h=i.substring(g,o.index),u?u=(u+1)%5:"rgba("===h.substr(-5)&&(u=1),c!==l[v++]&&(d=parseFloat(l[v-1])||0,m._pt={_next:m._pt,p:h||1===v?h:",",s:d,c:"="===c.charAt(1)?Yu(d,c)-d:parseFloat(c)-d,m:u&&u<4?Math.round:0},g=yu.lastIndex);return m.c=g<i.length?i.substring(g,i.length):"",m.fp=s,(bu.test(i)||p)&&(m.e=0),this._pt=m,m},Mh=function(e,t,n,i,r,a,s,o,l,u){lu(i)&&(i=i(r||0,e,a));var c,h=e[t],d="get"!==n?n:lu(h)?l?e[t.indexOf("set")||!lu(e["get"+t.substr(3)])?t:"get"+t.substr(3)](l):e[t]():h,p=lu(h)?l?Dh:Rh:Ph;if(ou(i)&&(~i.indexOf("random(")&&(i=Vc(i)),"="===i.charAt(1)&&((c=Yu(d,i)+(Pc(d)||0))||0===c)&&(i=c)),!u||d!==i||yh)return isNaN(d*i)||""===i?(!h&&!(t in e)&&Au(t,i),bh.call(this,e,t,d,i,p,o||Kl.stringFilter,l)):(c=new Hh(this._pt,e,t,+d||0,i-(d||0),"boolean"==typeof h?zh:Nh,0,p),l&&(c.fp=l),s&&c.modifier(s,this,e),this._pt=c)},Sh=function(e,t,n,i,r,a){var s,o,l,u;if(Uu[e]&&!1!==(s=new Uu[e]).init(r,s.rawVars?t[e]:function(e,t,n,i,r){if(lu(e)&&(e=Eh(e,r,t,n,i)),!hu(e)||e.style&&e.nodeType||gu(e)||mu(e))return ou(e)?Eh(e,r,t,n,i):e;var a,s={};for(a in e)s[a]=Eh(e[a],r,t,n,i);return s}(t[e],i,r,a,n),n,i,a)&&(n._pt=o=new Hh(n._pt,r,e,0,1,s.render,s,0,s.priority),n!==Ol))for(l=n._ptLookup[n._targets.indexOf(r)],u=s._props.length;u--;)l[s._props[u]]=o;return s},wh=function e(t,n,i){var r,a,s,o,l,u,c,h,d,p,f,m,g,v=t.vars,_=v.ease,x=v.startAt,y=v.immediateRender,b=v.lazy,M=v.onUpdate,S=v.onUpdateParams,w=v.callbackScope,T=v.runBackwards,E=v.yoyoEase,A=v.keyframes,C=v.autoRevert,L=t._dur,P=t._startAt,R=t._targets,D=t.parent,I=D&&"nested"===D.data?D.vars.targets:R,O="auto"===t._overwrite&&!Tl,N=t.timeline;if(N&&(!A||!_)&&(_="none"),t._ease=hh(_,Ql.ease),t._yEase=E?uh(hh(!0===E?_:E,Ql.ease)):0,E&&t._yoyo&&!t._repeat&&(E=t._yEase,t._yEase=t._ease,t._ease=E),t._from=!N&&!!v.runBackwards,!N||A&&!v.stagger){if(m=(h=R[0]?Hu(R[0]).harness:0)&&v[h.prop],r=ic(v,Ou),P&&(P._zTime<0&&P.progress(1),n<0&&T&&y&&!C?P.render(-1,!0):P.revert(T&&L?Du:Ru),P._lazy=0),x){if(oc(t._startAt=Lh.set(R,ec({data:"isStart",overwrite:!1,parent:D,immediateRender:!0,lazy:!P&&du(b),startAt:null,delay:0,onUpdate:M,onUpdateParams:S,callbackScope:w,stagger:0},x))),t._startAt._dp=0,t._startAt._sat=t,n<0&&(El||!y&&!C)&&t._startAt.revert(Du),y&&L&&n<=0&&i<=0)return void(n&&(t._zTime=n))}else if(T&&L&&!P)if(n&&(y=!1),s=ec({overwrite:!1,data:"isFromStart",lazy:y&&!P&&du(b),immediateRender:y,stagger:0,parent:D},r),m&&(s[h.prop]=m),oc(t._startAt=Lh.set(R,s)),t._startAt._dp=0,t._startAt._sat=t,n<0&&(El?t._startAt.revert(Du):t._startAt.render(-1,!0)),t._zTime=n,y){if(!n)return}else e(t._startAt,eu,eu);for(t._pt=t._ptCache=0,b=L&&du(b)||b&&!L,a=0;a<R.length;a++){if(c=(l=R[a])._gsap||Gu(R)[a]._gsap,t._ptLookup[a]=p={},zu[c.id]&&Nu.length&&Zu(),f=I===R?a:I.indexOf(l),h&&!1!==(d=new h).init(l,m||r,t,f,I)&&(t._pt=o=new Hh(t._pt,l,d.name,0,1,d.render,d,0,d.priority),d._props.forEach((function(e){p[e]=o})),d.priority&&(u=1)),!h||m)for(s in r)Uu[s]&&(d=Sh(s,r,t,f,l,I))?d.priority&&(u=1):p[s]=o=Mh.call(t,l,s,"get",r[s],f,I,0,v.stringFilter);t._op&&t._op[a]&&t.kill(l,t._op[a]),O&&t._pt&&(xh=t,Cl.killTweensOf(l,p,t.globalTime(n)),g=!t.parent,xh=0),t._pt&&b&&(zu[c.id]=1)}u&&Gh(t),t._onInit&&t._onInit(t)}t._onUpdate=M,t._initted=(!t._op||t._pt)&&!g,A&&n<=0&&N.render($l,!0,!0)},Th=function(e,t,n,i){var r,a,s=t.ease||i||"power1.inOut";if(gu(t))a=n[e]||(n[e]=[]),t.forEach((function(e,n){return a.push({t:n/(t.length-1)*100,v:e,e:s})}));else for(r in t)a=n[r]||(n[r]=[]),"ease"===r||a.push({t:parseFloat(e),v:t[r],e:s})},Eh=function(e,t,n,i,r){return lu(e)?e.call(t,n,i,r):ou(e)&&~e.indexOf("random(")?Vc(e):e},Ah=Vu+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",Ch={};Wu(Ah+",id,stagger,delay,duration,paused,scrollTrigger",(function(e){return Ch[e]=1}));var Lh=function(e){function t(t,n,i,r){var a;"number"==typeof n&&(i.duration=n,n=i,i=null);var s,o,l,u,c,h,d,p,f=(a=e.call(this,r?n:rc(n))||this).vars,m=f.duration,g=f.delay,v=f.immediateRender,_=f.stagger,x=f.overwrite,y=f.keyframes,b=f.defaults,M=f.scrollTrigger,S=f.yoyoEase,w=n.parent||Cl,T=(gu(t)||mu(t)?uu(t[0]):"length"in n)?[t]:Ic(t);if(a._targets=T.length?Gu(T):Cu("GSAP target "+t+" not found. https://greensock.com",!Kl.nullTargetWarn)||[],a._ptLookup=[],a._overwrite=x,y||_||fu(m)||fu(g)){if(n=a.vars,(s=a.timeline=new _h({data:"nested",defaults:b||{},targets:w&&"nested"===w.data?w.vars.targets:T})).kill(),s.parent=s._dp=Sl(a),s._start=0,_||fu(m)||fu(g)){if(u=T.length,d=_&&zc(_),hu(_))for(c in _)~Ah.indexOf(c)&&(p||(p={}),p[c]=_[c]);for(o=0;o<u;o++)(l=ic(n,Ch)).stagger=0,S&&(l.yoyoEase=S),p&&tc(l,p),h=T[o],l.duration=+Eh(m,Sl(a),o,h,T),l.delay=(+Eh(g,Sl(a),o,h,T)||0)-a._delay,!_&&1===u&&l.delay&&(a._delay=g=l.delay,a._start+=g,l.delay=0),s.to(h,l,d?d(o,h,T):0),s._ease=ah.none;s.duration()?m=g=0:a.timeline=0}else if(y){rc(ec(s.vars.defaults,{ease:"none"})),s._ease=hh(y.ease||n.ease||"none");var E,A,C,L=0;if(gu(y))y.forEach((function(e){return s.to(T,e,">")})),s.duration();else{for(c in l={},y)"ease"===c||"easeEach"===c||Th(c,y[c],l,y.easeEach);for(c in l)for(E=l[c].sort((function(e,t){return e.t-t.t})),L=0,o=0;o<E.length;o++)(C={ease:(A=E[o]).e,duration:(A.t-(o?E[o-1].t:0))/100*m})[c]=A.v,s.to(T,C,L),L+=C.duration;s.duration()<m&&s.to({},{duration:m-s.duration()})}}m||a.duration(m=s.duration())}else a.timeline=0;return!0!==x||Tl||(xh=Sl(a),Cl.killTweensOf(T),xh=0),_c(w,Sl(a),i),n.reversed&&a.reverse(),n.paused&&a.paused(!0),(v||!m&&!y&&a._start===Xu(w._time)&&du(v)&&hc(Sl(a))&&"nested"!==w.data)&&(a._tTime=-eu,a.render(Math.max(0,-g)||0)),M&&xc(Sl(a),M),a}wl(t,e);var n=t.prototype;return n.render=function(e,t,n){var i,r,a,s,o,l,u,c,h,d=this._time,p=this._tDur,f=this._dur,m=e<0,g=e>p-eu&&!m?p:e<eu?0:e;if(f){if(g!==this._tTime||!e||n||!this._initted&&this._tTime||this._startAt&&this._zTime<0!==m){if(i=g,c=this.timeline,this._repeat){if(s=f+this._rDelay,this._repeat<-1&&m)return this.totalTime(100*s+e,t,n);if(i=Xu(g%s),g===p?(a=this._repeat,i=f):((a=~~(g/s))&&a===g/s&&(i=f,a--),i>f&&(i=f)),(l=this._yoyo&&1&a)&&(h=this._yEase,i=f-i),o=pc(this._tTime,s),i===d&&!n&&this._initted)return this._tTime=g,this;a!==o&&(c&&this._yEase&&ch(c,l),!this.vars.repeatRefresh||l||this._lock||(this._lock=n=1,this.render(Xu(s*a),!0).invalidate()._lock=0))}if(!this._initted){if(yc(this,m?e:i,n,t,g))return this._tTime=0,this;if(d!==this._time)return this;if(f!==this._dur)return this.render(e,t,n)}if(this._tTime=g,this._time=i,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=u=(h||this._ease)(i/f),this._from&&(this.ratio=u=1-u),i&&!d&&!t&&!a&&(qc(this,"onStart"),this._tTime!==g))return this;for(r=this._pt;r;)r.r(u,r.d),r=r._next;c&&c.render(e<0?e:!i&&l?-eu:c._dur*c._ease(i/this._dur),t,n)||this._startAt&&(this._zTime=e),this._onUpdate&&!t&&(m&&cc(this,e,0,n),qc(this,"onUpdate")),this._repeat&&a!==o&&this.vars.onRepeat&&!t&&this.parent&&qc(this,"onRepeat"),g!==this._tDur&&g||this._tTime!==g||(m&&!this._onUpdate&&cc(this,e,0,!0),(e||!f)&&(g===this._tDur&&this._ts>0||!g&&this._ts<0)&&oc(this,1),t||m&&!d||!(g||d||l)||(qc(this,g===p?"onComplete":"onReverseComplete",!0),this._prom&&!(g<p&&this.timeScale()>0)&&this._prom()))}}else!function(e,t,n,i){var r,a,s,o=e.ratio,l=t<0||!t&&(!e._start&&bc(e)&&(e._initted||!Mc(e))||(e._ts<0||e._dp._ts<0)&&!Mc(e))?0:1,u=e._rDelay,c=0;if(u&&e._repeat&&(c=Lc(0,e._tDur,t),a=pc(c,u),e._yoyo&&1&a&&(l=1-l),a!==pc(e._tTime,u)&&(o=1-l,e.vars.repeatRefresh&&e._initted&&e.invalidate())),l!==o||El||i||e._zTime===eu||!t&&e._zTime){if(!e._initted&&yc(e,t,i,n,c))return;for(s=e._zTime,e._zTime=t||(n?eu:0),n||(n=t&&!s),e.ratio=l,e._from&&(l=1-l),e._time=0,e._tTime=c,r=e._pt;r;)r.r(l,r.d),r=r._next;t<0&&cc(e,t,0,!0),e._onUpdate&&!n&&qc(e,"onUpdate"),c&&e._repeat&&!n&&e.parent&&qc(e,"onRepeat"),(t>=e._tDur||t<0)&&e.ratio===l&&(l&&oc(e,1),n||El||(qc(e,l?"onComplete":"onReverseComplete",!0),e._prom&&e._prom()))}else e._zTime||(e._zTime=t)}(this,e,t,n);return this},n.targets=function(){return this._targets},n.invalidate=function(t){return(!t||!this.vars.runBackwards)&&(this._startAt=0),this._pt=this._op=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(t),e.prototype.invalidate.call(this,t)},n.resetTo=function(e,t,n,i){Nl||ih.wake(),this._ts||this.play();var r=Math.min(this._dur,(this._dp._time-this._start)*this._ts);return this._initted||wh(this,r),function(e,t,n,i,r,a,s){var o,l,u,c,h=(e._pt&&e._ptCache||(e._ptCache={}))[t];if(!h)for(h=e._ptCache[t]=[],u=e._ptLookup,c=e._targets.length;c--;){if((o=u[c][t])&&o.d&&o.d._pt)for(o=o.d._pt;o&&o.p!==t&&o.fp!==t;)o=o._next;if(!o)return yh=1,e.vars[t]="+=0",wh(e,s),yh=0,1;h.push(o)}for(c=h.length;c--;)(o=(l=h[c])._pt||l).s=!i&&0!==i||r?o.s+(i||0)+a*o.c:i,o.c=n-o.s,l.e&&(l.e=ju(n)+Pc(l.e)),l.b&&(l.b=o.s+Pc(l.b))}(this,e,t,n,i,this._ease(r/this._dur),r)?this.resetTo(e,t,n,i):(gc(this,0),this.parent||ac(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},n.kill=function(e,t){if(void 0===t&&(t="all"),!(e||t&&"all"!==t))return this._lazy=this._pt=0,this.parent?Wc(this):this;if(this.timeline){var n=this.timeline.totalDuration();return this.timeline.killTweensOf(e,t,xh&&!0!==xh.vars.overwrite)._first||Wc(this),this.parent&&n!==this.timeline.totalDuration()&&Sc(this,this._dur*this.timeline._tDur/n,0,1),this}var i,r,a,s,o,l,u,c=this._targets,h=e?Ic(e):c,d=this._ptLookup,p=this._pt;if((!t||"all"===t)&&function(e,t){for(var n=e.length,i=n===t.length;i&&n--&&e[n]===t[n];);return n<0}(c,h))return"all"===t&&(this._pt=0),Wc(this);for(i=this._op=this._op||[],"all"!==t&&(ou(t)&&(o={},Wu(t,(function(e){return o[e]=1})),t=o),t=function(e,t){var n,i,r,a,s=e[0]?Hu(e[0]).harness:0,o=s&&s.aliases;if(!o)return t;for(i in n=tc({},t),o)if(i in n)for(r=(a=o[i].split(",")).length;r--;)n[a[r]]=n[i];return n}(c,t)),u=c.length;u--;)if(~h.indexOf(c[u]))for(o in r=d[u],"all"===t?(i[u]=t,s=r,a={}):(a=i[u]=i[u]||{},s=t),s)(l=r&&r[o])&&("kill"in l.d&&!0!==l.d.kill(o)||sc(this,l,"_pt"),delete r[o]),"all"!==a&&(a[o]=1);return this._initted&&!this._pt&&p&&Wc(this),this},t.to=function(e,n){return new t(e,n,arguments[2])},t.from=function(e,t){return Ac(1,arguments)},t.delayedCall=function(e,n,i,r){return new t(n,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:e,onComplete:n,onReverseComplete:n,onCompleteParams:i,onReverseCompleteParams:i,callbackScope:r})},t.fromTo=function(e,t,n){return Ac(2,arguments)},t.set=function(e,n){return n.duration=0,n.repeatDelay||(n.repeat=0),new t(e,n)},t.killTweensOf=function(e,t,n){return Cl.killTweensOf(e,t,n)},t}(vh);ec(Lh.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0}),Wu("staggerTo,staggerFrom,staggerFromTo",(function(e){Lh[e]=function(){var t=new _h,n=Rc.call(arguments,0);return n.splice("staggerFromTo"===e?5:4,0,0),t[e].apply(t,n)}}));var Ph=function(e,t,n){return e[t]=n},Rh=function(e,t,n){return e[t](n)},Dh=function(e,t,n,i){return e[t](i.fp,n)},Ih=function(e,t,n){return e.setAttribute(t,n)},Oh=function(e,t){return lu(e[t])?Rh:cu(e[t])&&e.setAttribute?Ih:Ph},Nh=function(e,t){return t.set(t.t,t.p,Math.round(1e6*(t.s+t.c*e))/1e6,t)},zh=function(e,t){return t.set(t.t,t.p,!!(t.s+t.c*e),t)},Uh=function(e,t){var n=t._pt,i="";if(!e&&t.b)i=t.b;else if(1===e&&t.e)i=t.e;else{for(;n;)i=n.p+(n.m?n.m(n.s+n.c*e):Math.round(1e4*(n.s+n.c*e))/1e4)+i,n=n._next;i+=t.c}t.set(t.t,t.p,i,t)},Fh=function(e,t){for(var n=t._pt;n;)n.r(e,n.d),n=n._next},kh=function(e,t,n,i){for(var r,a=this._pt;a;)r=a._next,a.p===i&&a.modifier(e,t,n),a=r},Bh=function(e){for(var t,n,i=this._pt;i;)n=i._next,i.p===e&&!i.op||i.op===e?sc(this,i,"_pt"):i.dep||(t=1),i=n;return!t},Vh=function(e,t,n,i){i.mSet(e,t,i.m.call(i.tween,n,i.mt),i)},Gh=function(e){for(var t,n,i,r,a=e._pt;a;){for(t=a._next,n=i;n&&n.pr>a.pr;)n=n._next;(a._prev=n?n._prev:r)?a._prev._next=a:i=a,(a._next=n)?n._prev=a:r=a,a=t}e._pt=i},Hh=function(){function e(e,t,n,i,r,a,s,o,l){this.t=t,this.s=i,this.c=r,this.p=n,this.r=a||Nh,this.d=s||this,this.set=o||Ph,this.pr=l||0,this._next=e,e&&(e._prev=this)}return e.prototype.modifier=function(e,t,n){this.mSet=this.mSet||this.set,this.set=Vh,this.m=e,this.mt=n,this.tween=t},e}();Wu(Vu+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",(function(e){return Ou[e]=1})),wu.TweenMax=wu.TweenLite=Lh,wu.TimelineLite=wu.TimelineMax=_h,Cl=new _h({sortChildren:!1,defaults:Ql,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0}),Kl.stringFilter=nh;var qh=[],Wh={},jh=[],Xh=0,Yh=0,Jh=function(e){return(Wh[e]||jh).map((function(e){return e()}))},Zh=function(){var e=Date.now(),t=[];e-Xh>2&&(Jh("matchMediaInit"),qh.forEach((function(e){var n,i,r,a,s=e.queries,o=e.conditions;for(i in s)(n=Ll.matchMedia(s[i]).matches)&&(r=1),n!==o[i]&&(o[i]=n,a=1);a&&(e.revert(),r&&t.push(e))})),Jh("matchMediaRevert"),t.forEach((function(e){return e.onMatch(e)})),Xh=e,Jh("matchMedia"))},Kh=function(){function e(e,t){this.selector=t&&Oc(t),this.data=[],this._r=[],this.isReverted=!1,this.id=Yh++,e&&this.add(e)}var t=e.prototype;return t.add=function(e,t,n){lu(e)&&(n=t,t=e,e=lu);var i=this,r=function(){var e,r=Al,a=i.selector;return r&&r!==i&&r.data.push(i),n&&(i.selector=Oc(n)),Al=i,e=t.apply(i,arguments),lu(e)&&i._r.push(e),Al=r,i.selector=a,i.isReverted=!1,e};return i.last=r,e===lu?r(i):e?i[e]=r:r},t.ignore=function(e){var t=Al;Al=null,e(this),Al=t},t.getTweens=function(){var t=[];return this.data.forEach((function(n){return n instanceof e?t.push.apply(t,n.getTweens()):n instanceof Lh&&!(n.parent&&"nested"===n.parent.data)&&t.push(n)})),t},t.clear=function(){this._r.length=this.data.length=0},t.kill=function(e,t){var n=this;if(e){var i=this.getTweens();this.data.forEach((function(e){"isFlip"===e.data&&(e.revert(),e.getChildren(!0,!0,!1).forEach((function(e){return i.splice(i.indexOf(e),1)})))})),i.map((function(e){return{g:e.globalTime(0),t:e}})).sort((function(e,t){return t.g-e.g||-1/0})).forEach((function(t){return t.t.revert(e)})),this.data.forEach((function(t){return!(t instanceof Lh)&&t.revert&&t.revert(e)})),this._r.forEach((function(t){return t(e,n)})),this.isReverted=!0}else this.data.forEach((function(e){return e.kill&&e.kill()}));if(this.clear(),t)for(var r=qh.length;r--;)qh[r].id===this.id&&qh.splice(r,1)},t.revert=function(e){this.kill(e||{})},e}(),Qh=function(){function e(e){this.contexts=[],this.scope=e}var t=e.prototype;return t.add=function(e,t,n){hu(e)||(e={matches:e});var i,r,a,s=new Kh(0,n||this.scope),o=s.conditions={};for(r in Al&&!s.selector&&(s.selector=Al.selector),this.contexts.push(s),t=s.add("onMatch",t),s.queries=e,e)"all"===r?a=1:(i=Ll.matchMedia(e[r]))&&(qh.indexOf(s)<0&&qh.push(s),(o[r]=i.matches)&&(a=1),i.addListener?i.addListener(Zh):i.addEventListener("change",Zh));return a&&t(s),this},t.revert=function(e){this.kill(e||{})},t.kill=function(e){this.contexts.forEach((function(t){return t.kill(e,!0)}))},e}(),$h={registerPlugin:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t.forEach((function(e){return Xc(e)}))},timeline:function(e){return new _h(e)},getTweensOf:function(e,t){return Cl.getTweensOf(e,t)},getProperty:function(e,t,n,i){ou(e)&&(e=Ic(e)[0]);var r=Hu(e||{}).get,a=n?$u:Qu;return"native"===n&&(n=""),e?t?a((Uu[t]&&Uu[t].get||r)(e,t,n,i)):function(t,n,i){return a((Uu[t]&&Uu[t].get||r)(e,t,n,i))}:e},quickSetter:function(e,t,n){if((e=Ic(e)).length>1){var i=e.map((function(e){return nd.quickSetter(e,t,n)})),r=i.length;return function(e){for(var t=r;t--;)i[t](e)}}e=e[0]||{};var a=Uu[t],s=Hu(e),o=s.harness&&(s.harness.aliases||{})[t]||t,l=a?function(t){var i=new a;Ol._pt=0,i.init(e,n?t+n:t,Ol,0,[e]),i.render(1,i),Ol._pt&&Fh(1,Ol)}:s.set(e,o);return a?l:function(t){return l(e,o,n?t+n:t,s,1)}},quickTo:function(e,t,n){var i,r=nd.to(e,tc(((i={})[t]="+=0.1",i.paused=!0,i),n||{})),a=function(e,n,i){return r.resetTo(t,e,n,i)};return a.tween=r,a},isTweening:function(e){return Cl.getTweensOf(e,!0).length>0},defaults:function(e){return e&&e.ease&&(e.ease=hh(e.ease,Ql.ease)),nc(Ql,e||{})},config:function(e){return nc(Kl,e||{})},registerEffect:function(e){var t=e.name,n=e.effect,i=e.plugins,r=e.defaults,a=e.extendTimeline;(i||"").split(",").forEach((function(e){return e&&!Uu[e]&&!wu[e]&&Cu(t+" effect requires "+e+" plugin.")})),Fu[t]=function(e,t,i){return n(Ic(e),ec(t||{},r),i)},a&&(_h.prototype[t]=function(e,n,i){return this.add(Fu[t](e,hu(n)?n:(i=n)&&{},this),i)})},registerEase:function(e,t){ah[e]=hh(t)},parseEase:function(e,t){return arguments.length?hh(e,t):ah},getById:function(e){return Cl.getById(e)},exportRoot:function(e,t){void 0===e&&(e={});var n,i,r=new _h(e);for(r.smoothChildTiming=du(e.smoothChildTiming),Cl.remove(r),r._dp=0,r._time=r._tTime=Cl._time,n=Cl._first;n;)i=n._next,!t&&!n._dur&&n instanceof Lh&&n.vars.onComplete===n._targets[0]||_c(r,n,n._start-n._delay),n=i;return _c(Cl,r,0),r},context:function(e,t){return e?new Kh(e,t):Al},matchMedia:function(e){return new Qh(e)},matchMediaRefresh:function(){return qh.forEach((function(e){var t,n,i=e.conditions;for(n in i)i[n]&&(i[n]=!1,t=1);t&&e.revert()}))||Zh()},addEventListener:function(e,t){var n=Wh[e]||(Wh[e]=[]);~n.indexOf(t)||n.push(t)},removeEventListener:function(e,t){var n=Wh[e],i=n&&n.indexOf(t);i>=0&&n.splice(i,1)},utils:{wrap:function e(t,n,i){var r=n-t;return gu(t)?Bc(t,e(0,t.length),n):Cc(i,(function(e){return(r+(e-t)%r)%r+t}))},wrapYoyo:function e(t,n,i){var r=n-t,a=2*r;return gu(t)?Bc(t,e(0,t.length-1),n):Cc(i,(function(e){return t+((e=(a+(e-t)%a)%a||0)>r?a-e:e)}))},distribute:zc,random:kc,snap:Fc,normalize:function(e,t,n){return Gc(e,t,0,1,n)},getUnit:Pc,clamp:function(e,t,n){return Cc(n,(function(n){return Lc(e,t,n)}))},splitColor:Kc,toArray:Ic,selector:Oc,mapRange:Gc,pipe:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return t.reduce((function(e,t){return t(e)}),e)}},unitize:function(e,t){return function(n){return e(parseFloat(n))+(t||Pc(n))}},interpolate:function e(t,n,i,r){var a=isNaN(t+n)?0:function(e){return(1-e)*t+e*n};if(!a){var s,o,l,u,c,h=ou(t),d={};if(!0===i&&(r=1)&&(i=null),h)t={p:t},n={p:n};else if(gu(t)&&!gu(n)){for(l=[],u=t.length,c=u-2,o=1;o<u;o++)l.push(e(t[o-1],t[o]));u--,a=function(e){e*=u;var t=Math.min(c,~~e);return l[t](e-t)},i=n}else r||(t=tc(gu(t)?[]:{},t));if(!l){for(s in n)Mh.call(d,t,s,"get",n[s]);a=function(e){return Fh(e,d)||(h?t.p:t)}}}return Cc(i,a)},shuffle:Nc},install:Eu,effects:Fu,ticker:ih,updateRoot:_h.updateRoot,plugins:Uu,globalTimeline:Cl,core:{PropTween:Hh,globals:Lu,Tween:Lh,Timeline:_h,Animation:vh,getCache:Hu,_removeLinkedListItem:sc,reverting:function(){return El},context:function(e){return e&&Al&&(Al.data.push(e),e._ctx=Al),Al},suppressOverwrites:function(e){return Tl=e}}};Wu("to,from,fromTo,delayedCall,set,killTweensOf",(function(e){return $h[e]=Lh[e]})),ih.add(_h.updateRoot),Ol=$h.to({},{duration:0});var ed=function(e,t){for(var n=e._pt;n&&n.p!==t&&n.op!==t&&n.fp!==t;)n=n._next;return n},td=function(e,t){return{name:e,rawVars:1,init:function(e,n,i){i._onInit=function(e){var i,r;if(ou(n)&&(i={},Wu(n,(function(e){return i[e]=1})),n=i),t){for(r in i={},n)i[r]=t(n[r]);n=i}!function(e,t){var n,i,r,a=e._targets;for(n in t)for(i=a.length;i--;)(r=e._ptLookup[i][n])&&(r=r.d)&&(r._pt&&(r=ed(r,n)),r&&r.modifier&&r.modifier(t[n],e,a[i],n))}(e,n)}}}},nd=$h.registerPlugin({name:"attr",init:function(e,t,n,i,r){var a,s,o;for(a in this.tween=n,t)o=e.getAttribute(a)||"",(s=this.add(e,"setAttribute",(o||0)+"",t[a],i,r,0,0,a)).op=a,s.b=o,this._props.push(a)},render:function(e,t){for(var n=t._pt;n;)El?n.set(n.t,n.p,n.b,n):n.r(e,n.d),n=n._next}},{name:"endArray",init:function(e,t){for(var n=t.length;n--;)this.add(e,n,e[n]||0,t[n],0,0,0,0,0,1)}},td("roundProps",Uc),td("modifiers"),td("snap",Fc))||$h;Lh.version=_h.version=nd.version="3.12.2",Dl=1,pu()&&rh();ah.Power0,ah.Power1,ah.Power2,ah.Power3,ah.Power4,ah.Linear,ah.Quad,ah.Cubic,ah.Quart,ah.Quint,ah.Strong,ah.Elastic,ah.Back,ah.SteppedEase,ah.Bounce,ah.Sine,ah.Expo,ah.Circ
/*!
 * CSSPlugin 3.12.2
 * https://greensock.com
 *
 * Copyright 2008-2023, GreenSock. All rights reserved.
 * Subject to the terms at https://greensock.com/standard-license or for
 * Club GreenSock members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/;var id,rd,ad,sd,od,ld,ud,cd,hd={},dd=180/Math.PI,pd=Math.PI/180,fd=Math.atan2,md=/([A-Z])/g,gd=/(left|right|width|margin|padding|x)/i,vd=/[\s,\(]\S/,_d={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},xd=function(e,t){return t.set(t.t,t.p,Math.round(1e4*(t.s+t.c*e))/1e4+t.u,t)},yd=function(e,t){return t.set(t.t,t.p,1===e?t.e:Math.round(1e4*(t.s+t.c*e))/1e4+t.u,t)},bd=function(e,t){return t.set(t.t,t.p,e?Math.round(1e4*(t.s+t.c*e))/1e4+t.u:t.b,t)},Md=function(e,t){var n=t.s+t.c*e;t.set(t.t,t.p,~~(n+(n<0?-.5:.5))+t.u,t)},Sd=function(e,t){return t.set(t.t,t.p,e?t.e:t.b,t)},wd=function(e,t){return t.set(t.t,t.p,1!==e?t.b:t.e,t)},Td=function(e,t,n){return e.style[t]=n},Ed=function(e,t,n){return e.style.setProperty(t,n)},Ad=function(e,t,n){return e._gsap[t]=n},Cd=function(e,t,n){return e._gsap.scaleX=e._gsap.scaleY=n},Ld=function(e,t,n,i,r){var a=e._gsap;a.scaleX=a.scaleY=n,a.renderTransform(r,a)},Pd=function(e,t,n,i,r){var a=e._gsap;a[t]=n,a.renderTransform(r,a)},Rd="transform",Dd=Rd+"Origin",Id=function e(t,n){var i=this,r=this.target,a=r.style;if(t in hd&&a){if(this.tfm=this.tfm||{},"transform"===t)return _d.transform.split(",").forEach((function(t){return e.call(i,t,n)}));if(~(t=_d[t]||t).indexOf(",")?t.split(",").forEach((function(e){return i.tfm[e]=Kd(r,e)})):this.tfm[t]=r._gsap.x?r._gsap[t]:Kd(r,t),this.props.indexOf(Rd)>=0)return;r._gsap.svg&&(this.svgo=r.getAttribute("data-svg-origin"),this.props.push(Dd,n,"")),t=Rd}(a||n)&&this.props.push(t,n,a[t])},Od=function(e){e.translate&&(e.removeProperty("translate"),e.removeProperty("scale"),e.removeProperty("rotate"))},Nd=function(){var e,t,n=this.props,i=this.target,r=i.style,a=i._gsap;for(e=0;e<n.length;e+=3)n[e+1]?i[n[e]]=n[e+2]:n[e+2]?r[n[e]]=n[e+2]:r.removeProperty("--"===n[e].substr(0,2)?n[e]:n[e].replace(md,"-$1").toLowerCase());if(this.tfm){for(t in this.tfm)a[t]=this.tfm[t];a.svg&&(a.renderTransform(),i.setAttribute("data-svg-origin",this.svgo||"")),(e=ud())&&e.isStart||r[Rd]||(Od(r),a.uncache=1)}},zd=function(e,t){var n={target:e,props:[],revert:Nd,save:Id};return e._gsap||nd.core.getCache(e),t&&t.split(",").forEach((function(e){return n.save(e)})),n},Ud=function(e,t){var n=rd.createElementNS?rd.createElementNS((t||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),e):rd.createElement(e);return n.style?n:rd.createElement(e)},Fd=function e(t,n,i){var r=getComputedStyle(t);return r[n]||r.getPropertyValue(n.replace(md,"-$1").toLowerCase())||r.getPropertyValue(n)||!i&&e(t,Bd(n)||n,1)||""},kd="O,Moz,ms,Ms,Webkit".split(","),Bd=function(e,t,n){var i=(t||od).style,r=5;if(e in i&&!n)return e;for(e=e.charAt(0).toUpperCase()+e.substr(1);r--&&!(kd[r]+e in i););return r<0?null:(3===r?"ms":r>=0?kd[r]:"")+e},Vd=function(){"undefined"!=typeof window&&window.document&&(id=window,rd=id.document,ad=rd.documentElement,od=Ud("div")||{style:{}},Ud("div"),Rd=Bd(Rd),Dd=Rd+"Origin",od.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",cd=!!Bd("perspective"),ud=nd.core.reverting,sd=1)},Gd=function e(t){var n,i=Ud("svg",this.ownerSVGElement&&this.ownerSVGElement.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),r=this.parentNode,a=this.nextSibling,s=this.style.cssText;if(ad.appendChild(i),i.appendChild(this),this.style.display="block",t)try{n=this.getBBox(),this._gsapBBox=this.getBBox,this.getBBox=e}catch(e){}else this._gsapBBox&&(n=this._gsapBBox());return r&&(a?r.insertBefore(this,a):r.appendChild(this)),ad.removeChild(i),this.style.cssText=s,n},Hd=function(e,t){for(var n=t.length;n--;)if(e.hasAttribute(t[n]))return e.getAttribute(t[n])},qd=function(e){var t;try{t=e.getBBox()}catch(n){t=Gd.call(e,!0)}return t&&(t.width||t.height)||e.getBBox===Gd||(t=Gd.call(e,!0)),!t||t.width||t.x||t.y?t:{x:+Hd(e,["x","cx","x1"])||0,y:+Hd(e,["y","cy","y1"])||0,width:0,height:0}},Wd=function(e){return!(!e.getCTM||e.parentNode&&!e.ownerSVGElement||!qd(e))},jd=function(e,t){if(t){var n=e.style;t in hd&&t!==Dd&&(t=Rd),n.removeProperty?("ms"!==t.substr(0,2)&&"webkit"!==t.substr(0,6)||(t="-"+t),n.removeProperty(t.replace(md,"-$1").toLowerCase())):n.removeAttribute(t)}},Xd=function(e,t,n,i,r,a){var s=new Hh(e._pt,t,n,0,1,a?wd:Sd);return e._pt=s,s.b=i,s.e=r,e._props.push(n),s},Yd={deg:1,rad:1,turn:1},Jd={grid:1,flex:1},Zd=function e(t,n,i,r){var a,s,o,l,u=parseFloat(i)||0,c=(i+"").trim().substr((u+"").length)||"px",h=od.style,d=gd.test(n),p="svg"===t.tagName.toLowerCase(),f=(p?"client":"offset")+(d?"Width":"Height"),m=100,g="px"===r,v="%"===r;return r===c||!u||Yd[r]||Yd[c]?u:("px"!==c&&!g&&(u=e(t,n,i,"px")),l=t.getCTM&&Wd(t),!v&&"%"!==c||!hd[n]&&!~n.indexOf("adius")?(h[d?"width":"height"]=m+(g?c:r),s=~n.indexOf("adius")||"em"===r&&t.appendChild&&!p?t:t.parentNode,l&&(s=(t.ownerSVGElement||{}).parentNode),s&&s!==rd&&s.appendChild||(s=rd.body),(o=s._gsap)&&v&&o.width&&d&&o.time===ih.time&&!o.uncache?ju(u/o.width*m):((v||"%"===c)&&!Jd[Fd(s,"display")]&&(h.position=Fd(t,"position")),s===t&&(h.position="static"),s.appendChild(od),a=od[f],s.removeChild(od),h.position="absolute",d&&v&&((o=Hu(s)).time=ih.time,o.width=s[f]),ju(g?a*u/m:a&&u?m/a*u:0))):(a=l?t.getBBox()[d?"width":"height"]:t[f],ju(v?u/a*m:u/100*a)))},Kd=function(e,t,n,i){var r;return sd||Vd(),t in _d&&"transform"!==t&&~(t=_d[t]).indexOf(",")&&(t=t.split(",")[0]),hd[t]&&"transform"!==t?(r=lp(e,i),r="transformOrigin"!==t?r[t]:r.svg?r.origin:up(Fd(e,Dd))+" "+r.zOrigin+"px"):(!(r=e.style[t])||"auto"===r||i||~(r+"").indexOf("calc("))&&(r=tp[t]&&tp[t](e,t,n)||Fd(e,t)||qu(e,t)||("opacity"===t?1:0)),n&&!~(r+"").trim().indexOf(" ")?Zd(e,t,r,n)+n:r},Qd=function(e,t,n,i){if(!n||"none"===n){var r=Bd(t,e,1),a=r&&Fd(e,r,1);a&&a!==n?(t=r,n=a):"borderColor"===t&&(n=Fd(e,"borderTopColor"))}var s,o,l,u,c,h,d,p,f,m,g,v=new Hh(this._pt,e.style,t,0,1,Uh),_=0,x=0;if(v.b=n,v.e=i,n+="","auto"===(i+="")&&(e.style[t]=i,i=Fd(e,t)||i,e.style[t]=n),nh(s=[n,i]),i=s[1],l=(n=s[0]).match(xu)||[],(i.match(xu)||[]).length){for(;o=xu.exec(i);)d=o[0],f=i.substring(_,o.index),c?c=(c+1)%5:"rgba("!==f.substr(-5)&&"hsla("!==f.substr(-5)||(c=1),d!==(h=l[x++]||"")&&(u=parseFloat(h)||0,g=h.substr((u+"").length),"="===d.charAt(1)&&(d=Yu(u,d)+g),p=parseFloat(d),m=d.substr((p+"").length),_=xu.lastIndex-m.length,m||(m=m||Kl.units[t]||g,_===i.length&&(i+=m,v.e+=m)),g!==m&&(u=Zd(e,t,h,m)||0),v._pt={_next:v._pt,p:f||1===x?f:",",s:u,c:p-u,m:c&&c<4||"zIndex"===t?Math.round:0});v.c=_<i.length?i.substring(_,i.length):""}else v.r="display"===t&&"none"===i?wd:Sd;return bu.test(i)&&(v.e=0),this._pt=v,v},$d={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},ep=function(e,t){if(t.tween&&t.tween._time===t.tween._dur){var n,i,r,a=t.t,s=a.style,o=t.u,l=a._gsap;if("all"===o||!0===o)s.cssText="",i=1;else for(r=(o=o.split(",")).length;--r>-1;)n=o[r],hd[n]&&(i=1,n="transformOrigin"===n?Dd:Rd),jd(a,n);i&&(jd(a,Rd),l&&(l.svg&&a.removeAttribute("transform"),lp(a,1),l.uncache=1,Od(s)))}},tp={clearProps:function(e,t,n,i,r){if("isFromStart"!==r.data){var a=e._pt=new Hh(e._pt,t,n,0,0,ep);return a.u=i,a.pr=-10,a.tween=r,e._props.push(n),1}}},np=[1,0,0,1,0,0],ip={},rp=function(e){return"matrix(1, 0, 0, 1, 0, 0)"===e||"none"===e||!e},ap=function(e){var t=Fd(e,Rd);return rp(t)?np:t.substr(7).match(_u).map(ju)},sp=function(e,t){var n,i,r,a,s=e._gsap||Hu(e),o=e.style,l=ap(e);return s.svg&&e.getAttribute("transform")?"1,0,0,1,0,0"===(l=[(r=e.transform.baseVal.consolidate().matrix).a,r.b,r.c,r.d,r.e,r.f]).join(",")?np:l:(l!==np||e.offsetParent||e===ad||s.svg||(r=o.display,o.display="block",(n=e.parentNode)&&e.offsetParent||(a=1,i=e.nextElementSibling,ad.appendChild(e)),l=ap(e),r?o.display=r:jd(e,"display"),a&&(i?n.insertBefore(e,i):n?n.appendChild(e):ad.removeChild(e))),t&&l.length>6?[l[0],l[1],l[4],l[5],l[12],l[13]]:l)},op=function(e,t,n,i,r,a){var s,o,l,u=e._gsap,c=r||sp(e,!0),h=u.xOrigin||0,d=u.yOrigin||0,p=u.xOffset||0,f=u.yOffset||0,m=c[0],g=c[1],v=c[2],_=c[3],x=c[4],y=c[5],b=t.split(" "),M=parseFloat(b[0])||0,S=parseFloat(b[1])||0;n?c!==np&&(o=m*_-g*v)&&(l=M*(-g/o)+S*(m/o)-(m*y-g*x)/o,M=M*(_/o)+S*(-v/o)+(v*y-_*x)/o,S=l):(M=(s=qd(e)).x+(~b[0].indexOf("%")?M/100*s.width:M),S=s.y+(~(b[1]||b[0]).indexOf("%")?S/100*s.height:S)),i||!1!==i&&u.smooth?(x=M-h,y=S-d,u.xOffset=p+(x*m+y*v)-x,u.yOffset=f+(x*g+y*_)-y):u.xOffset=u.yOffset=0,u.xOrigin=M,u.yOrigin=S,u.smooth=!!i,u.origin=t,u.originIsAbsolute=!!n,e.style[Dd]="0px 0px",a&&(Xd(a,u,"xOrigin",h,M),Xd(a,u,"yOrigin",d,S),Xd(a,u,"xOffset",p,u.xOffset),Xd(a,u,"yOffset",f,u.yOffset)),e.setAttribute("data-svg-origin",M+" "+S)},lp=function(e,t){var n=e._gsap||new gh(e);if("x"in n&&!t&&!n.uncache)return n;var i,r,a,s,o,l,u,c,h,d,p,f,m,g,v,_,x,y,b,M,S,w,T,E,A,C,L,P,R,D,I,O,N=e.style,z=n.scaleX<0,U="px",F="deg",k=getComputedStyle(e),B=Fd(e,Dd)||"0";return i=r=a=l=u=c=h=d=p=0,s=o=1,n.svg=!(!e.getCTM||!Wd(e)),k.translate&&("none"===k.translate&&"none"===k.scale&&"none"===k.rotate||(N[Rd]=("none"!==k.translate?"translate3d("+(k.translate+" 0 0").split(" ").slice(0,3).join(", ")+") ":"")+("none"!==k.rotate?"rotate("+k.rotate+") ":"")+("none"!==k.scale?"scale("+k.scale.split(" ").join(",")+") ":"")+("none"!==k[Rd]?k[Rd]:"")),N.scale=N.rotate=N.translate="none"),g=sp(e,n.svg),n.svg&&(n.uncache?(A=e.getBBox(),B=n.xOrigin-A.x+"px "+(n.yOrigin-A.y)+"px",E=""):E=!t&&e.getAttribute("data-svg-origin"),op(e,E||B,!!E||n.originIsAbsolute,!1!==n.smooth,g)),f=n.xOrigin||0,m=n.yOrigin||0,g!==np&&(y=g[0],b=g[1],M=g[2],S=g[3],i=w=g[4],r=T=g[5],6===g.length?(s=Math.sqrt(y*y+b*b),o=Math.sqrt(S*S+M*M),l=y||b?fd(b,y)*dd:0,(h=M||S?fd(M,S)*dd+l:0)&&(o*=Math.abs(Math.cos(h*pd))),n.svg&&(i-=f-(f*y+m*M),r-=m-(f*b+m*S))):(O=g[6],D=g[7],L=g[8],P=g[9],R=g[10],I=g[11],i=g[12],r=g[13],a=g[14],u=(v=fd(O,R))*dd,v&&(E=w*(_=Math.cos(-v))+L*(x=Math.sin(-v)),A=T*_+P*x,C=O*_+R*x,L=w*-x+L*_,P=T*-x+P*_,R=O*-x+R*_,I=D*-x+I*_,w=E,T=A,O=C),c=(v=fd(-M,R))*dd,v&&(_=Math.cos(-v),I=S*(x=Math.sin(-v))+I*_,y=E=y*_-L*x,b=A=b*_-P*x,M=C=M*_-R*x),l=(v=fd(b,y))*dd,v&&(E=y*(_=Math.cos(v))+b*(x=Math.sin(v)),A=w*_+T*x,b=b*_-y*x,T=T*_-w*x,y=E,w=A),u&&Math.abs(u)+Math.abs(l)>359.9&&(u=l=0,c=180-c),s=ju(Math.sqrt(y*y+b*b+M*M)),o=ju(Math.sqrt(T*T+O*O)),v=fd(w,T),h=Math.abs(v)>2e-4?v*dd:0,p=I?1/(I<0?-I:I):0),n.svg&&(E=e.getAttribute("transform"),n.forceCSS=e.setAttribute("transform","")||!rp(Fd(e,Rd)),E&&e.setAttribute("transform",E))),Math.abs(h)>90&&Math.abs(h)<270&&(z?(s*=-1,h+=l<=0?180:-180,l+=l<=0?180:-180):(o*=-1,h+=h<=0?180:-180)),t=t||n.uncache,n.x=i-((n.xPercent=i&&(!t&&n.xPercent||(Math.round(e.offsetWidth/2)===Math.round(-i)?-50:0)))?e.offsetWidth*n.xPercent/100:0)+U,n.y=r-((n.yPercent=r&&(!t&&n.yPercent||(Math.round(e.offsetHeight/2)===Math.round(-r)?-50:0)))?e.offsetHeight*n.yPercent/100:0)+U,n.z=a+U,n.scaleX=ju(s),n.scaleY=ju(o),n.rotation=ju(l)+F,n.rotationX=ju(u)+F,n.rotationY=ju(c)+F,n.skewX=h+F,n.skewY=d+F,n.transformPerspective=p+U,(n.zOrigin=parseFloat(B.split(" ")[2])||0)&&(N[Dd]=up(B)),n.xOffset=n.yOffset=0,n.force3D=Kl.force3D,n.renderTransform=n.svg?gp:cd?mp:hp,n.uncache=0,n},up=function(e){return(e=e.split(" "))[0]+" "+e[1]},cp=function(e,t,n){var i=Pc(t);return ju(parseFloat(t)+parseFloat(Zd(e,"x",n+"px",i)))+i},hp=function(e,t){t.z="0px",t.rotationY=t.rotationX="0deg",t.force3D=0,mp(e,t)},dp="0deg",pp="0px",fp=") ",mp=function(e,t){var n=t||this,i=n.xPercent,r=n.yPercent,a=n.x,s=n.y,o=n.z,l=n.rotation,u=n.rotationY,c=n.rotationX,h=n.skewX,d=n.skewY,p=n.scaleX,f=n.scaleY,m=n.transformPerspective,g=n.force3D,v=n.target,_=n.zOrigin,x="",y="auto"===g&&e&&1!==e||!0===g;if(_&&(c!==dp||u!==dp)){var b,M=parseFloat(u)*pd,S=Math.sin(M),w=Math.cos(M);M=parseFloat(c)*pd,b=Math.cos(M),a=cp(v,a,S*b*-_),s=cp(v,s,-Math.sin(M)*-_),o=cp(v,o,w*b*-_+_)}m!==pp&&(x+="perspective("+m+fp),(i||r)&&(x+="translate("+i+"%, "+r+"%) "),(y||a!==pp||s!==pp||o!==pp)&&(x+=o!==pp||y?"translate3d("+a+", "+s+", "+o+") ":"translate("+a+", "+s+fp),l!==dp&&(x+="rotate("+l+fp),u!==dp&&(x+="rotateY("+u+fp),c!==dp&&(x+="rotateX("+c+fp),h===dp&&d===dp||(x+="skew("+h+", "+d+fp),1===p&&1===f||(x+="scale("+p+", "+f+fp),v.style[Rd]=x||"translate(0, 0)"},gp=function(e,t){var n,i,r,a,s,o=t||this,l=o.xPercent,u=o.yPercent,c=o.x,h=o.y,d=o.rotation,p=o.skewX,f=o.skewY,m=o.scaleX,g=o.scaleY,v=o.target,_=o.xOrigin,x=o.yOrigin,y=o.xOffset,b=o.yOffset,M=o.forceCSS,S=parseFloat(c),w=parseFloat(h);d=parseFloat(d),p=parseFloat(p),(f=parseFloat(f))&&(p+=f=parseFloat(f),d+=f),d||p?(d*=pd,p*=pd,n=Math.cos(d)*m,i=Math.sin(d)*m,r=Math.sin(d-p)*-g,a=Math.cos(d-p)*g,p&&(f*=pd,s=Math.tan(p-f),r*=s=Math.sqrt(1+s*s),a*=s,f&&(s=Math.tan(f),n*=s=Math.sqrt(1+s*s),i*=s)),n=ju(n),i=ju(i),r=ju(r),a=ju(a)):(n=m,a=g,i=r=0),(S&&!~(c+"").indexOf("px")||w&&!~(h+"").indexOf("px"))&&(S=Zd(v,"x",c,"px"),w=Zd(v,"y",h,"px")),(_||x||y||b)&&(S=ju(S+_-(_*n+x*r)+y),w=ju(w+x-(_*i+x*a)+b)),(l||u)&&(s=v.getBBox(),S=ju(S+l/100*s.width),w=ju(w+u/100*s.height)),s="matrix("+n+","+i+","+r+","+a+","+S+","+w+")",v.setAttribute("transform",s),M&&(v.style[Rd]=s)},vp=function(e,t,n,i,r){var a,s,o=360,l=ou(r),u=parseFloat(r)*(l&&~r.indexOf("rad")?dd:1)-i,c=i+u+"deg";return l&&("short"===(a=r.split("_")[1])&&(u%=o)!==u%180&&(u+=u<0?o:-360),"cw"===a&&u<0?u=(u+36e9)%o-~~(u/o)*o:"ccw"===a&&u>0&&(u=(u-36e9)%o-~~(u/o)*o)),e._pt=s=new Hh(e._pt,t,n,i,u,yd),s.e=c,s.u="deg",e._props.push(n),s},_p=function(e,t){for(var n in t)e[n]=t[n];return e},xp=function(e,t,n){var i,r,a,s,o,l,u,c=_p({},n._gsap),h=n.style;for(r in c.svg?(a=n.getAttribute("transform"),n.setAttribute("transform",""),h[Rd]=t,i=lp(n,1),jd(n,Rd),n.setAttribute("transform",a)):(a=getComputedStyle(n)[Rd],h[Rd]=t,i=lp(n,1),h[Rd]=a),hd)(a=c[r])!==(s=i[r])&&"perspective,force3D,transformOrigin,svgOrigin".indexOf(r)<0&&(o=Pc(a)!==(u=Pc(s))?Zd(n,r,a,u):parseFloat(a),l=parseFloat(s),e._pt=new Hh(e._pt,i,r,o,l-o,xd),e._pt.u=u||0,e._props.push(r));_p(i,c)};Wu("padding,margin,Width,Radius",(function(e,t){var n="Top",i="Right",r="Bottom",a="Left",s=(t<3?[n,i,r,a]:[n+a,n+i,r+i,r+a]).map((function(n){return t<2?e+n:"border"+n+e}));tp[t>1?"border"+e:e]=function(e,t,n,i,r){var a,o;if(arguments.length<4)return a=s.map((function(t){return Kd(e,t,n)})),5===(o=a.join(" ")).split(a[0]).length?a[0]:o;a=(i+"").split(" "),o={},s.forEach((function(e,t){return o[e]=a[t]=a[t]||a[(t-1)/2|0]})),e.init(t,o,r)}}));var yp,bp,Mp,Sp={name:"css",register:Vd,targetTest:function(e){return e.style&&e.nodeType},init:function(e,t,n,i,r){var a,s,o,l,u,c,h,d,p,f,m,g,v,_,x,y,b,M,S,w,T=this._props,E=e.style,A=n.vars.startAt;for(h in sd||Vd(),this.styles=this.styles||zd(e),y=this.styles.props,this.tween=n,t)if("autoRound"!==h&&(s=t[h],!Uu[h]||!Sh(h,t,n,i,e,r)))if(u=typeof s,c=tp[h],"function"===u&&(u=typeof(s=s.call(n,i,e,r))),"string"===u&&~s.indexOf("random(")&&(s=Vc(s)),c)c(this,e,h,s,n)&&(x=1);else if("--"===h.substr(0,2))a=(getComputedStyle(e).getPropertyValue(h)+"").trim(),s+="",eh.lastIndex=0,eh.test(a)||(d=Pc(a),p=Pc(s)),p?d!==p&&(a=Zd(e,h,a,p)+p):d&&(s+=d),this.add(E,"setProperty",a,s,i,r,0,0,h),T.push(h),y.push(h,0,E[h]);else if("undefined"!==u){if(A&&h in A?(a="function"==typeof A[h]?A[h].call(n,i,e,r):A[h],ou(a)&&~a.indexOf("random(")&&(a=Vc(a)),Pc(a+"")||(a+=Kl.units[h]||Pc(Kd(e,h))||""),"="===(a+"").charAt(1)&&(a=Kd(e,h))):a=Kd(e,h),l=parseFloat(a),(f="string"===u&&"="===s.charAt(1)&&s.substr(0,2))&&(s=s.substr(2)),o=parseFloat(s),h in _d&&("autoAlpha"===h&&(1===l&&"hidden"===Kd(e,"visibility")&&o&&(l=0),y.push("visibility",0,E.visibility),Xd(this,E,"visibility",l?"inherit":"hidden",o?"inherit":"hidden",!o)),"scale"!==h&&"transform"!==h&&~(h=_d[h]).indexOf(",")&&(h=h.split(",")[0])),m=h in hd)if(this.styles.save(h),g||((v=e._gsap).renderTransform&&!t.parseTransform||lp(e,t.parseTransform),_=!1!==t.smoothOrigin&&v.smooth,(g=this._pt=new Hh(this._pt,E,Rd,0,1,v.renderTransform,v,0,-1)).dep=1),"scale"===h)this._pt=new Hh(this._pt,v,"scaleY",v.scaleY,(f?Yu(v.scaleY,f+o):o)-v.scaleY||0,xd),this._pt.u=0,T.push("scaleY",h),h+="X";else{if("transformOrigin"===h){y.push(Dd,0,E[Dd]),M=void 0,S=void 0,w=void 0,M=(b=s).split(" "),S=M[0],w=M[1]||"50%","top"!==S&&"bottom"!==S&&"left"!==w&&"right"!==w||(b=S,S=w,w=b),M[0]=$d[S]||S,M[1]=$d[w]||w,s=M.join(" "),v.svg?op(e,s,0,_,0,this):((p=parseFloat(s.split(" ")[2])||0)!==v.zOrigin&&Xd(this,v,"zOrigin",v.zOrigin,p),Xd(this,E,h,up(a),up(s)));continue}if("svgOrigin"===h){op(e,s,1,_,0,this);continue}if(h in ip){vp(this,v,h,l,f?Yu(l,f+s):s);continue}if("smoothOrigin"===h){Xd(this,v,"smooth",v.smooth,s);continue}if("force3D"===h){v[h]=s;continue}if("transform"===h){xp(this,s,e);continue}}else h in E||(h=Bd(h)||h);if(m||(o||0===o)&&(l||0===l)&&!vd.test(s)&&h in E)o||(o=0),(d=(a+"").substr((l+"").length))!==(p=Pc(s)||(h in Kl.units?Kl.units[h]:d))&&(l=Zd(e,h,a,p)),this._pt=new Hh(this._pt,m?v:E,h,l,(f?Yu(l,f+o):o)-l,m||"px"!==p&&"zIndex"!==h||!1===t.autoRound?xd:Md),this._pt.u=p||0,d!==p&&"%"!==p&&(this._pt.b=a,this._pt.r=bd);else if(h in E)Qd.call(this,e,h,a,f?f+s:s);else if(h in e)this.add(e,h,a||e[h],f?f+s:s,i,r);else if("parseTransform"!==h){Au(h,s);continue}m||(h in E?y.push(h,0,E[h]):y.push(h,1,a||e[h])),T.push(h)}x&&Gh(this)},render:function(e,t){if(t.tween._time||!ud())for(var n=t._pt;n;)n.r(e,n.d),n=n._next;else t.styles.revert()},get:Kd,aliases:_d,getSetter:function(e,t,n){var i=_d[t];return i&&i.indexOf(",")<0&&(t=i),t in hd&&t!==Dd&&(e._gsap.x||Kd(e,"x"))?n&&ld===n?"scale"===t?Cd:Ad:(ld=n||{},"scale"===t?Ld:Pd):e.style&&!cu(e.style[t])?Td:~t.indexOf("-")?Ed:Oh(e,t)},core:{_removeProperty:jd,_getMatrix:sp}};nd.utils.checkPrefix=Bd,nd.core.getStyleSaver=zd,Mp=Wu((yp="x,y,z,scale,scaleX,scaleY,xPercent,yPercent")+","+(bp="rotation,rotationX,rotationY,skewX,skewY")+",transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective",(function(e){hd[e]=1})),Wu(bp,(function(e){Kl.units[e]="deg",ip[e]=1})),_d[Mp[13]]=yp+","+bp,Wu("0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY",(function(e){var t=e.split(":");_d[t[1]]=Mp[t[0]]})),Wu("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",(function(e){Kl.units[e]="px"})),nd.registerPlugin(Sp);var wp=nd.registerPlugin(Sp)||nd;
/*!
 * ScrollTrigger 3.12.2
 * https://greensock.com
 *
 * @license Copyright 2008-2023, GreenSock. All rights reserved.
 * Subject to the terms at https://greensock.com/standard-license or for
 * Club GreenSock members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/wp.core.Tween;function Tp(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}
/*!
 * Observer 3.12.2
 * https://greensock.com
 *
 * @license Copyright 2008-2023, GreenSock. All rights reserved.
 * Subject to the terms at https://greensock.com/standard-license or for
 * Club GreenSock members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var Ep,Ap,Cp,Lp,Pp,Rp,Dp,Ip,Op,Np,zp,Up,Fp,kp=function(){return Ep||"undefined"!=typeof window&&(Ep=window.gsap)&&Ep.registerPlugin&&Ep},Bp=1,Vp=[],Gp=[],Hp=[],qp=Date.now,Wp=function(e,t){return t},jp=function(e,t){return~Hp.indexOf(e)&&Hp[Hp.indexOf(e)+1][t]},Xp=function(e){return!!~Np.indexOf(e)},Yp=function(e,t,n,i,r){return e.addEventListener(t,n,{passive:!i,capture:!!r})},Jp=function(e,t,n,i){return e.removeEventListener(t,n,!!i)},Zp="scrollLeft",Kp="scrollTop",Qp=function(){return zp&&zp.isPressed||Gp.cache++},$p=function(e,t){var n=function n(i){if(i||0===i){Bp&&(Cp.history.scrollRestoration="manual");var r=zp&&zp.isPressed;i=n.v=Math.round(i)||(zp&&zp.iOS?1:0),e(i),n.cacheID=Gp.cache,r&&Wp("ss",i)}else(t||Gp.cache!==n.cacheID||Wp("ref"))&&(n.cacheID=Gp.cache,n.v=e());return n.v+n.offset};return n.offset=0,e&&n},ef={s:Zp,p:"left",p2:"Left",os:"right",os2:"Right",d:"width",d2:"Width",a:"x",sc:$p((function(e){return arguments.length?Cp.scrollTo(e,tf.sc()):Cp.pageXOffset||Lp[Zp]||Pp[Zp]||Rp[Zp]||0}))},tf={s:Kp,p:"top",p2:"Top",os:"bottom",os2:"Bottom",d:"height",d2:"Height",a:"y",op:ef,sc:$p((function(e){return arguments.length?Cp.scrollTo(ef.sc(),e):Cp.pageYOffset||Lp[Kp]||Pp[Kp]||Rp[Kp]||0}))},nf=function(e,t){return(t&&t._ctx&&t._ctx.selector||Ep.utils.toArray)(e)[0]||("string"==typeof e&&!1!==Ep.config().nullTargetWarn?console.warn("Element not found:",e):null)},rf=function(e,t){var n=t.s,i=t.sc;Xp(e)&&(e=Lp.scrollingElement||Pp);var r=Gp.indexOf(e),a=i===tf.sc?1:2;!~r&&(r=Gp.push(e)-1),Gp[r+a]||Yp(e,"scroll",Qp);var s=Gp[r+a],o=s||(Gp[r+a]=$p(jp(e,n),!0)||(Xp(e)?i:$p((function(t){return arguments.length?e[n]=t:e[n]}))));return o.target=e,s||(o.smooth="smooth"===Ep.getProperty(e,"scrollBehavior")),o},af=function(e,t,n){var i=e,r=e,a=qp(),s=a,o=t||50,l=Math.max(500,3*o),u=function(e,t){var l=qp();t||l-a>o?(r=i,i=e,s=a,a=l):n?i+=e:i=r+(e-r)/(l-s)*(a-s)};return{update:u,reset:function(){r=i=n?0:i,s=a=0},getVelocity:function(e){var t=s,o=r,c=qp();return(e||0===e)&&e!==i&&u(e),a===s||c-s>l?0:(i+(n?o:-o))/((n?c:a)-t)*1e3}}},sf=function(e,t){return t&&!e._gsapAllow&&e.preventDefault(),e.changedTouches?e.changedTouches[0]:e},of=function(e){var t=Math.max.apply(Math,e),n=Math.min.apply(Math,e);return Math.abs(t)>=Math.abs(n)?t:n},lf=function(){var e,t,n,i;(Op=Ep.core.globals().ScrollTrigger)&&Op.core&&(e=Op.core,t=e.bridge||{},n=e._scrollers,i=e._proxies,n.push.apply(n,Gp),i.push.apply(i,Hp),Gp=n,Hp=i,Wp=function(e,n){return t[e](n)})},uf=function(e){return(Ep=e||kp())&&"undefined"!=typeof document&&document.body&&(Cp=window,Lp=document,Pp=Lp.documentElement,Rp=Lp.body,Np=[Cp,Lp,Pp,Rp],Ep.utils.clamp,Fp=Ep.core.context||function(){},Ip="onpointerenter"in Rp?"pointer":"mouse",Dp=cf.isTouch=Cp.matchMedia&&Cp.matchMedia("(hover: none), (pointer: coarse)").matches?1:"ontouchstart"in Cp||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0?2:0,Up=cf.eventTypes=("ontouchstart"in Pp?"touchstart,touchmove,touchcancel,touchend":"onpointerdown"in Pp?"pointerdown,pointermove,pointercancel,pointerup":"mousedown,mousemove,mouseup,mouseup").split(","),setTimeout((function(){return Bp=0}),500),lf(),Ap=1),Ap};ef.op=tf,Gp.cache=0;var cf=function(){function e(e){this.init(e)}var t,n,i;return e.prototype.init=function(e){Ap||uf(Ep)||console.warn("Please gsap.registerPlugin(Observer)"),Op||lf();var t=e.tolerance,n=e.dragMinimum,i=e.type,r=e.target,a=e.lineHeight,s=e.debounce,o=e.preventDefault,l=e.onStop,u=e.onStopDelay,c=e.ignore,h=e.wheelSpeed,d=e.event,p=e.onDragStart,f=e.onDragEnd,m=e.onDrag,g=e.onPress,v=e.onRelease,_=e.onRight,x=e.onLeft,y=e.onUp,b=e.onDown,M=e.onChangeX,S=e.onChangeY,w=e.onChange,T=e.onToggleX,E=e.onToggleY,A=e.onHover,C=e.onHoverEnd,L=e.onMove,P=e.ignoreCheck,R=e.isNormalizer,D=e.onGestureStart,I=e.onGestureEnd,O=e.onWheel,N=e.onEnable,z=e.onDisable,U=e.onClick,F=e.scrollSpeed,k=e.capture,B=e.allowClicks,V=e.lockAxis,G=e.onLockAxis;this.target=r=nf(r)||Pp,this.vars=e,c&&(c=Ep.utils.toArray(c)),t=t||1e-9,n=n||0,h=h||1,F=F||1,i=i||"wheel,touch,pointer",s=!1!==s,a||(a=parseFloat(Cp.getComputedStyle(Rp).lineHeight)||22);var H,q,W,j,X,Y,J,Z=this,K=0,Q=0,$=rf(r,ef),ee=rf(r,tf),te=$(),ne=ee(),ie=~i.indexOf("touch")&&!~i.indexOf("pointer")&&"pointerdown"===Up[0],re=Xp(r),ae=r.ownerDocument||Lp,se=[0,0,0],oe=[0,0,0],le=0,ue=function(){return le=qp()},ce=function(e,t){return(Z.event=e)&&c&&~c.indexOf(e.target)||t&&ie&&"touch"!==e.pointerType||P&&P(e,t)},he=function(){var e=Z.deltaX=of(se),n=Z.deltaY=of(oe),i=Math.abs(e)>=t,r=Math.abs(n)>=t;w&&(i||r)&&w(Z,e,n,se,oe),i&&(_&&Z.deltaX>0&&_(Z),x&&Z.deltaX<0&&x(Z),M&&M(Z),T&&Z.deltaX<0!=K<0&&T(Z),K=Z.deltaX,se[0]=se[1]=se[2]=0),r&&(b&&Z.deltaY>0&&b(Z),y&&Z.deltaY<0&&y(Z),S&&S(Z),E&&Z.deltaY<0!=Q<0&&E(Z),Q=Z.deltaY,oe[0]=oe[1]=oe[2]=0),(j||W)&&(L&&L(Z),W&&(m(Z),W=!1),j=!1),Y&&(Y=!1,1)&&G&&G(Z),X&&(O(Z),X=!1),H=0},de=function(e,t,n){se[n]+=e,oe[n]+=t,Z._vx.update(e),Z._vy.update(t),s?H||(H=requestAnimationFrame(he)):he()},pe=function(e,t){V&&!J&&(Z.axis=J=Math.abs(e)>Math.abs(t)?"x":"y",Y=!0),"y"!==J&&(se[2]+=e,Z._vx.update(e,!0)),"x"!==J&&(oe[2]+=t,Z._vy.update(t,!0)),s?H||(H=requestAnimationFrame(he)):he()},fe=function(e){if(!ce(e,1)){var t=(e=sf(e,o)).clientX,i=e.clientY,r=t-Z.x,a=i-Z.y,s=Z.isDragging;Z.x=t,Z.y=i,(s||Math.abs(Z.startX-t)>=n||Math.abs(Z.startY-i)>=n)&&(m&&(W=!0),s||(Z.isDragging=!0),pe(r,a),s||p&&p(Z))}},me=Z.onPress=function(e){ce(e,1)||e&&e.button||(Z.axis=J=null,q.pause(),Z.isPressed=!0,e=sf(e),K=Q=0,Z.startX=Z.x=e.clientX,Z.startY=Z.y=e.clientY,Z._vx.reset(),Z._vy.reset(),Yp(R?r:ae,Up[1],fe,o,!0),Z.deltaX=Z.deltaY=0,g&&g(Z))},ge=Z.onRelease=function(e){if(!ce(e,1)){Jp(R?r:ae,Up[1],fe,!0);var t=!isNaN(Z.y-Z.startY),n=Z.isDragging&&(Math.abs(Z.x-Z.startX)>3||Math.abs(Z.y-Z.startY)>3),i=sf(e);!n&&t&&(Z._vx.reset(),Z._vy.reset(),o&&B&&Ep.delayedCall(.08,(function(){if(qp()-le>300&&!e.defaultPrevented)if(e.target.click)e.target.click();else if(ae.createEvent){var t=ae.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,Cp,1,i.screenX,i.screenY,i.clientX,i.clientY,!1,!1,!1,!1,0,null),e.target.dispatchEvent(t)}}))),Z.isDragging=Z.isGesturing=Z.isPressed=!1,l&&!R&&q.restart(!0),f&&n&&f(Z),v&&v(Z,n)}},ve=function(e){return e.touches&&e.touches.length>1&&(Z.isGesturing=!0)&&D(e,Z.isDragging)},_e=function(){return Z.isGesturing=!1,I(Z)},xe=function(e){if(!ce(e)){var t=$(),n=ee();de((t-te)*F,(n-ne)*F,1),te=t,ne=n,l&&q.restart(!0)}},ye=function(e){if(!ce(e)){e=sf(e,o),O&&(X=!0);var t=(1===e.deltaMode?a:2===e.deltaMode?Cp.innerHeight:1)*h;de(e.deltaX*t,e.deltaY*t,0),l&&!R&&q.restart(!0)}},be=function(e){if(!ce(e)){var t=e.clientX,n=e.clientY,i=t-Z.x,r=n-Z.y;Z.x=t,Z.y=n,j=!0,(i||r)&&pe(i,r)}},Me=function(e){Z.event=e,A(Z)},Se=function(e){Z.event=e,C(Z)},we=function(e){return ce(e)||sf(e,o)&&U(Z)};q=Z._dc=Ep.delayedCall(u||.25,(function(){Z._vx.reset(),Z._vy.reset(),q.pause(),l&&l(Z)})).pause(),Z.deltaX=Z.deltaY=0,Z._vx=af(0,50,!0),Z._vy=af(0,50,!0),Z.scrollX=$,Z.scrollY=ee,Z.isDragging=Z.isGesturing=Z.isPressed=!1,Fp(this),Z.enable=function(e){return Z.isEnabled||(Yp(re?ae:r,"scroll",Qp),i.indexOf("scroll")>=0&&Yp(re?ae:r,"scroll",xe,o,k),i.indexOf("wheel")>=0&&Yp(r,"wheel",ye,o,k),(i.indexOf("touch")>=0&&Dp||i.indexOf("pointer")>=0)&&(Yp(r,Up[0],me,o,k),Yp(ae,Up[2],ge),Yp(ae,Up[3],ge),B&&Yp(r,"click",ue,!1,!0),U&&Yp(r,"click",we),D&&Yp(ae,"gesturestart",ve),I&&Yp(ae,"gestureend",_e),A&&Yp(r,Ip+"enter",Me),C&&Yp(r,Ip+"leave",Se),L&&Yp(r,Ip+"move",be)),Z.isEnabled=!0,e&&e.type&&me(e),N&&N(Z)),Z},Z.disable=function(){Z.isEnabled&&(Vp.filter((function(e){return e!==Z&&Xp(e.target)})).length||Jp(re?ae:r,"scroll",Qp),Z.isPressed&&(Z._vx.reset(),Z._vy.reset(),Jp(R?r:ae,Up[1],fe,!0)),Jp(re?ae:r,"scroll",xe,k),Jp(r,"wheel",ye,k),Jp(r,Up[0],me,k),Jp(ae,Up[2],ge),Jp(ae,Up[3],ge),Jp(r,"click",ue,!0),Jp(r,"click",we),Jp(ae,"gesturestart",ve),Jp(ae,"gestureend",_e),Jp(r,Ip+"enter",Me),Jp(r,Ip+"leave",Se),Jp(r,Ip+"move",be),Z.isEnabled=Z.isPressed=Z.isDragging=!1,z&&z(Z))},Z.kill=Z.revert=function(){Z.disable();var e=Vp.indexOf(Z);e>=0&&Vp.splice(e,1),zp===Z&&(zp=0)},Vp.push(Z),R&&Xp(r)&&(zp=Z),Z.enable(d)},t=e,(n=[{key:"velocityX",get:function(){return this._vx.getVelocity()}},{key:"velocityY",get:function(){return this._vy.getVelocity()}}])&&Tp(t.prototype,n),i&&Tp(t,i),e}();cf.version="3.12.2",cf.create=function(e){return new cf(e)},cf.register=uf,cf.getAll=function(){return Vp.slice()},cf.getById=function(e){return Vp.filter((function(t){return t.vars.id===e}))[0]},kp()&&Ep.registerPlugin(cf);var hf,df,pf,ff,mf,gf,vf,_f,xf,yf,bf,Mf,Sf,wf,Tf,Ef,Af,Cf,Lf,Pf,Rf,Df,If,Of,Nf,zf,Uf,Ff,kf,Bf,Vf,Gf,Hf,qf,Wf,jf,Xf=1,Yf=Date.now,Jf=Yf(),Zf=0,Kf=0,Qf=function(e,t,n){var i=dm(e)&&("clamp("===e.substr(0,6)||e.indexOf("max")>-1);return n["_"+t+"Clamp"]=i,i?e.substr(6,e.length-7):e},$f=function(e,t){return!t||dm(e)&&"clamp("===e.substr(0,6)?e:"clamp("+e+")"},em=function e(){return Kf&&requestAnimationFrame(e)},tm=function(){return wf=1},nm=function(){return wf=0},im=function(e){return e},rm=function(e){return Math.round(1e5*e)/1e5||0},am=function(){return"undefined"!=typeof window},sm=function(){return hf||am()&&(hf=window.gsap)&&hf.registerPlugin&&hf},om=function(e){return!!~vf.indexOf(e)},lm=function(e){return("Height"===e?Vf:pf["inner"+e])||mf["client"+e]||gf["client"+e]},um=function(e){return jp(e,"getBoundingClientRect")||(om(e)?function(){return bg.width=pf.innerWidth,bg.height=Vf,bg}:function(){return Nm(e)})},cm=function(e,t){var n=t.s,i=t.d2,r=t.d,a=t.a;return Math.max(0,(a=jp(e,n="scroll"+i))?a()-um(e)()[r]:om(e)?(mf[n]||gf[n])-lm(i):e[n]-e["offset"+i])},hm=function(e,t){for(var n=0;n<Lf.length;n+=3)(!t||~t.indexOf(Lf[n+1]))&&e(Lf[n],Lf[n+1],Lf[n+2])},dm=function(e){return"string"==typeof e},pm=function(e){return"function"==typeof e},fm=function(e){return"number"==typeof e},mm=function(e){return"object"==typeof e},gm=function(e,t,n){return e&&e.progress(t?0:1)&&n&&e.pause()},vm=function(e,t){if(e.enabled){var n=t(e);n&&n.totalTime&&(e.callbackAnimation=n)}},_m=Math.abs,xm="left",ym="right",bm="bottom",Mm="width",Sm="height",wm="Right",Tm="Left",Em="Top",Am="Bottom",Cm="padding",Lm="margin",Pm="Width",Rm="Height",Dm="px",Im=function(e){return pf.getComputedStyle(e)},Om=function(e,t){for(var n in t)n in e||(e[n]=t[n]);return e},Nm=function(e,t){var n=t&&"matrix(1, 0, 0, 1, 0, 0)"!==Im(e)[Tf]&&hf.to(e,{x:0,y:0,xPercent:0,yPercent:0,rotation:0,rotationX:0,rotationY:0,scale:1,skewX:0,skewY:0}).progress(1),i=e.getBoundingClientRect();return n&&n.progress(0).kill(),i},zm=function(e,t){var n=t.d2;return e["offset"+n]||e["client"+n]||0},Um=function(e){var t,n=[],i=e.labels,r=e.duration();for(t in i)n.push(i[t]/r);return n},Fm=function(e){var t=hf.utils.snap(e),n=Array.isArray(e)&&e.slice(0).sort((function(e,t){return e-t}));return n?function(e,i,r){var a;if(void 0===r&&(r=.001),!i)return t(e);if(i>0){for(e-=r,a=0;a<n.length;a++)if(n[a]>=e)return n[a];return n[a-1]}for(a=n.length,e+=r;a--;)if(n[a]<=e)return n[a];return n[0]}:function(n,i,r){void 0===r&&(r=.001);var a=t(n);return!i||Math.abs(a-n)<r||a-n<0==i<0?a:t(i<0?n-e:n+e)}},km=function(e,t,n,i){return n.split(",").forEach((function(n){return e(t,n,i)}))},Bm=function(e,t,n,i,r){return e.addEventListener(t,n,{passive:!i,capture:!!r})},Vm=function(e,t,n,i){return e.removeEventListener(t,n,!!i)},Gm=function(e,t,n){(n=n&&n.wheelHandler)&&(e(t,"wheel",n),e(t,"touchmove",n))},Hm={startColor:"green",endColor:"red",indent:0,fontSize:"16px",fontWeight:"normal"},qm={toggleActions:"play",anticipatePin:0},Wm={top:0,left:0,center:.5,bottom:1,right:1},jm=function(e,t){if(dm(e)){var n=e.indexOf("="),i=~n?+(e.charAt(n-1)+1)*parseFloat(e.substr(n+1)):0;~n&&(e.indexOf("%")>n&&(i*=t/100),e=e.substr(0,n-1)),e=i+(e in Wm?Wm[e]*t:~e.indexOf("%")?parseFloat(e)*t/100:parseFloat(e)||0)}return e},Xm=function(e,t,n,i,r,a,s,o){var l=r.startColor,u=r.endColor,c=r.fontSize,h=r.indent,d=r.fontWeight,p=ff.createElement("div"),f=om(n)||"fixed"===jp(n,"pinType"),m=-1!==e.indexOf("scroller"),g=f?gf:n,v=-1!==e.indexOf("start"),_=v?l:u,x="border-color:"+_+";font-size:"+c+";color:"+_+";font-weight:"+d+";pointer-events:none;white-space:nowrap;font-family:sans-serif,Arial;z-index:1000;padding:4px 8px;border-width:0;border-style:solid;";return x+="position:"+((m||o)&&f?"fixed;":"absolute;"),(m||o||!f)&&(x+=(i===tf?ym:bm)+":"+(a+parseFloat(h))+"px;"),s&&(x+="box-sizing:border-box;text-align:left;width:"+s.offsetWidth+"px;"),p._isStart=v,p.setAttribute("class","gsap-marker-"+e+(t?" marker-"+t:"")),p.style.cssText=x,p.innerText=t||0===t?e+"-"+t:e,g.children[0]?g.insertBefore(p,g.children[0]):g.appendChild(p),p._offset=p["offset"+i.op.d2],Ym(p,0,i,v),p},Ym=function(e,t,n,i){var r={display:"block"},a=n[i?"os2":"p2"],s=n[i?"p2":"os2"];e._isFlipped=i,r[n.a+"Percent"]=i?-100:0,r[n.a]=i?"1px":0,r["border"+a+Pm]=1,r["border"+s+Pm]=0,r[n.p]=t+"px",hf.set(e,r)},Jm=[],Zm={},Km=function(){return Yf()-Zf>34&&(Hf||(Hf=requestAnimationFrame(fg)))},Qm=function(){(!If||!If.isPressed||If.startX>gf.clientWidth)&&(Gp.cache++,If?Hf||(Hf=requestAnimationFrame(fg)):fg(),Zf||rg("scrollStart"),Zf=Yf())},$m=function(){zf=pf.innerWidth,Nf=pf.innerHeight},eg=function(){Gp.cache++,!Sf&&!Df&&!ff.fullscreenElement&&!ff.webkitFullscreenElement&&(!Of||zf!==pf.innerWidth||Math.abs(pf.innerHeight-Nf)>.25*pf.innerHeight)&&_f.restart(!0)},tg={},ng=[],ig=function e(){return Vm(Cg,"scrollEnd",e)||hg(!0)},rg=function(e){return tg[e]&&tg[e].map((function(e){return e()}))||ng},ag=[],sg=function(e){for(var t=0;t<ag.length;t+=5)(!e||ag[t+4]&&ag[t+4].query===e)&&(ag[t].style.cssText=ag[t+1],ag[t].getBBox&&ag[t].setAttribute("transform",ag[t+2]||""),ag[t+3].uncache=1)},og=function(e,t){var n;for(Ef=0;Ef<Jm.length;Ef++)!(n=Jm[Ef])||t&&n._ctx!==t||(e?n.kill(1):n.revert(!0,!0));t&&sg(t),t||rg("revert")},lg=function(e,t){Gp.cache++,(t||!qf)&&Gp.forEach((function(e){return pm(e)&&e.cacheID++&&(e.rec=0)})),dm(e)&&(pf.history.scrollRestoration=kf=e)},ug=0,cg=function(){gf.appendChild(Bf),Vf=Bf.offsetHeight||pf.innerHeight,gf.removeChild(Bf)},hg=function(e,t){if(!Zf||e){cg(),qf=Cg.isRefreshing=!0,Gp.forEach((function(e){return pm(e)&&++e.cacheID&&(e.rec=e())}));var n=rg("refreshInit");Pf&&Cg.sort(),t||og(),Gp.forEach((function(e){pm(e)&&(e.smooth&&(e.target.style.scrollBehavior="auto"),e(0))})),Jm.slice(0).forEach((function(e){return e.refresh()})),Jm.forEach((function(e,t){if(e._subPinOffset&&e.pin){var n=e.vars.horizontal?"offsetWidth":"offsetHeight",i=e.pin[n];e.revert(!0,1),e.adjustPinSpacing(e.pin[n]-i),e.refresh()}})),Jm.forEach((function(e){var t=cm(e.scroller,e._dir);("max"===e.vars.end||e._endClamp&&e.end>t)&&e.setPositions(e.start,Math.max(e.start+1,t),!0)})),n.forEach((function(e){return e&&e.render&&e.render(-1)})),Gp.forEach((function(e){pm(e)&&(e.smooth&&requestAnimationFrame((function(){return e.target.style.scrollBehavior="smooth"})),e.rec&&e(e.rec))})),lg(kf,1),_f.pause(),ug++,qf=2,fg(2),Jm.forEach((function(e){return pm(e.vars.onRefresh)&&e.vars.onRefresh(e)})),qf=Cg.isRefreshing=!1,rg("refresh")}else Bm(Cg,"scrollEnd",ig)},dg=0,pg=1,fg=function(e){if(!qf||2===e){Cg.isUpdating=!0,jf&&jf.update(0);var t=Jm.length,n=Yf(),i=n-Jf>=50,r=t&&Jm[0].scroll();if(pg=dg>r?-1:1,qf||(dg=r),i&&(Zf&&!wf&&n-Zf>200&&(Zf=0,rg("scrollEnd")),bf=Jf,Jf=n),pg<0){for(Ef=t;Ef-- >0;)Jm[Ef]&&Jm[Ef].update(0,i);pg=1}else for(Ef=0;Ef<t;Ef++)Jm[Ef]&&Jm[Ef].update(0,i);Cg.isUpdating=!1}Hf=0},mg=[xm,"top",bm,ym,Lm+Am,Lm+wm,Lm+Em,Lm+Tm,"display","flexShrink","float","zIndex","gridColumnStart","gridColumnEnd","gridRowStart","gridRowEnd","gridArea","justifySelf","alignSelf","placeSelf","order"],gg=mg.concat([Mm,Sm,"boxSizing","max"+Pm,"max"+Rm,"position",Lm,Cm,Cm+Em,Cm+wm,Cm+Am,Cm+Tm]),vg=function(e,t,n,i){if(!e._gsap.swappedIn){for(var r,a=mg.length,s=t.style,o=e.style;a--;)s[r=mg[a]]=n[r];s.position="absolute"===n.position?"absolute":"relative","inline"===n.display&&(s.display="inline-block"),o[bm]=o[ym]="auto",s.flexBasis=n.flexBasis||"auto",s.overflow="visible",s.boxSizing="border-box",s[Mm]=zm(e,ef)+Dm,s[Sm]=zm(e,tf)+Dm,s[Cm]=o[Lm]=o.top=o[xm]="0",xg(i),o[Mm]=o["max"+Pm]=n[Mm],o[Sm]=o["max"+Rm]=n[Sm],o[Cm]=n[Cm],e.parentNode!==t&&(e.parentNode.insertBefore(t,e),t.appendChild(e)),e._gsap.swappedIn=!0}},_g=/([A-Z])/g,xg=function(e){if(e){var t,n,i=e.t.style,r=e.length,a=0;for((e.t._gsap||hf.core.getCache(e.t)).uncache=1;a<r;a+=2)n=e[a+1],t=e[a],n?i[t]=n:i[t]&&i.removeProperty(t.replace(_g,"-$1").toLowerCase())}},yg=function(e){for(var t=gg.length,n=e.style,i=[],r=0;r<t;r++)i.push(gg[r],n[gg[r]]);return i.t=e,i},bg={left:0,top:0},Mg=function(e,t,n,i,r,a,s,o,l,u,c,h,d,p){pm(e)&&(e=e(o)),dm(e)&&"max"===e.substr(0,3)&&(e=h+("="===e.charAt(4)?jm("0"+e.substr(3),n):0));var f,m,g,v=d?d.time():0;if(d&&d.seek(0),isNaN(e)||(e=+e),fm(e))d&&(e=hf.utils.mapRange(d.scrollTrigger.start,d.scrollTrigger.end,0,h,e)),s&&Ym(s,n,i,!0);else{pm(t)&&(t=t(o));var _,x,y,b,M=(e||"0").split(" ");g=nf(t,o)||gf,(_=Nm(g)||{})&&(_.left||_.top)||"none"!==Im(g).display||(b=g.style.display,g.style.display="block",_=Nm(g),b?g.style.display=b:g.style.removeProperty("display")),x=jm(M[0],_[i.d]),y=jm(M[1]||"0",n),e=_[i.p]-l[i.p]-u+x+r-y,s&&Ym(s,y,i,n-y<20||s._isStart&&y>20),n-=n-y}if(p&&(o[p]=e||-.001,e<0&&(e=0)),a){var S=e+n,w=a._isStart;f="scroll"+i.d2,Ym(a,S,i,w&&S>20||!w&&(c?Math.max(gf[f],mf[f]):a.parentNode[f])<=S+1),c&&(l=Nm(s),c&&(a.style[i.op.p]=l[i.op.p]-i.op.m-a._offset+Dm))}return d&&g&&(f=Nm(g),d.seek(h),m=Nm(g),d._caScrollDist=f[i.p]-m[i.p],e=e/d._caScrollDist*h),d&&d.seek(v),d?e:Math.round(e)},Sg=/(webkit|moz|length|cssText|inset)/i,wg=function(e,t,n,i){if(e.parentNode!==t){var r,a,s=e.style;if(t===gf){for(r in e._stOrig=s.cssText,a=Im(e))+r||Sg.test(r)||!a[r]||"string"!=typeof s[r]||"0"===r||(s[r]=a[r]);s.top=n,s.left=i}else s.cssText=e._stOrig;hf.core.getCache(e).uncache=1,t.appendChild(e)}},Tg=function(e,t,n){var i=t,r=i;return function(t){var a=Math.round(e());return a!==i&&a!==r&&Math.abs(a-i)>3&&Math.abs(a-r)>3&&(t=a,n&&n()),r=i,i=t,t}},Eg=function(e,t,n){var i={};i[t.p]="+="+n,hf.set(e,i)},Ag=function(e,t){var n=rf(e,t),i="_scroll"+t.p2,r=function t(r,a,s,o,l){var u=t.tween,c=a.onComplete,h={};s=s||n();var d=Tg(n,s,(function(){u.kill(),t.tween=0}));return l=o&&l||0,o=o||r-s,u&&u.kill(),a[i]=r,a.modifiers=h,h[i]=function(){return d(s+o*u.ratio+l*u.ratio*u.ratio)},a.onUpdate=function(){Gp.cache++,fg()},a.onComplete=function(){t.tween=0,c&&c.call(u)},u=t.tween=hf.to(e,a)};return e[i]=n,n.wheelHandler=function(){return r.tween&&r.tween.kill()&&(r.tween=0)},Bm(e,"wheel",n.wheelHandler),Cg.isTouch&&Bm(e,"touchmove",n.wheelHandler),r},Cg=function(){function e(t,n){df||e.register(hf)||console.warn("Please gsap.registerPlugin(ScrollTrigger)"),Ff(this),this.init(t,n)}return e.prototype.init=function(t,n){if(this.progress=this.start=0,this.vars&&this.kill(!0,!0),Kf){var i,r,a,s,o,l,u,c,h,d,p,f,m,g,v,_,x,y,b,M,S,w,T,E,A,C,L,P,R,D,I,O,N,z,U,F,k,B,V,G,H,q,W=t=Om(dm(t)||fm(t)||t.nodeType?{trigger:t}:t,qm),j=W.onUpdate,X=W.toggleClass,Y=W.id,J=W.onToggle,Z=W.onRefresh,K=W.scrub,Q=W.trigger,$=W.pin,ee=W.pinSpacing,te=W.invalidateOnRefresh,ne=W.anticipatePin,ie=W.onScrubComplete,re=W.onSnapComplete,ae=W.once,se=W.snap,oe=W.pinReparent,le=W.pinSpacer,ue=W.containerAnimation,ce=W.fastScrollEnd,he=W.preventOverlaps,de=t.horizontal||t.containerAnimation&&!1!==t.horizontal?ef:tf,pe=!K&&0!==K,fe=nf(t.scroller||pf),me=hf.core.getCache(fe),ge=om(fe),ve="fixed"===("pinType"in t?t.pinType:jp(fe,"pinType")||ge&&"fixed"),_e=[t.onEnter,t.onLeave,t.onEnterBack,t.onLeaveBack],xe=pe&&t.toggleActions.split(" "),ye="markers"in t?t.markers:qm.markers,be=ge?0:parseFloat(Im(fe)["border"+de.p2+Pm])||0,Me=this,Se=t.onRefreshInit&&function(){return t.onRefreshInit(Me)},we=function(e,t,n){var i=n.d,r=n.d2,a=n.a;return(a=jp(e,"getBoundingClientRect"))?function(){return a()[i]}:function(){return(t?lm(r):e["client"+r])||0}}(fe,ge,de),Te=function(e,t){return!t||~Hp.indexOf(e)?um(e):function(){return bg}}(fe,ge),Ee=0,Ae=0,Ce=0,Le=rf(fe,de);if(Me._startClamp=Me._endClamp=!1,Me._dir=de,ne*=45,Me.scroller=fe,Me.scroll=ue?ue.time.bind(ue):Le,s=Le(),Me.vars=t,n=n||t.animation,"refreshPriority"in t&&(Pf=1,-9999===t.refreshPriority&&(jf=Me)),me.tweenScroll=me.tweenScroll||{top:Ag(fe,tf),left:Ag(fe,ef)},Me.tweenTo=i=me.tweenScroll[de.p],Me.scrubDuration=function(e){(N=fm(e)&&e)?O?O.duration(e):O=hf.to(n,{ease:"expo",totalProgress:"+=0",duration:N,paused:!0,onComplete:function(){return ie&&ie(Me)}}):(O&&O.progress(1).kill(),O=0)},n&&(n.vars.lazy=!1,n._initted&&!Me.isReverted||!1!==n.vars.immediateRender&&!1!==t.immediateRender&&n.duration()&&n.render(0,!0,!0),Me.animation=n.pause(),n.scrollTrigger=Me,Me.scrubDuration(K),D=0,Y||(Y=n.vars.id)),se&&(mm(se)&&!se.push||(se={snapTo:se}),"scrollBehavior"in gf.style&&hf.set(ge?[gf,mf]:fe,{scrollBehavior:"auto"}),Gp.forEach((function(e){return pm(e)&&e.target===(ge?ff.scrollingElement||mf:fe)&&(e.smooth=!1)})),a=pm(se.snapTo)?se.snapTo:"labels"===se.snapTo?function(e){return function(t){return hf.utils.snap(Um(e),t)}}(n):"labelsDirectional"===se.snapTo?(G=n,function(e,t){return Fm(Um(G))(e,t.direction)}):!1!==se.directional?function(e,t){return Fm(se.snapTo)(e,Yf()-Ae<500?0:t.direction)}:hf.utils.snap(se.snapTo),z=se.duration||{min:.1,max:2},z=mm(z)?yf(z.min,z.max):yf(z,z),U=hf.delayedCall(se.delay||N/2||.1,(function(){var e=Le(),t=Yf()-Ae<500,r=i.tween;if(!(t||Math.abs(Me.getVelocity())<10)||r||wf||Ee===e)Me.isActive&&Ee!==e&&U.restart(!0);else{var s=(e-l)/g,o=n&&!pe?n.totalProgress():s,c=t?0:(o-I)/(Yf()-bf)*1e3||0,h=hf.utils.clamp(-s,1-s,_m(c/2)*c/.185),d=s+(!1===se.inertia?0:h),p=yf(0,1,a(d,Me)),f=Math.round(l+p*g),m=se,v=m.onStart,_=m.onInterrupt,x=m.onComplete;if(e<=u&&e>=l&&f!==e){if(r&&!r._initted&&r.data<=_m(f-e))return;!1===se.inertia&&(h=p-s),i(f,{duration:z(_m(.185*Math.max(_m(d-o),_m(p-o))/c/.05||0)),ease:se.ease||"power3",data:_m(f-e),onInterrupt:function(){return U.restart(!0)&&_&&_(Me)},onComplete:function(){Me.update(),Ee=Le(),D=I=n&&!pe?n.totalProgress():Me.progress,re&&re(Me),x&&x(Me)}},e,h*g,f-e-h*g),v&&v(Me,i.tween)}}})).pause()),Y&&(Zm[Y]=Me),(V=(Q=Me.trigger=nf(Q||!0!==$&&$))&&Q._gsap&&Q._gsap.stRevert)&&(V=V(Me)),$=!0===$?Q:nf($),dm(X)&&(X={targets:Q,className:X}),$&&(!1===ee||ee===Lm||(ee=!(!ee&&$.parentNode&&$.parentNode.style&&"flex"===Im($.parentNode).display)&&Cm),Me.pin=$,(r=hf.core.getCache($)).spacer?v=r.pinState:(le&&((le=nf(le))&&!le.nodeType&&(le=le.current||le.nativeElement),r.spacerIsNative=!!le,le&&(r.spacerState=yg(le))),r.spacer=y=le||ff.createElement("div"),y.classList.add("pin-spacer"),Y&&y.classList.add("pin-spacer-"+Y),r.pinState=v=yg($)),!1!==t.force3D&&hf.set($,{force3D:!0}),Me.spacer=y=r.spacer,R=Im($),E=R[ee+de.os2],M=hf.getProperty($),S=hf.quickSetter($,de.a,Dm),vg($,y,R),x=yg($)),ye){f=mm(ye)?Om(ye,Hm):Hm,d=Xm("scroller-start",Y,fe,de,f,0),p=Xm("scroller-end",Y,fe,de,f,0,d),b=d["offset"+de.op.d2];var Pe=nf(jp(fe,"content")||fe);c=this.markerStart=Xm("start",Y,Pe,de,f,b,0,ue),h=this.markerEnd=Xm("end",Y,Pe,de,f,b,0,ue),ue&&(B=hf.quickSetter([c,h],de.a,Dm)),ve||Hp.length&&!0===jp(fe,"fixedMarkers")||(q=Im(H=ge?gf:fe).position,H.style.position="absolute"===q||"fixed"===q?q:"relative",hf.set([d,p],{force3D:!0}),C=hf.quickSetter(d,de.a,Dm),P=hf.quickSetter(p,de.a,Dm))}if(ue){var Re=ue.vars.onUpdate,De=ue.vars.onUpdateParams;ue.eventCallback("onUpdate",(function(){Me.update(0,0,1),Re&&Re.apply(ue,De||[])}))}if(Me.previous=function(){return Jm[Jm.indexOf(Me)-1]},Me.next=function(){return Jm[Jm.indexOf(Me)+1]},Me.revert=function(e,t){if(!t)return Me.kill(!0);var i=!1!==e||!Me.enabled,r=Sf;i!==Me.isReverted&&(i&&(F=Math.max(Le(),Me.scroll.rec||0),Ce=Me.progress,k=n&&n.progress()),c&&[c,h,d,p].forEach((function(e){return e.style.display=i?"none":"block"})),i&&(Sf=Me,Me.update(i)),!$||oe&&Me.isActive||(i?function(e,t,n){xg(n);var i=e._gsap;if(i.spacerIsNative)xg(i.spacerState);else if(e._gsap.swappedIn){var r=t.parentNode;r&&(r.insertBefore(e,t),r.removeChild(t))}e._gsap.swappedIn=!1}($,y,v):vg($,y,Im($),A)),i||Me.update(i),Sf=r,Me.isReverted=i)},Me.refresh=function(r,a,f,b){if(!Sf&&Me.enabled||a)if($&&r&&Zf)Bm(e,"scrollEnd",ig);else{!qf&&Se&&Se(Me),Sf=Me,i.tween&&!f&&(i.tween.kill(),i.tween=0),O&&O.pause(),te&&n&&n.revert({kill:!1}).invalidate(),Me.isReverted||Me.revert(!0,!0),Me._subPinOffset=!1;var S,E,C,P,R,D,I,N,z,B,V,G,H,q=we(),W=Te(),j=ue?ue.duration():cm(fe,de),X=g<=.01,Y=0,J=b||0,K=mm(f)?f.end:t.end,ne=t.endTrigger||Q,ie=mm(f)?f.start:t.start||(0!==t.start&&Q?$?"0 0":"0 100%":0),re=Me.pinnedContainer=t.pinnedContainer&&nf(t.pinnedContainer,Me),ae=Q&&Math.max(0,Jm.indexOf(Me))||0,se=ae;for(ye&&mm(f)&&(G=hf.getProperty(d,de.p),H=hf.getProperty(p,de.p));se--;)(D=Jm[se]).end||D.refresh(0,1)||(Sf=Me),!(I=D.pin)||I!==Q&&I!==$&&I!==re||D.isReverted||(B||(B=[]),B.unshift(D),D.revert(!0,!0)),D!==Jm[se]&&(ae--,se--);for(pm(ie)&&(ie=ie(Me)),ie=Qf(ie,"start",Me),l=Mg(ie,Q,q,de,Le(),c,d,Me,W,be,ve,j,ue,Me._startClamp&&"_startClamp")||($?-.001:0),pm(K)&&(K=K(Me)),dm(K)&&!K.indexOf("+=")&&(~K.indexOf(" ")?K=(dm(ie)?ie.split(" ")[0]:"")+K:(Y=jm(K.substr(2),q),K=dm(ie)?ie:(ue?hf.utils.mapRange(0,ue.duration(),ue.scrollTrigger.start,ue.scrollTrigger.end,l):l)+Y,ne=Q)),K=Qf(K,"end",Me),u=Math.max(l,Mg(K||(ne?"100% 0":j),ne,q,de,Le()+Y,h,p,Me,W,be,ve,j,ue,Me._endClamp&&"_endClamp"))||-.001,Y=0,se=ae;se--;)(I=(D=Jm[se]).pin)&&D.start-D._pinPush<=l&&!ue&&D.end>0&&(S=D.end-(Me._startClamp?Math.max(0,D.start):D.start),(I===Q&&D.start-D._pinPush<l||I===re)&&isNaN(ie)&&(Y+=S*(1-D.progress)),I===$&&(J+=S));if(l+=Y,u+=Y,Me._startClamp&&(Me._startClamp+=Y),Me._endClamp&&!qf&&(Me._endClamp=u||-.001,u=Math.min(u,cm(fe,de))),g=u-l||(l-=.01)&&.001,X&&(Ce=hf.utils.clamp(0,1,hf.utils.normalize(l,u,F))),Me._pinPush=J,c&&Y&&((S={})[de.a]="+="+Y,re&&(S[de.p]="-="+Le()),hf.set([c,h],S)),$)S=Im($),P=de===tf,C=Le(),w=parseFloat(M(de.a))+J,!j&&u>1&&(V={style:V=(ge?ff.scrollingElement||mf:fe).style,value:V["overflow"+de.a.toUpperCase()]},ge&&"scroll"!==Im(gf)["overflow"+de.a.toUpperCase()]&&(V.style["overflow"+de.a.toUpperCase()]="scroll")),vg($,y,S),x=yg($),E=Nm($,!0),N=ve&&rf(fe,P?ef:tf)(),ee&&((A=[ee+de.os2,g+J+Dm]).t=y,(se=ee===Cm?zm($,de)+g+J:0)&&A.push(de.d,se+Dm),xg(A),re&&Jm.forEach((function(e){e.pin===re&&!1!==e.vars.pinSpacing&&(e._subPinOffset=!0)})),ve&&Le(F)),ve&&((R={top:E.top+(P?C-l:N)+Dm,left:E.left+(P?N:C-l)+Dm,boxSizing:"border-box",position:"fixed"})[Mm]=R["max"+Pm]=Math.ceil(E.width)+Dm,R[Sm]=R["max"+Rm]=Math.ceil(E.height)+Dm,R[Lm]=R[Lm+Em]=R[Lm+wm]=R[Lm+Am]=R[Lm+Tm]="0",R[Cm]=S[Cm],R[Cm+Em]=S[Cm+Em],R[Cm+wm]=S[Cm+wm],R[Cm+Am]=S[Cm+Am],R[Cm+Tm]=S[Cm+Tm],_=function(e,t,n){for(var i,r=[],a=e.length,s=n?8:0;s<a;s+=2)i=e[s],r.push(i,i in t?t[i]:e[s+1]);return r.t=e.t,r}(v,R,oe),qf&&Le(0)),n?(z=n._initted,Rf(1),n.render(n.duration(),!0,!0),T=M(de.a)-w+g+J,L=Math.abs(g-T)>1,ve&&L&&_.splice(_.length-2,2),n.render(0,!0,!0),z||n.invalidate(!0),n.parent||n.totalTime(n.totalTime()),Rf(0)):T=g,V&&(V.value?V.style["overflow"+de.a.toUpperCase()]=V.value:V.style.removeProperty("overflow-"+de.a));else if(Q&&Le()&&!ue)for(E=Q.parentNode;E&&E!==gf;)E._pinOffset&&(l-=E._pinOffset,u-=E._pinOffset),E=E.parentNode;B&&B.forEach((function(e){return e.revert(!1,!0)})),Me.start=l,Me.end=u,s=o=qf?F:Le(),ue||qf||(s<F&&Le(F),Me.scroll.rec=0),Me.revert(!1,!0),Ae=Yf(),U&&(Ee=-1,U.restart(!0)),Sf=0,n&&pe&&(n._initted||k)&&n.progress()!==k&&n.progress(k||0,!0).render(n.time(),!0,!0),(X||Ce!==Me.progress||ue)&&(n&&!pe&&n.totalProgress(ue&&l<-.001&&!Ce?hf.utils.normalize(l,u,0):Ce,!0),Me.progress=X||(s-l)/g===Ce?0:Ce),$&&ee&&(y._pinOffset=Math.round(Me.progress*T)),O&&O.invalidate(),isNaN(G)||(G-=hf.getProperty(d,de.p),H-=hf.getProperty(p,de.p),Eg(d,de,G),Eg(c,de,G-(b||0)),Eg(p,de,H),Eg(h,de,H-(b||0))),X&&!qf&&Me.update(),!Z||qf||m||(m=!0,Z(Me),m=!1)}},Me.getVelocity=function(){return(Le()-o)/(Yf()-bf)*1e3||0},Me.endAnimation=function(){gm(Me.callbackAnimation),n&&(O?O.progress(1):n.paused()?pe||gm(n,Me.direction<0,1):gm(n,n.reversed()))},Me.labelToScroll=function(e){return n&&n.labels&&(l||Me.refresh()||l)+n.labels[e]/n.duration()*g||0},Me.getTrailing=function(e){var t=Jm.indexOf(Me),n=Me.direction>0?Jm.slice(0,t).reverse():Jm.slice(t+1);return(dm(e)?n.filter((function(t){return t.vars.preventOverlaps===e})):n).filter((function(e){return Me.direction>0?e.end<=l:e.start>=u}))},Me.update=function(e,t,r){if(!ue||r||e){var a,c,h,p,f,m,v,b=!0===qf?F:Me.scroll(),M=e?0:(b-l)/g,A=M<0?0:M>1?1:M||0,R=Me.progress;if(t&&(o=s,s=ue?Le():b,se&&(I=D,D=n&&!pe?n.totalProgress():A)),ne&&!A&&$&&!Sf&&!Xf&&Zf&&l<b+(b-o)/(Yf()-bf)*ne&&(A=1e-4),A!==R&&Me.enabled){if(p=(f=(a=Me.isActive=!!A&&A<1)!==(!!R&&R<1))||!!A!=!!R,Me.direction=A>R?1:-1,Me.progress=A,p&&!Sf&&(c=A&&!R?0:1===A?1:1===R?2:3,pe&&(h=!f&&"none"!==xe[c+1]&&xe[c+1]||xe[c],v=n&&("complete"===h||"reset"===h||h in n))),he&&(f||v)&&(v||K||!n)&&(pm(he)?he(Me):Me.getTrailing(he).forEach((function(e){return e.endAnimation()}))),pe||(!O||Sf||Xf?n&&n.totalProgress(A,!(!Sf||!Ae&&!e)):(O._dp._time-O._start!==O._time&&O.render(O._dp._time-O._start),O.resetTo?O.resetTo("totalProgress",A,n._tTime/n._tDur):(O.vars.totalProgress=A,O.invalidate().restart()))),$)if(e&&ee&&(y.style[ee+de.os2]=E),ve){if(p){if(m=!e&&A>R&&u+1>b&&b+1>=cm(fe,de),oe)if(e||!a&&!m)wg($,y);else{var N=Nm($,!0),z=b-l;wg($,gf,N.top+(de===tf?z:0)+Dm,N.left+(de===tf?0:z)+Dm)}xg(a||m?_:x),L&&A<1&&a||S(w+(1!==A||m?0:T))}}else S(rm(w+T*A));se&&!i.tween&&!Sf&&!Xf&&U.restart(!0),X&&(f||ae&&A&&(A<1||!Gf))&&xf(X.targets).forEach((function(e){return e.classList[a||ae?"add":"remove"](X.className)})),j&&!pe&&!e&&j(Me),p&&!Sf?(pe&&(v&&("complete"===h?n.pause().totalProgress(1):"reset"===h?n.restart(!0).pause():"restart"===h?n.restart(!0):n[h]()),j&&j(Me)),!f&&Gf||(J&&f&&vm(Me,J),_e[c]&&vm(Me,_e[c]),ae&&(1===A?Me.kill(!1,1):_e[c]=0),f||_e[c=1===A?1:3]&&vm(Me,_e[c])),ce&&!a&&Math.abs(Me.getVelocity())>(fm(ce)?ce:2500)&&(gm(Me.callbackAnimation),O?O.progress(1):gm(n,"reverse"===h?1:!A,1))):pe&&j&&!Sf&&j(Me)}if(P){var k=ue?b/ue.duration()*(ue._caScrollDist||0):b;C(k+(d._isFlipped?1:0)),P(k)}B&&B(-b/ue.duration()*(ue._caScrollDist||0))}},Me.enable=function(t,n){Me.enabled||(Me.enabled=!0,Bm(fe,"resize",eg),ge||Bm(fe,"scroll",Qm),Se&&Bm(e,"refreshInit",Se),!1!==t&&(Me.progress=Ce=0,s=o=Ee=Le()),!1!==n&&Me.refresh())},Me.getTween=function(e){return e&&i?i.tween:O},Me.setPositions=function(e,t,n,i){if(ue){var r=ue.scrollTrigger,a=ue.duration(),s=r.end-r.start;e=r.start+s*e/a,t=r.start+s*t/a}Me.refresh(!1,!1,{start:$f(e,n&&!!Me._startClamp),end:$f(t,n&&!!Me._endClamp)},i),Me.update()},Me.adjustPinSpacing=function(e){if(A&&e){var t=A.indexOf(de.d)+1;A[t]=parseFloat(A[t])+e+Dm,A[1]=parseFloat(A[1])+e+Dm,xg(A)}},Me.disable=function(t,n){if(Me.enabled&&(!1!==t&&Me.revert(!0,!0),Me.enabled=Me.isActive=!1,n||O&&O.pause(),F=0,r&&(r.uncache=1),Se&&Vm(e,"refreshInit",Se),U&&(U.pause(),i.tween&&i.tween.kill()&&(i.tween=0)),!ge)){for(var a=Jm.length;a--;)if(Jm[a].scroller===fe&&Jm[a]!==Me)return;Vm(fe,"resize",eg),ge||Vm(fe,"scroll",Qm)}},Me.kill=function(e,i){Me.disable(e,i),O&&!i&&O.kill(),Y&&delete Zm[Y];var a=Jm.indexOf(Me);a>=0&&Jm.splice(a,1),a===Ef&&pg>0&&Ef--,a=0,Jm.forEach((function(e){return e.scroller===Me.scroller&&(a=1)})),a||qf||(Me.scroll.rec=0),n&&(n.scrollTrigger=null,e&&n.revert({kill:!1}),i||n.kill()),c&&[c,h,d,p].forEach((function(e){return e.parentNode&&e.parentNode.removeChild(e)})),jf===Me&&(jf=0),$&&(r&&(r.uncache=1),a=0,Jm.forEach((function(e){return e.pin===$&&a++})),a||(r.spacer=0)),t.onKill&&t.onKill(Me)},Jm.push(Me),Me.enable(!1,!1),V&&V(Me),n&&n.add&&!g){var Ie=Me.update;Me.update=function(){Me.update=Ie,l||u||Me.refresh()},hf.delayedCall(.01,Me.update),g=.01,l=u=0}else Me.refresh();$&&function(){if(Wf!==ug){var e=Wf=ug;requestAnimationFrame((function(){return e===ug&&hg(!0)}))}}()}else this.update=this.refresh=this.kill=im},e.register=function(t){return df||(hf=t||sm(),am()&&window.document&&e.enable(),df=Kf),df},e.defaults=function(e){if(e)for(var t in e)qm[t]=e[t];return qm},e.disable=function(e,t){Kf=0,Jm.forEach((function(n){return n[t?"kill":"disable"](e)})),Vm(pf,"wheel",Qm),Vm(ff,"scroll",Qm),clearInterval(Mf),Vm(ff,"touchcancel",im),Vm(gf,"touchstart",im),km(Vm,ff,"pointerdown,touchstart,mousedown",tm),km(Vm,ff,"pointerup,touchend,mouseup",nm),_f.kill(),hm(Vm);for(var n=0;n<Gp.length;n+=3)Gm(Vm,Gp[n],Gp[n+1]),Gm(Vm,Gp[n],Gp[n+2])},e.enable=function(){if(pf=window,ff=document,mf=ff.documentElement,gf=ff.body,hf&&(xf=hf.utils.toArray,yf=hf.utils.clamp,Ff=hf.core.context||im,Rf=hf.core.suppressOverwrites||im,kf=pf.history.scrollRestoration||"auto",dg=pf.pageYOffset,hf.core.globals("ScrollTrigger",e),gf)){Kf=1,(Bf=document.createElement("div")).style.height="100vh",Bf.style.position="absolute",cg(),em(),cf.register(hf),e.isTouch=cf.isTouch,Uf=cf.isTouch&&/(iPad|iPhone|iPod|Mac)/g.test(navigator.userAgent),Bm(pf,"wheel",Qm),vf=[pf,ff,mf,gf],hf.matchMedia?(e.matchMedia=function(e){var t,n=hf.matchMedia();for(t in e)n.add(t,e[t]);return n},hf.addEventListener("matchMediaInit",(function(){return og()})),hf.addEventListener("matchMediaRevert",(function(){return sg()})),hf.addEventListener("matchMedia",(function(){hg(0,1),rg("matchMedia")})),hf.matchMedia("(orientation: portrait)",(function(){return $m(),$m}))):console.warn("Requires GSAP 3.11.0 or later"),$m(),Bm(ff,"scroll",Qm);var t,n,i=gf.style,r=i.borderTopStyle,a=hf.core.Animation.prototype;for(a.revert||Object.defineProperty(a,"revert",{value:function(){return this.time(-.01,!0)}}),i.borderTopStyle="solid",t=Nm(gf),tf.m=Math.round(t.top+tf.sc())||0,ef.m=Math.round(t.left+ef.sc())||0,r?i.borderTopStyle=r:i.removeProperty("border-top-style"),Mf=setInterval(Km,250),hf.delayedCall(.5,(function(){return Xf=0})),Bm(ff,"touchcancel",im),Bm(gf,"touchstart",im),km(Bm,ff,"pointerdown,touchstart,mousedown",tm),km(Bm,ff,"pointerup,touchend,mouseup",nm),Tf=hf.utils.checkPrefix("transform"),gg.push(Tf),df=Yf(),_f=hf.delayedCall(.2,hg).pause(),Lf=[ff,"visibilitychange",function(){var e=pf.innerWidth,t=pf.innerHeight;ff.hidden?(Af=e,Cf=t):Af===e&&Cf===t||eg()},ff,"DOMContentLoaded",hg,pf,"load",hg,pf,"resize",eg],hm(Bm),Jm.forEach((function(e){return e.enable(0,1)})),n=0;n<Gp.length;n+=3)Gm(Vm,Gp[n],Gp[n+1]),Gm(Vm,Gp[n],Gp[n+2])}},e.config=function(t){"limitCallbacks"in t&&(Gf=!!t.limitCallbacks);var n=t.syncInterval;n&&clearInterval(Mf)||(Mf=n)&&setInterval(Km,n),"ignoreMobileResize"in t&&(Of=1===e.isTouch&&t.ignoreMobileResize),"autoRefreshEvents"in t&&(hm(Vm)||hm(Bm,t.autoRefreshEvents||"none"),Df=-1===(t.autoRefreshEvents+"").indexOf("resize"))},e.scrollerProxy=function(e,t){var n=nf(e),i=Gp.indexOf(n),r=om(n);~i&&Gp.splice(i,r?6:2),t&&(r?Hp.unshift(pf,t,gf,t,mf,t):Hp.unshift(n,t))},e.clearMatchMedia=function(e){Jm.forEach((function(t){return t._ctx&&t._ctx.query===e&&t._ctx.kill(!0,!0)}))},e.isInViewport=function(e,t,n){var i=(dm(e)?nf(e):e).getBoundingClientRect(),r=i[n?Mm:Sm]*t||0;return n?i.right-r>0&&i.left+r<pf.innerWidth:i.bottom-r>0&&i.top+r<pf.innerHeight},e.positionInViewport=function(e,t,n){dm(e)&&(e=nf(e));var i=e.getBoundingClientRect(),r=i[n?Mm:Sm],a=null==t?r/2:t in Wm?Wm[t]*r:~t.indexOf("%")?parseFloat(t)*r/100:parseFloat(t)||0;return n?(i.left+a)/pf.innerWidth:(i.top+a)/pf.innerHeight},e.killAll=function(e){if(Jm.slice(0).forEach((function(e){return"ScrollSmoother"!==e.vars.id&&e.kill()})),!0!==e){var t=tg.killAll||[];tg={},t.forEach((function(e){return e()}))}},e}();Cg.version="3.12.2",Cg.saveStyles=function(e){return e?xf(e).forEach((function(e){if(e&&e.style){var t=ag.indexOf(e);t>=0&&ag.splice(t,5),ag.push(e,e.style.cssText,e.getBBox&&e.getAttribute("transform"),hf.core.getCache(e),Ff())}})):ag},Cg.revert=function(e,t){return og(!e,t)},Cg.create=function(e,t){return new Cg(e,t)},Cg.refresh=function(e){return e?eg():(df||Cg.register())&&hg(!0)},Cg.update=function(e){return++Gp.cache&&fg(!0===e?2:0)},Cg.clearScrollMemory=lg,Cg.maxScroll=function(e,t){return cm(e,t?ef:tf)},Cg.getScrollFunc=function(e,t){return rf(nf(e),t?ef:tf)},Cg.getById=function(e){return Zm[e]},Cg.getAll=function(){return Jm.filter((function(e){return"ScrollSmoother"!==e.vars.id}))},Cg.isScrolling=function(){return!!Zf},Cg.snapDirectional=Fm,Cg.addEventListener=function(e,t){var n=tg[e]||(tg[e]=[]);~n.indexOf(t)||n.push(t)},Cg.removeEventListener=function(e,t){var n=tg[e],i=n&&n.indexOf(t);i>=0&&n.splice(i,1)},Cg.batch=function(e,t){var n,i=[],r={},a=t.interval||.016,s=t.batchMax||1e9,o=function(e,t){var n=[],i=[],r=hf.delayedCall(a,(function(){t(n,i),n=[],i=[]})).pause();return function(e){n.length||r.restart(!0),n.push(e.trigger),i.push(e),s<=n.length&&r.progress(1)}};for(n in t)r[n]="on"===n.substr(0,2)&&pm(t[n])&&"onRefreshInit"!==n?o(0,t[n]):t[n];return pm(s)&&(s=s(),Bm(Cg,"refresh",(function(){return s=t.batchMax()}))),xf(e).forEach((function(e){var t={};for(n in r)t[n]=r[n];t.trigger=e,i.push(Cg.create(t))})),i};var Lg,Pg=function(e,t,n,i){return t>i?e(i):t<0&&e(0),n>i?(i-t)/(n-t):n<0?t/(t-n):1},Rg=function e(t,n){!0===n?t.style.removeProperty("touch-action"):t.style.touchAction=!0===n?"auto":n?"pan-"+n+(cf.isTouch?" pinch-zoom":""):"none",t===mf&&e(gf,n)},Dg={auto:1,scroll:1},Ig=function(e){var t,n=e.event,i=e.target,r=e.axis,a=(n.changedTouches?n.changedTouches[0]:n).target,s=a._gsap||hf.core.getCache(a),o=Yf();if(!s._isScrollT||o-s._isScrollT>2e3){for(;a&&a!==gf&&(a.scrollHeight<=a.clientHeight&&a.scrollWidth<=a.clientWidth||!Dg[(t=Im(a)).overflowY]&&!Dg[t.overflowX]);)a=a.parentNode;s._isScroll=a&&a!==i&&!om(a)&&(Dg[(t=Im(a)).overflowY]||Dg[t.overflowX]),s._isScrollT=o}(s._isScroll||"x"===r)&&(n.stopPropagation(),n._gsapAllow=!0)},Og=function(e,t,n,i){return cf.create({target:e,capture:!0,debounce:!1,lockAxis:!0,type:t,onWheel:i=i&&Ig,onPress:i,onDrag:i,onScroll:i,onEnable:function(){return n&&Bm(ff,cf.eventTypes[0],zg,!1,!0)},onDisable:function(){return Vm(ff,cf.eventTypes[0],zg,!0)}})},Ng=/(input|label|select|textarea)/i,zg=function(e){var t=Ng.test(e.target.tagName);(t||Lg)&&(e._gsapAllow=!0,Lg=t)},Ug=function(e){mm(e)||(e={}),e.preventDefault=e.isNormalizer=e.allowClicks=!0,e.type||(e.type="wheel,touch"),e.debounce=!!e.debounce,e.id=e.id||"normalizer";var t,n,i,r,a,s,o,l,u=e,c=u.normalizeScrollX,h=u.momentum,d=u.allowNestedScroll,p=u.onRelease,f=nf(e.target)||mf,m=hf.core.globals().ScrollSmoother,g=m&&m.get(),v=Uf&&(e.content&&nf(e.content)||g&&!1!==e.content&&!g.smooth()&&g.content()),_=rf(f,tf),x=rf(f,ef),y=1,b=(cf.isTouch&&pf.visualViewport?pf.visualViewport.scale*pf.visualViewport.width:pf.outerWidth)/pf.innerWidth,M=0,S=pm(h)?function(){return h(t)}:function(){return h||2.8},w=Og(f,e.type,!0,d),T=function(){return r=!1},E=im,A=im,C=function(){n=cm(f,tf),A=yf(Uf?1:0,n),c&&(E=yf(0,cm(f,ef))),i=ug},L=function(){v._gsap.y=rm(parseFloat(v._gsap.y)+_.offset)+"px",v.style.transform="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, "+parseFloat(v._gsap.y)+", 0, 1)",_.offset=_.cacheID=0},P=function(){C(),a.isActive()&&a.vars.scrollY>n&&(_()>n?a.progress(1)&&_(n):a.resetTo("scrollY",n))};return v&&hf.set(v,{y:"+=0"}),e.ignoreCheck=function(e){return Uf&&"touchmove"===e.type&&function(){if(r){requestAnimationFrame(T);var e=rm(t.deltaY/2),n=A(_.v-e);if(v&&n!==_.v+_.offset){_.offset=n-_.v;var i=rm((parseFloat(v&&v._gsap.y)||0)-_.offset);v.style.transform="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, "+i+", 0, 1)",v._gsap.y=i+"px",_.cacheID=Gp.cache,fg()}return!0}_.offset&&L(),r=!0}()||y>1.05&&"touchstart"!==e.type||t.isGesturing||e.touches&&e.touches.length>1},e.onPress=function(){r=!1;var e=y;y=rm((pf.visualViewport&&pf.visualViewport.scale||1)/b),a.pause(),e!==y&&Rg(f,y>1.01||!c&&"x"),s=x(),o=_(),C(),i=ug},e.onRelease=e.onGestureStart=function(e,t){if(_.offset&&L(),t){Gp.cache++;var i,r,s=S();c&&(r=(i=x())+.05*s*-e.velocityX/.227,s*=Pg(x,i,r,cm(f,ef)),a.vars.scrollX=E(r)),r=(i=_())+.05*s*-e.velocityY/.227,s*=Pg(_,i,r,cm(f,tf)),a.vars.scrollY=A(r),a.invalidate().duration(s).play(.01),(Uf&&a.vars.scrollY>=n||i>=n-1)&&hf.to({},{onUpdate:P,duration:s})}else l.restart(!0);p&&p(e)},e.onWheel=function(){a._ts&&a.pause(),Yf()-M>1e3&&(i=0,M=Yf())},e.onChange=function(e,t,n,r,a){if(ug!==i&&C(),t&&c&&x(E(r[2]===t?s+(e.startX-e.x):x()+t-r[1])),n){_.offset&&L();var l=a[2]===n,u=l?o+e.startY-e.y:_()+n-a[1],h=A(u);l&&u!==h&&(o+=h-u),_(h)}(n||t)&&fg()},e.onEnable=function(){Rg(f,!c&&"x"),Cg.addEventListener("refresh",P),Bm(pf,"resize",P),_.smooth&&(_.target.style.scrollBehavior="auto",_.smooth=x.smooth=!1),w.enable()},e.onDisable=function(){Rg(f,!0),Vm(pf,"resize",P),Cg.removeEventListener("refresh",P),w.kill()},e.lockAxis=!1!==e.lockAxis,(t=new cf(e)).iOS=Uf,Uf&&!_()&&_(1),Uf&&hf.ticker.add(im),l=t._dc,a=hf.to(t,{ease:"power4",paused:!0,scrollX:c?"+=0.1":"+=0",scrollY:"+=0.1",modifiers:{scrollY:Tg(_,_(),(function(){return a.pause()}))},onUpdate:fg,onComplete:l.vars.onComplete}),t};Cg.sort=function(e){return Jm.sort(e||function(e,t){return-1e6*(e.vars.refreshPriority||0)+e.start-(t.start+-1e6*(t.vars.refreshPriority||0))})},Cg.observe=function(e){return new cf(e)},Cg.normalizeScroll=function(e){if(void 0===e)return If;if(!0===e&&If)return If.enable();if(!1===e)return If&&If.kill();var t=e instanceof cf?e:Ug(e);return If&&If.target===t.target&&If.kill(),om(t.target)&&(If=t),t},Cg.core={_getVelocityProp:af,_inputObserver:Og,_scrollers:Gp,_proxies:Hp,bridge:{ss:function(){Zf||rg("scrollStart"),Zf=Yf()},ref:function(){return Sf}}},sm()&&hf.registerPlugin(Cg);var Fg={};Fg=JSON.parse("{\"forewordTitle\":\"Je ne suis pas ton fantasme orientaliste\",\"foreword1paragraph\":\"En t 2020, apparat une tendance nomme #NorthAfricanTakeOver sur Twitter. Cette dernire avait pour but de clbrer dans toute sa diversit la beaut maghrbine, trop souvent occulte dans les mdias traditionnels puisqu'elle ne correspond pas ncessairement aux standards occidentaux. J'avais dcid d'y participer en postant une de mes photos. Parmi quelques compliments et une flope de ractions xnophobes, un message se voulant compliment un peu coquin, mais qui s'avre surtout dplac attire mon attention :  Je kiffe trop les muslims je le fais qu'avec vous . Je l'ai bien videmment dulcor pour qu'il ne vous choque pas autant que j'ai pu l'tre.  la suite de ce message, ce sont enchans les remarques plus dgradantes les unes que les autres. Outre le fait que ces personnes aient pu dduire mon appartenance religieuse de la simple vue de mon visage, outre le fait qu'ils associent consciemment ou non Maghrbin et Musulman, ce qui m'interpelle, c'est qu'ils choisissent leurs partenaires sexuels en fonction de leur ethnie, en projetant sur moi tout l'imaginaire que le  rebeu  leur renvoie. En analysant leurs comptes j'ai pu dcouvrir un univers o le ftichisme racial est banalis et entretenu par une communaut trs active.\",\"foreword2paragraph\":\"Je suis rest sans rponse face  cet incident. D'o vient cette  attirance  ? A-t-elle un enracinement historique ? A l'heure o les discours identitaires ne cessent d'occuper l'espace mdiatique franais, est-il tonnant que cette fascination envers les  rebeu  et les  beurettes  s'affiche davantage ? Je me suis intress au sujet et j'ai donc pass quelque temps  tudier la question. Cet crit se nomme  Je ne suis pas ton fantasme orientaliste . Ce choix de titre est li  une pancarte que j'ai pu voir en marge d'une manifestation contre le racisme. Elle m'a intrigu et pouss  faire plus de recherches, et j'espre que ce sera galement votre cas. Cet article s'adresse en particulier aux personnes qui n'auraient pas conscience de ce ftichisme envers les Maghrbines et Maghrbins. Par ce dernier, j'espre vous avertir de l'existence d'une caractristique moins visible et d'autant plus insidieuse d'un problme plus vaste et gnral qu'est le racisme. Pour ce faire, je m'appuierai sur des livres, podcasts et articles que vous pourrez consulter, mais aussi sur des entretiens avec d'autres personnes qui ont t face  des situations semblables  la mienne. N'tant ni historien, ni sociologue, ni mme sexologue, je ne saurais avoir pour ambition d'tre exhaustif. Je souhaite plutt runir des pistes de rflexion, que nous interrogions ensemble les strotypes que nous avons intrioriss. En parlant de sociologie, le terme  race  et ses drivs sont  lire au sens sociologique du terme car si biologiquement il n'existe qu'une unique race humaine, c'est bel et bien le terme adquat et utilis pour pointer cette construction sociale. Dans cet crit, je m'intresserais surtout au cas du ftichisme racial touchant les Franaises et les Franais d'origine maghrbine, bien que ce phnomne se retrouve dans d'autres parties du monde, et qu'il touche aussi d'autres groupes ethniques (Noirs, Asiatiques, Latino-amricains, ...). D'autre part, tant donn la nature de ce sujet, je mentionnerai des faits politiques bien que ce document n'ait aucune vise politique. Enfin, j'ai pris le soin d'adoucir le premier message auquel j'ai fait rfrence, mais il se peut que dans la suite apparaissent d'autres termes plus crus.\",\"historyTitle\":\"Quelques origines historiques\",\"history1paragraph\":\"La premire question que je me suis pose tait de savoir quand ce ftichisme envers les Nord Africains est apparu. Pour tre tout  fait honnte il est assez difficile de la dater prcisment. Nanmoins on peut souligner le lien historique entre la France et les pays du Maghreb qui constitue un facteur important  prendre compte. Lorsque l'on s'y intresse, on voit que les femmes maghrbines ont souvent t sexualises, notamment pendant la guerre d'Algrie.\",\"history1quote\":\" Pour prendre le contrle d'un territoire, la violence politique et militaire ne suffit pas. Il faut aussi s'approprier les corps, en particulier celui des femmes  Sexualits, identits & corps coloniss, CNRS\",\"history2paragraph\":\"En effet, pendant cette guerre, les responsables de l'administration franaise en Algrie vont mettre en place des  campagnes de dvoilement , et vont redoubler d'effort afin d'inciter les femmes algriennes  retirer leur voile. Gardons en tte que cet vnement s'inscrit dans un contexte de guerre coloniale. Mais nous pouvons toutefois remarquer que ce qui se cache sous le voile des femmes algriennes (et maghrbines en gnral) suscite la curiosit des Franais, d'Algrie ou non, et alimente la perversion de certains. Frantz Fanon, psychiatre, essayiste et figure majeure de l'anticolonialisme, a d'ailleurs crit dans son article  L'Algrie se dvoile  publi en 1957 :\",\"history3paragraph\":\" Une rflexion  parmi d'autres  rvlatrice de cet tat d'esprit, nous a t faite par un Europen de passage en Algrie et qui, dans l'exercice de sa profession  il tait avocat  avait pu voir quelques Algriennes dvoiles. Ces hommes, disait-il, parlant des Algriens, sont coupables de couvrir tant de beauts tranges. Quand un peuple, concluait cet avocat, recle de telles russites, de telles perfections de la nature, il se doit de les montrer, de les exposer.  l'extrme, ajoutait-il, on devrait pouvoir les obliger  le faire.  On peut trs clairement comprendre l'attitude de certains hommes  Europens  envers les femmes maghrbines. Ils estiment avoir la lgitimit de disposer de leurs vtements et de leur corps. Lorsqu'elles sont dvoiles, elles n'existent que par leur beaut. Fanon ajoute ensuite :  Il y a chez l'Europen cristallisation d'une agressivit, mise en tension d'une violence en face de la femme algrienne. Dvoiler cette femme, c'est mettre en vidence la beaut, c'est mettre  nu son secret, briser sa rsistance, la faire disponible pour l'aventure. Cacher le visage, c'est aussi dissimuler un secret, c'est faire exister un monde du mystre et du cach. Confusment, l'Europen vit  un niveau fort complexe sa relation avec la femme algrienne. Volont de mettre cette femme  porte de soi, d'en faire un ventuel objet de possession . La femme maghrbine est donc une sorte de trsor cach, qu'il faut dcouvrir et capturer. Et l'homme  Europen  en tant que  colonisateur s'octroie le droit de se l'approprier. Peut-tre pouvons-nous comprendre que cette manire de penser n'est que la rsultante des rapports de domination prsents  cette rgion pendant cette priode de l'histoire, et que, de ce fait, ces paroles sont l'expression de son inconscient colonial qui a intrioris ces dits rapports. Je ne pense pas qu'il soit draisonnable de parler d'inconscient colonial dans ce cadre-ci. En effet, nos dsirs ne sont pas contrlables ( l'inverse de l'expression de ces dsirs qui est matrisable).  Ils sont donc en troite relation avec notre inconscient et Fanon, dans sa qualit de psychiatre, ajoute plus loin :  Chaque fois que l'Europen, dans des rves  contenu rotique rencontre la femme algrienne, se manifestent les particularits de ses relations avec la socit colonise. [] L'Europen rve toujours d'un groupe de femmes, d'un champ de femmes, qui n'est pas sans voquer le gynce, le harem, thmes exotiques fortement implants dans l'inconscient. L'agressivit de l'Europen va galement s'exprimer dans des considrations sur la moralit de l'Algrienne. Sa timidit et sa rserve vont se transformer selon les lois banales de la psychologie conflictuelle en leur contraire et l'Algrienne sera hypocrite, perverse, voire authentique nymphomane.  Cette analyse des contenus oniriques des hommes Europens nous fait comprendre que derrire ce dsir se cache tout un imaginaire que les sujets se font de la vie prive de ces femmes, vues comme inaccessibles.\",\"history2quote\":\" La sidration provoque par la dcouverte de corps exotiques [] a progressivement cd la place  des strotypes de plus en plus dvalorisants.  Sexualits, identits & corps coloniss, CNRS\",\"history4paragraph\":\"La France, en tant qu'empire colonial, essayait d'attirer, vers les colonies asiatiques ou africaines, les habitants de la mtropole. C'est pour cette raison que l'on y trouvait des cartes postales reprsentant les femmes de ces colonies, dont le Maghreb. Certaines y affichaient des femmes  moiti dnudes. Elles avaient pour but de renvoyer l'image d'une fminit dvoile et accessible.\",\"history3quote\":\" Le viol dlibr et systmatique fut considr comme un moyen de briser une population  en Algrie comme au Maroc  en la frappant l o elle tait le plus susceptible de souffrir : l'honneur  Violences sexuelles au temps des dcolonisations, Nicolas Bancel & Alain Ruscio\",\"history5paragraph\":\"Un exemple important d'appropriation des corps est l'utilisation du viol comme arme de guerre. Que ce soit au Maroc ou en Algrie, d'innombrables viols ont t commis. Gisle Halimi, avocate de nombreuses d'Algriennes emprisonnes, estimait qu'au moins 90% de ses clientes furent violes.\",\"historyLegend\":\"AFFICHE DE PROPAGANDE REALISE PAR L'ARME FRANAISE PENDANT LA GUERRE D'ALGRIE\",\"artTitle\":\"Reprsentations artisitiques\",\"art1paragraph\":\"Avant mme la guerre d'Algrie, l'orientalisme tait dj un mouvement artistique prsent et rcurrent aux XVIIIe et XIXe sicles. On voit apparatre des uvres voquant des thmes en rapport avec l'Orient dont l'Afrique du Nord.  Mais l'orientalisme, c'est avant tout la perception de l'Orient et ses habitants par l'Occident. Eugne Delacroix, figure emblmatique de ce courant, a peint plus de 72 tableaux lis  ce dernier, dont  Femmes d'Alger dans leur appartement  en 1833. On peut y voir un lieu largement prsent dans l'imaginaire des artistes de cette poque : le harem. Dans ce tableau, on peut apercevoir des femmes, dont le regard est suggestif, tenant des postures lascives, laissant apparaitre leurs bras, leurs mollets et leurs pieds. A cette poque, ces parties du corps taient trs rotises, leur dvoilement confre donc  cette scne une dimension intime, sensuelle voire rotique. Ces postures sont spcifiquement  exotiques  selon les adeptes de ces courants, puisque presque jamais prsentes dans les reprsentations de femmes occidentales.\",\"art2paragraph\":\"On peut aussi noter un aspect luxueux vident, ainsi qu'une composante plus mystrieuse avec l'ombre prsente en arrire-plan et celle sur le visage des femmes. Cette uvre propage donc l'ide d'un Orient rv o les femmes sont certes mystrieuses, inaccessibles, mais pour autant trs voluptueuses et rotiques dans leur intimit.\",\"art1legend\":\"EUGENE DELACROIX, FEMMES D'ALGER DANS LEUR APPARTEMENT, 1833, MUSEE DU LOUVRE\",\"art3paragraph\":\"Le hammam est l'autre lieu emblmatique prsent dans la perception que les artistes de cette poque ont de l'Orient. On le retrouve dans bon nombre de tableaux de Jean-Lon Grme, dont  Le bain turc .\",\"art4paragraph\":\"Dans cette scne, on peut apercevoir une femme dnude, ce qui tait encore tabou dans la socit de l'poque. Elle prend un bain, avec l'aide de sa servante, dont la peau noire contraste avec sa peau blanche, signe de beaut en Occident. Il y a donc encore une fois une composante rotique qui est prsente dans cette uvre. Bien qu'elle soit entirement nue, on ne distingue pour autant pas son visage, et la femme semble dissimuler une partie de son corps, contrairement  la servante. Cela peut voquer une dimension plus mystrieuse, attisant ainsi la curiosit du spectateur, le poussant ainsi  dcouvrir ce monde lointain et exotique, dont l'unique reprsentation auquel il fait face est celui d'une femme dnude. Ces deux aspects aboutissent sensiblement  la mme consquence qu' celle du tableau de Delacroix.\",\"art2legend\":\"JEAN-LON GRME, LE BAIN TURC, 1863, BOSTON MUSEUM OF FINE ARTS\",\"cultureTitle\":\"Dans la culture populaire\",\"culture1paragraph\":\"Maintenant que nous avons vu que ce ftichisme racial tire ses racines des sicles derniers, et qu'il tait bel et bien dans les imaginaires et inconscients des hommes franais, nous pouvons nous demander ce qu'il en est de nos jours.\",\"culture2paragraph\":\"Depuis quelques annes, le terme  reprsentation  est de plus en plus employ par les personnes racises (dont la race, au sens des sciences sociales, n'est pas la race blanche). Il est effectivement ncessaire, en tant que population si diverse, de s'interroger sur les perceptions que l'on a des autres individus. Mais comment obtient-on ces perceptions ? Et bien, en y tant confront constamment. Si un groupe de personnes nous est toujours reprsent avec certaines caractristiques, nous allons naturellement les associer ensemble, c'est invitable. Ce sont nos biais cognitifs qui crent et alimentent nos strotypes.\",\"culture3paragraph\":\"Je choisis ici de ne traiter que les reprsentations cinmatographiques, car c'est selon moi le support culturel par lequel ces clichs sont largement propags aujourd'hui.\",\"culture4paragraph\":\"Les artistes, notamment les acteurs et actrices, tentent de dnoncer les rles clichs qui leur sont proposs constamment. Je pense que le cinma franais a un souci avec la diversit. Bien que ce problme commence  se rgler, rares sont les actrices maghrbines qui n'ont pas endoss un rle de femme prisonnire de ses coutumes, en qute de libert, celui de femme esclave de sa famille, battue par ses frres, son pre, ou ses cousins\",\"culture5paragraph\":\"Lorsque j'tais plus jeune, il y avait un tlfilm sorti en 2009,  Acha , qui tait suivi par beaucoup de femmes de mon entourage. Il faut dire que c'tait l'une des rares fois o le personnage ponyme tait une femme d'origine Maghrbine,  laquelle elles pouvaient peut-tre s'identifier. Aujourd'hui, avec le recul, j'ai remarqu que ce tlfilm perptue l'ide qui est faite des Maghrbines, aussi poussireuse soit elle.\",\"culture1quote\":\"Aicha est une jeune %s%Franaise d'origine algrienne%/%, vivant dans une %s%cit de la banlieue parisienne%/%. Le tlfilm nous retrace son parcours, sa %s%qute de libert%/% et son rve : travailler %s%de l'autre ct du priphrique%/%,  en France . Acha mne donc sa vie tant bien que mal entre la cit, son boulot dans un garage et surtout %s%les traditions que sa culture lui impose%/%. Elle rve de partir, de trouver un vrai travail et de vivre  Paris avec sa meilleure amie Lisa. %s%C'est alors qu'elle croise Patrick, un ami d'enfance. Charm par Acha, il souhaite la revoir.%/% Mais tout n'est pas si simple lorsqu'on essaye au mieux de concilier : %s%la famille patriarcale, les traditions musulmanes et la cit d'un ct, et de l'autre l'amour et la volont de vivre seule%/% avant de se marier\",\"culture6paragraph\":\"Dans le synopsis, on voit que la description de l'identit d'Acha fait rfrence  son origine ethnique,  son origine sociale et  sa confession. Ces trois caractristiques sont prsentes ensemble comme indissociables. (Rappelez-vous de la confusion entre  muslim  et maghrbin dont j'avais parl). Acha est dcrite comme enferme dans un carcan familial, social et religieux. Son seul espoir est un homme blanc, Patrick, qui va tenter de la dlivrer de cette prison.\",\"culture7paragraph\":\"Ce film strotyp est loin d'tre le seul, et c'est bien cela le problme. A cette poque, et encore maintenant, nous n'tions face qu' trs peu de diversit dans les reprsentations. Un an auparavant, en 2008, sortait le film  Des poupes et des anges . Je vous laisse prendre connaissance du synopsis, bien qu'il soit sensiblement similaire  celui d' Acha .\",\"culture2quote\":\" 16 ans, Lya vit dans %s%une cit de banlieue%/% avec ses surs Chirine, 17 ans, et Ins, 7 ans. Depuis que son ane est devenue femme, %s%leur pre ne lui parle plus%/% et dans la famille, Lya est la seule  oser tenir tte  %s%ce pre devenu violent%/% depuis quelques mois. A Paris, Chirine rencontre Alex, qui se dit agent. Ce dernier lui propose de devenir mannequin, mais Chirine prend conscience qu'elle est %s%en train de tomber dans la prostitution%/%. Elle rencontre alors Simon, un publicitaire reconnu qui, %s%fascin par sa beaut, dcide de prendre son destin en main.%/%\",\"culture8paragraph\":\"Cette fois ci, c'est l'histoire d'un pre violent et de ses filles. L'une d'entre elles tombe dans la prostitution, et se voit sauve par un homme blanc, Simon, qui est  fascin par sa beaut . Ces deux films propagent l'ide d'une magnifique plante exotique qu'il faut librer de la suppose soumission qu'elle subit, qu'il faut la sortir du joug de sa famille barbare pour pouvoir l'arroser avec de la culture, la voir fleurir et admirer ses fleurs.\",\"culture9paragraph\":\"Ces strotypes ne sautent pas forcment aux yeux d'une personne qui n'y est pas constamment confront, mais je vous invite  voir ces films ou les revoir d'un il averti.\",\"culture10paragraph\":\"Cette anne, en mars 2022 sortira un film intitul  Kung Fu Zohra , comptant l'histoire d'une femme qui apprend le Kung-Fu pour se dfendre des violences conjugales qu'elle subit de la part de son mari Omar. On peut certes saluer un effort d'originalit avec l'incorporation d'arts martiaux. Mais s'il a fallu attendre plus de 10 ans avant de renouveler ce scnario vu et revu, dans combien d'annes pourrons-nous esprer voir un cinma qui cesse de rduire les femmes maghrbines aux trois mmes rles clichs ?\",\"culture11paragraph\":\"Il y a quelques annes, une fausse annonce de casting avait t poste sur un site spcialis, recensant les strotypes du cinma franais. Cette annonce recherchait entre autres :  Le personnage de Fatima, une femme de 18-25 ans, musulmane, d'une grande beaut et un physique de rve, prostitue  ses heures perdues, type maghrbin avec de forts traits arabes (cf Sabrina Ouazani) . Les actrices et acteurs n'ont pas manqu de s'indigner, mais ce casting a tout mme pu tre publi sans que cela ne choque les responsables de ce site, preuve que ce type de rle est bel et bien souvent recherch dans le cinma franais.\",\"culture1legend\":\"ALADDIN (FILM), DISNEY, 1992\",\"culture12paragraph\":\"Un dernier point li au cinma que je trouve pertinent se trouve dans le film Aladdin de Disney, l'un de mes prfrs Dans le reportage  Hollywood et les arabes , bas sur le livre  Real Bad Arabs  de Jack Shaheen, on comprend que Disney fait rfrence  de nombreux strotypes dans son film d'animation. On remarque tout d'abord que les femmes sont bien plus dvtues que dans les autres films Disney. D'ailleurs, Jasmine est la seule princesse Disney dont le ventre est visible. Elle est enferme au palais et suffoque sous la tutelle de son pre.\",\"culture13paragraph\":\"Mme ce dessin anim, d'apparence innocente et dont les chansons ont berc l'enfance de nombreux franais, numre encore les mmes strotypes.\",\"beuretteTitle\":\"La beurette\",\"beurette1paragraph\":\"Arabe, en verlan et contract, a donne beur. Vous avez srement dj entendu ce terme. Black Blanc Beur, la Marche des Beurs,  Au fminin cela donne  beurette . Si vous avez dj entendu ce terme, je doute que ce soit dans un sens mlioratif.\",\"beurette1quote\":\" Je vais  la chicha pour les beurettes , %br%Booba, rappeur\",\"beurette2paragraph\":\" Beur  est un terme argotique apparu dans les annes 1980, dans les cits franaises. Il servait  dsigner les descendants d'immigrs maghrbins, c'est--dire, les  immigrs de deuxime gnration . Bien que ce terme ait t cre par des  Beurs  pour des  Beurs , il se retrouve rapidement utilis par le reste des Franais, notamment  partir de 1983 lors de la Marche pour l'galit et contre le racisme, rebaptise par les mdias de l'poque  La Marche des Beurs . Ce mot est ensuite devenu peu apprci des personnes qu'ils dsignent, puisqu'il renferme l'ide d'une  bonne intgration . En effet, les politiques et intellectuels de cette poque se sont appropris les termes  beur  et surtout  beurette  afin d'en dpeindre l'image d'une femme, descendante de l'immigration maghrbine, qui s'intgre  la socit franaise en occultant toutes les autres parties de son identit. On peut aussi s'interroger sur le mot en lui-mme, Pourquoi dire  une beurette  et non pas tout simplement  une beurre  ? L'ajout de ce suffixe -ette confre une sensation de d'infantilisation, de minoration, presque de mise sous tutelle. La journaliste Irne Ahmadi va jusqu' placer ce terme en parallle de  soubrette . Aujourd'hui ces deux termes ont laiss leur place   rebeu , moins connot, que ce soit pour parler d'un homme ou d'une femme d'origine maghrbine.\",\"beurette3paragraph\":\"Les  beurettes  sont donc prsentes comme des femmes soumises. Mais  qui le sont-elles ? Selon Nacira Gutif-Souilamas, professeure et sociologue spcialise sur les questions d'immigration, d'intgration et de racisme, la figure de la  beurette  cache un rcit colonialiste labor par la classe politique dominante de l'poque : la  beurette  serait oppresse par ses homologues masculins, si bien qu'elle doive s'manciper de cet asservissement, et donc affirmer ses inhrentes valeurs occidentales. En se librant de ce carcan, elle parvient  s'intgrer.\",\"beurette4paragraph\":\"Le terme  beurette  a subi d'autres volutions,  tel point qu'aujourd'hui l'utilisation de ce mot revt pour beaucoup une dimension raciste et misogyne.\",\"beurette5paragraph\":\"J'ai entendu ce terme pour la premire fois en 2014, avec une connotation extrmement ngative. L'usage de ce mot tait banalis chez les adolescents et les jeunes adultes, parce que rgulirement employ par des rappeurs ou mme des politiciens. Il tait utilis pour insulter des femmes qui se maquillaient un peu trop, ou dont les murs taient juges trop lgres. Les filles de tlralit telles que Nabilla ou Ayem, et l'escort girl Zahia, taient des  beurettes , entendez bimbos orientales superficielles et sans cerveau.\",\"beurette6paragraph\":\"Au dbut des annes 2000, la  beurette voile  se distingue comme nouveau genre pornographique. Si de nombreuses productions pour adulte affichent des femmes prsentes comme tel, cela implique ncessairement l'existence d'un fantasme autour d'elles. Et c'est ici que rside une contradiction qui me hante. Si le but de l'intgration des femmes maghrbines est d'aboutir  leur mancipation, pourquoi sont elles reprsentes en tant qu'objet sexuel ?\",\"beurette2quote\":\" Autrefois les beurettes taient sexy, maintenant elles sont voiles , %br%Robert Mnard, %br%homme politque\",\"franceTitle\":\"Une exception franaise ?\",\"france1paragraph\":\"De clbres sites pour adultes collectent des informations sur les habitudes  de leurs utilisateurs pour en compiler des statistiques chaque anne. C'est pour cette raison que le leader mondial Pornhub a publi en 2018, son tude annuelle, dans laquelle il est possible de voir ce que les utilisateurs de chaque pays cherchent en majorit. La partie consacre  la France est disponible en annexe de cet article. Il est clair que ce ftichisme envers les femmes maghrbines ne s'estompe pas, au contraire. En 2017, le terme  beurette  tait plus plbiscit par les utilisateurs qu'en 2016 et en 2018 il est presque quatre fois plus recherch. Les mots cls  beurette  et  beurette franaise  sont toujours dans le top 10 des mots les plus recherchs sur le site, et continuent de gagner des places au classement. Un dernier point que je trouve trs pertinent est  noter. La catgorie de vidos  Arab  est bien plus recherch en France que dans le reste du monde (environ deux fois plus que la moyenne mondiale). Pornhub n'est pas le seul acteur du milieu publiant ses statistiques d'utilisation, mais sur les autres sites pour adultes, le constat reste le mme, il est peut-tre mme plus inquitant. Sur l'tude de XHamster affiche en annexe, le terme  beurette  arrive en tte des recherches, suivi par  pute ,  marocaine ,  arabe  et mme  viol .\",\"analysisTitle\":\"Analyse des scnes\",\"analysis1paragraph\":\"Comment expliquer cette fascination franaise envers les Maghrbines, confusment appeles Arabes,  une poque o les discours identitaires occupent une grande place mdiatique ?\",\"analysis2paragraph\":\"Linda Williams, professeure de thorie du cinma  Berkeley, a montr l'importance des Porn Studies, un pan de la sociologie qui vise  analyser les contenus pornographiques sans aucun jugement, comme tout autre matriel culturel. Il en rsulte que ces images sont souvent rvlatrices de rapport sociaux entre les genres, les races ou les classes sociales.\",\"analysis3paragraph\":\"Lors de mes recherches, je suis tomb sur plusieurs crits de sociologues concernant les contenus pornographiques franais se rclamant du genre  beurette . L'article qui m'a le plus marqu est  Voiler les beurettes pour les dvoiler: Les doubles jeux d'un fantasme pornographique blanc  publi en 2013 par Eric Fassin et Mathieu Trachman.\",\"analysis4paragraph\":\"Il est question dans cet article de l'tude croise du contexte politique d'aprs septembre 2001, et de contenus pornographiques. Je vous invite fortement  le lire si le sujet vous intresse. Il est trs abordable et permet de mieux comprendre le malaise que pose le ftichisme racial envers les Maghrbines. Je vais ici citer des passages de cet article car les auteurs ont parfaitement expliqu les aspects de ce fantasme : \",\"analysis5paragraph\":\" Ce sous-genre met en scne de jeunes Maghrbines dnudes, uniquement vtues d'un hijab ou d'un niqab leur couvrant le visage. [] des hommes blancs dcouvrent ou rvlent, sous le voile de la pudeur, des filles toujours dj rebelles \",\"analysis6paragraph\":\"On voit que pour les femmes maghrbines, s'additionne toujours une dimension religieuse. Fatima At Bounoua crit en 2007 son article  Toutes des salopes ?  dans lequel on peut lire :   Tout se passe comme si les beurettes taient forcment des musulmanes, des musulmanes prisonnires et celles du site seraient celles qu'on est parvenu  librer des contraintes religieuses. . Certains producteurs motivent l'utilisation du voile par des raisons d'anonymat. Mais la moiti des contenus mettent en scne des dvoilements, et pour l'autre moiti on aurait pu utiliser une cagoule ou mme un floutage en post-production. Pour moi, il s'agit juste de pousser le clich au maximum, et pour E. Fassin :  Le marketing inspire la rfrence religieuse  ostentatoire , [] s'inscrit dans une actualit (la loi sur les signes religieux dans l'cole publique, qui vise bien sr au premier chef le voile islamique, est adopte  l'issue d'un dbat intense le 15 mars 2004) .\",\"analysis7paragraph\":\"D'autre part il y dans ces scnes, encore une fois, le strotype de la soumission, inhrente  la reprsentation post-coloniale des Maghrbines. Il suffit de regarder les noms des sites produisant ces contenus  Beurettes rebelles ,  Beurettes insoumises ,  Selon moi, la suppose soumission qu'elles subiraient est avant tout rotise avant d'tre dnonce comme pourraient l'argumenter certains distributeurs.\",\"analysis8paragraph\":\"Eric Fassin ajoute :  Doublement dsirable car simultanment mancipe et asservie, soit une chose et son contraire  telle est la beurette fantasme . L'article parle aussi  domination coloniale  car il est toujours questions de femmes maghrbines qui coutent et excutent les directives d'un homme blanc. On peut noter que c'est l'homme qui introduit toujours l'origine ethnique de l'actrice :  T'es de quelle origine ? ,  Tu es d'origine tunisienne, c'est a ? ,  Tu peux nous dire un petit quelque chose en arabe ? .\",\"analysis9paragraph\":\"Dans la suite de l'article on lit :  Les fantasmes sexuels sont travaills par les fantasmes sociaux . En effet, l'imaginaire orientaliste laisse place  un imaginaire social qui rotise les banlieues. On renvoie donc la  beurette   son origine ethnique, son appartenance religieuse et sa classe sociale. Plus loin, il ajoute  Le fantasme est aliment par l'actualit, soit une ralit extrieure au monde de la pornographie, qui prend pour objet de fantasmes politiques ces jeunes femmes  issues de l'immigration  . L'image de la banlieue est un objet de fantasme pour les spectateurs, cela se remarque facilement par les titres des films comme  Farida et les meufs de ma cit . Dans leurs (rares) dialogues, les actrices se prsentent au ralisateur en prcisant leur ville natale. On y retrouve Grigny, Bobigny, ou d'autres villes de banlieues parisienne assez connues du grand public. L'actrice dit souvent qu'elle porte un voile pour pas que l'on puisse la reconnatre dans sa ville car  C'est dangereux .\",\"analysis10paragraph\":\"E. Fassin argumente :  On imagine aussitt la violence  laquelle les exposerait leur sexualit libre  non pas dans la socit franaise en gnral, nous suggrent-elles, mais dans leurs quartiers en particulier. Qu'elles l'oublient quelques minutes plus tard n'encourage-t-il pas le spectateur, prsum blanc,  penser qu'elles seraient finalement exposes  son seul regard, chappant  celui de leurs  frres  ? .\",\"menTitle\":\"Les Hommes\",\"men1paragraph\":\"Tout ce qui est vrai en matire de ftichisme racial envers les Maghrbines se translate presque naturellement envers les Maghrbins. En premire partie Fanon nous disait que les hommes taient perus comme  coupables  de vouloir soumettre leurs femmes, d'o la volont des  Europens  de les dvoiler. Cette narration a considrablement contribu  l'image encore actuelle de l'homme maghrbin violent et agressif, et cet imaginaire se retrouve videmment lorsque l'on aborde  leur sexualit.\",\"men1quote\":\" De l'indpendance de l'Algrie en 1962 et jusqu' la fin de l'agitation culturelle et sociale des annes 1970, les thories profondment sexualises sur les  Arabes  ont t omniprsentes dans les grands dbats publics franais, aussi bien autour de la sexualit que sur les Arabes  %br%Mle dcolonisation, Todd Shepard\",\"men2paragraph\":\"Todd Shepard, historien amricain a tudi le dbat public franais entre 1962, date de l'indpendance de l'Algrie, et 1979. Dans son livre  Mle dcolonisation , dont le nom anglais est  Sex, France and Arab Men , il nous dit que, jusque dans les annes 70, les discours concernant sur les sexualits des populations maghrbines portaient sur les hommes. Il parle mme d'une  obsession franaise autour des hommes arabes .\",\"men3paragraph\":\"En 1962, l'essayiste Edouard Roditi crivait :   On estime couramment en France que les Arabes sont dous d'une plus grande virilit que nous , ce qu'il explique par une construction sociale plus primitive. Sheppard distingue ce parallle entre  dou  et  primitif . En effet, il analyse dans son livre  les discours de l'extrme gauche, jusqu' ceux de l'extrme droite, et bien que les raisonnements soient diffrents, les rsultats sont comparables. Dans un contexte d'immigration suite  la fin de la guerre d'Algrie, l'extrme droite affirme que les hommes maghrbins  (primitifs) reprsentent un danger pour la socit franaise, notamment en raison de leur sexualit. Ainsi Franois Brigneau, militant d'extrme droite, expliquait en 1978 que la  vigueur de la sexualit arabe  constituait une menace pour les familles franaises. La sexualit de l'homme maghrbin est toujours prsente de manire violente, agressive, et cela aboutit  une peur de l'image du maghrbin violeur. D'un autre ct, pendant les annes 60, l'extrme gauche adopte une vision plus hroque de l'homme maghrbin (dou), en particulier de l'homme algrien, mais encore virile et violente :  Les anticolonialistes avaient russi  faire de l'homme algrien  rvolutionnaire  ou hroque une incarnation de la masculinit (universelle et vritable), affrontant la puissance crasante de la France  avec ses mthodes sadiques et dshonorantes [] et dlivrant son pays et sa famille de l'oppression coloniale . Cette vision de  l'Arabe triomphant  inspire les manifestants de Mai 68. Sheppard ajoute :  On trouvait d'un ct ceux pour qui les hommes arabes [] apportaient la solution  toute une srie de problmes franais. De l'autre, ceux pour qui ces mmes hommes incarnaient tous les problmes que les Arabes continuaient de poser  la France et aux Franais. Le premier camp a disparu. Le second, de toute vidence, a encore gagn .\",\"men4paragraph\":\"Effectivement, lorsque l'on regarde les dbats publics actuels visant les maghrbins, on retrouve uniquement les discours de l'extrme droite de l'poque.\",\"men2quote\":\" La beurette c'est celle qui va  l'cole pendant que son frre fait des roues arrires en bas des btiments.  %br%Ilham Madd\",\"men5paragraph\":\"Aprs l'an 2000, la reprsentation des Maghrbins en France est, comme pour les Maghrbines, souvent trs connote. Les rles masculins des films  Acha  et  Des poupes et des anges , que j'ai mentionns prcdemment, sont toujours indissociables d'une agressivit prsume intrinsque  leur origine. Un autre aspect vident est celui des  quartiers  et du  Rebeu de cit . Dans les productions cinmatographiques, les cits sont souvent synonyme de refus d'intgration, de dscolarisation, de violence, de trafics de drogue, de dlinquance et de Maghrbins. C'est un mlange rcurrent, on le voit dans des films tels que  Banlieue 13 ,  La Dsintgration ,  La journe de la jupe  et bien trop souvent dans la filmographie de Franck Gastambide. Kamelia Ouaissa a crit pour le Bondy Blog :  Les films de Franck Gastambide associent l'image des jeunes issus de quartiers  celle du sexe. Une reprsentation souvent vulgaire allant mme jusqu'au prdateur .\",\"men6paragraph\":\"Encore une fois, de la manire analogue aux Maghrbines, cet imaginaire construit autour des hommes maghrbins se prolonge dans la pornographie. Dans le podcast  Crac-Crac  sur le thme  Sexe et racisme , les animateurs font rfrence  des socits de production, de contenus pornographiques qui utilisent  outrance l'image de la cit et de l'homme maghrbin. Lors de l'interview du fondateur du site pour adulte gay  Citebeur , ce dernier argument qu'il y a  la racine de la cration de son entreprise, la volont d'inclure des profils  exotiques  pas forcment reprsents par le reste des acteurs du march. L'une des questions que l'on peut se poser est pourquoi axer cette initiative sur la  cit  et sur le  beur . Lorsque la journaliste Rene Greusard l'interroge, il semble tre totalement conscient que certaines personnes puissent ftichiser une ethnie spcifique, ce que l'on peut aisment comprendre puisque son commerce se base sur ce ftichisme. Il ajoute  a :  Souvent quand les gens me disent je veux des Rebeus, ce sont plutt des Franais [] qui n'ont que comme rve l'archtype du petit lascar qui va les monter .\",\"men7paragraph\":\"Ici il faut lire  Franais  comme  non blanc . On voit d'ailleurs que l'emploi du mot  Franais  marque une opposition avec  Rebeus , le Rebeu ne serait donc pas franais. Mme s'il ne voit aucun problme avec ce ftichisme, il reste clairvoyant sur les origines de celui-ci. Encore une fois la figure du  Rebeu  et celle du  lascar  sont adjointes. C'est ce qui est dnonc par la journaliste. Elle nous dit que c'est peut-tre une bonne chose de reprsenter des profils divers, mais les scnarios de  Citebeur  sont souvent ceux d'hommes perus comme maghrbins, dont la  vigueur  sexuelle (pour reprendre les discours des annes 60), s'exprime de manire agressive sur les  Franais .\",\"men8paragraph\":\"Pour finir avec cette interview, le fondateur de  Citebeur  a point un autre problme qui, je pense, se place  l'oppos du ftichisme racial. La journaliste lui demande :  O s'arrte le racisme et o commence le choix ? , ce  quoi il rpond :  Le racisme c'est le fait de ne pas avoir envie de telle couleur .\",\"finalTitle\":\"Conclusion\",\"final1paragraph\":\"Nous avons donc vu en quelques pages ce qu'tait le fantasme orientaliste, certaines de ses origines et ses manifestations. Plus gnralement, on parle de ftichisme racial lorsque ce phnomne touche d'autres groupes ethniques. En France il y a aussi des personnes Noires et Asiatiques qui dnoncent cette attirance fondamentalement raciste : les femmes asiatiques seraient censes tre dociles, les hommes noirs seraient censs tre sauvages. Les individus qui subissent cette ftichisation s'accordent  dire qu'elle est dshumanisante. En effet, elle n'existe que par la prsence dans l'imaginaire des personnes de caractristiques physiques ou mentales, prsupposes vraies et immuables  toute une ethnie. C'est prcisment ce point qui la distingue d'une simple prfrence comme certains peuvent le faire croire. On retrouve aussi du ftichisme racial dans d'autres parties du monde. Aux Etats-Unis par exemple, les Noirs, les Asiatiques, et les Latino-Amricains dnoncent de manire unanime cette facette du racisme. Dans la partie voquant  Les Hommes , j'ai parl d'un problme situ   l'oppos  du ftichisme racial, il s'agit du racisme sexuel. En 2018, une tude de l'Ifop a montr que les 57% des Parisiennes expriment leur refus de s'unir avec des hommes originaires du Maghreb ou du Moyen-Orient, et que cette proportion montre  62% pour les hommes originaires d'Afrique sub-saharienne. On pourrait argumenter que c'est  acceptable  de vouloir s'unir avec quelqu'un de sa communaut, et donc que ce n'est pas un problme de reprsentation. Mais une tude similaire en Angleterre a montr que les hommes noirs jugeaient les femmes noires moins attirantes que les autres femmes.\",\"final2paragraph\":\"Pour terminer mon crit, j'aimerais remercier Tassa, Karim et tous les autres personnes qui ont accept de tmoigner pendant l'criture de ces mots. Il est crucial d'en parler pour que ce problme puisse recevoir l'attention ncessaire  sa rsolution. Je souhaite aussi remercier Farah, Ins et Yacine pour leurs prcieux conseils. Et j'aimerais vous remercier d'avoir lu ces pages, en esprant qu'elles aient pu vous faire prendre conscience d'un problme historique mais qui est bel et bien actuel.\",\"finalReadMore\":\"Bibliograhie\",\"bibliographyTitle\":\"Bibliographie\"}");var kg={};kg=JSON.parse('["Philippe Testard-Vaillant,  De la domination sexuelle dans les empires coloniaux , %i%CNRS Le journal%/i%, 3 dcembre 2019","Botsch, Gilles, %i%et al. Sexualits, identit & corps coloniss. XVe sicle-XXIe sicle.%/i% CNRS, 2019.","Christelle Taraud,  Femmes orientales dans la carte postale coloniale , %i%musea.fr%/i%","Jean-Pierre Sereni,  Le dvoilement des femmes musulmanes en Algrie , %i%orientxxi.info%/i%, 13 septembre 2016","Fanon, F. (1959).  L\'Algrie se dvoile , %i%L\'an V de la rvolution algrienne%/i%, 16-50.","Louise Wessbecher,  La colonisation cachait aussi un grand march sexuel, de l\'Algrie au Maroc , %i%Huffington Post%/i%, 3 octobre 2021","Anas Mit,  L\'image de la femme dans la peinture orientaliste , %i%Les cls du Moyen-Orient%/i%, 22 fvrier 2022","Guillaume Morel,  Le Bain turc de Jean-Lon Grme : Focus sur un chef-d\'uvre , %i%connaissancedesarts.com%/i%, 3 avril 2020","Irne Ahmadi,  Pourquoi il faut arrter d\'employer le mot  beurette  , %i%Les Inrockuptibles%/i%, 4 juin 2020.","Nioucha Zakavati,   Beurette  : gnalogie d\'un terme sexiste et raciste , %i%TV5Monde%/i%, 25 juillet 2019","Charlotte Vautier :   Fais pas ta beurette  : un documentaire se penche sur ce terme trs connot , %i%Clique%/i%, 24 dcembre 2016","Ilham Maad,  Fais pas ta beurette , %i%Arte Radio%/i%, 22 novembre 2016","Faza Zerouala,  Ne m\'appelez plus jamais beurette , %i%Clique%/i%, 28 septembre 2015"," #PasVosBeurettes , %i%Collectif Nta Rajel ?%/i%, 17 juillet 2019","Gary Neill,  Naked Capitalism , %i%The Economist%/i%, 26 septembre 2015","Fabrice Roger. (2021) %i%L\'Arbre qui cache la fort%/i% : on the sexualization of the term beurette, Gilles Kepel\'s travel writing, and the French %i%mission civilisatrice%/i%. %i%Modern & Contemporary France%/i% 29:4, pages 367-377.","ric Fassin & Mathieu Trachman (2013) Voiler les beurettes pour les dvoiler: Les doubles jeux d\'un fantasme pornographique blanc, %i%Modern & Contemporary France%/i%, 21:2, 199-217, DOI: 10.1080/09639489.2013.776736","Fatima At Bounoua,  Toutes des salopes ? , %i%Libration%/i%, 20 fvrier 2007"," Pornhub Insights ","William Blanc,  La fantasy ou le fantasme de l\'Orient, violent et lascif , %i%Le Point%/i%, 4 juin 2020","Tahar Ben Jelloun,  L\'Orient, fantasme de l\'Occident , %i%Le Monde%/i%, 8 dcembre 1980","Sut Jhally,  Hollywood et les Arabes , %i%Media Education Foundation%/i%, 2006","Shaheen, Jack G. Reel bad Arabs: How Hollywood vilifies a people. %i%The ANNALS of the American Academy of Political and Social science%/i% 588.1 (2003): 171-193."," Une annonce de casting fait bondir le monde du cinma , %i%Le Point%/i%, 21 mars 2015"," Les acteurs arabes seraient-ils seulement bons pour jouer les terroristes ? , %i%Respect Mag%/i%, 28 fvrier 2017","Shepard, Todd. Mle dcolonisation: L\'homme arabe et la France, de l\'indpendance algrienne  la rvolution iranienne. ditions Payot, 2017.","Kamelia Ouaissa,  Les films de Franck Gastambide : opium des quartiers ? , %i%Bondy Blog%/i%, 19 octobre 2021","Gaertner, Julien.  Aspects et reprsentations du personnage arabe dans le cinma franais. 1995-2005, retour sur une dcennie , %i%Confluences Mditerrane%/i%, vol. 55, no. 4, 2005, pp. 189-201."," Sexe & Racisme  issu du podcast  Crac-Crac , %i%Canal+%/i%, 25 avril 2021"," Coucheriez-vous avec un mec du 93 ? Enqute sur le poids des origines et du lieu de rsidence dans le choix du conjoint des Parisiens , %i%Ifop%/i%, 17 dcembre 2018","Jean-Lou Delmas,  Les sites de rencontres sont-ils propices au racisme ? , %i%20 minutes%/i%, 18 dcembre 2018"]'),wp.registerPlugin(Cg);const Bg=new class{constructor(){this.loadingManager=new Io,this.textureLoader=new Fo(this.loadingManager),this.assetsInit(),this.camera=new Wr(-window.innerWidth/2,window.innerWidth/2,window.innerHeight/2,-window.innerHeight/2,.01,1e5),this.scene=new mo,this.scene.add(this.camera),this.canvas=document.querySelector("#scene"),this.renderer=new fo({antialias:!0,canvas:this.canvas}),this.renderer.setSize(window.innerWidth,window.innerHeight),this.time=0,this.spontaeousTimeIncrement=0,this.addMesh(),this.composer=new il(this.renderer),this.composer.setSize(window.innerWidth,window.innerHeight),this.addPostProcessing(),this.render()}assetsInit(){this.colormaps=new Map,this.colormaps.set("red",[this.textureLoader.load(t(ml)),"#bd2240"]),this.colormaps.set("orange",[this.textureLoader.load(t(gl)),"#641801"]),this.colormaps.set("brown",[this.textureLoader.load(t(vl)),"#705152"]),this.colormaps.set("beigePink",[this.textureLoader.load(t(_l)),"#fddcd4"]),this.colormaps.set("lightGray",[this.textureLoader.load(t(xl)),"#e4dadf"]),this.colormaps.set("blue",[this.textureLoader.load(t(yl)),"#166f9c"]),this.colormaps.set("beigeGray",[this.textureLoader.load(t(bl)),"#6f6f6f"]),this.colormaps.set("purple",[this.textureLoader.load(t(Ml)),"#5c236d"]),this.colormapIndex=0}addMesh(){this.geometry=new pr(window.innerWidth,window.innerHeight,1e4),this.material=new go({side:m}),this.material=new _r({uniforms:{progress:{type:"f",value:0},time:{type:"f",value:0}},fragmentShader:t("#define GLSLIFY 1\nuniform float time;\nuniform float progress;\nuniform sampler2D sky;\nuniform vec4 resolution;\n\nvarying vec2 vUv;\nvarying vec3 vPosition;\nvarying vec3 vNormal;\n\nfloat PI = 3.141592653589793238;\n\n#define S(a,b,t) smoothstep(a,b,t)\n\nmat2 Rot(float a)\n{\n    float s = sin(a);\n    float c = cos(a);\n    return mat2(c, -s, s, c);\n}\n\n// Created by inigo quilez - iq/2014\n// License Creative Commons Attribution-NonCommercial-ShareAlike 3.0 Unported License.\nvec2 hash( vec2 p )\n{\n    p = vec2( dot(p,vec2(2127.1,81.17)), dot(p,vec2(1269.5,283.37)) );\n\treturn fract(sin(p)*43758.5453);\n}\n\nfloat noise( in vec2 p )\n{\n    vec2 i = floor( p );\n    vec2 f = fract( p );\n\t\n\tvec2 u = f*f*(3.0-2.0*f);\n\n    float n = mix( mix( dot( -1.0+2.0*hash( i + vec2(0.0,0.0) ), f - vec2(0.0,0.0) ), \n                        dot( -1.0+2.0*hash( i + vec2(1.0,0.0) ), f - vec2(1.0,0.0) ), u.x),\n                   mix( dot( -1.0+2.0*hash( i + vec2(0.0,1.0) ), f - vec2(0.0,1.0) ), \n                        dot( -1.0+2.0*hash( i + vec2(1.0,1.0) ), f - vec2(1.0,1.0) ), u.x), u.y);\n\treturn 0.5 + 0.5*n;\n}\n\nvoid main()\n{\n    //vec2 uv = vUv.xy/resolution.xy;\n    vec2 uv = vUv.xy;\n    float ratio = vUv.x / vUv.y;\n\n    vec2 tuv = uv;\n    tuv -= .5;\n\n    // rotate with Noise\n    float degree = noise(vec2(time*.1, tuv.x*tuv.y));\n\n    tuv.y *= 1./ratio;\n    tuv *= Rot(radians((degree-.5)*720.+180.));\n\ttuv.y *= ratio;\n\n    \n    // Wave warp with sin\n    float frequency = 5.;\n    float amplitude = 500.;\n    float speed = time * 20.;\n    tuv.x += sin(tuv.y*frequency+speed)/amplitude;\n   \ttuv.y += sin(tuv.x*frequency*1.5+speed)/(amplitude*.5);\n    \n    \n    // draw the image\n    vec3 color1 = mix(vec3(0.91, 0.65, 0.59), vec3(0.80), progress);\n    vec3 color2 = mix(vec3(0.91, 0.91, 0.94), vec3(0.), progress);\n    vec3 layer1 = mix(color1, color2, S(-.3, .2, (tuv*Rot(radians(-5.))).x));\n    \n    vec3 color3 = mix(vec3(0.59, 0.76, 0.87), vec3(0.90), progress);\n    vec3 color4 = mix(vec3(0.36, 0.07, 0.07), vec3(0.), progress);\n    vec3 layer2 = mix(color3, color4, S(-.3, .2, (tuv*Rot(radians(-5.))).x));\n    \n    vec3 finalComp = mix(layer1, layer2, S(.5, -.3, tuv.y));\n    \n    vec3 col = finalComp;\n    \n    gl_FragColor = vec4(col ,1.0);\n    // gl_FragColor = vec4(0.0, vUv.xy ,1.0);\n}"),vertexShader:t("#define GLSLIFY 1\nvarying vec2 vUv;\n\nvoid main(){\n    vUv = uv;\n\n    vec4 mvPosition = modelViewMatrix * vec4(position, 1.);\n\n    gl_PointSize = 50. * (1./ - mvPosition.z);\n    gl_Position = projectionMatrix * mvPosition;\n}"),side:m}),this.mesh=new hr(this.geometry,this.material),this.scene.add(this.mesh)}addPostProcessing(){this.renderPass=new Qo(this.scene,this.camera),this.composer.addPass(this.renderPass),this.colormapPass=new fl(this.colormaps.get("brown")[0]),this.composer.addPass(this.colormapPass)}render(){this.resizeRendererToDisplaySize(this.composer.renderer),this.time++,this.time+=this.spontaeousTimeIncrement,this.material.uniforms.time.value=this.time/50,this.composer.render(),window.requestAnimationFrame(this.render.bind(this))}resize(){}resizeRendererToDisplaySize(e){const t=this.canvas,n=window.innerWidth,i=window.innerHeight,r=t.width!=n||t.height!=i;return r&&(console.log("resize"),e.setSize(n,i,!1),this.camera.aspect=n/i,this.camera.updateProjectionMatrix(),t.width=n,t.height=i,t.style.width=n+"px",t.style.height=i+"px"),r}toggleColormap(){this.colormapPass.toggleOpacity()}changeColormap(e){t(pl)({from:0,to:20,duration:500,easing:"linear",change:e=>{this.spontaeousTimeIncrement=e}}),t(pl)({from:20,to:0,duration:500,delay:500,easing:"linear",change:e=>{this.spontaeousTimeIncrement=e}});let n=this.colormaps.get(e);return this.colormapPass.changeColormap(n[0]),n[1]}enableBlackAndWhite(){t(pl)({from:this.material.uniforms.progress.value,to:Math.abs(this.material.uniforms.progress.value-1),duration:1e3,easing:"easeInOutCubic",change:e=>{this.material.uniforms.progress.value=e}})}},Vg=document.querySelector("#loader-wrapper"),Gg=(document.querySelector("#loader"),document.querySelector("#loader-bar-fill")),Hg=document.querySelector("#language-selector"),qg=document.querySelectorAll(".language-option");function Wg(e){let t=document.querySelector(`#${e}`),n=document.querySelector(".chapter:not(.none)");setTimeout((()=>{let e=function(e){let t=e.querySelectorAll("[data-toHide='true']");t.forEach(((e,t)=>e.style.transition="transition: all 1000ms cubic-bezier(0.645, 0.045, 0.355, 1.000)")),t.forEach(((e,t)=>setTimeout((()=>e.classList.add("hidden")),Math.min(100*t,900))));let n=t.length;return setTimeout((()=>e.classList.add("none")),500+Math.min(100*n,1100)),setTimeout((()=>window.scrollTo(0,0)),500+Math.min(100*n,1100)+1),n}(n);setTimeout((()=>jg(t)),500+100*e+1e3)}),1e3)}function jg(e){Bg.colormapPass.changeOpacity(parseFloat(e.attributes["data-colormap-opacity"].value));let t=Bg.changeColormap(e.attributes["data-colormap"].value);document.querySelector("body").style.backgroundColor=t,e.classList.remove("none");let n=e.querySelectorAll(".hidden");e.querySelectorAll("[data-gsap='true']").forEach(((e,t)=>{setTimeout((()=>wp.fromTo(e,JSON.parse(e.attributes["data-gsap-from"].value),JSON.parse(e.attributes["data-gsap-to"].value))),e.attributes["data-delay"].value)})),n.forEach(((e,t)=>setTimeout((()=>e.classList.remove("hidden")),1+parseInt(e.attributes["data-delay"].value)))),Xg.observe(e.querySelector(".read-more")),"culture"==e.id&&document.querySelectorAll(".emphasis").forEach((e=>{wp.to(e,{opacity:1,css:{backgroundColor:"rgba(255,255,255,0.25)"},duration:.5,rotationY:90,ease:"none",scrollTrigger:{trigger:e,start:"top center"}})}))}Bg.loadingManager.onProgress=(e,t,n)=>Gg.style.width=t/n*100+"%",Bg.loadingManager.onLoad=()=>setTimeout((()=>Hg.classList.add("visible")),500),qg.forEach((e=>{e.onclick=()=>async function(e){Vg.classList.add("hidden");let n="fr"==e?t(Fg):en,i="fr"==e?t(kg):enSources;for(let e in n){let t=n[e];t=t.replaceAll("%s%","<span class='emphasis'>"),t=t.replaceAll("%/%","</span>"),t=t.replaceAll("%br%","<br/>"),document.querySelector(`#${e}`).innerHTML=t}let r=document.querySelector("#sources"),a=0;for(let e in i){let t=i[e];t=t.replaceAll("%i%","<span class='italic'>"),t=t.replaceAll("%/i%","</span>");let n=document.createElement("li");n.classList.add("hidden"),n.setAttribute("data-delay",125+50*a),n.innerHTML=t,r.appendChild(n),a++}setTimeout((()=>Vg.parentElement.removeChild(Vg)),500),setTimeout((()=>Bg.colormapPass.changeOpacity(.5)),700),setTimeout((()=>jg(document.querySelector("#foreword"))),1e3)}(e.attributes["data-lang"].value)}));let Xg=new IntersectionObserver((e=>{e.forEach((e=>{e.isIntersecting&&e.target.classList.add("visible")}))}),{threshold:1});document.querySelectorAll(".read-more").forEach((e=>{let t=[...e.children],n=t.length,i=(r=n,function(e){return 1/(1+Math.exp(-e/r))/1/(1+Math.exp(-r))});var r;for(let e=0;e<n;e++)t[e].style.transitionDelay=1e3*i(e)+"ms";e.onclick=()=>{e.classList.remove("visible"),e.classList.add("clicked"),Wg(e.attributes["data-next"].value)}})),document.querySelector("#toggleColor").onclick=()=>Bg.toggleColormap(),document.querySelector("#changeColor").onclick=()=>{Bg.colormapIndex+=1,Bg.colormapIndex%=Bg.colormaps.size;let e=[...Bg.colormaps.keys()][Bg.colormapIndex];document.querySelector("body").style.backgroundColor=Bg.changeColormap(e)},document.querySelector("#toggleBW").onclick=()=>Bg.enableBlackAndWhite(),document.querySelector("#gsapify").onclick=()=>{wp.fromTo("#beurette1quote",{xPercent:0},{xPercent:200,ease:"none",scrollTrigger:{trigger:"#beurette1quote",start:"top-=100 20%",end:"bottom+=200 top",markers:!0,scrub:1}}),wp.fromTo("#beurette2quote",{xPercent:-200},{xPercent:0,ease:"none",scrollTrigger:{trigger:"#beurette2quote",start:"top-=100 bottom",end:"center 75%",scrub:1}}),wp.fromTo("#imageEugene",{yPercent:0},{yPercent:-100,opacity:0,ease:"none",scrollTrigger:{trigger:"#art",start:"top top",end:"50% 50%",scrub:1}}),wp.fromTo("#imageJeanLeon",{yPercent:20},{yPercent:0,ease:"none",scrollTrigger:{trigger:"#art",start:"center bottom",end:"center+=200 center",scrub:1}})},document.onmousemove=e=>{e.clientX,window.innerWidth,e.clientY,window.innerHeight};
//# sourceMappingURL=index.9d0afd4c.js.map
